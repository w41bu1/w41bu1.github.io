<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="vi">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>CVE-2025-59577 Analysis &amp; POC - Bui Van Y</title><meta name="author" content="Bui Van Y">
<meta name="description" content="Security Vulnerability in WordPress MasterStudy LMS Plugin."><meta name="keywords" content='analyst, plugin, Bypass Vulnerability'>
  <meta itemprop="name" content="CVE-2025-59577 Analysis & POC">
  <meta itemprop="description" content="Security Vulnerability in WordPress MasterStudy LMS Plugin.">
  <meta itemprop="datePublished" content="2026-01-24T19:00:00+07:00">
  <meta itemprop="dateModified" content="2026-01-24T19:00:00+07:00">
  <meta itemprop="wordCount" content="1768">
  <meta itemprop="image" content="http://localhost:1313/posts/2026-01-24-cve-2025-59577/app.png">
  <meta itemprop="keywords" content="Analyst,Plugin,Bypass Vulnerability"><meta property="og:url" content="http://localhost:1313/vi/posts/2026-01-24-cve-2025-59577/">
  <meta property="og:site_name" content="Bui Van Y">
  <meta property="og:title" content="CVE-2025-59577 Analysis & POC">
  <meta property="og:description" content="Security Vulnerability in WordPress MasterStudy LMS Plugin.">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-01-24T19:00:00+07:00">
    <meta property="article:modified_time" content="2026-01-24T19:00:00+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Bypass Vulnerability">
    <meta property="og:image" content="http://localhost:1313/posts/2026-01-24-cve-2025-59577/app.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/posts/2026-01-24-cve-2025-59577/app.png">
  <meta name="twitter:title" content="CVE-2025-59577 Analysis & POC">
  <meta name="twitter:description" content="Security Vulnerability in WordPress MasterStudy LMS Plugin.">
<meta name="application-name" content="Bui Van Y">
<meta name="apple-mobile-web-app-title" content="Bui Van Y"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/svg-spinners--wind-toy.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/vi/posts/2026-01-24-cve-2025-59577/" title="CVE-2025-59577 Analysis &amp; POC - Bui Van Y" /><link rel="prev" type="text/html" href="http://localhost:1313/vi/posts/2026-01-23-cve-2025-10745/" title="CVE-2025-10745 Analysis &amp; POC" /><link rel="alternate" type="text/markdown" href="http://localhost:1313/vi/posts/2026-01-24-cve-2025-59577/index.md" title="CVE-2025-59577 Analysis & POC - Bui Van Y"><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "CVE-2025-59577 Analysis \u0026 POC",
    "inLanguage": "vi",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/vi\/posts\/2026-01-24-cve-2025-59577\/"
    },"image": ["http:\/\/localhost:1313\/images\/avatar.png"],"genre": "posts","keywords": "analyst, plugin, Bypass Vulnerability","wordcount":  1768 ,
    "url": "http:\/\/localhost:1313\/vi\/posts\/2026-01-24-cve-2025-59577\/","datePublished": "2026-01-24T19:00:00+07:00","dateModified": "2026-01-24T19:00:00+07:00","publisher": {
      "@type": "Organization",
      "name": "/images/avatar.png","logo": "http:\/\/localhost:1313\/images\/avatar.png"},"author": {
        "@type": "Person",
        "name": "Bui Van Y"
      },"description": "Security Vulnerability in WordPress MasterStudy LMS Plugin."
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-instant-intensity="viewport" data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="32" width="32"><span class="header-title-text">Bui Van Y</span></a><span class="typeit header-subtitle"><template>w41bu1</template></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Tìm kiếm">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Xoá">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" role="button" aria-label="Đổi chủ đề" title="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></li><li class="menu-item language-switch">
            <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ"><i class="fa-solid fa-language fa-fw" aria-hidden="true"></i></span>
            <ul class="sub-menu"><li class="menu-item"><a href="/posts/2026-01-24-cve-2025-59577/" class="menu-link" title="English">English</a></li><li class="menu-item"><span class="text-secondary" title="Vietnamese">Vietnamese</span></li></ul>
          </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="26" width="26"><span class="header-title-text">Bui Van Y</span></a><span class="typeit header-subtitle"><template>w41bu1</template></span></div>
      <div class="theme-switch" role="button" aria-label="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></div>
      <div class="menu-toggle" id="menu-toggle-mobile" role="button" aria-labelledby="menu-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Tìm kiếm">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Xoá">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              Huỷ
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item menu-system"><span class="menu-system-item language-switch">
              <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ">Vietnamese<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i></span>
              <select id="language-select" class="language-select" onchange="location = this.value;"><option value="/posts/2026-01-24-cve-2025-59577/">English</option><option value="/vi/posts/2026-01-24-cve-2025-59577/" selected disabled>Vietnamese</option></select>
            </span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"><div class="details related-details open">
      <div class="details-summary related-summary">
        <i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden="true"></i>
        <span class="related-title">Nội dung liên quan</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
      <div class="details-content related-content">
        <ul class="related-list"><li class="related-item">
              <a href="/vi/posts/2026-01-23-cve-2025-10745/" title="CVE-2025-10745 Analysis &amp; POC">CVE-2025-10745 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-22-cve-2025-11707/" title="CVE-2025-11707 Analysis &amp; POC">CVE-2025-11707 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-15-cve-2025-12788/" title="CVE-2025-12788 Analysis &amp; POC">CVE-2025-12788 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-14-cve-2025-3102/" title="CVE-2025-3102 Analysis &amp; POC">CVE-2025-3102 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-13-cve-2025-6688/" title="CVE-2025-4796 Analysis &amp; POC">CVE-2025-4796 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-12-cve-2025-4796/" title="CVE-2025-4796 Analysis &amp; POC">CVE-2025-4796 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-11-cve-2025-8059/" title="CVE-2025-8059 Analysis &amp; POC">CVE-2025-8059 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-08-cve-2025-14156/" title="CVE-2025-2563 Analysis &amp; POC">CVE-2025-2563 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-07-cve-2025-2563/" title="CVE-2025-2563 Analysis &amp; POC">CVE-2025-2563 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-06-cve-2025-7654/" title="CVE-2025-7654 Analysis &amp; POC">CVE-2025-7654 Analysis &amp; POC</a></li></ul>
      </div>
    </div></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>CVE-2025-59577 Analysis &amp; POC</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="github.com/w41bu1" title="Tác giả" rel=" author" class="author"><img class="avatar" src='/images/avatar.png' alt="Bui Van Y" height="16" width="16">&nbsp;Bui Van Y</a></span><span class="post-included-in">&nbsp;trong <a href="/vi/categories/cve-analysis/" class="post-category" title="Danh mục - CVE Analysis"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> CVE Analysis</a></span></div><div class="post-meta-line"><span title="đăng ngày 2026-01-24 19:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2026-01-24">2026-01-24</time></span>&nbsp;<span title="1768 từ"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>Khoảng 1800 từ</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>9 phút</span>&nbsp;</div>
    </div><div class="featured-image"><img loading="eager" src='/posts/2026-01-24-cve-2025-59577/app.png' sizes="(max-width: 680px) 100vw, (max-width: 960px) 80vw, (max-width: 1440px) 56vw, 800px" alt="/posts/2026-01-24-cve-2025-59577/app.png" height="500" width="1544"></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Nội dung</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#cve--basic-info">CVE &amp; Basic Info</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#analysis">Analysis</a></li>
    <li><a href="#flow">Flow</a></li>
    <li><a href="#proof-of-concept-poc">Proof of Concept (PoC)</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#key-takeaways">Key Takeaways</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h2 class="heading-element" id="cve--basic-info"><span>CVE &amp; Basic Info</span>
  <a href="#cve--basic-info" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Lỗ hổng <strong>Thực thi đồng thời sử dụng tài nguyên dùng chung nhưng đồng bộ không đúng cách (Race Condition)</strong> trong <strong>Stylemix MasterStudy LMS</strong> cho phép khai thác điều kiện tranh chấp. Lỗ hổng này ảnh hưởng đến MasterStudy LMS từ các phiên bản trước đến <strong>3.6.20</strong>.</p>
<ul>
<li><strong>CVE ID</strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2025-59577" target="_blank" rel="external nofollow noopener noreferrer">CVE-2025-59577</a></li>
<li><strong>Vulnerability Type</strong>: Bypass Vulnerability</li>
<li><strong>Affected Versions</strong>: &lt;= 3.6.20</li>
<li><strong>Patched Versions</strong>: 3.6.21</li>
<li><strong>CVSS severity</strong>: Low (4.3)</li>
<li><strong>Required Privilege</strong>: Unauthenticated</li>
<li><strong>Product</strong>: <a href="https://wordpress.org/plugins/login-lockdown/" target="_blank" rel="external nofollow noopener noreferrer">WordPress MasterStudy LMS Plugin</a></li>
</ul>
<h2 class="heading-element" id="requirements"><span>Requirements</span>
  <a href="#requirements" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li><strong>Local WordPress &amp; Debugging</strong>
<ul>
<li><a href="https://w41bu1.github.io/posts/2025-08-21-wordpress-local-and-debugging/" target="_blank" rel="external nofollow noopener noreferrer">Virtual Machine</a></li>
<li><a href="https://w41bu1.github.io/posts/2025-10-22-wordpress-local-and-debugging-docker/" target="_blank" rel="external nofollow noopener noreferrer">Docker</a></li>
</ul>
</li>
<li><strong>Plugin Version</strong> - <strong>MasterStudy LMS</strong>:
<ul>
<li><code>3.6.20</code> – <strong>vulnerable</strong></li>
<li><code>3.6.21</code> – <strong>patched</strong></li>
</ul>
</li>
<li><strong>Diff Tool (diff)</strong> → <a href="https://meldmerge.org/" target="_blank" rel="external nofollow noopener noreferrer"><strong>Meld</strong></a> hoặc bất kỳ công cụ diff nào.</li>
</ul>
<h2 class="heading-element" id="analysis"><span>Analysis</span>
  <a href="#analysis" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Plugin đã đăng ký action hook:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">add_action</span><span class="p">(</span> <span class="s1">&#39;wp_ajax_stm_lms_add_review&#39;</span><span class="p">,</span> <span class="s1">&#39;STM_LMS_Reviews::add_review&#39;</span><span class="p">,</span> <span class="mi">100</span> <span class="p">);</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p><code>wp_ajax_</code> là hook dành cho người đùng đã đăng nhập, khi có request gửi đến <code>/wp-admin/admin-ajax.php</code> với param <code>action=stm_lms_add_review</code> thì callback <code>add_review()</code> được gọi:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true" title="reviews.php v3.6.20" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">reviews.php v3.6.20</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="hl"><span class="lnt">43
</span></span><span class="lnt">44
</span><span class="lnt">45
</span><span class="hl"><span class="lnt">46
</span></span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">add_review</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">check_ajax_referer</span><span class="p">(</span> <span class="s1">&#39;stm_lms_add_review&#39;</span><span class="p">,</span> <span class="s1">&#39;nonce&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;post_id&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$course_id</span> <span class="o">=</span> <span class="nx">intval</span><span class="p">(</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;post_id&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">is_user_logged_in</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$error_message</span> <span class="o">=</span> <span class="nx">wp_kses_post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="nx">sprintf</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nx">__</span><span class="p">(</span> <span class="s1">&#39;Please, &lt;a href=&#34;%s&#34; class=&#34;masterstudy-single-course-reviews__login-link&#34; target=&#34;_blank&#34;&gt;login&lt;/a&gt; to leave a review&#39;</span><span class="p">,</span> <span class="s1">&#39;masterstudy-lms-learning-management-system&#39;</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="nx">esc_url</span><span class="p">(</span> <span class="nx">STM_LMS_User</span><span class="o">::</span><span class="na">login_page_url</span><span class="p">()</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nx">STM_LMS_Course</span><span class="o">::</span><span class="na">check_course_author</span><span class="p">(</span> <span class="nv">$course_id</span><span class="p">,</span> <span class="nx">get_current_user_id</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$error_message</span> <span class="o">=</span> <span class="nx">esc_html__</span><span class="p">(</span> <span class="s1">&#39;You can\&#39;t leave a review for your own course&#39;</span><span class="p">,</span> <span class="s1">&#39;masterstudy-lms-learning-management-system&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$error_message</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">wp_send_json</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;error&#39;</span>   <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nv">$error_message</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$mark</span>   <span class="o">=</span> <span class="p">(</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;mark&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">intval</span><span class="p">(</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;mark&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$review</span> <span class="o">=</span> <span class="p">(</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">wp_kses_post</span><span class="p">(</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">STM_LMS_Options</span><span class="o">::</span><span class="na">get_option</span><span class="p">(</span> <span class="s1">&#39;course_allow_review&#39;</span><span class="p">,</span> <span class="k">true</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">STM_LMS_User</span><span class="o">::</span><span class="na">has_course_access</span><span class="p">(</span> <span class="nv">$course_id</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$r</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;error&#39;</span>   <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nx">esc_html__</span><span class="p">(</span> <span class="s1">&#39;You must purchase the course to leave a review&#39;</span><span class="p">,</span> <span class="s1">&#39;masterstudy-lms-learning-management-system&#39;</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">            <span class="nv">$r</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">create</span><span class="p">(</span> <span class="nv">$course_id</span><span class="p">,</span> <span class="nv">$mark</span><span class="p">,</span> <span class="nv">$review</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="nv">$r</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">create</span><span class="p">(</span> <span class="nv">$course_id</span><span class="p">,</span> <span class="nv">$mark</span><span class="p">,</span> <span class="nv">$review</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">wp_send_json</span><span class="p">(</span> <span class="nv">$r</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><p>Trong <code>add_review()</code>, plugin thực hiện một loạt các kiểm tra:</p>
<ul>
<li>Kiểm tra nonce (chống <strong>CSRF</strong>)</li>
<li>Kiểm tra đã đăng nhập hay chưa</li>
<li>Không cho giảng viên tự review khóa học của mình</li>
<li>Kiểm tra người dùng đã mua khóa học hay chưa (nếu cấu hình yêu cầu)</li>
</ul>
<p>Sau khi các điều kiện này hợp lệ, hàm không tự xử lý việc tạo review, mà chuyển toàn bộ sang:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$r</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">create</span><span class="p">(</span> <span class="nv">$course_id</span><span class="p">,</span> <span class="nv">$mark</span><span class="p">,</span> <span class="nv">$review</span> <span class="p">);</span></span></span></code></pre></td></tr></table></div>
</div>
</div><div class="code-block highlight" data-mode="classic" data-copyable="true" title="reviews.php v3.6.20" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">reviews.php v3.6.20</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="hl"><span class="lnt">15
</span></span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="hl"><span class="lnt">63
</span></span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="hl"><span class="lnt">72
</span></span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">create</span><span class="p">(</span> <span class="nv">$course_id</span><span class="p">,</span> <span class="nv">$mark</span><span class="p">,</span> <span class="nv">$review</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$current_user</span> <span class="o">=</span> <span class="nx">STM_LMS_User</span><span class="o">::</span><span class="na">get_current_user</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$current_user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">die</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$user_id</span> <span class="o">=</span> <span class="nv">$current_user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nv">$r</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			<span class="s1">&#39;error&#39;</span>   <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="s1">&#39;status&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nx">esc_html__</span><span class="p">(</span> <span class="s1">&#39;Your review is moderating.&#39;</span><span class="p">,</span> <span class="s1">&#39;masterstudy-lms-learning-management-system&#39;</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="cm">/*Check if user has review*/</span>
</span></span><span class="line hl"><span class="cl">		<span class="nv">$prev_reviews</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">get_user_review_on_course</span><span class="p">(</span> <span class="nv">$course_id</span><span class="p">,</span> <span class="nv">$user_id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span> <span class="nv">$prev_reviews</span><span class="o">-&gt;</span><span class="na">found_posts</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$r</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;error&#39;</span>   <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;status&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nx">esc_html__</span><span class="p">(</span> <span class="s1">&#39;You already left review.&#39;</span><span class="p">,</span> <span class="s1">&#39;masterstudy-lms-learning-management-system&#39;</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$mark</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$r</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;error&#39;</span>   <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;status&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nx">esc_html__</span><span class="p">(</span> <span class="s1">&#39;Please, check rating&#39;</span><span class="p">,</span> <span class="s1">&#39;masterstudy-lms-learning-management-system&#39;</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$review</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$r</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;error&#39;</span>   <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;status&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nx">esc_html__</span><span class="p">(</span> <span class="s1">&#39;Please, write review.&#39;</span><span class="p">,</span> <span class="s1">&#39;masterstudy-lms-learning-management-system&#39;</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span> <span class="nv">$mark</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nv">$mark</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span> <span class="nv">$mark</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nv">$mark</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="cm">/* Create post object*/</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$my_review</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;post_type&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;stm-reviews&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;post_title&#39;</span>   <span class="o">=&gt;</span> <span class="nx">wp_strip_all_tags</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">					<span class="nx">sprintf</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">						<span class="cm">/* translators: %s: string */</span>
</span></span><span class="line"><span class="cl">						<span class="nx">esc_html__</span><span class="p">(</span> <span class="s1">&#39;Review on %1$s by %2$s&#39;</span><span class="p">,</span> <span class="s1">&#39;masterstudy-lms-learning-management-system&#39;</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">get_the_title</span><span class="p">(</span> <span class="nv">$course_id</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">						<span class="nv">$current_user</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">					<span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">),</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;post_content&#39;</span> <span class="o">=&gt;</span> <span class="nv">$review</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;post_status&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;pending&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">			<span class="nv">$review_id</span> <span class="o">=</span> <span class="nx">wp_insert_post</span><span class="p">(</span> <span class="nv">$my_review</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="nv">$meta_fields</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;review_course&#39;</span> <span class="o">=&gt;</span> <span class="nv">$course_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;review_user&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;review_mark&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$mark</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">foreach</span> <span class="p">(</span> <span class="nv">$meta_fields</span> <span class="k">as</span> <span class="nv">$meta_key</span> <span class="o">=&gt;</span> <span class="nv">$meta_value</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">				<span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$review_id</span><span class="p">,</span> <span class="nv">$meta_key</span><span class="p">,</span> <span class="nv">$meta_value</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="nv">$course_title</span> <span class="o">=</span> <span class="nx">get_the_title</span><span class="p">(</span> <span class="nv">$course_id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$login</span>        <span class="o">=</span> <span class="nv">$current_user</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="nx">STM_LMS_Helpers</span><span class="o">::</span><span class="na">send_email</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;admin&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="nx">esc_html__</span><span class="p">(</span> <span class="s1">&#39;New Review&#39;</span><span class="p">,</span> <span class="s1">&#39;masterstudy-lms-learning-management-system&#39;</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">				<span class="nx">sprintf</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">					<span class="cm">/* translators: %s: string */</span>
</span></span><span class="line"><span class="cl">					<span class="nx">esc_html__</span><span class="p">(</span> <span class="s1">&#39;Check out new review on course %1$s by %2$s&#39;</span><span class="p">,</span> <span class="s1">&#39;masterstudy-lms-learning-management-system&#39;</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">					<span class="nv">$course_title</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nv">$login</span>
</span></span><span class="line"><span class="cl">				<span class="p">),</span>
</span></span><span class="line"><span class="cl">				<span class="s1">&#39;stm_lms_new_review&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="nx">compact</span><span class="p">(</span> <span class="s1">&#39;course_title&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="nx">delete_transient</span><span class="p">(</span> <span class="nx">STM_LMS_Instructor</span><span class="o">::</span><span class="na">transient_name</span><span class="p">(</span> <span class="nv">$current_user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="s1">&#39;rating&#39;</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nv">$r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><p>Trong <code>create()</code>, plugin kiểm tra xem người dùng đã từng review khóa học này hay chưa:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$prev_reviews</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">get_user_review_on_course</span><span class="p">(</span> <span class="nv">$course_id</span><span class="p">,</span> <span class="nv">$user_id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="nv">$prev_reviews</span><span class="o">-&gt;</span><span class="na">found_posts</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Nếu chưa có review, plugin tiếp tục:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$review_id</span> <span class="o">=</span> <span class="nx">wp_insert_post</span><span class="p">(</span> <span class="nv">$my_review</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">update_post_meta</span><span class="p">(</span><span class="o">...</span><span class="p">)</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Tuy nhiên, không có bất kỳ <strong>lock</strong> hay <strong>transaction</strong> nào để đảm bảo rằng trạng thái <code>“chưa có review”</code> vẫn còn đúng tại thời điểm ghi dữ liệu.</p>
<p><strong>Kịch bản Race Condition thực tế</strong>:</p>
<p>Giả sử người dùng gửi <strong>hai request song song</strong>:</p>
<ul>
<li>Request A kiểm tra: chưa có review =&gt; hợp lệ</li>
<li>Request B kiểm tra: chưa có review =&gt; hợp lệ</li>
<li>Request A tạo review</li>
<li>Request B cũng tạo review</li>
</ul>
<p>Kết quả: Database xuất hiện hai review cho cùng user và cùng khóa học, dù logic hệ thống chỉ cho phép một review.</p>
<div class="alert alert-note"><p class="alert-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8-6.5a6.5 6.5.0 100 13 6.5 6.5.0 000-13zM6.5 7.75A.75.75.0 017.25 7h1a.75.75.0 01.75.75v2.75h.25a.75.75.0 010 1.5h-2a.75.75.0 010-1.5h.25v-2h-.25a.75.75.0 01-.75-.75zM8 6a1 1 0 110-2 1 1 0 010 2z"/></svg>Ghi chú</p><p>Để có thể tạo review, trước hết cần đăng ký và đăng nhập bằng tài khoản <strong>student</strong> tại:
<code>http://localhost/user-account/</code></p>
<p>Hệ thống sẽ yêu cầu đăng nhập để thực hiện chức năng review này.</p>
<p><figure><a class="lightgallery" target="_blank" href="/posts/2026-01-24-cve-2025-59577/login.png" title="Yêu cầu login trước khi review" data-thumbnail="/posts/2026-01-24-cve-2025-59577/login.png" data-sub-html="<h2>Login</h2><p>Yêu cầu login trước khi review</p>"><img loading="lazy" src='/posts/2026-01-24-cve-2025-59577/login.png' alt="Login" height="584" width="1233"></a><figcaption class="image-caption">Yêu cầu login trước khi review</figcaption>
  </figure></p></div><h2 class="heading-element" id="flow"><span>Flow</span>
  <a href="#flow" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="diagram-container">
  <pre class="mermaid">flowchart TD
A["User sends AJAX request: action=stm_lms_add_review"] --> B["add_review() is executed"]

B --> C["Check nonce (CSRF protection)"]
C --> D["Check user is logged in"]
D --> E["Check user is not the course author"]
E --> F["Check course access / purchase requirement"]

F --> G["Call create(course_id, mark, review)"]

G --> H["Query DB: has this user already reviewed this course?"]

H --> I{"Existing review found?"}
I -->|Yes| J["Return error: already reviewed"]
I -->|No| K["Proceed to create review"]

K --> L["wp_insert_post(): create review post"]
L --> M["update_post_meta(): save course_id, user_id, rating"]
M --> N["Return success response"]

%% Race condition point
H -.->|"Multiple parallel requests see no existing review"| K</pre>
  <pre class="mermaid-dark">flowchart TD
A["User sends AJAX request: action=stm_lms_add_review"] --> B["add_review() is executed"]

B --> C["Check nonce (CSRF protection)"]
C --> D["Check user is logged in"]
D --> E["Check user is not the course author"]
E --> F["Check course access / purchase requirement"]

F --> G["Call create(course_id, mark, review)"]

G --> H["Query DB: has this user already reviewed this course?"]

H --> I{"Existing review found?"}
I -->|Yes| J["Return error: already reviewed"]
I -->|No| K["Proceed to create review"]

K --> L["wp_insert_post(): create review post"]
L --> M["update_post_meta(): save course_id, user_id, rating"]
M --> N["Return success response"]

%% Race condition point
H -.->|"Multiple parallel requests see no existing review"| K</pre>
  <pre class="mermaid-neutral">flowchart TD
A["User sends AJAX request: action=stm_lms_add_review"] --> B["add_review() is executed"]

B --> C["Check nonce (CSRF protection)"]
C --> D["Check user is logged in"]
D --> E["Check user is not the course author"]
E --> F["Check course access / purchase requirement"]

F --> G["Call create(course_id, mark, review)"]

G --> H["Query DB: has this user already reviewed this course?"]

H --> I{"Existing review found?"}
I -->|Yes| J["Return error: already reviewed"]
I -->|No| K["Proceed to create review"]

K --> L["wp_insert_post(): create review post"]
L --> M["update_post_meta(): save course_id, user_id, rating"]
M --> N["Return success response"]

%% Race condition point
H -.->|"Multiple parallel requests see no existing review"| K</pre><div class="diagram-copy-btn" aria-label="Copy Mermaid code" role="button"><i class="fa-regular fa-clone" aria-hidden="true"></i></div>
<template><pre>flowchart TD
A["User sends AJAX request: action=stm_lms_add_review"] --> B["add_review() is executed"]

B --> C["Check nonce (CSRF protection)"]
C --> D["Check user is logged in"]
D --> E["Check user is not the course author"]
E --> F["Check course access / purchase requirement"]

F --> G["Call create(course_id, mark, review)"]

G --> H["Query DB: has this user already reviewed this course?"]

H --> I{"Existing review found?"}
I -->|Yes| J["Return error: already reviewed"]
I -->|No| K["Proceed to create review"]

K --> L["wp_insert_post(): create review post"]
L --> M["update_post_meta(): save course_id, user_id, rating"]
M --> N["Return success response"]

%% Race condition point
H -.->|"Multiple parallel requests see no existing review"| K</pre></template>
</div><h2 class="heading-element" id="proof-of-concept-poc"><span>Proof of Concept (PoC)</span>
  <a href="#proof-of-concept-poc" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ol>
<li>Đăng ký và đăng nhập bằng tài khoản <strong>student</strong>.</li>
<li>Truy cập vào một khóa học bất kỳ, bật <strong>Intercept</strong> trên Burp Suite.</li>
<li>Thực hiện gửi review, bắt request và <strong>Send to Turbo Intruder</strong>, sau đó <strong>drop</strong> request gốc.</li>
<li>Trong Turbo Intruder, chỉnh sửa script như sau để gửi nhiều request song song:</li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-py"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">queueRequests</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">wordlists</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">engine</span> <span class="o">=</span> <span class="n">RequestEngine</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">endpoint</span><span class="o">=</span><span class="n">target</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">concurrentConnections</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">requestsPerConnection</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">pipeline</span><span class="o">=</span><span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">engine</span><span class="o">.</span><span class="n">queue</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">handleResponse</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">interesting</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">table</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">req</span><span class="p">)</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><ol start="5">
<li>Nhấn <strong>Attack</strong> để bắt đầu gửi các request đồng thời và quan sát kết quả (nhiều review được tạo cùng lúc).</li>
</ol>
<p><figure><a class="lightgallery" target="_blank" href="/posts/2026-01-24-cve-2025-59577/result.png" title="Result" data-thumbnail="/posts/2026-01-24-cve-2025-59577/result.png" data-sub-html="<h2>Result</h2><p>Result</p>"><img loading="lazy" src='/posts/2026-01-24-cve-2025-59577/result.png' alt="Result" height="971" width="1122"></a><figcaption class="image-caption">Result</figcaption>
  </figure></p>
<h2 class="heading-element" id="conclusion"><span>Conclusion</span>
  <a href="#conclusion" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Lỗ hổng xảy ra do plugin sử dụng mô hình <strong>kiểm tra trước rồi mới ghi (check-then-insert)</strong> nhưng không có bất kỳ cơ chế <strong>lock</strong> hay <strong>transaction</strong> nào ở mức cơ sở dữ liệu. Khi nhiều request AJAX được gửi song song, tất cả đều có thể vượt qua bước “chưa có review” trước khi bất kỳ request nào kịp ghi dữ liệu, dẫn đến việc cùng một người dùng có thể tạo nhiều review cho cùng một khóa học. Điều này phá vỡ logic nghiệp vụ vốn chỉ cho phép mỗi người dùng để lại một review cho mỗi khóa học.</p>
<h2 class="heading-element" id="key-takeaways"><span>Key Takeaways</span>
  <a href="#key-takeaways" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li>Race Condition có thể xảy ra ngay cả khi đã có đầy đủ kiểm tra đăng nhập và phân quyền.</li>
<li>Logic “kiểm tra rồi mới ghi” cần được bảo vệ bằng <strong>lock</strong> hoặc <strong>transaction</strong> khi có khả năng xử lý song song.</li>
<li>Các endpoint AJAX rất dễ bị khai thác race condition vì attacker có thể gửi nhiều request đồng thời.</li>
<li>Việc ngăn trùng lặp nên được đảm bảo ở mức <strong>database</strong> (unique constraint) hoặc bằng cơ chế khóa rõ ràng trong code.</li>
</ul>
<h2 class="heading-element" id="references"><span>References</span>
  <a href="#references" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><a href="https://patchstack.com/academy/wordpress/vulnerabilities/race-condition/" target="_blank" rel="external nofollow noopener noreferrer">Race Condition</a></p>
<p><a href="https://patchstack.com/database/wordpress/plugin/masterstudy-lms-learning-management-system/vulnerability/wordpress-masterstudy-lms-plugin-3-6-20-race-condition-vulnerability" target="_blank" rel="external nofollow noopener noreferrer">WordPress MasterStudy LMS Plugin &lt;= 3.6.20 is vulnerable to Race Condition</a></p></div><hr class="awesome-hr" />
    <h2 id="see-also">Nội dung liên quan</h2>
    <ul><li>
          <a href="/vi/posts/2026-01-23-cve-2025-10745/" title="CVE-2025-10745 Analysis &amp; POC">CVE-2025-10745 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-22-cve-2025-11707/" title="CVE-2025-11707 Analysis &amp; POC">CVE-2025-11707 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-15-cve-2025-12788/" title="CVE-2025-12788 Analysis &amp; POC">CVE-2025-12788 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-14-cve-2025-3102/" title="CVE-2025-3102 Analysis &amp; POC">CVE-2025-3102 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-13-cve-2025-6688/" title="CVE-2025-4796 Analysis &amp; POC">CVE-2025-4796 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-12-cve-2025-4796/" title="CVE-2025-4796 Analysis &amp; POC">CVE-2025-4796 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-11-cve-2025-8059/" title="CVE-2025-8059 Analysis &amp; POC">CVE-2025-8059 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-08-cve-2025-14156/" title="CVE-2025-2563 Analysis &amp; POC">CVE-2025-2563 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-07-cve-2025-2563/" title="CVE-2025-2563 Analysis &amp; POC">CVE-2025-2563 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-06-cve-2025-7654/" title="CVE-2025-7654 Analysis &amp; POC">CVE-2025-7654 Analysis &amp; POC</a></li></ul><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="Cập nhật ngày 2026-01-24 19:00:00">Cập nhật ngày 2026-01-24&nbsp;</span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"><span><a href="/vi/posts/2026-01-24-cve-2025-59577/index.md" title="Đọc với định dạng Markdown" class="link-to-markdown">Đọc với định dạng Markdown</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2026-01-24-CVE-2025-59577/index.vi.md?plain=1" title="Xem mã nguồn" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-source">Xem mã nguồn</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/edit/main/content/posts/2026-01-24-CVE-2025-59577/index.vi.md" title="Chỉnh sửa trang này" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-edit">Chỉnh sửa trang này</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/issues/new?title=[BUG]%20CVE-2025-59577&#43;Analysis&#43;%26&#43;POC&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cCVE-2025-59577&#43;Analysis&#43;%26&#43;POC%7c%0A%7cURL%7chttp://localhost:1313/vi/posts/2026-01-24-cve-2025-59577/%7c%0A%7cFilename%7chttps://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2026-01-24-CVE-2025-59577/index.vi.md?plain=1%7c" title="Báo cáo lỗi" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-report">Báo cáo lỗi</a></span><span><a href="vscode://file//home/w41/Project/w41bu1.github.io/content/posts/2026-01-24-CVE-2025-59577/index.vi.md" title="Mở trong trình chỉnh sửa" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-vscode">Mở trong trình chỉnh sửa</a></span></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="Chia sẻ trên X" data-sharer="twitter" data-url="http://localhost:1313/vi/posts/2026-01-24-cve-2025-59577/" data-title="CVE-2025-59577 Analysis &amp; POC" data-hashtags="analyst,plugin,Bypass Vulnerability"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Facebook" data-sharer="facebook" data-url="http://localhost:1313/vi/posts/2026-01-24-cve-2025-59577/" data-hashtag="analyst"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/vi/posts/2026-01-24-cve-2025-59577/"><i class="fa-brands fa-linkedin fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/vi/posts/2026-01-24-cve-2025-59577/" data-title="CVE-2025-59577 Analysis &amp; POC"><i class="fa-brands fa-hacker-news fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/vi/tags/analyst/" class="post-tag" title="Nhãn - Analyst">Analyst</a><a href="/vi/tags/plugin/" class="post-tag" title="Nhãn - Plugin">Plugin</a><a href="/vi/tags/bypass-vulnerability/" class="post-tag" title="Nhãn - Bypass Vulnerability">Bypass Vulnerability</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">Quay lại</a></span>&nbsp;|&nbsp;<span><a href="/vi/">Trang chủ</a></span>
    </section>
  </div><div class="post-nav"><a href="/vi/posts/2026-01-23-cve-2025-10745/" class="post-nav-item" rel="prev" title="CVE-2025-10745 Analysis &amp; POC"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>CVE-2025-10745 Analysis &amp; POC</a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Nội dung"><h2 class="toc-title">Nội dung&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside><dialog id="toc-dialog" aria-labelledby="toc-dialog-title" role="dialog">
      <div class="toc">
        <h2 class="toc-title">Nội dung</h2>
        <div class="toc-content" id="toc-content-drawer"><nav >
  <ul>
    <li><a href="#cve--basic-info">CVE &amp; Basic Info</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#analysis">Analysis</a></li>
    <li><a href="#flow">Flow</a></li>
    <li><a href="#proof-of-concept-poc">Proof of Concept (PoC)</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#key-takeaways">Key Takeaways</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div>
    </dialog></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2026</span><span class="author" itemprop="copyrightHolder">
              <a href="github.com/w41bu1">Bui Van Y</a></span><span class="license footer-divider">w41bu1</span></div><div class="footer-line statistics"></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='Tổng khách truy cập'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='Tổng lượt truy cập'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div><div class="footer-line beian"><span class="gov"><i class="fa-solid fa-user-secret"></i></span><span class="icp footer-divider"><i class="fa-solid fa-bug"></i></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons"><div class="fixed-button back-to-top animate__faster d-none" role="button" aria-label="Lên trên"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><svg viewBox="0 0 100 100">
              <circle class="bg" cx="50" cy="50" r="50"></circle>
              <circle class="progress" cx="50" cy="50" r="50"></circle>
            </svg></div><div id="toc-drawer-button" class="fixed-button toc-drawer-button d-none" role="button" aria-label="Nội dung"><i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i></div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">Trang web này hoạt động tốt nhất khi JavaScript được kích hoạt.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/cell-watermark/watermark.min.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script src="/vi/js/config/631c6b0c2ba517fb8995186d1cc47f3e.js" defer></script><script src="/js/lib/mermaid.js" type="module"></script><script src="/js/theme.min.js" defer></script><script src="/js/flyfish.min.js" defer></script></body>
</html>
