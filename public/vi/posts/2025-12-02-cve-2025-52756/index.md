# CVE-2025-52756 Analysis & POC


<!--more-->

## CVE & Basic Info
L·ªó h·ªïng **Improper Control of Generation of Code ('Code Injection')** trong plugin Sayan Datta **WP Last Modified Info (wp-last-modified-info)** cho ph√©p **Remote Code Inclusion**. V·∫•n ƒë·ªÅ n√†y ·∫£nh h∆∞·ªüng ƒë·∫øn **WP Last Modified Info** t·ª´ **n/a** ƒë·∫øn **<= 1.9.2**.

* **CVE ID**: [CVE-2025-52756](https://www.cve.org/CVERecord?id=CVE-2025-52756)
* **Vulnerability Type**: Remote Code Execution
* **Affected Versions**: <= 1.9.4
* **Patched Versions**: 1.9.5
* **CVSS severity**: Medium (7.2)
* **Required Privilege**: Contributor
* **Product**: [WordPress WP Last Modified Info Plugin](https://wordpress.org/plugins/wp-last-modified-info/)

## Requirements
* **Local WordPress & Debugging**
    * [Virtual Machine](https://w41bu1.github.io/posts/2025-08-21-wordpress-local-and-debugging/)
    * [Docker](https://w41bu1.github.io/posts/2025-10-22-wordpress-local-and-debugging-docker/)
* **Plugin Version** - **WP Last Modified Info**:  
    * `1.9.4` ‚Äì **vulnerable**  
    * `1.9.5` ‚Äì **patched**
* **Diff Tool (diff)** ‚Üí [**Meld**](https://meldmerge.org/) ho·∫∑c b·∫•t k·ª≥ c√¥ng c·ª• diff n√†o.

## Cause
**Trong phi√™n b·∫£n l·ªói (v1.9.4):**

```php {title="Shortcode.php v1.9.4" data-open=true hl_lines=[24,36]}
public function render( $atts ) {
    $post = get_post();
    if ( ! $post instanceof \WP_Post ) {
        return '';
    }

    if ( ! $this->is_enabled( 'enable_last_modified_cb' ) ) {
        return '';
    }

    $author_id = $this->get_meta( $post->ID, '_edit_last' );
    if ( $this->is_equal( 'show_author_cb', 'custom', 'default' ) ) {
        $author_id = $this->get_data( 'lmt_show_author_list' );
    }
    
    $default_format = get_option( 'date_format' );
    $atts = shortcode_atts( [
        'id'           => $post->ID,
        'template'     => $this->get_data( 'lmt_last_modified_info_template' ),
        'date_format'  => $this->get_data( 'lmt_date_time_format', $default_format ),
        'date_type'    => $this->get_data( 'lmt_last_modified_format_post', 'default' ),
        'schema'       => $this->get_data( 'lmt_enable_jsonld_markup_cb', 'disable' ),
        'author_id'    => (int) $author_id,
        'hide_archive' => '',
        'filter_ids'   => '',
        'gap'          => (int) $this->get_data( 'lmt_gap_on_post', 0 ),
    ], $atts, 'lmt-post-modified-info' );

    $_post = get_post( absint( $atts['id'] ) );
    if ( ! $_post ) {
        return '';
    }

    if ( $atts['hide_archive'] !== '' ) {
        foreach ( array_map( 'trim', explode( ',', $atts['hide_archive'] ) ) as $callback ) {
            if ( is_callable( $callback ) && $callback() ) {
                return '';
            }
        }
    }
    ...
}
```

H√†m `render()` c·ªßa shortcode cho ph√©p nh·∫≠n thu·ªôc t√≠nh `$atts['hide_archive']` t·ª´ ng∆∞·ªùi d√πng. Gi√° tr·ªã n√†y l√† m·ªôt chu·ªói ch·ª©a **danh s√°ch c√°c t√™n h√†m**, ƒë∆∞·ª£c ngƒÉn c√°ch b·ªüi d·∫•u ph·∫©y (`,`).

V√≠ d·ª•:

```php
$atts['hide_archive'] = "a,b,c";
```

Khi ƒë√≥:

```php
explode(',', $atts['hide_archive']) 
‚Üí ['a', 'b', 'c']
```

Sau khi t√°ch chu·ªói b·∫±ng `explode()`, ƒëo·∫°n code d√πng:

```php
array_map('trim', ...)
```

ƒë·ªÉ **xo√° kho·∫£ng tr·∫Øng th·ª´a** ·ªü ƒë·∫ßu/ng∆∞·ªùi m·ªói ph·∫ßn t·ª≠, ƒë·∫£m b·∫£o t√™n h√†m ‚Äús·∫°ch‚Äù tr∆∞·ªõc khi x·ª≠ l√Ω. K·∫øt qu·∫£ v·∫´n l√† m·ªôt m·∫£ng c√°c chu·ªói, nh∆∞ng ƒë√£ ƒë∆∞·ª£c chu·∫©n ho√°:

```
[" a ", " b ", " c "] ‚Üí ["a", "b", "c"]
```

Ti·∫øp theo, v√≤ng l·∫∑p `foreach` duy·ªát t·ª´ng ph·∫ßn t·ª≠ v√† g√°n v√†o bi·∫øn `$callback`. T·∫°i ƒë√¢y, `$callback` ch√≠nh l√† **t√™n m·ªôt h√†m d∆∞·ªõi d·∫°ng chu·ªói**.

```php
foreach ( ... as $callback ) 
```

V·ªõi m·ªói `$callback`, code ki·ªÉm tra:

```php
is_callable( $callback )
```

ƒêi·ªÅu n√†y c√≥ nghƒ©a l√†:
üëâ T√™n h√†m n√†y **c√≥ t·ªìn t·∫°i v√† c√≥ th·ªÉ g·ªçi ƒë∆∞·ª£c hay kh√¥ng**.

N·∫øu ƒë√∫ng, ƒëo·∫°n code ti·∫øp t·ª•c g·ªçi tr·ª±c ti·∫øp h√†m ƒë√≥:

```php
$callback()
```

Kh√¥ng c√≥ tham s·ªë n√†o ƒë∆∞·ª£c truy·ªÅn v√†o. N·∫øu h√†m ƒë∆∞·ª£c g·ªçi tr·∫£ v·ªÅ `true` th√¨ plugin s·∫Ω:

```php
return '';
```

v√† **kh√¥ng hi·ªÉn th·ªã b·∫•t k·ª≥ n·ªôi dung n√†o c·ªßa shortcode**.

**B·∫£n v√° (v1.9.5):** 

![Diff](diff.png "S·ª± thay ƒë·ªïi c·ªßa b·∫£n v√°")

B·∫£n v√° ƒë√£ d√πng whitelist cho c√°c function => Tr√°nh g·ªçi h√†m tu·ª≥ √Ω.

```php {title="Shortcode.php v1.9.5" data-open=true hl_lines=[]}
class Shortcode extends PostView {
    ...
    if ( in_array( $archive, $this->functions, true ) && is_callable( $archive ) && $archive() ) {
        return $content;
    }
    ...
}
```

```php {title="PostView.php v1.9.5" data-open=true hl_lines=[]}
class PostView {
    protected $functions = [
        'is_archive',
        'is_tax',
        'is_home',
        'is_front_page',
        'is_search',
        'is_404',
        'is_author',
        'is_category',
        'is_tag',
    ];
    ...
}
```

V√¨ class `ShortCode` k·∫ø th·ª´a `PostView` n√™n c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë∆∞·ª£c `$functions` c·ªßa l·ªõp cha.

## Analysis
Plugin ƒë√£ ƒëƒÉng k√Ω m·ªôt shortcode b·∫±ng d√≤ng l·ªánh:

```php
add_shortcode( 'lmt-post-modified-info', [ $this, 'render' ] );
```

ƒêi·ªÅu n√†y c√≥ nghƒ©a l√†:
khi WordPress g·∫∑p shortcode c√≥ tag **`lmt-post-modified-info`** trong n·ªôi dung b√†i vi·∫øt (ho·∫∑c khi b√†i vi·∫øt ƒë∆∞·ª£c hi·ªÉn th·ªã v√† c√≥ ch·ª©a shortcode n√†y), WordPress s·∫Ω **g·ªçi ph∆∞∆°ng th·ª©c `render()` c·ªßa class hi·ªán t·∫°i** ƒë·ªÉ x·ª≠ l√Ω v√† tr·∫£ v·ªÅ n·ªôi dung t∆∞∆°ng ·ª©ng.

ƒê·ªÉ c√°c logic c·ªßa render ƒë∆∞·ª£c g·ªçi ta c·∫ßn ph·∫£i v∆∞·ª£t qua:

```php
if ( ! $this->is_enabled( 'enable_last_modified_cb' ) ) {
    return '';
}
```

T·ª©c c·∫ßn ph·∫£i b·∫≠t option:

![Show Info on Frontend](option.png "Show Info on Frontend")

## Flow
{{< mermaid >}}
graph TD
A["Contributor adds shortcode [lmt-post-modified-info hide_archive='...'] in post"]
--> B["WordPress loads the post content"]
B --> C["Shortcode::render($atts) is executed"]
C --> D["$atts['hide_archive'] is parsed and trimmed into list of callbacks"]
D --> E["For each $callback in list"]
E --> F{"is_callable($callback)?"}
F -->|Yes| G["Invoke $callback()"]
{{< /mermaid >}}

## Proof of Concept (PoC)
1. D√πng t√†i kho·∫£n Administrator ƒë·ªÉ b·∫≠t option `Show Info on Frontend`
2. ƒêƒÉng nh·∫≠p v·ªõi user **Contributor**
3. T·∫°o post v·ªõi shortcode

```
[lmt-post-modified-info hide_archive=phpinfo]
```

4. Submit v√† preview:

![Result](result.png "K·∫øt qu·∫£")

## Conclusion

L·ªó h·ªïng trong **WP Last Modified Info <= 1.9.4** cho ph√©p **Contributor** ch√®n shortcode v·ªõi t√™n h√†m PHP tu·ª≥ √Ω trong `hide_archive`. C√°c h√†m n√†y ƒë∆∞·ª£c ki·ªÉm tra b·∫±ng `is_callable()` v√† g·ªçi tr·ª±c ti·∫øp, d·∫´n ƒë·∫øn **Remote Code Execution**. B·∫£n v√° 1.9.5 ƒë√£ kh·∫Øc ph·ª•c b·∫±ng c√°ch gi·ªõi h·∫°n ch·ªâ g·ªçi c√°c h√†m an to√†n (whitelist).

## Key Takeaways

* Kh√¥ng g·ªçi h√†m tr·ª±c ti·∫øp t·ª´ input ng∆∞·ªùi d√πng, k·ªÉ c·∫£ v·ªõi `is_callable()`.
* N·∫øu d√πng dynamic callback, lu√¥n d√πng **whitelist**.
* Shortcode l√† ƒëi·ªÉm t·∫•n c√¥ng ti·ªÅm ·∫©n; c·∫ßn ki·ªÉm so√°t input v√† quy·ªÅn ng∆∞·ªùi d√πng.

## References

[Remote Code Execution (RCE)](https://patchstack.com/academy/wordpress/vulnerabilities/remote-code-execution/)

[WordPress WP Last Modified Info Plugin <= 1.9.4 is vulnerable to PHP Object Injection](https://patchstack.com/database/wordpress/plugin/wp-last-modified-info/vulnerability/wordpress-wp-last-modified-info-plugin-1-9-2-remote-code-execution-rce-vulnerability)

---

> T√°c gi·∫£: [Bui Van Y](github.com/w41bu1)  
> URL: http://localhost:1313/vi/posts/2025-12-02-cve-2025-52756/  

