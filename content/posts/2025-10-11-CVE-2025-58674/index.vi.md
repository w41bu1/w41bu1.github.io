---
title: CVE-2025-58674 Analysis & POC
description: Security Vulnerability in WordPress Core.
date: 2025-10-11 19:18:00 +0700
categories: [CVE Analysis]
tags: [analyst, core, xss]
images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
  auto: false
---

<!--more-->

Lá»— há»•ng **Stored Cross Site Scripting(XSS)** xáº£y ra trÃªn WordPress Core trÆ°á»›c phiÃªn báº£n `6.8.3`. NguyÃªn nhÃ¢n do sai xá»­ lÃ½ Ä‘áº§u vÃ o khi sinh trang web Ä‘á»™ng, tÃ¡c Ä‘á»™ng Ä‘áº¿n chá»©c nÄƒng táº¡o menu (`nav menus`)

* **CVE ID**: [CVE-2025-58674](https://www.cve.org/CVERecord?id=CVE-2025-58674)
* **Vulnerability Type**: Cross Site Scripting (XSS)
* **Affected Versions**: <= 6.8.2
* **Patched Versions**: 6.8.3
* **CVSS severity**: Low (5.9)
* **Required Privilege**: Author
* **Product**: [WordPressCore](https://wordpress.org/)

## Requirements

* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **Wordpress Core Versions**: **v6.8.2** (vulnerable) vÃ  **v6.8.3** (patched).
* **Diff Tool** - [**Meld**](https://meldmerge.org/) hoáº·c báº¥t ká»³ cÃ´ng cá»¥ so sÃ¡nh (diff) nÃ o Ä‘á»ƒ kiá»ƒm tra vÃ  so sÃ¡nh khÃ¡c biá»‡t giá»¯a hai phiÃªn báº£n.
* **Theme** - [**Astra**](https://wordpress.org/themes/astra/): Theme ráº¥t phá»• biáº¿n vá»›i ngÆ°á»i dÃ¹ng WordPress, há»— trá»£ táº¡o **nav memu** nhanh chÃ³ng.

## Analysis

WordPress lÃ  pháº§n má»m mÃ£ nguá»“n má»Ÿ, cÃ³ kho lÆ°u trá»¯ náº±m á»Ÿ github nÃªn ta cÃ³ thá»ƒ tÃ¬m Ä‘áº¿n [commit](https://github.com/WordPress/WordPress/commit/e5caef19d3e842cc9c8c94621b223a9a696fb5b3) liÃªn quan Ä‘áº¿n sá»± kiá»‡n vÃ¡ lá»— há»•ng XSS Ä‘á»ƒ quan sÃ¡t sá»± thay Ä‘á»•i, hiá»ƒu Ä‘Æ°á»£c lá»— há»•ng xáº£y ra á»Ÿ Ä‘Ã¢u.

### Patch diff

**Báº£n lá»—i**:

```js
updateParentDropdown : function() {
    return this.each(function(){
        var menuItems = $( '#menu-to-edit li' ),
            parentDropdowns = $( '.edit-menu-item-parent' );

        $.each( parentDropdowns, function() {
            var parentDropdown = $( this ),
                $html = '',
                $selected = '',
                currentItemID = parentDropdown.closest( 'li.menu-item' ).find( '.menu-item-data-db-id' ).val(),
                currentparentID = parentDropdown.closest( 'li.menu-item' ).find( '.menu-item-data-parent-id' ).val(),
                currentItem = parentDropdown.closest( 'li.menu-item' ),
                currentMenuItemChild = currentItem.childMenuItems(),
                excludeMenuItem = [ currentItemID ];

            if ( currentMenuItemChild.length > 0 ) {
                $.each( currentMenuItemChild, function(){
                    var childItem = $(this),
                        childID = childItem.find( '.menu-item-data-db-id' ).val();

                    excludeMenuItem.push( childID );
                });
            }

            if ( currentparentID == 0 ) {
                $selected = 'selected';
            }

            $html += '<option ' + $selected + ' value="0">' + wp.i18n._x( 'No Parent', 'menu item without a parent in navigation menu' ) + '</option>';

            $.each( menuItems, function() {
                var menuItem = $(this),
                $selected = '',
                menuID = menuItem.find( '.menu-item-data-db-id' ).val(),
                menuTitle = menuItem.find( '.edit-menu-item-title' ).val();

                if ( ! excludeMenuItem.includes( menuID ) ) {
                    if ( currentparentID == menuID ) {
                        $selected = 'selected';
                    }
                    $html += '<option ' + $selected + ' value="' + menuID + '">' + menuTitle + '</option>';
                }
            });

            parentDropdown.html( $html );
        });
        
    });
},
```

Trong phiÃªn báº£n lá»—i, giÃ¡ trá»‹ `menuTitle` Ä‘Æ°á»£c chÃ¨n vÃ o tháº» `<option>` vÃ  Ä‘Æ°á»£c hiá»ƒn thá»‹ ra HTML báº±ng phÆ°Æ¡ng thá»©c [html()](https://api.jquery.com/html/) cá»§a **jQuery** mÃ  khÃ´ng cÃ³ báº¥t ká»³ cÆ¡ cháº¿ ngÄƒn cháº·n XSS nÃ o. HÃ m [html()](https://api.jquery.com/html/) dÃ¹ng Ä‘á»ƒ thay tháº¿ ná»™i dung HTML bÃªn trong pháº§n tá»­ hiá»‡n táº¡i, nÃªn náº¿u `menuTitle` chá»©a mÃ£ Ä‘á»™c thÃ¬ mÃ£ Ä‘Ã³ sáº½ Ä‘Æ°á»£c thá»±c thi trÃªn trÃ¬nh duyá»‡t.

**Báº£n vÃ¡**:

```js
updateParentDropdown : function() {
    return this.each(function(){
        var menuItems = $( '#menu-to-edit li' ),
            parentDropdowns = $( '.edit-menu-item-parent' );

        $.each( parentDropdowns, function() {
            var parentDropdown = $( this ),
                currentItemID = parseInt( parentDropdown.closest( 'li.menu-item' ).find( '.menu-item-data-db-id' ).val() ),
                currentParentID = parseInt( parentDropdown.closest( 'li.menu-item' ).find( '.menu-item-data-parent-id' ).val() ),
                currentItem = parentDropdown.closest( 'li.menu-item' ),
                currentMenuItemChild = currentItem.childMenuItems(),
                excludeMenuItem =  /** @type {number[]} */ [ currentItemID ];

            parentDropdown.empty();

            if ( currentMenuItemChild.length > 0 ) {
                $.each( currentMenuItemChild, function(){
                    var childItem = $(this),
                        childID = parseInt( childItem.find( '.menu-item-data-db-id' ).val() );

                    excludeMenuItem.push( childID );
                });
            }

            parentDropdown.append(
                $( '<option>', {
                    value: '0',
                    selected: currentParentID === 0,
                    text: wp.i18n._x( 'No Parent', 'menu item without a parent in navigation menu' ),
                } )
            );

            $.each( menuItems, function() {
                var menuItem = $(this),
                menuID = parseInt( menuItem.find( '.menu-item-data-db-id' ).val() ),
                menuTitle = menuItem.find( '.edit-menu-item-title' ).val();

                if ( ! excludeMenuItem.includes( menuID ) ) {
                    parentDropdown.append(
                        $( '<option>', {
                            value: menuID.toString(),
                            selected: currentParentID === menuID,
                            text: menuTitle,
                        } )
                    );
                }
            });
        });
        
    });
},
```

Báº£n vÃ¡ Ä‘Ã£ kháº¯c phá»¥c lá»— há»•ng báº±ng cÃ¡ch chá»‰ Ä‘á»‹nh rÃµ `menuTitle` Ä‘Æ°á»£c gÃ¡n vÃ o thuá»™c tÃ­nh `text` thay vÃ¬ ná»™i dung HTML.
Äiá»u nÃ y Ä‘áº£m báº£o giÃ¡ trá»‹ cá»§a `menuTitle` Ä‘Æ°á»£c xá»­ lÃ½ nhÆ° vÄƒn báº£n thuáº§n tÃºy, khÃ´ng thá»ƒ chá»©a hoáº·c thá»±c thi mÃ£ JavaScript Ä‘á»™c háº¡i.
Nhá» Ä‘Ã³, dá»¯ liá»‡u Ä‘Æ°á»£c thÃªm vÃ o tháº» `<option>` hoÃ n toÃ n an toÃ n vÃ  loáº¡i bá» kháº£ nÄƒng táº¥n cÃ´ng XSS thÃ´ng qua giÃ¡ trá»‹ `menuTitle`.

{{< figure src="dif.png" caption="So sÃ¡nh sá»± khÃ¡c biá»‡t giá»¯a báº£n lá»—i vÃ  báº£n vÃ¡" >}}

### Vulnerable code

Inpsect code trÃªn trÃ¬nh duyá»‡t ta tháº¥y `menuItems = #menu-to-edit li` lÃ  máº£ng cÃ¡c tháº» `<li>` thuá»™c tháº» `<ul>` cÃ³ `id=menu-to-edit`

{{< figure src="viewsource.png" caption="Inspect code trÃªn trÃ¬nh duyá»‡t" >}}

HÃ m `updateParentDropdown` sáº½ duyá»‡t cÃ¡c tháº» `<li>` láº¥y value cá»§a `<input>` cÃ³ class `edit-menu-item-title`, gÃ¡n giÃ¡ trá»‹ Ä‘Ã³ cho `menuTitle` trong tháº» `<option>` vÃ  hiá»ƒn thá»‹ ra HTML.

{{< figure src="viewsource1.png" caption="Inspect DOM sau khi thÃªm menu" >}}

**TrÃªn UI**:

{{< figure src="UIlist.png" caption="HÃ¬nh áº£nh hiá»ƒn thá»‹ trÃªn giao diá»‡n quáº£n trá»‹" >}}

Trong [commit](https://github.com/WordPress/WordPress/commit/e5caef19d3e842cc9c8c94621b223a9a696fb5b3) cÃ³ má»™t sá»­a Ä‘á»•i tÆ°á»Ÿng chá»«ng lÃ  há»¯u Ã­ch, nhÆ°ng cháº£ cÃ³ Ã­ch cho quÃ¡ trÃ¬nh phÃ¢n tÃ­ch.

{{< figure src="htmlett.png" caption="HTML entity encode (1)" >}}

TÃ´i Ä‘Ã£ sá»­ dá»¥ng `//` Ä‘á»ƒ comment táº¥t cáº£ cÃ¡c dÃ²ng liÃªn quan Ä‘áº¿n `html_entity_decode` cá»§a `origin_title` nhÆ°ng váº«n khai thÃ¡c Ä‘Æ°á»£c. TrÆ°á»›c Ä‘Ã³ tÃ´i Ä‘Ã£ Ä‘áº·t debug Ä‘áº¿n cÃ¡c vá»‹ trÃ­ nÃ y nhÆ°ng khÃ´ng cÃ³ gÃ¬ xáº£y ra.

NgoÃ i viá»‡c sá»­ dá»¥ng comment, tÃ´i Ä‘Ã£ chá»n menu chá»©a XSS payload vÃ  click <kbd>Add to Menu</kbd>, báº¯t request báº±ng **BurpSuite** Ä‘á»ƒ xem giÃ¡ trá»‹ Ä‘Æ°á»£c add cÃ³ Ä‘Æ°á»£c html entity encode khÃ´ng.

{{< figure src="htmlett1.png" caption="HTML entity encode (2)" >}}

`menu-item-title` lÃ  giÃ¡ trá»‹ láº¥y tháº» input cÃ³ name `menu-item[-5][menu-item-title]` tá»« `post-title` Ä‘Æ°á»£c **check** Ä‘á»ƒ thÃªm vÃ o body cá»§a request

```html
<input type="hidden" class="menu-item-title" name="menu-item[-5][menu-item-title]" value="<script>alert(document.domain)</script>">
```

CÃ³ 1 Ä‘iá»u thÃº vá»‹ á»Ÿ Ä‘Ã¢y, trÃ¬nh duyá»‡t láº¥y giÃ¡ trá»‹ Ä‘Ã£ decode html entity Ä‘á»ƒ thÃªm vÃ o request, biáº¿t giÃ¡ trá»‹ tá»« server trÆ°á»›c khi echo ra HTML Ä‘Ã£ Ä‘Æ°á»£c encode

{{< figure src="htmlett2.png" caption="TrÃ¬nh duyá»‡t decode HTML entity trÆ°á»›c khi gá»­i" >}}

ğŸ‘‰ Browser Ä‘Ã£ decode html entity trÆ°á»›c khi hiá»ƒn thá»‹ ra HTML.

TrÃªn DOM, sau khi click <kbd>Add to Menu</kbd> => `attachTabsPanelListeners` Ä‘Æ°á»£c gá»i vÃ  thÃªm giÃ¡ trá»‹ vá»«a **selected** vÃ o bottom cá»§a menu item.

{{< figure src="addbottom.png" caption="ThÃªm item vÃ o cuá»‘i danh sÃ¡ch menu" >}}

ğŸ‘‰ `edit-menu-item-title` cÃ³ giÃ¡ trá»‹ chá»©a XSS payload. HÃ m `updateParentDropdown` sáº½ láº¥y nÃ³ gÃ¡n cho tháº» `<option>` => XSS xáº£y ra

### Sources & Sinks

* **Source**: `post-title` tiÃªu Ä‘á» cá»§a post
* **Sink**: `parentDropdown.html( $html )` cÃ³ thá»ƒ chá»©a HTML Ä‘á»™c háº¡i

```php
$html += '<option ' + $selected + ' value="' + menuID + '">' + menuTitle + '</option>';
```

## Exploit

### Proof of Concept (PoC)

* Sá»­ dá»¥ng tÃ i khoáº£n author, táº¡o post cÃ³ title chá»©a XSS payload
* Admin truy cáº­p endpoint `wp-admin/nav-menus.php` vÃ  thá»±c hiá»‡n add menus tá»« post vá»«a táº¡o
* Sá»± kiá»‡n Javascript Ä‘Æ°á»£c kÃ­ch hoáº¡t

{{< figure src="xss.png" caption="Proof of Concept: XSS" >}}

> Tháº» `<script>` náº±m trong `<option>` thuá»™c `<select>` cÃ³ thá»ƒ thá»±c thi Ä‘Æ°á»£c nhÆ°ng cÃ¡c tháº» khÃ¡c thÃ¬ khÃ´ng, chá»‰ tráº£ vá» text chá»©a trong Ä‘Ã³.
> {: .prompt-info }

* Khi browser parse chuá»—i HTML, `<script>` khÃ´ng náº±m trong flow `<option>` thá»±c sá»± mÃ  parser â€œnháº¥câ€ script ra khá»i `<option>` vÃ  Ä‘Æ°a vÃ o DOM tree.

```html
<select name="" id="">
    <option value="">abc</option>
    <option value=""><script>alert(1)</script></option>
</select>
```

* VÃ¬ tháº¿, script thá»±c thi ngay, cÃ²n `<option>` váº«n tá»“n táº¡i, nhÆ°ng ná»™i dung `<option>` trá»‘ng hoáº·c hiá»ƒn thá»‹ text rá»—ng.

{{< figure src="inspect1.png" caption="Inspect DOM sau khi script Ä‘Æ°á»£c tÃ¡ch" >}}

* Äá»‘i vá»›i cÃ¡c tháº» khÃ¡c

```html
<select name="" id="">
	<option value="">abc</option>
	<option value=""><b>abd</b></option>
</select>
```

- Browser tuÃ¢n thá»§ spec: `<option>` chá»‰ chá»©a text-only.
- Khi parse `<b>` hoáº·c `<img>` trong `<option>`:
    - `<b>` bá»‹ coi lÃ  text => máº¥t tag, chá»‰ hiá»ƒn thá»‹ abd nhÆ° text.
    - `<img>` bá»‹ loáº¡i bá» hoÃ n toÃ n.

{{< figure src="inspect2.png" caption="Inspect: render option vá»›i tháº» inline" >}}

## Conclusion

CVE-2025-58674 cho tháº¥y rá»§i ro khi chÃ¨n dá»¯ liá»‡u ngÆ°á»i dÃ¹ng trá»±c tiáº¿p vÃ o HTML báº±ng `html()` hoáº·c `innerHTML`. `<script>` trong `<option>` Ä‘Æ°á»£c parser tÃ¡ch ra vÃ  thá»±c thi, trong khi cÃ¡c tháº» khÃ¡c bá»‹ bá» hoáº·c coi lÃ  text. Báº£n vÃ¡ sá»­ dá»¥ng thuá»™c tÃ­nh `text` Ä‘á»ƒ Ä‘áº£m báº£o an toÃ n, loáº¡i bá» XSS.

## Key takeaways

* KhÃ´ng ná»‘i chuá»—i HTML tá»« dá»¯ liá»‡u user rá»“i chÃ¨n báº±ng `html()`/`innerHTML`.
* DÃ¹ng API táº¡o element an toÃ n (`option.text`, `document.createElement`).
* LuÃ´n escape/sanitize dá»¯ liá»‡u á»Ÿ cáº£ server vÃ  client.
* Hiá»ƒu hÃ nh vi parser: `<script>` cÃ³ thá»ƒ thoÃ¡t khá»i container inert.

## References

[Cross-site scripting (XSS) cheat sheet â€” PortSwigger](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)

[ WordPress Core <= 6.8.2 is vulnerable to Cross Site Scripting (XSS) ](https://patchstack.com/database/wordpress/wordpress/wordpress/vulnerability/wordpress-wordpress-wordpress-6-8-2-cross-site-scripting-xss-vulnerability)
